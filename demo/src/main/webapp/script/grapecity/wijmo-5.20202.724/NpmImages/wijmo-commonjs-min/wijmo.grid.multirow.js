/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=require("wijmo/wijmo.grid.multirow"),_Cell=function(e){__extends(_Cell,e);function _Cell(t){var o=e.call(this)||this;o._row=o._col=0;o._rowspan=o._colspan=1;wijmo_1.copy(o,t);return o}Object.defineProperty(_Cell.prototype,"row",{get:function(){return this._row},set:function(e){this._row=wijmo_1.asInt(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"col",{get:function(){return this._col},set:function(e){this._col=wijmo_1.asInt(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"colspan",{get:function(){return this._colspan},set:function(e){this._colspan=wijmo_1.asInt(e,!1,!0);wijmo_1.assert(this._colspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"rowspan",{get:function(){return this._rowspan},set:function(e){this._rowspan=wijmo_1.asInt(e,!1,!0);wijmo_1.assert(this._rowspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});return _Cell}(wijmo_grid_1.Column);exports._Cell=_Cell;var _MultiRow=function(e){__extends(_MultiRow,e);function _MultiRow(t,o,r){var i=e.call(this,t)||this;i._idxData=o;i._idxRecord=r;return i}Object.defineProperty(_MultiRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRow}(wijmo_grid_1.Row);exports._MultiRow=_MultiRow;var _MultiGroupRow=function(e){__extends(_MultiGroupRow,e);function _MultiGroupRow(t,o){var r=e.call(this,t)||this;r._idxRecord=o;return r}Object.defineProperty(_MultiGroupRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});Object.defineProperty(_MultiGroupRow.prototype,"hasChildren",{get:function(){return!0},enumerable:!0,configurable:!0});_MultiGroupRow.prototype.getCellRange=function(){var t=this._getLastRowInHeader();return t!=this?t.getCellRange():e.prototype.getCellRange.call(this)};Object.defineProperty(_MultiGroupRow.prototype,"isCollapsed",{get:function(){return this._getLastRowInHeader()._getFlag(wijmo_grid_1.RowColFlags.Collapsed)},set:function(e){var t=this._getLastRowInHeader();e!=t.isCollapsed&&null!=t._list&&t._setCollapsed(wijmo_1.asBoolean(e))},enumerable:!0,configurable:!0});_MultiGroupRow.prototype._setCollapsed=function(e){var t=this,o=this.grid,r=o.rows,i=this.getCellRange(),n=new wijmo_grid_1.CellRangeEventArgs(o.cells,new wijmo_grid_1.CellRange(this.index,-1));if(o.onGroupCollapsedChanging(n)){o.deferUpdate((function(){r.deferUpdate((function(){t._setFlag(wijmo_grid_1.RowColFlags.Collapsed,e,!0);for(var o=i.topRow+1;o<=i.bottomRow&&o>-1&&o<r.length;o++){r[o]._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,e,!0);var n=r[o];if(n instanceof _MultiGroupRow){var l=n._getLastRowInHeader();for(o+=1;o<=l.index;o++)(n=r[o])._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,e,!0);o--}n instanceof wijmo_grid_1.GroupRow&&n.isCollapsed&&(o=n.getCellRange().bottomRow)}}))}));o.onGroupCollapsedChanged(n)}};_MultiGroupRow.prototype._getLastRowInHeader=function(){var e=this.grid,t=this;if(e.multiRowGroupHeaders)for(var o=e.rows,r=this.dataItem,i=this.index+1;i<o.length&&o[i].dataItem==r;i++)t=o[i];wijmo_1.assert(t instanceof _MultiGroupRow,"last row in header should be a _MultiRowGroup");return t};return _MultiGroupRow}(wijmo_grid_1.GroupRow);exports._MultiGroupRow=_MultiGroupRow;var MultiRow=function(e){__extends(MultiRow,e);function MultiRow(t,o){var r=e.call(this,t)||this;r._centerVert=!0;r._collapsedHeaders=!1;r._multiRowGroupHeaders=!1;r._rowHdrCnt=0;r.collapsedHeadersChanging=new wijmo_1.Event;r.collapsedHeadersChanged=new wijmo_1.Event;r._layout=new _MultiRowLayout(r,null);wijmo_1.addClass(r.hostElement,"wj-multirow");var i=r.columnHeaders.hostElement.parentElement,n=wijmo_1.createElement('<div class="wj-hdr-collapse"><span></span></div>');n.style.display="none";i.appendChild(n);r._btnCollapse=n;r._updateButtonGlyph();r.addEventListener(n,"mousedown",(function(e){switch(r.collapsedHeaders){case null:case!1:r._collapsedHeadersWasNull=null==r.collapsedHeaders;r.collapsedHeaders=!0;break;case!0:r.collapsedHeaders=!!r._collapsedHeadersWasNull&&null}e.preventDefault();r.focus()}),!0);var l=r.hostElement;r.addEventListener(l,"mousedown",(function(e){if(!r._mouseHdl._szRowCol){var t=r._layout?r._layout._bindingGroups:null;if(t&&t[0].isRowHeader){var o=r.hitTest(e);if(o.panel==r.columnHeaders&&o.col<r.frozenColumns){e.preventDefault();r.selectAll()}}}}),!0);r.removeEventListener(l,"dragover");r.removeEventListener(l,"dragleave");r.removeEventListener(l,"dragdrop");r._addHdl=new _MultiRowAddNewHandler(r);r.formatItem.addHandler(r._formatItem,r);r.autoGenerateColumns=!1;r.allowDragging=wijmo_grid_1.AllowDragging.None;r.mergeManager=new _MergeManager(r);r.initialize(o);return r}MultiRow.prototype._getProductInfo=function(){return"H87K,MultiRow"};Object.defineProperty(MultiRow.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(e){this._layoutDef=wijmo_1.asArray(e);this._layout=new _MultiRowLayout(this,e);this._rowHdrCnt=0;if(this._layout)for(var t=this._layout._bindingGroups,o=0;o<t.length;o++){var r=t[o];if(!r.isRowHeader)break;this._rowHdrCnt=r._colstart+r.colspan;r.cells.forEach((function(e){e.isReadOnly=!0;!e.header||e.binding||e.cellTemplate||(e.cellTemplate=e.header);e.cssClass?e.cssClass.indexOf("wj-header")<0&&(e.cssClass+=" wj-header"):e.cssClass="wj-header"}))}this.frozenColumns=this._rowHdrCnt;this._bindGrid(!0);this._rowHdrCnt&&this.selectionMode&&this.select(this.selection.row,this._rowHdrCnt)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"headerLayoutDefinition",{get:function(){return this._hdrLayoutDef},set:function(e){this._hdrLayoutDef=wijmo_1.asArray(e);this._hdrLayout=e?new _MultiRowLayout(this,e):null;this._bindGrid(!0)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"rowsPerItem",{get:function(){return this._layout._rowsPerItem},enumerable:!0,configurable:!0});MultiRow.prototype.getBindingColumn=function(e,t,o){return this._getBindingColumn(e,t,e.columns[o])};MultiRow.prototype.getColumn=function(t){if(wijmo_1.isString(t)){for(var o=this._layout._bindingGroups,r=null,i=0;i<o.length&&!r;i++)r=o[i].getColumn(t);return r}return e.prototype.getColumn.call(this,t)};Object.defineProperty(MultiRow.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(e){if(e!=this._centerVert){this._centerVert=wijmo_1.asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"collapsedHeaders",{get:function(){return this._collapsedHeaders},set:function(e){if(e!=this._collapsedHeaders){var t=new wijmo_1.CancelEventArgs;if(this.onCollapsedHeadersChanging(t)){this._collapsedHeaders=wijmo_1.asBoolean(e,!0);this._updateCollapsedHeaders();this._updateButtonGlyph();this.onCollapsedHeadersChanged(t)}}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"showHeaderCollapseButton",{get:function(){return""==this._btnCollapse.style.display},set:function(e){e!=this.showHeaderCollapseButton&&(this._btnCollapse.style.display=wijmo_1.asBoolean(e)?"":"none")},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"multiRowGroupHeaders",{get:function(){return this._multiRowGroupHeaders},set:function(e){if(e!=this._multiRowGroupHeaders){this._multiRowGroupHeaders=wijmo_1.asBoolean(e);this._bindGrid(!0)}},enumerable:!0,configurable:!0});MultiRow.prototype.onCollapsedHeadersChanging=function(e){this.collapsedHeadersChanging.raise(this,e);return!e.cancel};MultiRow.prototype.onCollapsedHeadersChanged=function(e){this.collapsedHeadersChanged.raise(this,e)};Object.defineProperty(MultiRow.prototype,"allowPinning",{get:function(){return!1},set:function(e){wijmo_1.assert(!e,"MultiRow does not support pinning.")},enumerable:!0,configurable:!0});MultiRow.prototype.onSelectionChanging=function(t){var o=t._rng;if(o&&o.isValid&&this.selectionMode){var r=this._mouseHdl._htDown,i=this.rows,n=this.columns,l=this._rowHdrCnt;if(l){o.col=Math.max(o.col,l);o.col2=Math.max(o.col2,l)}if(r&&(r.panel==this.rowHeaders||r.panel==this.cells&&r.col<l)){var a=i[o.topRow],s=i[o.bottomRow];if(a&&null!=a.recordIndex){var u=a.index-a.recordIndex,_=s instanceof _MultiGroupRow&&!this._multiRowGroupHeaders?1:this.rowsPerItem,d=s.index-s.recordIndex+_-1,p=n.length-1,c=o.row!=o.topRow?new wijmo_grid_1.CellRange(d,0,u,p):new wijmo_grid_1.CellRange(u,0,d,p);o.row=c.row;o.row2=c.row2;o.col2=p;switch(this.selectionMode){case wijmo_grid_1.SelectionMode.Cell:o.row2=c.row;o.col2=c.col;break;case wijmo_grid_1.SelectionMode.Row:o.row2=c.row}}}}return e.prototype.onSelectionChanging.call(this,t)};MultiRow.prototype._getDeleteColumnIndex=function(){return this._rowHdrCnt};MultiRow.prototype._getQuickAutoSize=function(){return wijmo_1.isBoolean(this.quickAutoSize)?this.quickAutoSize:this.formatItem.handlerCount<=1&&null==this.itemFormatter};MultiRow.prototype._addBoundRow=function(e,t){for(var o=e[t],r=0;r<this.rowsPerItem;r++)this.rows.push(new _MultiRow(o,t,r))};MultiRow.prototype._addNode=function(e,t,o){this._addBoundRow(e,t)};MultiRow.prototype._addGroupRow=function(e){for(var t=this._multiRowGroupHeaders?this.rowsPerItem:1,o=0;o<t;o++)this.rows.push(new _MultiGroupRow(e,o))};MultiRow.prototype._bindColumns=function(){for(var e=this,t=this.columnHeaders.rows,o=this._layout,r=this._hdrLayout,i=(r?r._rowsPerItem:this.rowsPerItem)+1;t.length>i;)t.removeAt(t.length-1);for(;t.length<i;)t.push(new wijmo_grid_1.Row);this._updateCollapsedHeaders();this.columns.clear();o&&o._bindingGroups.forEach((function(t){for(var _loop_1=function(o){for(var r=new wijmo_grid_1.Column,_loop_2=function(e){var i=t.cells[e];if(i._col==o){"width,minWidth,maxWidth,binding,header,format,dataMap,name,aggregate,cellTemplate".split(",").forEach((function(e){null!=i[e]&&(r[e]=i[e])}));return"break"}},i=0;i<t.cells.length;i++){if("break"===_loop_2(i))break}e.columns.push(r)},o=0;o<t._colspan;o++)_loop_1(o)}))};MultiRow.prototype._updateCollapsedHeaders=function(){var e=this.columnHeaders.rows,t=this.collapsedHeaders;e[0].visible=0!=t;for(var o=1;o<e.length;o++)e[o].visible=1!=t};MultiRow.prototype._updateColumnTypes=function(){e.prototype._updateColumnTypes.call(this);var t=this.collectionView;if(wijmo_1.hasItems(t)){var o=t.items[0];this._layout&&this._layout._updateCellTypes(o);this._hdrLayout&&this._hdrLayout._updateCellTypes(o)}};MultiRow.prototype._getBindingColumn=function(e,t,o){if(e==this.cells||e==this.columnHeaders){var r=e.cellType==wijmo_grid_1.CellType.ColumnHeader;r&&t--;o=this._getGroupByColumn(o.index,r).getBindingColumn(e,t,o.index)}return o};MultiRow.prototype._getBindingColumns=function(){var e=[];this._layout._bindingGroups.forEach((function(t){t._cols.forEach((function(t){e.indexOf(t)<0&&e.push(t)}))}));return e};MultiRow.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var o=wijmo_1.NotifyCollectionChangedAction;switch(t.action){case o.Change:this.invalidate();break;case o.Add:if(t.index==this.collectionView.items.length-1){for(var r=this.rows.length;r>0&&this.rows[r-1]instanceof wijmo_grid_1._NewRowTemplate;)r--;for(var i=0;i<this.rowsPerItem;i++)this.rows.insert(r+i,new _MultiRow(t.item,t.index,i));return}wijmo_1.assert(!1,"added item should be the last one.");break;default:this._bindGrid(!1)}}};MultiRow.prototype._getGroupByColumn=function(e,t){var o=null;t&&this._hdrLayout&&!this.collapsedHeaders&&(o=this._hdrLayout._getGroupByColumn(e));o||(o=this._layout._getGroupByColumn(e));wijmo_1.assert(o instanceof _CellGroup,"Failed to get the group!");return o};MultiRow.prototype._formatItem=function(e,t){var o=this.rowsPerItem,r=t.panel,i=r.cellType,n=r.rows[t.range.row],l=r.rows[t.range.row2],a=t.cell;i==wijmo_grid_1.CellType.ColumnHeader&&wijmo_1.toggleClass(a,"wj-group-header",0==t.range.row);if(i==wijmo_grid_1.CellType.Cell||i==wijmo_grid_1.CellType.ColumnHeader){var s=this._getGroupByColumn(t.col,i==wijmo_grid_1.CellType.ColumnHeader);wijmo_1.toggleClass(a,"wj-group-start",s._colstart==t.range.col);wijmo_1.toggleClass(a,"wj-group-end",s._colstart+s._colspan-1==t.range.col2)}if(o>1&&(i==wijmo_grid_1.CellType.Cell||i==wijmo_grid_1.CellType.RowHeader)){var u=n instanceof _MultiRow||n instanceof _MultiRowNewRowTemplate,_=l instanceof _MultiRow||l instanceof _MultiRowNewRowTemplate;wijmo_1.toggleClass(a,"wj-record-start",!!u&&0==n.recordIndex);wijmo_1.toggleClass(a,"wj-record-end",!!_&&l.recordIndex==o-1)}var d=this.alternatingRowStep;if(d){var p=!1;if(n instanceof _MultiRow){p=n.dataIndex%(d+1)==0;1==d&&(p=!p)}wijmo_1.toggleClass(a,"wj-alt",p)}if(this._centerVert&&!a.getAttribute("wj-state-measuring")){var c=!1;if(a.innerHTML&&t.range.rowSpan>1){c=!0;if(0==a.childElementCount)a.innerHTML="<div>"+a.innerHTML+"</div>";else{var w=document.createElement("div"),h=document.createRange();h.selectNodeContents(a);h.surroundContents(w)}}wijmo_1.toggleClass(a,"wj-center-vert",c)}};MultiRow.prototype._updateButtonGlyph=function(){var e=this._btnCollapse.querySelector("span");e instanceof HTMLElement&&(e.className=this.collapsedHeaders?"wj-glyph-left":"wj-glyph-down-left")};MultiRow.prototype._getError=function(t,o,r,i){if(wijmo_1.isFunction(this.itemValidator)&&t==this.rowHeaders)for(var n=0;n<this.rowsPerItem;n++)for(r=0;r<this.columns.length;r++){var l=this.itemValidator(o+n,r,i);if(l)return l}return e.prototype._getError.call(this,t,o,r,i)};return MultiRow}(wijmo_grid_1.FlexGrid);exports.MultiRow=MultiRow;var _MultiRowAddNewHandler=function(e){__extends(_MultiRowAddNewHandler,e);function _MultiRowAddNewHandler(t){t._addHdl._detach();return e.call(this,t)||this}_MultiRowAddNewHandler.prototype.updateNewRowTemplate=function(){for(var e=this._g.editableCollectionView,t=this._g,o=t.rows,r=e&&e.canAddNew&&t.allowAddNew&&!t.isReadOnly,i=-1,n=0;n<o.length;n+=t.rowsPerItem)if(o[n]instanceof _MultiRowNewRowTemplate){i=n;break}if(r&&i>-1&&(this._top&&i>0||!this._top&&0==i)){i=-1;this._removeNewRowTemplate()}if(r&&i<0)for(n=0;n<t.rowsPerItem;n++){var l=new _MultiRowNewRowTemplate(n);this._top?o.insert(n,l):o.push(l)}!r&&i>-1&&this._removeNewRowTemplate()};_MultiRowAddNewHandler.prototype._keydown=function(t){e.prototype._keydown.call(this,t);t.defaultPrevented||t.keyCode!=wijmo_1.Key.Escape||this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._rowEditEnded=function(t,o){e.prototype._rowEditEnded.call(this,t,o);this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._beginningEdit=function(t,o){e.prototype._beginningEdit.call(this,t,o);this._top&&!t.rows[0].dataItem&&this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._copyNewDataItem=function(){if(this._top)for(var e=this._g,t=e.rows,o=0;o<e.rowsPerItem;o++)t[o]instanceof wijmo_grid_1._NewRowTemplate&&(t[o].dataItem=this._nrt.dataItem)};_MultiRowAddNewHandler.prototype._removeNewRowTemplate=function(){for(var e=0,t=this._g.rows;e<t.length;e++)if(t[e]instanceof wijmo_grid_1._NewRowTemplate){t.removeAt(e);e--}};return _MultiRowAddNewHandler}(wijmo_grid_1._AddNewHandler);exports._MultiRowAddNewHandler=_MultiRowAddNewHandler;var _MultiRowNewRowTemplate=function(e){__extends(_MultiRowNewRowTemplate,e);function _MultiRowNewRowTemplate(t){var o=e.call(this)||this;o._idxRecord=t;return o}Object.defineProperty(_MultiRowNewRowTemplate.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRowNewRowTemplate}(wijmo_grid_1._NewRowTemplate);exports._MultiRowNewRowTemplate=_MultiRowNewRowTemplate;var _CellGroup=function(e){__extends(_CellGroup,e);function _CellGroup(t,o){var r=e.call(this)||this;r._isRowHeader=!1;r._colstart=0;r._layout=t;r._g=t._grid;wijmo_1.copy(r,o);if(!r._cells)throw"Cell group with no cells?";var i=0,n=0;r._cells.forEach((function(e,t){for(;!r._cellFits(e,t,i,n);)0==(n=(n+1)%r.colspan)&&i++;e.row=i;e.col=n}));var l=1,a=1;r._cells.forEach((function(e){l=Math.max(l,e.row+e.rowspan);a=Math.max(a,e.col+e.colspan)}));r.rowspan=l;r.colspan=a;return r}_CellGroup.prototype._copy=function(e,t){var o=this;if("cells"==e){this._cells=[];wijmo_1.isArray(t)&&t.forEach((function(e){var t=new _Cell(e);t.binding&&!t.header&&(t.header=wijmo_1.toHeaderCase(t.binding));o._cells.push(t);o.colspan=Math.max(o.colspan,t.colspan)}));return!0}return!1};Object.defineProperty(_CellGroup.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});Object.defineProperty(_CellGroup.prototype,"isRowHeader",{get:function(){return this._isRowHeader},set:function(e){this._isRowHeader=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});_CellGroup.prototype.closeGroup=function(e){var t=this;if(e>this.rowspan){this._cells.forEach((function(o){o.row==t.rowspan-1&&(o.rowspan=e-o.row)}));this.rowspan=e}this._cells.forEach((function(e){for(;e.col+e.colspan<t.colspan&&!t._slotTaken(e.row,e.col+e.colspan);)e.colspan++}));this._cells.forEach((function(e){for(;e.row+e.rowspan<t.rowspan&&!t._slotTaken(e.row+e.rowspan,e.col);)e.rowspan++}));for(var o=0;o<this.rowspan;o++)for(var r=0;r<this.colspan;r++)wijmo_1.assert(this._slotTaken(o,r),"Invalid layout (empty cells).");this._cols=new wijmo_grid_1.ColumnCollection(this._g,this._g.columns.defaultSize);this._rng=new Array(e*this.colspan);this._cells.forEach((function(e){for(var o=0;o<e.rowspan;o++)for(var r=0;r<e.colspan;r++){var i=(e.row+o)*t.colspan+e.col+r;t._cols.setAt(i,e);var n=new wijmo_grid_1.CellRange(0-o,0-r,0-o+e.rowspan-1,0-r+e.colspan-1);n.isSingleCell||(t._rng[i]=n)}}));var i=this._colstart;this._rng[-1]=new wijmo_grid_1.CellRange(0,i,0,i+this.colspan-1);this._hasAggregates=!1;for(var n=0;n<this._cells.length&&!this._hasAggregates;n++)this._hasAggregates=0!=this._cells[n].aggregate};_CellGroup.prototype.getColumnWidth=function(e){for(var t=0;t<this._cells.length;t++){var o=this._cells[t];if(o.col==e&&1==o.colspan)return o.width}return null};_CellGroup.prototype.getMergedRange=function(e,t,o){if(t<0)return this._rng[-1];var r=e.rows[t],i=null!=r.recordIndex?r.recordIndex:t%this.rowspan,n=o-this._colstart,l=this._rng[i*this.colspan+n];e.cellType==wijmo_grid_1.CellType.ColumnHeader&&t++;if(e.cellType==wijmo_grid_1.CellType.Cell&&r instanceof _MultiGroupRow){var a=e.grid;if(a.multiRowGroupHeaders&&!this._hasAggregates){var s=a._layout._bindingGroups,u=s.indexOf(this),_=a.rowsPerItem;(l=new wijmo_grid_1.CellRange(Math.floor(t/_)*_,this._colstart)).row2+=_-1;l.col2+=this.colspan-1;for(var d=u-1;d>=0&&!s[d]._hasAggregates;d--)l.col-=s[d].colspan;for(var p=u+1;p<s.length&&!s[p]._hasAggregates;p++)l.col2+=s[p].colspan;return l}}return l?new wijmo_grid_1.CellRange(t+l.row,o+l.col,t+l.row2,o+l.col2):null};_CellGroup.prototype.getBindingColumn=function(e,t,o){if(t<0)return this;var r=e.rows[t],i=r&&null!=r.recordIndex?r.recordIndex:t%this.rowspan,n=o-this._colstart;return this._cols[i*this.colspan+n]};_CellGroup.prototype.getColumn=function(e){return this._cols.getColumn(e)};_CellGroup.prototype._cellFits=function(e,t,o,r){if(r>0&&r+e.colspan>this.colspan)return!1;for(var i=0;i<e.colspan;i++)if(this._slotTaken(o,r+i,t))return!1;this.colspan=Math.max(this.colspan,r+e.colspan-1);return!0};_CellGroup.prototype._slotTaken=function(e,t,o){void 0===o&&(o=this._cells.length);for(var r=0;r<o;r++){var i=this._cells[r];if(e>=i.row&&e<=i.row+i.rowspan-1&&t>=i.col&&t<=i.col+i.colspan-1)return!0}return!1};return _CellGroup}(_Cell);exports._CellGroup=_CellGroup;var _MergeManager=function(e){__extends(_MergeManager,e);function _MergeManager(){return null!==e&&e.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(t,o,r,i){void 0===i&&(i=!0);var n=t.grid;if(o<0||o>=t.rows.length||r<0||r>=t.columns.length)return null;switch(t.cellType){case wijmo_grid_1.CellType.Cell:case wijmo_grid_1.CellType.RowHeader:if(t.rows[o]instanceof wijmo_grid_1.GroupRow&&!n.multiRowGroupHeaders)return e.prototype.getMergedRange.call(this,t,o,r,i)}switch(t.cellType){case wijmo_grid_1.CellType.Cell:case wijmo_grid_1.CellType.ColumnHeader:var l=t.cellType==wijmo_grid_1.CellType.ColumnHeader,a=n._getGroupByColumn(r,l);wijmo_1.assert(a instanceof _CellGroup,"Failed to get the group!");var s=l?a.getMergedRange(t,o-1,r):a.getMergedRange(t,o,r),u=t.columns.frozen;if(u&&s&&s.columnSpan>1&&s.col<u&&s.col2>=u){s=s.clone();r<u?s.col2=u-1:s.col=u}var _=t.rows.frozen;if(_&&s&&s.rowSpan>1&&t.cellType==wijmo_grid_1.CellType.Cell&&s.row<_&&s.row2>=_){s=s.clone();o<_?s.row2=_-1:s.row=_}wijmo_1.assert(!s||s.contains(o,r),"Merged range must contain source cell");return s;case wijmo_grid_1.CellType.RowHeader:var d=n.rowsPerItem,p=o-t.rows[o].recordIndex,c=Math.min(p+d-1,t.rows.length-1);return new wijmo_grid_1.CellRange(p,0,c,t.columns.length-1);case wijmo_grid_1.CellType.TopLeft:return new wijmo_grid_1.CellRange(0,0,t.rows.length-1,t.columns.length-1)}return null};return _MergeManager}(wijmo_grid_1.MergeManager);exports._MergeManager=_MergeManager;var _MultiRowLayout=function(){function _MultiRowLayout(e,t){this._rowsPerItem=1;this._bindingGroups=[];this._groupsByColumn={};this._grid=e;this._bindingGroups=this._parseCellGroups(t)}_MultiRowLayout.prototype._parseCellGroups=function(e){var t=[],o=1;if(e){for(var r=0,i=0;r<e.length;r++){var n=new _CellGroup(this,e[r]);n._colstart=i;i+=n._colspan;o=Math.max(o,n._rowspan);t.push(n)}t.forEach((function(e){e.closeGroup(o)}));this._rowsPerItem=o}return t};_MultiRowLayout.prototype._getGroupByColumn=function(e){var t=this._groupsByColumn[e];if(!t)for(var o=this._bindingGroups,r=0;r<o.length;r++)if(e>=(t=o[r])._colstart&&e<=t._colstart+t._colspan-1){this._groupsByColumn[e]=t;break}return t};_MultiRowLayout.prototype._updateCellTypes=function(e){this._bindingGroups.forEach((function(t){t._cols.forEach((function(t){null==t.dataType&&t._binding&&(t.dataType=wijmo_1.getType(t._binding.getValue(e)));if(!t.isReadOnly){var o=wijmo_1.isIE()?null:Object.getOwnPropertyDescriptor(e,t.binding);t.isReadOnly=o&&!o.writable&&!o.set}}))}))};return _MultiRowLayout}();exports._MultiRowLayout=_MultiRowLayout;wijmo_1._registerModule("wijmo.grid.multirow",selfModule);