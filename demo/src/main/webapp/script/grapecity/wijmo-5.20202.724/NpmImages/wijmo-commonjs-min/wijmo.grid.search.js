/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=require("wijmo/wijmo.grid.search"),FlexGridSearch=function(e){__extends(FlexGridSearch,e);function FlexGridSearch(t,i){var r=e.call(this,t)||this;r._delay=wijmo_1.Control._SEARCH_DELAY;r._cssMatch="wj-state-match";r._rxSearch=null;r._rxHighlight=null;var n=r.getTemplate();r.applyTemplate("wj-control wj-content wj-flexgridsearch",n,{_tbx:"input",_btn:"btn"},"input");r._filterBnd=r._filter.bind(r);r._tbx.addEventListener("input",(function(){r._toSearch&&clearTimeout(r._toSearch);r._toSearch=setTimeout((function(){r._toSearch=null;r._applySearch()}),r._delay)}));r._btn.addEventListener("click",(function(){r._toSearch&&clearTimeout(r._toSearch);r._toSearch=null;r._tbx.value="";r._applySearch();r.containsFocus()&&r._tbx.focus()}));r.initialize(i);return r}Object.defineProperty(FlexGridSearch.prototype,"grid",{get:function(){return this._g},set:function(e){if((e=wijmo_1.asType(e,wijmo_grid_1.FlexGrid,!0))!=this._g){var t=this._g;if(t){t.formatItem.removeHandler(this._formatItem);t.itemsSourceChanged.removeHandler(this._itemsSourceChanged)}t=this._g=e;this._itemsSourceChanged();if(t){t.formatItem.addHandler(this._formatItem,this);t.itemsSourceChanged.addHandler(this._itemsSourceChanged,this)}}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"inputElement",{get:function(){return this._tbx},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"text",{get:function(){return this._tbx.value},set:function(e){if(e!=this.text){this._tbx.value=wijmo_1.asString(e);this._applySearch()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"delay",{get:function(){return this._delay},set:function(e){this._delay=wijmo_1.asNumber(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"placeholder",{get:function(){return this._tbx.placeholder},set:function(e){this._tbx.placeholder=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"cssMatch",{get:function(){return this._cssMatch},set:function(e){this._cssMatch=wijmo_1.asString(e)},enumerable:!0,configurable:!0});FlexGridSearch.prototype._formatItem=function(e,t){if(this._rxHighlight&&this._cssMatch&&t.panel==e.cells&&!t.getColumn()._getFlag(wijmo_grid_1.RowColFlags.HasTemplate)&&!t.cell.querySelector("input")){var i=t.cell.innerHTML;this._rxHighlight.test(i)&&(t.cell.innerHTML=i.replace(this._rxHighlight,'<span class="'+this._cssMatch+'">$1</span>'))}};FlexGridSearch.prototype._itemsSourceChanged=function(){this._view&&this._view.filters.remove(this._filterBnd);var e=this._g?this._g.collectionView:null;this._view=e instanceof wijmo_1.CollectionView?e:null;this._view&&this._view.filters.push(this._filterBnd)};FlexGridSearch.prototype._applySearch=function(){var e=this._g;this._rxSearch=this._rxHighlight=null;var t=wijmo_1.escapeRegExp(this.text).split(" ").filter((function(e){return e}));if(t.length){var i=e&&e.caseSensitiveSearch?"g":"gi";this._rxSearch=new RegExp("(?=.*"+t.join(")(?=.*")+")",i);this._rxHighlight=new RegExp("("+t.join("|")+")(?![^<]*>)",i)}var r=e?e.collectionView:null;r instanceof wijmo_1.CollectionView&&r.refresh()};FlexGridSearch.prototype._filter=function(e){if(this._rxSearch&&this._g){var t=this._getItemText(e);return this._rxSearch.test(t)}return!0};FlexGridSearch.prototype._getItemText=function(e){for(var t=[],i=this._g._getBindingColumns(),r=0;r<i.length;r++){var n=i[r],o=n._binding;if(o){var a=o.getValue(e);a=n.dataMap?n.dataMap.getDisplayValue(a):wijmo_1.Globalize.format(a,n.format);t.push(a)}}return t.join(" ")};FlexGridSearch.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span wj-part="btn" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1">&times</button></span></div></div></div>';return FlexGridSearch}(wijmo_1.Control);exports.FlexGridSearch=FlexGridSearch;wijmo_1._registerModule("wijmo.grid.search",selfModule);