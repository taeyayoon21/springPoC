/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),selfModule=require("wijmo/wijmo.barcode"),alignmentMap={center:"middle",left:"start",right:"end"};class SVGRenderContext{constructor(t,e,i){this.dom=t;this.style=e;this.scale=i;this.color="rgb(0,0,0)";this.addGroup()}setColor(t){this.color=t}setBackgroundColor(t){const{dom:e}=this;e.style.backgroundColor=t}addGroup(){const{dom:t}=this;this.g=document.createElementNS("http://www.w3.org/2000/svg","g");this.g.setAttribute("shape-rendering","crispEdges");t.appendChild(this.g)}drawRect(t){const{g:e,scale:i,color:o}=this,r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",(t.x*i).toString());r.setAttribute("y",(t.y*i).toString());r.setAttribute("width",(t.width*i).toString());r.setAttribute("height",(t.height*i).toString());r.style.fill=o;e.appendChild(r)}drawText(t){const{g:e,scale:i,color:o,style:r}=this,s=document.createElementNS("http://www.w3.org/2000/svg","text");s.style.fill=o;s.style.fontSize=r.fontSize;s.style.fontFamily=r.fontFamily;s.style.fontStyle=t.fontStyle||r.fontStyle;s.style.fontWeight=t.fontWeight||r.fontWeight;s.style.textDecoration=t.textDecoration||r.textDecoration;s.style.textAnchor=alignmentMap[t.textAlign||r.textAlign];s.textContent=t.text;s.textContent=this.clipString(t,s);const n=this._measureText(s);s.setAttribute("y",(t.y*i+Math.abs(n.y)).toString());s.setAttribute("x",(t.x*i).toString());e.appendChild(s)}clipString(t,e){const{scale:i}=this;let{text:o,maxWidth:r}=t;const s=this._measureText(e);r*=i;if(s.width>r){const e=Math.floor(r/s.width*o.length);return t.text.substr(0,e)}return o}clear(){const{dom:t}=this;t.removeChild(this.g);this.addGroup()}_measureText(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg");e.style.visibility="hidden";e.style.position="absolute";t.setAttribute("x",0);t.setAttribute("y",0);e.appendChild(t);document.body.appendChild(e);const i=t.getBBox();document.body.removeChild(e);return i}getDataUrl(){return"data:image/svg+xml;base64,"+btoa(this.dom.outerHTML)}}exports.SVGRenderContext=SVGRenderContext;class CanvasRenderContext{constructor(t,e,i){this.dom=t;this.style=e;this.ctx=this.dom.getContext("2d");this.scale=i}setColor(t){this.ctx.fillStyle=t}setBackgroundColor(t){const{ctx:e,dom:i}=this;e.save();e.fillStyle=t;e.fillRect(0,0,i.width,i.height);e.restore()}drawRect(t){const{ctx:e,scale:i}=this;e.fillRect(t.x*i,t.y*i,t.width*i,t.height*i)}drawText(t){const{ctx:e,style:i,scale:o}=this;e.save();e.font=`${t.fontStyle||i.fontStyle} ${t.fontWeight||i.fontWeight} ${i.fontSize} ${i.fontFamily}`;e.textAlign=t.textAlign||i.textAlign;e.textBaseline="bottom";const r=t.x*o,s=t.y*o,n=this.clipString(t);e.fillText(n,r,s+i.fontHeight);this.drawTextDecorationLine(n,r,s,t.textDecoration||i.textDecoration);e.restore()}clipString(t){const{ctx:e,scale:i}=this;let{text:o,maxWidth:r}=t;const s=e.measureText(o);r*=i;if(s.width>r){const e=Math.floor(r/s.width*o.length);return t.text.substr(0,e)}return o}drawTextDecorationLine(t,e,i,o){let r;switch(o){case"underline":r=.9;break;case"overline":r=.1;break;case"line-through":r=.5;break;default:return}const{ctx:s,style:{fontHeight:n}}=this;let a=s.measureText(t).width;switch(s.textAlign){case"center":e-=a/2;break;case"right":e-=a}s.lineWidth=1;s.beginPath();let h=n*r+i;s.moveTo(e,h);s.lineTo(e+a,h);s.stroke()}clear(){const{ctx:t,dom:e}=this;t.clearRect(0,0,e.width,e.height)}getImageData(){const{ctx:t,dom:e}=this;return t.getImageData(0,0,e.width,e.height)}getDataUrl(){return this.dom.toDataURL()}}exports.CanvasRenderContext=CanvasRenderContext;var _errorCode;!function(t){t[t.Unknown=0]="Unknown";t[t.InvalidOptions=1]="InvalidOptions";t[t.InvalidBarcodeType=2]="InvalidBarcodeType";t[t.InvalidRenderType=3]="InvalidRenderType";t[t.MethodNotImplement=4]="MethodNotImplement";t[t.InvalidText=5]="InvalidText";t[t.InvalidCharacter=6]="InvalidCharacter";t[t.TextTooLong=7]="TextTooLong";t[t.GroupSizeOverflow=8]="GroupSizeOverflow"}(_errorCode=exports._errorCode||(exports._errorCode={}));class BaseException extends Error{constructor(t){super();this.code=t||_errorCode.Unknown}}exports.BaseException=BaseException;exports.ErrorCode=_errorCode;class InvalidOptionsException extends BaseException{constructor(t,e=""){super(_errorCode.InvalidOptions);this.name="InvalidOptionsException";this.message=`${JSON.stringify(t)} is not valid options. ${e}`;this.descriptor={source:t,message:this.message}}}exports.InvalidOptionsException=InvalidOptionsException;class InvalidBarcodeTypeException extends BaseException{constructor(t){super(_errorCode.InvalidBarcodeType);this.name="InvalidBarcodeTypeException";this.message=`${t} is not support!`;this.descriptor={source:t,message:this.message}}}exports.InvalidBarcodeTypeException=InvalidBarcodeTypeException;class InvalidRenderException extends BaseException{constructor(t){super(_errorCode.InvalidRenderType);this.name="InvalidRenderException";this.message=`${t} is not support!`;this.descriptor={source:t,message:this.message}}}exports.InvalidRenderException=InvalidRenderException;class MethodNotImplementException extends BaseException{constructor(t,e){super(_errorCode.MethodNotImplement);this.name="MethodNotImplementException";this.message=`${t} is not a method! ${e}`;this.descriptor={source:t,message:this.message}}}exports.MethodNotImplementException=MethodNotImplementException;class InvalidTextException extends BaseException{constructor(t,e=""){super(_errorCode.InvalidText);this.name="InvalidTextException";this.message=t?`${t} is invalid. ${e}`:"Text is required.";this.descriptor={source:t,message:this.message}}}exports.InvalidTextException=InvalidTextException;class InvalidCharacterException extends BaseException{constructor(t){super(_errorCode.InvalidCharacter);this.name="InvalidCharacterException";this.message=`${t} is invalid.`;this.descriptor={source:t,message:this.message}}}exports.InvalidCharacterException=InvalidCharacterException;class TextTooLongException extends BaseException{constructor(){super(_errorCode.TextTooLong);this.name="TextTooLongException";this.message="Text is too long to encode";this.descriptor={source:null,message:this.message}}}exports.TextTooLongException=TextTooLongException;class GroupSizeOverflowException extends BaseException{constructor(t){super(_errorCode.GroupSizeOverflow);this.name="GroupSizeOverflowException";this.message=`Group size is ${t}. The max group size is 9.`;this.descriptor={source:t,message:this.message}}}exports.GroupSizeOverflowException=GroupSizeOverflowException;function createRenderDom(t,e){let i;"svg"===t?(i=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("xmlns","http://www.w3.org/2000/svg"):i=document.createElement("canvas");i.setAttribute("width",e.width);i.setAttribute("height",e.height);return i}class BarcodeRender{constructor(t,e){this.container=t;e.toSymbol();this.barcode=e;this.style=e.style;let i=this.style.unitValue;this.size={width:e.size.width*i,height:e.size.height*i};let o=createRenderDom(this.style.renderType,this.size);switch(this.style.renderType){case"svg":this.context=new SVGRenderContext(o,this.style,i);break;case"canvas":this.context=new CanvasRenderContext(o,this.style,i);break;default:throw new InvalidRenderException(this.style.renderType)}t&&t.appendChild(o);this.renderDom=o}render(){const{style:t,barcode:{shapes:e}}=this,i=this.context;i.clear();i.setColor(t.color);i.setBackgroundColor(t.backgroundColor);e.forEach(t=>{"rect"===t.type&&i.drawRect(t);"text"===t.type&&i.drawText(t)});return this}getImageData(){if(!this.context.getImageData)throw new MethodNotImplementException("getImageData","You are working with svg render.");return this.context.getImageData()}getDataUrl(){return this.context.getDataUrl()}destroy(){this.container&&this.container.removeChild(this.renderDom)}getSize(){return this.size}}exports.BarcodeRender=BarcodeRender;function isFunction(t){return"function"==typeof t}function isWindow(t){return!!t&&t===t.window}function isDefined(t){return void 0!==t}function isNaN(t){return isFunction(Number.isNaN)?Number.isNaN(t):t!=t}function isNumberLike(t){return!isNaN(+t)}function sliceString(t="",e=1,i){let o=0,r=t.length,s=0;for(;o<r;){i(t.substring(o,o+e),s);o+=e;s++}}function sliceArray(t=[],e=1,i){let o=0,r=t.length,s=0;for(;o<r;){i(t.slice(o,o+e),s);o+=e;s++}}function str2Array(t=""){return isFunction(Array.from)?Array.from(t):Array.prototype.slice.call(t)}function combineTruthy(t=""){let e=str2Array(t),i=[];e.forEach(t=>{if("0"===t)i.push(0);else if(i[i.length-1]&&0!==i[i.length]){let t=i.pop();i.push(++t)}else i.push(1)});return i}function convertRadix(t,e=2){return(t=+t).toString(e)}function isEven(t){return t%2==0}function isOdd(t){return t%2==1}function toNumber(t="",e=0){if("number"==typeof t)return t;let i=parseFloat(t);return isNaN(i)?e:i}function getUnit(t=""){let e=/[a-zA-Z]+/.exec(t);return e?e[0]:"px"}function getMaxValue(t,e="length"){let i=0;t.forEach(t=>{t[e]>i&&(i=t[e])});return i}function assign(t,...e){if(isFunction(Object.assign))return Object.assign(t,...e);if(null==t)throw new TypeError("Cannot convert undefined or null to object");let i=Object(t);for(let t=0;t<e.length;t++){let o=e[t];if(null!=o)for(let t in o)Object.prototype.hasOwnProperty.call(o,t)&&(i[t]=o[t])}return i}function deepMerge(t,...e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");e.forEach(e=>{if(e)for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(null!=e[i]&&"object"==typeof e[i]&&"object"==typeof t[i]?t[i]=deepMerge({},t[i]||{},e[i]):t[i]=e[i])});return t}function deepMergeAll(...t){return deepMerge({},...t)}function strRepeat(t,e){if(isFunction(t.repeat))return t.repeat(e);let i=""+t;(e=+e)!=e&&(e=0);if(e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");e=Math.floor(e);if(0==i.length||0==e)return"";if(i.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let o="";for(let t=0;t<e;t++)o+=i;return o}function isInteger(t){return isFunction(Number.isInteger)?Number.isInteger(t):"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}function fillArray(t,e){if(isFunction(t.fill))return t.fill(e);for(let i=0;i<t.length;i++)t[i]=e;return t}function strPadStart(t,e,i){if(isFunction(t.padStart))return t.padStart(e,i);e>>=0;i=String(void 0!==i?i:" ");if(t.length>e)return t;(e-=t.length)>i.length&&(i+=strRepeat(i,e/i.length));return i.slice(0,e)+String(t)}const plugins={};function registerPlugin(t,e){plugins[t]=e}function _defaultMeasureText(t,e){return 1.4*toNumber(e.fontSize,12)}function measureText(t,e){return isFunction(plugins.measureText)?plugins.measureText(t,e):_defaultMeasureText(t,e)}function _defaultConvertUnit(t){return toNumber(t,12)}function convertUnit(t){return isFunction(plugins.convertUnit)?isNumberLike(t)?toNumber(t,12):plugins.convertUnit(t):_defaultConvertUnit(t)}function fixSize2PixelDefault(t){return isNumberLike(t)?t+"px":t}function loop(t,e){let i,o;if(isFinite(e)){i=0;o=e}else{i=e.from;o=e.to+1}for(;i<o;i++)t(i)}function toZeroOnePattern(t,e){const i=e?isEven:isOdd;return t.reduce((t,e,o)=>{i(o)?t+=strRepeat("1",e):t+=strRepeat("0",e);return t},"")}function range(t,e){const i=[];for(;t<e;){i.push(t);t++}i.push(e);return i}function makeEnums(t){Object.defineProperty(t,"has",{configurable:!1,enumerable:!1,writable:!1,value:function(t){return this.$br[t]}});const e=Object.keys(t).reduce((e,i)=>{e[t[i]]=i;return e},{});Object.defineProperty(t,"$br",{configurable:!1,enumerable:!1,writable:!1,value:e})}exports.Utils={isFunction:isFunction,isWindow:isWindow,isDefined:isDefined,isNaN:isNaN,isNumberLike:isNumberLike,sliceString:sliceString,sliceArray:sliceArray,str2Array:str2Array,combineTruthy:combineTruthy,convertRadix:convertRadix,isEven:isEven,isOdd:isOdd,toNumber:toNumber,getUnit:getUnit,getMaxValue:getMaxValue,assign:assign,deepMerge:deepMerge,deepMergeAll:deepMergeAll,strRepeat:strRepeat,isInteger:isInteger,fillArray:fillArray,strPadStart:strPadStart,registerPlugin:registerPlugin,measureText:measureText,convertUnit:convertUnit,fixSize2PixelDefault:fixSize2PixelDefault,loop:loop,toZeroOnePattern:toZeroOnePattern,range:range,makeEnums:makeEnums};class Option{constructor(t={}){this.originConfig=t;this.type=t.type;this.penddingMerge=[]}static setCustomDefaultOptions(t){Option.CustomDefaultOptions=t}spawn(t){return new Option(exports.Utils.deepMergeAll(this.originConfig,t))}merge(t){this.penddingMerge.unshift(t)}_getUnitValue(t){t=exports.Utils.fixSize2PixelDefault(t);return exports.Utils.convertUnit(t)}getMergedOption(){return exports.Utils.deepMergeAll(Option.DefaultOptions,...this.penddingMerge,Option.CustomDefaultOptions,this.originConfig)}getConfig(t){const e=this.getMergedOption();let{text:i,quietZone:o,height:r,labelPosition:s,desiredSize:n,showLabel:a,font:h,backgroundColor:l,color:c,renderType:d,unitSize:p,hideExtraChecksum:u}=e;const g={text:i,isLabelBottom:!1,hideExtraChecksum:u};if(!exports.Utils.isDefined(i))throw new InvalidTextException;g.text+="";exports.Utils.isDefined(s)&&(g.isLabelBottom="top"!==s);(h=exports.Utils.deepMergeAll(h)).fontSize=exports.Utils.fixSize2PixelDefault(h.fontSize);const f=exports.Utils.measureText(i,h);g.showLabel=a;t=t||this._getUnitValue(p);const x=a?f/t:0;g.fontSizeInUnit=x;const m={};for(let e in o)if(o.hasOwnProperty(e)){let i=o[e];if(exports.Utils.isNumberLike(i)){const t=+i;m[e]=t}else{let o=exports.Utils.convertUnit(i);m[e]=o/t}}g.quietZone=m;if(n){g.containerWidth=exports.Utils.convertUnit(exports.Utils.fixSize2PixelDefault(n.width));g.containerHeight=exports.Utils.convertUnit(exports.Utils.fixSize2PixelDefault(n.height));g.desiredSize=n}if(exports.Utils.isDefined(r))if(n){let e=a?g.containerHeight-f:g.containerHeight;g.height=e/t-m.top-m.bottom}else exports.Utils.isNumberLike(r)?g.height=+r-x-m.top-m.bottom:g.height=exports.Utils.convertUnit(r)/t-x-m.top-m.bottom;return{config:e,encodeConfig:g,style:exports.Utils.deepMergeAll({backgroundColor:l,color:c,renderType:d,unitValue:t,fontSize:h.fontSize,fontHeight:f},h)}}getOriginConfig(){return this.originConfig}getType(){return this.type}}Option.DefaultOptions={renderType:"canvas",unitSize:"1px",color:"rgb(0,0,0)",backgroundColor:"rgb(255,255,255)",font:{fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",textDecoration:"none",textAlign:"center",fontSize:"12px"},hideExtraChecksum:!1,quietZone:{top:0,right:0,bottom:0,left:0}};Option.CustomDefaultOptions={};exports.Option=Option;function _getProtos(t){var e=[];if(t&&t instanceof Function){let i=t;e.push(i);for(;i;){const t=Object.getPrototypeOf(i);if(!t||t===Object||t===Function.prototype)break;i=t;e.push(i)}}return e}function _getDefaultConfig(t,e){var i=[{type:e}];_getProtos(t).forEach(t=>{t.DefaultConfig&&i.unshift(t.DefaultConfig)});return exports.Utils.deepMergeAll(Option.DefaultOptions,...i,Option.CustomDefaultOptions)}exports._getDefaultConfig=_getDefaultConfig;class _EnumDictionary{constructor(t,e){this._keys={};this._values={};for(let r in t)if("string"==typeof t[r]){var i=parseInt(r),o=e(t[i]);this._keys[i]=o;this._values[o]=i}}getEnumByString(t){var e=this._values[t];if(void 0===e)throw`Unknown Barcode internal value '${t}'`;return e}getStringByEnum(t){return this._keys[t]}}exports._EnumDictionary=_EnumDictionary;class Area{constructor(t=0,e=0){this.x=0;this.y=0;this.style={padding:{top:0,right:0,bottom:0,left:0},border:{top:0,right:0,bottom:0,left:0},margin:{top:0,right:0,bottom:0,left:0}};this.width=t;this.height=e;this.children=[];this._updateBox()}append(t){this.children.push(t)}_makeRect(t,e,i,o){return{x:t,y:e,height:o,width:i,type:"rect"}}toShapes(){const{x:t,y:e,width:i,height:o,style:{border:r,margin:s}}=this,n=[],a=r.left+r.right+i,h=r.top+r.bottom+o,l=t+s.left,c=e+s.top;r.top&&n.push(this._makeRect(l,c,a,r.top));r.right&&n.push(this._makeRect(l+a-r.right,c,r.right,h));r.bottom&&n.push(this._makeRect(l,c+h-r.bottom,a,r.bottom));r.left&&n.push(this._makeRect(l,c,r.left,h));return n}getSize(){const{width:t,height:e,offsetBox:i}=this;return{width:t+i.width,height:e+i.height}}visiable(){return this.width>0&&this.height>0}setX(t){this.x=t;this._updateBox()}setY(t){this.y=t;this._updateBox()}updateContentSize(t,e){this.width=t;this.height=e;this._updateBox()}_fixOpt(t,e){if(exports.Utils.isNumberLike(t[e])){const i=t[e];t[e]={top:i,right:i,bottom:i,left:i}}}setStyle(t){this._fixOpt(t,"padding");this._fixOpt(t,"border");this._fixOpt(t,"margin");this.style=exports.Utils.deepMergeAll(this.style,t);this._updateBox()}_updateBox(){const{x:t,y:e,width:i,height:o,style:{padding:r,border:s,margin:n}}=this;this.offsetBox={x:t+r.left+s.left+n.left,y:e+r.top+s.top+n.top,width:n.left+s.left+s.right+n.right,height:n.top+s.top+s.bottom+n.bottom};const a=i-r.left-r.right,h=o-r.top-r.bottom;this.contentBox={width:a>=0?a:0,height:h>=0?h:0}}}exports.Area=Area;class HorizontalLayoutArea extends Area{toShapes(){this._updateContentSize();const{children:t,offsetBox:e}=this;let i=super.toShapes();const o=e.y;let r=0;t.forEach(t=>{const s=e.x+r;t.toShapes().forEach(t=>{t.x+=s;t.y+=o;i.push(t)});const n=t.getSize();r+=n.width});return i}getSize(){this._updateContentSize();return super.getSize()}_updateContentSize(){const{children:t,style:{padding:e}}=this,i=t.reduce((t,e)=>{const i=e.getSize();t.height=Math.max(i.height,t.height);t.width+=i.width;return t},{width:0,height:0});this.updateContentSize(i.width+e.left+e.right,i.height+e.top+e.bottom)}}exports.HorizontalLayoutArea=HorizontalLayoutArea;class VerticalLayoutArea extends Area{toShapes(){this._updateContentSize();const{children:t,offsetBox:e}=this;let i=super.toShapes();const o=e.x;let r=0;t.forEach(t=>{const s=e.y+r;t.toShapes().forEach(t=>{t.x+=o;t.y+=s;i.push(t)});const n=t.getSize();r+=n.height});return i}getSize(){this._updateContentSize();return super.getSize()}_updateContentSize(){const{children:t,style:{padding:e}}=this,i=t.reduce((t,e)=>{const i=e.getSize();t.width=Math.max(i.width,t.width);t.height+=i.height;return t},{width:0,height:0});this.updateContentSize(i.width+e.left+e.right,i.height+e.top+e.bottom)}}exports.VerticalLayoutArea=VerticalLayoutArea;class MatrixSymbolArea extends Area{constructor(t,e,i){super(t,e);this._xPosition=0;this._yPosition=0;this._lastMaxHeight=0;this._rowHeight=0;this._rowHeight=i}append(t,e){if(!t||!e)return;this._autoWrap(t);const{children:i,_xPosition:o,_yPosition:r}=this,s={width:t,height:e,x:o,y:r};i.push(s);this._xPosition+=t;this._rowHeight||(this._lastMaxHeight=Math.max(this._lastMaxHeight,e))}_autoWrap(t){if(this._checkNeedWrap(t)){this._yPosition+=this._rowHeight||this._lastMaxHeight;this._xPosition=0;this._lastMaxHeight=0}}_checkNeedWrap(t){const{_xPosition:e,contentBox:{width:i}}=this;return i-e-t<0}space(t=1){this._autoWrap(t);this._xPosition+=t}toShapes(){if(!this.visiable())return[];const{offsetBox:t,children:e}=this,i=super.toShapes();e.forEach(e=>{e.x+=t.x;e.y+=t.y;e.type="rect";i.push(e)});return i}}exports.MatrixSymbolArea=MatrixSymbolArea;class SymbolArea extends Area{constructor(t,e){super(t,e);this._lastIsBar=!1;this._cacheNumber=0;this._position=0}append(t,e,i){if(!t)return;const{children:o,_position:r}=this,s={width:t,x:r,barHeight:e,offsetY:i};o.push(s);this._position+=t}space(t=1){this._position+=t}_appendModule(t){const e="1"===t;if(e!==this._lastIsBar){this._flash();this._lastIsBar=e}this._cacheNumber++}_flash(){if(this._cacheNumber>0){this._lastIsBar?this.append(this._cacheNumber):this.space(this._cacheNumber);this._cacheNumber=0}}fromPattern(t){exports.Utils.str2Array(t).forEach(t=>this._appendModule(t));this._flash()}getContentBox(){return this.contentBox}toShapes(){if(!this.visiable())return[];const{offsetBox:t,children:e,contentBox:{height:i}}=this,o=super.toShapes();e.forEach(e=>{o.push({type:"rect",x:e.x+t.x,y:t.y+(e.offsetY||0),width:e.width,height:e.barHeight||i})});return o}}exports.SymbolArea=SymbolArea;class LabelArea extends Area{constructor(t,e,i){super(t,e);this._textAlign=i}toShapes(){if(!this.visiable())return[];const{offsetBox:t,children:e,_textAlign:i,contentBox:{width:o}}=this,r=super.toShapes();e.forEach(e=>{let s=t.x;switch(i){case"center":s+=o/2;break;case"right":s+=o}r.push({x:s+(e.x||0),y:t.y+(e.y||0),textAlign:i,maxWidth:o,type:"text",text:e.text})});return r}}exports.LabelArea=LabelArea;class MatrixBuilder{constructor(t,e){this.data=[];this.data=[];this.row=t;this.col=e}add(t,e,i){(this.data[t]||exports.Utils.fillArray(new Array(this.col),null))[e]=i;this.data[t]=[]}toMatrix(){const t=[];exports.Utils.loop(e=>{t.push(this.data[e]||exports.Utils.fillArray(new Array(this.col),null))},this.row);return t}}exports.MatrixBuilder=MatrixBuilder;class BitBuffer{constructor(t=[]){this.buffer=t;this.length=8*t.length;this.index=0}putBit(t){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0);t&&(this.buffer[e]|=128>>>this.length%8);this.length+=1}putBitAt(t,e){const{length:i}=this,o=new BitBuffer;for(let r=0;r<i;r++)r===e?o.putBit(t):o.putBit(this.getAt(r));this.buffer=o.buffer;this.length=o.length}put(t,e){for(let i=0;i<e;i+=1)this.putBit(1==(t>>>e-i-1&1))}putBits(t){this.put(parseInt(t,2),t.length)}getAt(t){const e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}getBuffer(){return this.buffer}getGroupedBits(t){let e=0;const i=[];for(;e<this.length;){let o="",r=e,s=e+t;for(;r<s;r++)o+=this.getAt(r)?1:0;e=s;i.push(parseInt(o,2))}return i}next(){this.index++;return this.getAt(this.index-1)}}exports.BitBuffer=BitBuffer;class BarcodeEncoder{constructor(t){this._option=t;this.shapes=[];this.size={width:0,height:0};this.applyDesiredSize()}validate(){}applyDesiredSize(t){const{config:e,encodeConfig:i,style:o}=this._option.getConfig(t);this.config=e;this.encodeConfig=i;this.style=o;this.useDesiredSize=!!i.desiredSize}afterApplyDesiredSize(){}toSymbol(){this.validate();const t=this.calculateData();if(this.useDesiredSize){this.convertToShape(t,!0);this.adjustDesiredSize();this.afterApplyDesiredSize()}this.convertToShape(t)}}exports.BarcodeEncoder=BarcodeEncoder;class TwoDimensionalBarcode extends BarcodeEncoder{adjustDesiredSize(){const{width:t,height:e}=this.size,{desiredSize:i,containerWidth:o,containerHeight:r}=this.encodeConfig;let s=Math.min(o/t,r/e);i.forceRounding&&(s=(s=~~s)<1?1:s);this.applyDesiredSize(s)}convertToShape(t,e){const{quietZone:i}=this.encodeConfig,o=t[0].length+i.right+i.left,r=t.length+i.top+i.bottom,s=new VerticalLayoutArea,n=new MatrixSymbolArea(o,r,1);n.setStyle({padding:{top:i.top,right:i.right,bottom:i.bottom,left:i.left}});s.append(n);if(!e){t.forEach(t=>{t.forEach(t=>{t?n.append(1,1):n.space()})});this.shapes=s.toShapes()}this.size=s.getSize()}}exports.TwoDimensionalBarcode=TwoDimensionalBarcode;class OneDimensionalBarcode extends BarcodeEncoder{constructor(t){t.merge(OneDimensionalBarcode.DefaultConfig);super(t);this.label=""}adjustDesiredSize(){const{width:t}=this.size;let{desiredSize:e,containerWidth:i}=this.encodeConfig,o=i/t;e.forceRounding&&(o=(o=~~o)<1?1:o);this.applyDesiredSize(o)}convertToShape(t,e){let{label:i,encodeConfig:{quietZone:o,isLabelBottom:r,height:s,showLabel:n,fontSizeInUnit:a},style:{textAlign:h}}=this,l=0;i&&n&&(l=a);const c=t.length+o.right+o.left,d=s+o.top+o.bottom,p=new VerticalLayoutArea,u=new SymbolArea(c,d);u.setStyle({padding:{top:o.top,right:o.right,bottom:o.bottom,left:o.left}});const g=u.getSize(),f=new LabelArea(g.width,l,h);if(r){p.append(u);p.append(f)}else{p.append(f);p.append(u)}if(!e){u.fromPattern(t);f.append({text:i});this.shapes=p.toShapes()}this.size=p.getSize()}}OneDimensionalBarcode.DefaultConfig={height:60,showLabel:!0,labelPosition:"bottom"};exports.OneDimensionalBarcode=OneDimensionalBarcode;const FNC1="Ï",FNC2="Ê",FNC3="É",DataMatrixFNC1=" ",DataMatrixMacro05=" ",DataMatrixMacro06=" ";exports.Constants={FNC1:"Ï",FNC2:"Ê",FNC3:"É",DataMatrixFNC1:" ",DataMatrixMacro05:" ",DataMatrixMacro06:" "};exports.encoders={};class Barcode{constructor(...t){let e,i,o;if(t.length>=3)[e,i,o]=t;else if(2===t.length)exports.Utils.isFunction(t[1])?[i,o]=t:[e,i]=t;else{if(1!==t.length)throw new MethodNotImplementException("constructor","The arguments is invalid.");[i]=t}this.dom="string"==typeof e?document.querySelector(e):e;this.callback=o&&o.bind(this);this.setOption(i)}static getImageData(t={}){return new Barcode(t).getImageData()}static getDataUrl(t={}){return new Barcode(t).getDataUrl()}static setDefaultOptions(t={}){Option.setCustomDefaultOptions(t)}static registerEncoder(t,e){exports.encoders[t]=e;Barcode.supportType.push(t)}static registerPlugin(t,e){exports.Utils.registerPlugin(t,e)}mergeOption(t){const e=this.option.spawn(t);this.update(e);return this}setOption(t){this.update(new Option(t));return this}getOption(){return this.option.getMergedOption()}update(t){const e=t.getType(),i=exports.encoders[e];if(!i)throw new InvalidBarcodeTypeException(e);const o=new i(t);this.destroy();const r=new BarcodeRender(this.dom,o);r.render();this.render=r;this.option=t;exports.Utils.isFunction(this.callback)&&this.callback()}refresh(){this.render.render();exports.Utils.isFunction(this.callback)&&this.callback()}getImageData(){return this.render.getImageData()}getDataUrl(){return this.render.getDataUrl()}getSize(){return this.render.getSize()}destroy(){if(this.render){this.render.destroy();this.render=null}}}Barcode.supportType=[];Barcode.constants=exports.Constants;Barcode.ErrorCode=exports.ErrorCode;exports.Barcode=Barcode;Barcode.registerPlugin("measureText",(function(t,e){const i=document.createElement("span");i.style.visibility="hidden";i.style.position="absolute";i.style.lineHeight="normal";i.textContent=t;Object.keys(e).forEach(t=>{i.style[t]=e[t]});document.body.appendChild(i);const o=i.getBoundingClientRect();document.body.removeChild(i);return o.height}));Barcode.registerPlugin("convertUnit",(function(t){const e=document.createElement("div");e.style.visibility="hidden";e.style.position="fixed";e.style.padding="0";e.style.border="0";e.style.width=t;document.body.appendChild(e);const i=e.getBoundingClientRect();document.body.removeChild(e);return i.width}));var RenderType,LabelPosition,NarrowToWideRatio;!function(t){t[t.Canvas=0]="Canvas";t[t.Svg=1]="Svg"}(RenderType=exports.RenderType||(exports.RenderType={}));!function(t){t[t.Top=0]="Top";t[t.Bottom=1]="Bottom"}(LabelPosition=exports.LabelPosition||(exports.LabelPosition={}));!function(t){t[t.OneToTwo=0]="OneToTwo";t[t.OneToThree=1]="OneToThree"}(NarrowToWideRatio=exports.NarrowToWideRatio||(exports.NarrowToWideRatio={}));class _RenderTypeConvertor{static stringToEnum(t){switch(t){case"canvas":return RenderType.Canvas;case"svg":return RenderType.Svg}throw`Unknown Barcode internal renderType '${t}'`}static enumToString(t){return RenderType[wijmo_1.asEnum(t,RenderType)].toLowerCase()}}exports._RenderTypeConvertor=_RenderTypeConvertor;class _LabelPositionConvertor{static stringToEnum(t){switch(t){case"top":return LabelPosition.Top;case"bottom":return LabelPosition.Bottom}throw`Unknown Barcode internal labelPosition '${t}'`}static enumToString(t){return LabelPosition[wijmo_1.asEnum(t,LabelPosition)].toLowerCase()}}exports._LabelPositionConvertor=_LabelPositionConvertor;class _NarrowWideRatioConvertor{static stringToEnum(t){switch(t.toString()){case"2":return NarrowToWideRatio.OneToTwo;case"3":return NarrowToWideRatio.OneToThree}throw`Unknown nwRatio internal value '${t}'`}static enumToString(t){let e;switch(wijmo_1.asEnum(t,NarrowToWideRatio)){case NarrowToWideRatio.OneToTwo:e="2";break;case NarrowToWideRatio.OneToThree:e="3"}return e}}exports._NarrowWideRatioConvertor=_NarrowWideRatioConvertor;class BarcodeBase extends wijmo_1.Control{constructor(t,e){super(t,null,!0);this._state={};this._isUpd=0;this._isValid=!0;this._aw=!1;this._wZoom=1;this.isValidChanged=new wijmo_1.Event;let i=this.getTemplate();this.applyTemplate("wj-barcode wj-control",i,{});wijmo_1.isIE()||(this.hostElement.style.lineHeight="0px");this._state=this._getDefaults();this._isUpd++;this.initialize(e);this._updateSize();this._isUpd--;this._mergeOptions({});this.invalidate()}initialize(t){this._isUpd++;try{super.initialize(t)}finally{this._isUpd--}!this._isUpd&&t&&Object.keys(t).length&&this._mergeOptions({})}static _getClassDefaults(){let t=this.type;return _getDefaultConfig(exports.encoders[t],t)}_getDefaults(){let t=this.constructor;t._defaults||(t._defaults=t._getClassDefaults());return exports.Utils.deepMergeAll(t._defaults)}get value(){return this._getProp("text")}set value(t){this._setProp("text",t)}get quietZone(){return this._getProp("quietZone")}set quietZone(t){this._setProp("quietZone",t)}get renderType(){return _RenderTypeConvertor.stringToEnum(this._getProp("renderType"))}set renderType(t){this._setProp("renderType",_RenderTypeConvertor.enumToString(t))}get color(){return this._getProp("color")}set color(t){this._setProp("color",t)}get backgroundColor(){return this._getProp("backgroundColor")}set backgroundColor(t){this._setProp("backgroundColor",t)}get hideExtraChecksum(){return this._getProp("hideExtraChecksum")}set hideExtraChecksum(t){this._setProp("hideExtraChecksum",t)}get font(){return this._getProp("font")}set font(t){this._setProp("font",t)}get isValid(){return this._isValid}onIsValidChanged(t){this.isValidChanged.raise(this,t)}refresh(t=!0){super.refresh(t);t?this._updateSize():this._bc.refresh()}getImageData(){return this._bc.getImageData()}getDataUrl(){return this._bc.getDataUrl()}getSize(){var t=new wijmo_1.Size,e=this._bc.getSize();if(e){t.width=e.width;t.height=e.height}return t}_mergeOptions(t){let e,i=this._bc,o=_copyObj(this._state,t);if(!this._isUpd){let t=o.text;if(null==t||""===t){if(i){i.destroy();this._bc=i=null}}else try{i?i.setOption(o):this._bc=i=new Barcode(this.hostElement,o)}catch(t){e=t}}let r=!0;if(e){if(i){i.destroy();this._bc=i=null}if(e.code!==_errorCode.InvalidText)throw e;r=!1}this._state=o;this._setValid(r)}_setValid(t){if(this._isValid!==t){this._isValid=t;wijmo_1.toggleClass(this.hostElement,"wj-state-invalid",!t);this.onIsValidChanged()}}_setProp(t,e){this._mergeOptions({[t]:e})}_getProp(t){let e=this._bc;return this._state[t]||e&&e.getOption()[t]}_updateSize(){let t=BarcodeBase._getContentSize(this.hostElement),e=this._prevSz,i=null,o=null,r=1,s=!0;if(this._getAw()){r=this._getWzoom();s=(o=t.height/r)===this._prevH;this._prevH=o;e=this._prevSz=null}else if(!e||!t.equals(e)){i={width:t.width+"px",height:t.height+"px",forceRounding:!1};s=!1;this._prevSz=t;this._prevH=null}s||this._mergeOptions({desiredSize:i,height:o,unitSize:r})}static _getContentSize(t){let e=getComputedStyle(t);return new wijmo_1.Size(t.offsetWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderLeftWidth)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderTopWidth)-parseFloat(e.borderBottomWidth))}_getAw(){return this._aw}_setAw(t){if(this._aw!==t){this._aw=t;this._updateSize()}}_getWzoom(){return this._wZoom}_setWzoom(t){wijmo_1.asNumber(t);wijmo_1.assert(t>=1,"autoWidthZoom value should be equal or greater than 1");if(this._wZoom!==t){this._wZoom=t;this._getAw()&&this._updateSize()}}}BarcodeBase.controlTemplate="";exports.BarcodeBase=BarcodeBase;const _copyObj="function"==typeof Object.assign?Object.assign:function(t,...e){for(let i of e)if(null!=i)for(let e in i)t[e]=i[e];return t};wijmo_1._registerModule("wijmo.barcode",selfModule);