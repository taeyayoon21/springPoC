/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=require("wijmo/wijmo.grid.cellmaker");var SparklineType,SparklineMarkers;!function(e){e[e.Line=0]="Line";e[e.Column=1]="Column";e[e.WinLoss=2]="WinLoss"}(SparklineType=exports.SparklineType||(exports.SparklineType={}));!function(e){e[e.None=0]="None";e[e.First=1]="First";e[e.Last=2]="Last";e[e.High=4]="High";e[e.Low=8]="Low";e[e.Negative=16]="Negative"}(SparklineMarkers=exports.SparklineMarkers||(exports.SparklineMarkers={}));class CellMaker{static makeButton(e){return(t,l)=>{t.col.isReadOnly=!0;l.innerHTML="";let r=wijmo_1.format('<button type="button">{txt}</button>',{txt:CellMaker._getOptionText(e,"text",t,t.text)});CellMaker._createElement(l,r,e,t);return null}}static makeLink(e){return(t,l)=>{t.col.isReadOnly=!0;l.innerHTML="";let r=wijmo_1.format('<a href="{href}">{txt}</a>',{txt:CellMaker._getOptionText(e,"text",t,t.text),href:CellMaker._getOptionText(e,"href",t,"#")});CellMaker._createElement(l,r,e,t);return null}}static makeSparkline(e){return(t,l)=>{t.col.isReadOnly=!0;l.innerHTML="";let r=wijmo_1.format("<div><svg><g>{spark}</g></svg></div>",{spark:CellMaker._getSparkline(t.value,e)});CellMaker._createElement(l,r,e,t);return null}}static makeImage(e){return(t,l)=>{t.col.isReadOnly=!0;l.innerHTML="";let r=wijmo_1.format('<img src="{src}"></div>',{src:CellMaker._getOptionText(e,"src",t,t.text)});CellMaker._createElement(l,r,e,t);return null}}static makeRating(e){return(t,l)=>{let r=t.col,a=wijmo_grid_1.DataMapEditor,i=r.cssClass||"",n=CellMaker._WJC_CellMaker;if(!r.dataMap||r.dataMapEditor!=a.RadioButtons||i.indexOf(n)<0){let t=e?e.range:null,l=[];for(let e=(t=t&&wijmo_1.isArray(t)&&t.length>1&&t[1]>t[0]?t:[0,5])[0];e<=t[1];e++)l.push(e);r.dataMap=new wijmo_grid_1.DataMap(l);r.dataMapEditor=a.RadioButtons;i.indexOf(n)<0&&(r.cssClass=(i+" "+n).trim())}if(e&&e.label){let r=CellMaker._getOptionText(e,"label",t);l.setAttribute("aria-label",r.trim())}let s=l.querySelectorAll("label"),o=!!e&&e.showZeros,m=null==l.querySelector("input:checked");for(let e=0;e<s.length;e++){let t=s[e];wijmo_1.toggleClass(t,"wj-chk-hidden","0"==t.textContent&&!o);wijmo_1.toggleClass(t,"wj-chk-off",m);m=m||null!=t.querySelector("input:checked")}return null}}static _getOptionText(e,t,l,r=""){let a=e?e[t]:"";return a?wijmo_1.evalTemplate(a,l):r}static _createElement(e,t,l,r){let a=wijmo_1.createElement(t,e),i=CellMaker._WJC_CellMaker;l&&l.cssClass&&(i+=" "+CellMaker._getOptionText(l,"cssClass",r));a.className=i.trim();if(l&&l.label){let e=CellMaker._getOptionText(l,"label",r);a.setAttribute("aria-label",e.trim());a instanceof HTMLImageElement&&a.setAttribute("alt",e.trim())}if(l&&l.attributes)for(let e in l.attributes)a.setAttribute(e,l.attributes[e]);l&&wijmo_1.isFunction(l.click)&&(a.onclick=CellMaker._handleClick.bind({options:l,ctx:CellMaker._cloneContext(r)}));return a}static _cloneContext(e){if(wijmo_1.isFunction(Object.assign))return Object.assign({},e);let t={};for(let l in e)t[l]=e[l];return t}static _handleClick(e){let t=this.options;if(wijmo_1.isFunction(t.click)){e.preventDefault();let l=this.ctx;t.click(e,l)}}static _getSparkline(e,t){let l="",r=SparklineType,a=SparklineMarkers,i=null!=(t=t||{}).type?t.type:r.Line,n=null!=t.markers?t.markers:a.None,s=wijmo_1.isNumber(t.baseValue)?t.baseValue:i==r.Line?null:0,o=wijmo_1.isNumber(t.maxPoints)?t.maxPoints:null;if(e instanceof Array&&e.length>1){i==r.WinLoss&&(e=e.map(e=>wijmo_1.isBoolean(e)?e?1:-1:wijmo_1.isNumber(e)?e>0?1:e<0?-1:null:null));let t=CellMaker._scaleValues(e,s,o),a=t.points,m=t.base,u=100/(a.length-(i==r.Line?1:0)),c=u>4?u-2:u,k=u-c;switch(i){case r.Column:case r.WinLoss:for(let e=0;e<a.length;e++){let r=a[e];null!=r&&(l+=wijmo_1.format("<rect {cls}x={x}% y={y}% width={w}% height={h}% />",{x:(e*u+k).toFixed(2),y:Math.min(m,r),w:c.toFixed(2),h:Math.abs(m-r),cls:CellMaker._getMarkers(n,t,e)}))}break;case r.Line:for(let e=0;e<a.length-1;e++){let r=a[e],i=a[e+1];null!=r&&null!=i&&(l+=wijmo_1.format("<line x1={x1}% y1={y1}% x2={x2}% y2={y2}% />",{x1:Math.round(u*e),y1:r,x2:Math.round(u*(e+1)),y2:i}));let s=CellMaker._getMarkers(n,t,e),o='<circle {cls}cx={x}% cy={y}% r="3"/>';s&&(l+=wijmo_1.format(o,{x:Math.round(u*e),y:r,cls:s}));e==a.length-2&&(s=CellMaker._getMarkers(n,t,e+1))&&(l+=wijmo_1.format(o,{x:Math.round(u*(e+1)),y:i,cls:s}))}}null!=s&&i!=r.WinLoss&&(l+=wijmo_1.format('<line class="x-axis" x1=0% y1={base}% x2=100% y2={base}% />',{base:t.base}))}return l}static _scaleValues(e,t,l){let r,a,i=[];l&&l>1&&e.length>l&&(e=e.slice(0,l));e.forEach(e=>{if(wijmo_1.isNumber(e)){r=!wijmo_1.isNumber(r)||e<r?e:r;a=!wijmo_1.isNumber(a)||e>a?e:a}});if(wijmo_1.isNumber(r)&&wijmo_1.isNumber(a)){if(null!=t){r=Math.min(r,t);a=Math.max(a,t)}else t=r>0?r:a<0?a:0;if(r==a){r--;a++}let l=a-r;e.forEach(e=>{i.push(wijmo_1.isNumber(e)?100-Math.round((e-r)/l*100):null)});t=100-Math.round((t-r)/l*100)}return{min:r,max:a,base:t,points:i,data:e}}static _getMarkers(e,t,l){let r="",a=SparklineMarkers;if(e){let i=t.data,n="wj-marker-";0!=(e&a.First)&&0==l&&(r+=n+"first ");0!=(e&a.Last)&&l==i.length-1&&(r+=n+"last ");0!=(e&a.High)&&i[l]==t.max&&(r+=n+"high ");0!=(e&a.Low)&&i[l]==t.min&&(r+=n+"low ");0!=(e&a.Negative)&&i[l]<0&&(r+=n+"negative ")}return r?'class="wj-marker '+r.trim()+'"':""}}CellMaker._WJC_CellMaker="wj-cell-maker";exports.CellMaker=CellMaker;wijmo_1._registerModule("wijmo.grid.cellmaker",selfModule);