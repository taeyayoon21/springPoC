/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),wijmo_grid_filter_1=require("wijmo/wijmo.grid.filter"),wijmo_xlsx_1=require("wijmo/wijmo.xlsx"),wijmo_grid_xlsx_1=require("wijmo/wijmo.grid.xlsx"),mInput=require("wijmo/wijmo.input"),mXlsx=require("wijmo/wijmo.xlsx"),selfModule=require("wijmo/wijmo.grid.sheet");function softInput(){return wijmo_1._getModule("wijmo.input")}exports.softInput=softInput;function softXlsx(){return wijmo_1._getModule("wijmo.xlsx")}exports.softXlsx=softXlsx;exports._ErrorMessages={InvalidCellRef:"Invalid cell reference.",InvalidSheetRef:"Invalid sheet reference.",InvalidTableRef:"Invalid table reference.",InvalidTableColRef:"Invalid table column reference.",InvalidParameters:"Invalid parameters.",BadExpression:"Bad expression.",CircRef:"Circular reference.",InvalidParameter:e=>`Invalid parameter: "${e}".`,ParameterIsOutOfRange:e=>`Parameter is out of range: "${e}".`,RowIsOutOfTableRange:e=>`The row is out of the table (${e}) range.`,UnkFuncName:e=>`The function "${e}" has not supported in FlexSheet yet.`,DefNameInvalidSheet:e=>`The defined name item works in "${e}". It does not work in current sheet.`,InvalidTable:e=>`The Table(${e}) is not located in any sheet.`,InvalidExpression:e=>`Invalid Expression: ${e}`,Atan2ArgsLessThanZero:"The x number and y number can't both be zero for the atan2 function.",RateCriteriaFails:"It is not able to calculate the rate with current parameters.",RangesMustBeTheSame:"The row span and column span of each cell range has to be same with each other.",TooFewParameters:"Too few parameters.",TooManyParameters:"Too many parameters.",ExpressionExpected:"Expression expected.",UnbalancedParenthesis:"Unbalanced parenthesis.",UnbalancedSquareBrackets:"Unbalanced square brackets.",TableReferencesExpected:"Table references expected.",IdentifierExpected:"Identifier expected.",CantFindFinalQuote:"Can't find final quote.",IllegalCrossSheetReference:"Illegal cross sheet reference.",CantFindFinalDateDelimiter:'Can\'t find final date delimiter ("#").',CellRefMustBeInSameSheet:"The cell reference must be in the same sheet.",SyntaxError:"Syntax error."};var _KnownErrors,TableSection;!function(e){e.Div="#DIV/0!";e.Name="#NAME?";e.Ref="#REF!";e.Num="#NUM!";e.Val="#VALUE!";e.Null="#NULL!";e.NA="#N/A"}(_KnownErrors||(_KnownErrors={}));class FormulaError{constructor(e,t){this._error=e;this._data=t}get error(){return this._error}get data(){return this._data}toString(){return this._error||(this._data||"").toString()}}exports.FormulaError=FormulaError;class DivideByZeroError extends FormulaError{constructor(e){super(_KnownErrors.Div,e)}}exports.DivideByZeroError=DivideByZeroError;class NameError extends FormulaError{constructor(e){super(_KnownErrors.Name,e)}}exports.NameError=NameError;class ReferenceError extends FormulaError{constructor(e){super(_KnownErrors.Ref,e)}}exports.ReferenceError=ReferenceError;class NumericError extends FormulaError{constructor(e){super(_KnownErrors.Num,e)}}exports.NumericError=NumericError;class ValueError extends FormulaError{constructor(e){super(_KnownErrors.Val,e)}}exports.ValueError=ValueError;class NotAvailableError extends FormulaError{constructor(e){super(_KnownErrors.NA,e)}}exports.NotAvailableError=NotAvailableError;class NullError extends FormulaError{constructor(e){super(_KnownErrors.Null,e)}}exports.NullError=NullError;class UnknownError extends FormulaError{constructor(e){super("",e)}}exports.UnknownError=UnknownError;class SyntaxError extends FormulaError{constructor(e){super("#SYNTAX",e)}}exports.SyntaxError=SyntaxError;class _FormulaErrorHelper{static asError(e){return e instanceof FormulaError?e:"string"==typeof e?this.fromString(e):null}static fromString(e){e=e.toUpperCase();if(this._errTypeMap[e])switch(e){case _KnownErrors.Div:return new DivideByZeroError;case _KnownErrors.Name:return new NameError;case _KnownErrors.NA:return new NotAvailableError;case _KnownErrors.Null:return new NullError;case _KnownErrors.Num:return new NumericError;case _KnownErrors.Ref:return new ReferenceError;case _KnownErrors.Val:return new ValueError}return null}}_FormulaErrorHelper._errTypeMap=(()=>{var e={};Object.keys(_KnownErrors).forEach(t=>e[_KnownErrors[t]]=1);return e})();exports._FormulaErrorHelper=_FormulaErrorHelper;class Table{constructor(e,t,o,i,s){this._showHeaderRow=!0;this._showTotalRow=!1;this._showBandedColumns=!1;this._showBandedRows=!0;this._alterFirstColumn=!1;this._alterLastColumn=!1;this._orgHeaderCellsContent=[];if(!t.isValid)throw"The range of this table is invalid.";this._name=e;this._range=t.clone();this._style=o;null!=i&&i.length>0&&this._pushTableColumns(i);if(null!=s){null!=s.showHeaderRow&&(this._showHeaderRow=s.showHeaderRow);null!=s.showTotalRow&&(this._showTotalRow=s.showTotalRow);null!=s.showBandedColumns&&(this._showBandedColumns=s.showBandedColumns);null!=s.showBandedRows&&(this._showBandedRows=s.showBandedRows);null!=s.alterFirstColumn&&(this._alterFirstColumn=s.alterFirstColumn);null!=s.alterLastColumn&&(this._alterLastColumn=s.alterLastColumn)}}get name(){return this._name}set name(e){var t,o;if(null==e||""===e)throw"The name of the Table should not be empty.";if(this._name.toLowerCase()!==e.toLowerCase()){o=this._name;this._name=e;if(this._owner){!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._owner._updateFormulasWithNameUpdating(o,e,!0);if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}}}}get sheet(){return this._sheet}get style(){return this._style}set style(e){var t;if(e.name!==this._style.name){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._style=e;if(this._owner){if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}this._owner.refresh()}}}get showHeaderRow(){return this._showHeaderRow}set showHeaderRow(e){var t,o;if(e!==this._showHeaderRow){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));o=this._showHeaderRow;this._showHeaderRow=e;if(this._owner)try{this._owner.beginUpdate();this._adjustTableRangeWithHeaderRow();if(t){t.saveNewState();this._owner.undoStack._addAction(t)}}catch(e){this._showHeaderRow=o;throw e}finally{t=null;this._owner.endUpdate()}}}get showTotalRow(){return this._showTotalRow}set showTotalRow(e){var t,o;if(e!==this._showTotalRow){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));o=this._showTotalRow;this._showTotalRow=e;if(this._owner)try{this._owner.beginUpdate();this._adjustTableRangeWithTotalRow();if(t){t.saveNewState();this._owner.undoStack._addAction(t)}}catch(e){this._showTotalRow=o;throw e}finally{t=null;this._owner.endUpdate()}}}get showBandedColumns(){return this._showBandedColumns}set showBandedColumns(e){var t;if(e!==this._showBandedColumns){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._showBandedColumns=e;if(this._owner){if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}this._owner.refresh()}}}get showBandedRows(){return this._showBandedRows}set showBandedRows(e){var t;if(e!==this._showBandedRows){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._showBandedRows=e;if(this._owner){if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}this._owner.refresh()}}}get alterFirstColumn(){return this._alterFirstColumn}set alterFirstColumn(e){var t;if(e!==this._alterFirstColumn){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._alterFirstColumn=e;if(this._owner){if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}this._owner.refresh()}}}get alterLastColumn(){return this._alterLastColumn}set alterLastColumn(e){var t;if(e!==this._alterLastColumn){this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(t=new _TableSettingAction(this._owner,this));this._alterLastColumn=e;if(this._owner){if(t){t.saveNewState();this._owner.undoStack._addAction(t);t=null}this._owner.refresh()}}}getRange(e=TableSection.All,t){let o;switch(e){case TableSection.Data:o=this._getDataRange();break;case TableSection.Header:o=this._getHeaderRange();break;case TableSection.Footer:o=this._getFooterRange();break;default:o=this._range.clone()}if(null!=t&&o){let e=this._getColumnIndex(t);if(null==e)return null;o.col=o.col2=o.leftCol+e}return o}getColumns(){return this._columns?this._columns.slice():[]}insertRows(e,t,o=!0){var i,s,l,n,r,a=this.getRange(),h=!1;null==t&&(t=1);if(!wijmo_1.isInt(t)||t<1)return!1;if(0===e&&this._showHeaderRow||e===this._range.rowSpan-1&&this._showTotalRow||e<0||e>=this._range.rowSpan)return!1;if(this._owner){this._owner.beginUpdate();n=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(o){l=new wijmo_grid_1.CellRange(a.bottomRow+1,a.col,a.bottomRow+1,a.col2);if(this._sheet._canShiftCells(l)){i=this._sheet._needAddRowCountForInsertTableRows(t,a);if(n.collectionView){r=n.itemsSource instanceof wijmo_1.CollectionView;n.collectionView.beginUpdate();for(s=0;s<i;s++)r?n.itemsSource.sourceCollection.push({}):n.itemsSource.push({});n.collectionView.endUpdate(!0)}else for(s=0;s<i;s++)n.rows.push(new wijmo_grid_1.Row);this._sheet._moveDownCells(t,l);h=!0}}else this._canInsertRowsWithoutShift(t)&&(h=!0);if(h){this._sheet._moveDownCellsWithinTable(e,t,a);this._updateTableRange(0,t,0,0)}this._owner.endUpdate()}else{this._updateTableRange(0,t,0,0);h=!0}return h}deleteRows(e,t,o=!0){var i,s=!1,l=this.getRange();null==t&&(t=1);if(wijmo_1.isInt(t)&&!(t<1)&&!(0===e&&this._showHeaderRow||e===this._range.rowSpan-1&&this._showTotalRow||e<0||e>=this._range.rowSpan||e+t>this._range.rowSpan-(this._showTotalRow?1:0)))if(this._owner){this._owner.beginUpdate();if(o){i=new wijmo_grid_1.CellRange(l.bottomRow+1,l.col,l.bottomRow+1,l.col2);this._sheet._canShiftCells(i)&&(s=!0)}else s=!0;if(s){this._sheet._moveUpCellsWithinTable(e,t,l);o&&this._sheet._moveUpCells(t,i);this._updateTableRange(0,-t,0,0)}this._owner.endUpdate()}else this._updateTableRange(0,-t,0,0)}_addColumn(e,t){var o,i=this.getRange();if(e<=0||e>this._columns.length)throw"The column index is out of range.";t=this._getUniqueColumnName(e,t);(o=new TableColumn(t))._attach(this);this._columns.splice(e,0,o);this.showHeaderRow&&this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(i.topRow,i.leftCol+e,t)}_updateCell(e,t,o){var i,s=e-this._range.topRow,l=t-this._range.leftCol;if(null!=this._style){i=this._getTableCellAppliedStyles(s,l);this._applyStylesForCell(i,o)}}_updateTableRange(e,t,o,i){if(this._range.row<=this._range.row2){this._range.row+=e;this._range.row2+=t}else{this._range.row2+=e;this._range.row+=t}if(this._range.col<=this._range.col2){this._range.col+=o;this._range.col2+=i}else{this._range.col2+=o;this._range.col+=i}}_setTableRange(e,t){var o;this._range=e;if(null!=t){this._columns.splice(0,this._columns.length);for(o=0;o<t.length;o++)this._columns.push(t[o])}}_updateColumnName(e,t){var o=this._columns[e];t=this._getUniqueColumnName(null,t);o.name=t;this._showHeaderRow&&this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(this._range.topRow,this._range.leftCol+e,t)}_updateColumnTotalRowContent(e,t){var o,i;null==t&&(t=this._columns.indexOf(e));if(!(t<0)){if(e.totalRowFunction)i=null!=(o=this._getSubtotalFunction(e.totalRowFunction.toLowerCase()))?"=subtotal("+o+",["+e.name+"])":"="===e.totalRowFunction[0]?e.totalRowFunction:"="+e.totalRowFunction;else if(0===t){e.totalRowLabel||(e.totalRowLabel="Total");i=e.totalRowLabel}else i=e.totalRowLabel;this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(this._range.bottomRow,this._range.leftCol+t,i,!1)}}_attachSheet(e){var t=this.getRange();if(!this._sheet||!this._owner){this._sheet=e;this._owner=e._owner;if(null!=this._owner){if(this._owner._containsMergedCells(this._range,e))throw"Table does not allow the merged cell within the table.";null==this._style&&(this._style=this._owner.getBuiltInTableStyle("TableStyleMedium9"));null!=this._columns&&0!==this._columns.length||this._generateColumns(this._showHeaderRow);try{this._owner.beginUpdate();this._showHeaderRow&&1===t.rowSpan&&this._adjustTableRangeWithHeaderRow();this._showTotalRow&&this._updateTotalRow()}finally{this._owner.endUpdate()}}}}_detachSheet(){this._sheet=null;this._owner=null}_pushTableColumns(e){var t,o;this._columns=[];for(o=0;o<e.length;o++){(t=e[o])._attach(this);this._columns.push(t)}}_generateColumns(e){var t,o,i,s,l,n=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(!this._range.isValid)throw"The range of the table is invalid.";this._columns=[];for(var r=0;r<this._range.columnSpan;r++){s=this._sheet.grid.columns[this._range.leftCol+r];l=this._range.topRow*this._sheet.grid.columns.length+this._range.leftCol+r;if(1===this._range.rowSpan)t=this._getUniqueColumnName(r+1);else{null==(t=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+r,!1))&&(t="");_isFormula(t)&&(t=this._owner.evaluate(t,"",this._sheet,!1));i=this._sheet._styledCells[l];var a=this._owner._formatEvaluatedResult(t,s,i?i.format:"");null!=t&&""==a||(t=a);t=this._getUniqueColumnName(r+1,t.toString())}if(e&&this._range.rowSpan>1){this._orgHeaderCellsContent[r]=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+r,!1);isNaN(+t)||s.format||i&&i.format||(i?i.format="@":this._sheet._styledCells[l]={format:"@"});n.setCellData(this._range.topRow,this._range.leftCol+r,t,!1)}(o=new TableColumn(t))._attach(this);0===r?o._totalRowLabel="Total":r===this._range.columnSpan-1&&(o._totalRowFunction="Sum");this._columns.push(o)}}_getTableCellAppliedStyles(e,t){var o,i={},s=!1,l=!1,n=0;this._showHeaderRow&&(n=1);this._showHeaderRow&&0===e?s=!0:this._showTotalRow&&e===this._range.rowSpan-1&&(l=!0);this._extendStyle(i,this._style.wholeTableStyle,e,t,s,l);if(!s&&!l){!this._showBandedColumns||null==this._style.firstBandedColumnStyle&&null==this._style.secondBandedColumnStyle||(t%((o=this._style.firstBandedColumnStyle?null==this._style.firstBandedColumnStyle.size?1:this._style.firstBandedColumnStyle.size:1)+(this._style.secondBandedColumnStyle?null==this._style.secondBandedColumnStyle.size?1:this._style.secondBandedColumnStyle.size:1))>=o?this._style.secondBandedColumnStyle&&this._extendStyle(i,this._style.secondBandedRowStyle,e,t,s,l):this._style.firstBandedColumnStyle&&this._extendStyle(i,this._style.firstBandedColumnStyle,e,t,s,l));!this._showBandedRows||null==this._style.firstBandedRowStyle&&null==this._style.secondBandedRowStyle||((e-n)%((o=this._style.firstBandedRowStyle?null==this._style.firstBandedRowStyle.size?1:this._style.firstBandedRowStyle.size:1)+(this._style.secondBandedRowStyle?null==this._style.secondBandedRowStyle.size?1:this._style.secondBandedRowStyle.size:1))>=o?this._style.secondBandedRowStyle&&this._extendStyle(i,this._style.secondBandedRowStyle,e,t,s,l):this._style.firstBandedRowStyle&&this._extendStyle(i,this._style.firstBandedRowStyle,e,t,s,l))}this._alterLastColumn&&t===this._range.columnSpan-1&&this._style.lastColumnStyle&&this._extendStyle(i,this._style.lastColumnStyle,e,t,s,l);this._alterFirstColumn&&0===t&&this._style.firstColumnStyle&&this._extendStyle(i,this._style.firstColumnStyle,e,t,s,l);if(s){this._style.headerRowStyle&&this._extendStyle(i,this._style.headerRowStyle,e,t,s,l);t===this._range.columnSpan-1&&this._style.lastHeaderCellStyle&&this._extendStyle(i,this._style.lastHeaderCellStyle,e,t,s,l);0===t&&this._style.firstHeaderCellStyle&&this._extendStyle(i,this._style.firstHeaderCellStyle,e,t,s,l)}else if(l){this._style.totalRowStyle&&this._extendStyle(i,this._style.totalRowStyle,e,t,s,l);t===this._range.columnSpan-1&&this._style.lastTotalCellStyle&&this._extendStyle(i,this._style.lastTotalCellStyle,e,t,s,l);0===t&&this._style.firstTotalCellStyle&&this._extendStyle(i,this._style.firstTotalCellStyle,e,t,s,l)}return i}_applyStylesForCell(e,t){var o,i=t.style;for(var s in e)(o=e[s])&&(i[s]=o)}_extendStyle(e,t,o,i,s,l){var n;for(var r in t)null!==(n=t[r])&&(r.indexOf("borderTop")>-1?(0===o||l)&&(e[r]=n):r.indexOf("borderBottom")>-1?(o===this._range.rowSpan-1||s)&&(e[r]=n):r.indexOf("borderLeft")>-1?0===i&&(e[r]=n):r.indexOf("borderRight")>-1?i===this._range.columnSpan-1&&(e[r]=n):r.indexOf("borderHorizontal")>-1?o<this._range.rowSpan-1&&("borderHorizontalStyle"===r?e.borderBottomStyle=n:"borderHorizontalWidth"===r?e.borderBottomWidth=n:e.borderBottomColor=n):r.indexOf("borderVertical")>-1?i<this._range.columnSpan-1&&("borderVerticalStyle"===r?e.borderRightStyle=n:"borderVerticalWidth"===r?e.borderRightWidth=n:e.borderRightColor=n):e[r]=n)}_getSubtotalFunction(e){switch(e){case"average":return"101";case"countnums":return"102";case"count":return"103";case"max":return"104";case"min":return"105";case"stddev":return"107";case"sum":return"109";case"var":return"110"}return null}_checkColumnNameExist(e){var t,o=this.getColumns();for(t=0;t<o.length;t++)if(o[t].name.toLowerCase()===e.toLowerCase())return!0;return!1}_adjustTableRangeWithHeaderRow(){var e,t,o,i,s=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(this._showHeaderRow){if(this._sheet._needMoveDownTable(this)){o=this.getRange();i=new wijmo_grid_1.CellRange(o.bottomRow+1,o.col,o.bottomRow+1,o.col2);if(!this._sheet._canShiftCells(i))throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";if(1===this._sheet._needAddRowCountForInsertTableRows(1,o))if(s.collectionView){s.collectionView.beginUpdate();s.itemsSource instanceof wijmo_1.CollectionView?s.itemsSource.sourceCollection.push({}):s.itemsSource.push({});s.collectionView.endUpdate(!0)}else s.rows.push(new wijmo_grid_1.Row);this._sheet._moveDownCells(1,i);this._sheet._moveDownTable(this)}this._range.row<=this._range.row2?this._range.row-=1:this._range.row2-=1;for(e=0;e<this._columns.length;e++){t=this._columns[e];this._orgHeaderCellsContent[e]=s.getCellData(this._range.topRow,this._range.leftCol+e,!1);s.setCellData(this._range.topRow,this._range.leftCol+e,t.name)}}else{for(e=this._range.leftCol;e<=this._range.rightCol;e++)s.setCellData(this._range.topRow,e,"");this._range.row<=this._range.row2?this._range.row+=1:this._range.row2+=1}}_adjustTableRangeWithTotalRow(){var e,t,o,i=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;t=this.getRange();o=new wijmo_grid_1.CellRange(t.bottomRow+1,t.col,t.bottomRow+1,t.col2);if(this._showTotalRow){if(this._sheet._canShiftCells(o)){if(1===this._sheet._needAddRowCountForInsertTableRows(1,t))if(i.collectionView){i.collectionView.beginUpdate();i.itemsSource instanceof wijmo_1.CollectionView?i.itemsSource.sourceCollection.push({}):i.itemsSource.push({});i.collectionView.endUpdate(!0)}else i.rows.push(new wijmo_grid_1.Row);this._sheet._moveDownCells(1,o);this._owner._updateAffectedFormula(this._range.bottomRow+1,1,!0,!0,this.getRange())}else if(!this._beneathRowIsEmpty())throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";this._range.row<=this._range.row2?this._range.row2+=1:this._range.row+=1;this._updateTotalRow()}else{for(e=this._range.leftCol;e<=this._range.rightCol;e++)i.setCellData(this._range.bottomRow,e,"");if(this._sheet._canShiftCells(o)){this._owner._updateAffectedFormula(this._range.bottomRow,1,!1,!0,this.getRange());this._sheet._moveUpCells(1,o)}this._range.row<=this._range.row2?this._range.row2-=1:this._range.row-=1}}_updateTotalRow(){let e;if(this.showTotalRow)for(let t=0;t<this._columns.length;t++){e=this._columns[t];this._updateColumnTotalRowContent(e,t)}}_getUniqueColumnName(e,t){var o,i=1;null!=t&&""!==t||(t="Column"+e);if(this._checkColumnNameExist(t)){o=t+i;for(;this._checkColumnNameExist(o);)o=t+ ++i;t=o}return t}_moveColumns(e,t){if(!this._columns)return;let o=this._columns[e];this._columns.splice(e,1);t<0&&(t=this._columns.length);this._columns.splice(t,0,o)}_canInsertRowsWithoutShift(e){var t,o,i,s,l,n=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(this._range.bottomRow+e>=n.rows.length)return!1;for(t=1;t<=e;t++){o=this._range.bottomRow+t;for(i=this._range.leftCol;i<=this._range.rightCol;i++){s=n.getCellData(o,i,!1);l=this._sheet.getCellStyle(o,i);if(null!=s&&""!==s||null!=l)return!1}}return!0}_beneathRowIsEmpty(){let e,t,o,i,s,l,n=this._range.bottomRow+1,r=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(n>=r.rows.length)return!1;for(e=this._range.leftCol;e<=this._range.rightCol;e++){if(null!=(t=r.getCellData(this._range.bottomRow+1,e,!1))&&""!==t)return!1;if(null!=(o=this._sheet.getCellStyle(this._range.bottomRow+1,e)))return!1;if(null!=(i=this._sheet.findTable(n,e)))return null;s=n*r.columns.length+e;if(null!=(l=this._sheet._mergedRanges[s]))return!1}return!0}_getDataRange(){var e=this._range.topRow,t=this._range.bottomRow;this._showHeaderRow&&(e+=1);this._showTotalRow&&(t-=1);return new wijmo_grid_1.CellRange(e,this._range.leftCol,t,this._range.rightCol)}_getHeaderRange(){return this._showHeaderRow?new wijmo_grid_1.CellRange(this._range.topRow,this._range.leftCol,this._range.topRow,this._range.rightCol):null}_getFooterRange(){return this._showTotalRow?new wijmo_grid_1.CellRange(this._range.bottomRow,this._range.leftCol,this._range.bottomRow,this._range.rightCol):null}_getColumnIndex(e){var t,o,i;if(wijmo_1.isInt(e)&&e>=0&&e<this._columns.length)t=e;else{e instanceof TableColumn?o=e.name.toLowerCase():wijmo_1.isString(e)&&""!==e&&(o=e.toLowerCase());i=this.getColumns();for(var s=0;s<i.length;s++)if(i[s].name.toLowerCase()===o){t=s;break}}return t}}exports.Table=Table;class TableColumn{constructor(e,t,o,i=!0){this._name=e;this._totalRowLabel=t;this._totalRowFunction=o;null!=i&&(this._showFilterButton=i)}get table(){return this._table}get name(){return this._name}set name(e){e!==this._name&&(this._name=e)}get totalRowLabel(){return this._totalRowLabel}set totalRowLabel(e){if(e!==this._totalRowLabel){this._totalRowLabel=e;this._updateTableTotalInfo()}}get totalRowFunction(){return this._totalRowFunction}set totalRowFunction(e){if(e!==this._totalRowFunction){this._totalRowFunction=e;this._updateTableTotalInfo()}}get showFilterButton(){return this._showFilterButton}set showFilterButton(e){this._showFilterButton!==e&&(this._showFilterButton=e)}_attach(e){this._table=e}_updateTableTotalInfo(){if(this._table&&this._table.showTotalRow){this._table._updateColumnTotalRowContent(this);this._table._owner&&this._table._owner.refresh()}}}exports.TableColumn=TableColumn;class TableStyle{constructor(e,t=!1){this._name=e;this._isBuiltIn=t}get name(){return this._name}set name(e){e!==this._name&&(this._name=e)}get wholeTableStyle(){return this._wholeTableStyle}set wholeTableStyle(e){this._wholeTableStyle=e}get firstBandedColumnStyle(){return this._firstBandedColumnStyle}set firstBandedColumnStyle(e){this._firstBandedColumnStyle=e}get secondBandedColumnStyle(){return this._secondBandedColumnStyle}set secondBandedColumnStyle(e){this._secondBandedColumnStyle=e}get firstBandedRowStyle(){return this._firstBandedRowStyle}set firstBandedRowStyle(e){this._firstBandedRowStyle=e}get secondBandedRowStyle(){return this._secondBandedRowStyle}set secondBandedRowStyle(e){this._secondBandedRowStyle=e}get firstColumnStyle(){return this._firstColumnStyle}set firstColumnStyle(e){this._firstColumnStyle=e}get lastColumnStyle(){return this._lastColumnStyle}set lastColumnStyle(e){this._lastColumnStyle=e}get headerRowStyle(){return this._headerRowStyle}set headerRowStyle(e){this._headerRowStyle=e}get totalRowStyle(){return this._totalRowStyle}set totalRowStyle(e){this._totalRowStyle=e}get firstHeaderCellStyle(){return this._firstHeaderCellStyle}set firstHeaderCellStyle(e){this._firstHeaderCellStyle=e}get lastHeaderCellStyle(){return this._lastHeaderCellStyle}set lastHeaderCellStyle(e){this._lastHeaderCellStyle=e}get firstTotalCellStyle(){return this._firstTotalCellStyle}set firstTotalCellStyle(e){this._firstTotalCellStyle=e}get lastTotalCellStyle(){return this._lastTotalCellStyle}set lastTotalCellStyle(e){this._lastTotalCellStyle=e}get isBuiltIn(){return this._isBuiltIn}}exports.TableStyle=TableStyle;!function(e){e[e.All=0]="All";e[e.Data=1]="Data";e[e.Header=2]="Header";e[e.Footer=3]="Footer"}(TableSection=exports.TableSection||(exports.TableSection={}));class _UndoAction{constructor(e){this._owner=e;this._sheetIndex=e.selectedSheetIndex}get sheetIndex(){return this._sheetIndex}undo(){throw"This abstract method must be overridden."}redo(){throw"This abstract method must be overridden."}saveNewState(){throw"This abstract method must be overridden."}}exports._UndoAction=_UndoAction;class _EditAction extends _UndoAction{constructor(e,t){super(e);this._isPaste=!1;this._selections=t?[t]:e.selectedSheet.selectionRanges.length>0?e.selectedSheet.selectionRanges.slice():[e.selection.clone()];this._mergeAction=new _CellMergeAction(e);this._cellStyleAction=new _CellStyleAction(e);this._saveValues(!0)}get isPaste(){return this._isPaste}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){if(!this._saveValues(!1))return!1;this._mergeAction.saveNewState();this._cellStyleAction.saveNewState();return this._checkActionState()}markIsPaste(){this._isPaste=!0}updateForPasting(e){var t=this._selections[this._selections.length-1],o=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);if(!t){t=this._owner.selection;this._selections=[t]}o=null==o?"":o;this._oldValues["r"+e.row+"_c"+e.col]={row:e.row,col:e.col,value:o};t.row=Math.min(t.topRow,e.topRow);t.row2=Math.max(t.bottomRow,e.bottomRow);t.col=Math.min(t.leftCol,e.leftCol);t.col2=Math.max(t.rightCol,e.rightCol)}_storeDeletedTables(e){null==this._deletedTables&&(this._deletedTables=[]);this._deletedTables.push(e)}_checkActionState(){var e=this,t=!1;Object.keys(e._oldValues).forEach(o=>{var i,s;if(!t){i=e._oldValues[o];s=e._newValues[o];i&&s&&i.value!==s.value&&(t=!0)}});return t||e._mergeAction._checkActionState()||e._cellStyleAction._checkActionState()}_saveValues(e){var t,o,i,s,l,n,r={};for(t=0;t<this._selections.length;t++)for(s=(o=this._selections[t]).topRow;s<=o.bottomRow;s++)for(l=o.leftCol;l<=o.rightCol;l++){if(!(i=this._owner.columns[l]))return!1;n=null==(n=this._owner.getCellData(s,l,!!i.dataMap))?"":n;r["r"+s+"_c"+l]={row:s,col:l,value:n}}e?this._oldValues=r:this._newValues=r;return!0}_handleUndoRedo(e){var t=this;t._owner._clearCalcEngine();t._owner.selectedSheet.selectionRanges.clear();t._owner.deferUpdate(()=>{var o,i,s,l,n,r,a,h=e?t._oldValues:t._newValues;if(t._deletedTables&&t._deletedTables.length>0)for(o=0;o<t._deletedTables.length;o++){i=t._deletedTables[o];e?t._owner.selectedSheet.tables.push(i):t._owner.selectedSheet.tables.remove(i)}for(s=0;s<t._selections.length;s++){l=t._selections[s];t._owner.selectedSheet.selectionRanges.push(l)}Object.keys(h).forEach(e=>{var o=h[e];t._owner.setCellData(o.row,o.col,o.value)});t._affectedFormulas&&(n=e?t._affectedFormulas.oldFormulas:t._affectedFormulas.newFormulas);if(n&&n.length>0)for(a=0;a<n.length;a++){r=n[a];t._owner.setCellData(r.point.x,r.point.y,r.formula)}if(e){t._mergeAction.undo();t._cellStyleAction.undo()}else{t._mergeAction.redo();t._cellStyleAction.redo()}t._owner.refresh(!1)})}}exports._EditAction=_EditAction;class _ColumnResizeAction extends _UndoAction{constructor(e,t,o){super(e);this._panel=t;this._colIndex=o;this._oldColWidth=t.columns[o].width}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._newColWidth=this._panel.columns[this._colIndex].width;return this._oldColWidth!==this._newColWidth}_handleUndoRedo(e){var t=this._panel.columns[this._colIndex];t&&(t.width=e?this._oldColWidth:this._newColWidth)}}exports._ColumnResizeAction=_ColumnResizeAction;class _RowResizeAction extends _UndoAction{constructor(e,t,o){super(e);this._panel=t;this._rowIndex=o;this._oldRowHeight=t.rows[o].height}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._newRowHeight=this._panel.rows[this._rowIndex].height;return this._oldRowHeight!==this._newRowHeight}_handleUndoRedo(e){var t=this._panel.rows[this._rowIndex];t&&(t.height=e?this._oldRowHeight:this._newRowHeight)}}exports._RowResizeAction=_RowResizeAction;class _ColumnsChangedAction extends _UndoAction{constructor(e,t,o,i){super(e);this._delSubActions=[];this._columnIndex=t;this._count=o;this._isAdding=i;this._saveValues(!0)}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._saveValues(!1);return!0}_saveValues(e){var t,o,i,s,l=[],n=[];if(null==this._isAdding)for(t=0;t<this._owner.columns.length;t++)l.push(this._owner.columns[t]);else if(e&&!this._isAdding||!e&&this._isAdding)for(t=this._columnIndex;t<this._columnIndex+this._count&&t<this._owner.columns.length;t++)l.push(this._owner.columns[t]);if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(o=0;o<this._owner.selectedSheet.tables.length;o++)(i=this._owner.selectedSheet.tables[o])&&i.sheet.name===this._owner.selectedSheet.name&&n.push({name:i.name,range:i.getRange(),columns:i.getColumns()});s={columns:l,sortList:this._owner.sortManager._cloneSortList(this._owner.sortManager._committedList),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableRanges:n,selection:this._owner.selection,filterDef:this._owner.selectedSheet._filterDefinition};e?this._oldValue=s:this._newValue=s}_handleUndoRedo(e,t=!0){var o,i,s,l,n,r,a,h,d,_,u,c,g=e?this._oldValue:this._newValue;if(this._owner.selectedSheet)if(this._delSubActions.length)this._owner.deferUpdate(()=>{if(e)for(let t=this._delSubActions.length-1;t>=0;t--){this._delSubActions[t]._handleUndoRedo(e,!1)}else for(let t=0;t<this._delSubActions.length;t++){this._delSubActions[t]._handleUndoRedo(e,!1)}});else{try{t&&this._owner.beginUpdate();let w;this._owner._isUndoing=!0;this._owner._clearCalcEngine();this._owner.finishEditing();if(null==this._isAdding){this._owner.columns.clear();this._columnIndex=0}this._owner.selectedSheet._styledCells=null;this._owner.selectedSheet._mergedRanges.length=0;this._owner.columns.beginUpdate();if(g.columns&&g.columns.length>0){for(o=0;o<g.columns.length;o++)if((i=g.columns[o])&&i.isVisible){this._owner.columns.insert(this._columnIndex+o,i);if(this._owner.itemsSource&&(w=this._owner.allowAddNew&&this._owner.newRowAtTop?this._owner.rows[1]:this._owner.rows[0])){w._ubv||(w._ubv={});w._ubv[i._hash]=i.header}}}else for(o=this._columnIndex+this._count-1;o>=this._columnIndex;o--)(i=this._owner.columns[o])&&i.isVisible&&this._owner.columns.removeAt(o);this._owner.columns.endUpdate();this._owner.selectedSheet._styledCells=this._owner._cloneObject(g.styledCells);for(c=0;c<g.mergedCells.length;c++)this._owner.selectedSheet._mergedRanges[c]=g.mergedCells[c];for(l=0;l<g.tableRanges.length;l++){n=g.tableRanges[l];(r=this._owner._getTable(n.name))&&r._setTableRange(n.range,n.columns)}this._affectedFormulas&&(h=e?this._affectedFormulas.oldFormulas:this._affectedFormulas.newFormulas);if(h&&h.length>0)for(s=0;s<h.length;s++)null!=(a=h[s]).point?a.sheet.name===this._owner.selectedSheet.name?this._owner.setCellData(a.point.x,a.point.y,a.formula):a.sheet.grid.setCellData(a.point.x,a.point.y,a.formula):a.row._ubv[a.column._hash]=a.formula;if(this._deletedTables&&this._deletedTables.length>0)for(l=0;l<this._deletedTables.length;l++){r=this._deletedTables[l];e?this._owner.selectedSheet.tables.push(r):this._owner.selectedSheet.tables.remove(r)}this._affectedDefinedNameVals&&(d=e?this._affectedDefinedNameVals.oldDefinedNameVals:this._affectedDefinedNameVals.newDefinedNameVals);if(d&&d.length>0)for(s=0;s<d.length;s++){_=d[s];(u=this._owner._getDefinedNameIndexByName(_.name))>-1&&(this._owner.definedNames[u].value=_.value)}this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner._isUndoing=!1}finally{t&&this._owner.endUpdate()}this._owner._copyColumnsToSelectedSheet();this._owner.sortManager.sortDescriptions.sourceCollection=g.sortList.slice();this._owner.selectedSheet._filterDefinition=g.filterDef;this._owner.sortManager.commitSort(!1);this._owner.selection=g.selection}}}exports._ColumnsChangedAction=_ColumnsChangedAction;class _RowsChangedAction extends _UndoAction{constructor(e,t,o,i){super(e);this._delSubActions=[];this._rowIndex=t;this._count=o;this._isAdding=i;this._saveValues(!0)}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._saveValues(!1);return!0}addDeleteSubAction(e){this._delSubActions.push(e)}_saveValues(e){var t,o,i,s,l,n,r,a,h=[],d=[],_=[];if(null==this._isAdding)if(this._owner.itemsSource){n=this._owner.itemsSource instanceof wijmo_1.CollectionView?this._owner.itemsSource.sourceCollection.slice():this._owner.itemsSource.slice();for(i=0;i<this._owner.columns.length;i++)d.push(this._owner.columns[i])}else for(t=0;t<this._owner.rows.length;t++)h.push(this._owner.rows[t]);else{if(e&&!this._isAdding||!e&&this._isAdding)for(t=this._rowIndex;t<this._rowIndex+this._count&&t<this._owner.rows.length;t++)(o=this._owner.rows[t]).isVisible||this._isAdding?h.push(o):h.push(null);this._owner.collectionView&&this._owner.collectionView.sortDescriptions.length>0&&(r=this._owner.collectionView._view.slice())}if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(s=0;s<this._owner.selectedSheet.tables.length;s++)(l=this._owner.selectedSheet.tables[s])&&l.sheet.name===this._owner.selectedSheet.name&&_.push({name:l.name,range:l.getRange(),setting:{showHeaderRow:l.showHeaderRow,showTotalRow:l.showTotalRow}});a={rows:h,columns:d,itemsSource:n,styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableSettings:_,selection:this._owner.selection,dataView:r,scrollPosition:this._owner.scrollPosition};e?this._oldValue=a:this._newValue=a}_handleUndoRedo(e,t=!0){var o,i,s,l,n,r,a,h,d,_,u,c,g,w,m,f,p,C=!!this._owner.itemsSource,S=e?this._oldValue:this._newValue;if(this._owner.selectedSheet)if(this._delSubActions.length)this._owner.deferUpdate(()=>{if(e)for(let t=this._delSubActions.length-1;t>=0;t--){this._delSubActions[t]._handleUndoRedo(e,!1)}else for(let t=0;t<this._delSubActions.length;t++){this._delSubActions[t]._handleUndoRedo(e,!1)}});else{try{t&&this._owner.beginUpdate();this._owner._isUndoing=!0;this._owner._clearCalcEngine();this._owner.finishEditing();if(null==this._isAdding){this._owner.itemsSource&&this._owner.columns.clear();this._owner.rows.clear();this._rowIndex=0}this._owner.selectedSheet._styledCells=null;this._owner.selectedSheet._mergedRanges.length=0;if(null==this._isAdding&&C){m=this._owner.autoGenerateColumns;this._owner.autoGenerateColumns=!1;this._owner.collectionView.beginUpdate();if(this._owner.itemsSource instanceof wijmo_1.CollectionView){w=[0,this._owner.itemsSource.sourceCollection.length].concat(S.itemsSource);Array.prototype.splice.apply(this._owner.itemsSource.sourceCollection,w)}else this._owner.itemsSource=S.itemsSource.slice();this._owner.columns.beginUpdate();for(s=0;s<S.columns.length;s++)this._owner.columns.push(S.columns[s]);this._owner.columns.endUpdate();this._owner.collectionView.endUpdate(!0);this._owner.autoGenerateColumns=m}else{this._owner.rows.beginUpdate();if(C){m=this._owner.autoGenerateColumns;this._owner.autoGenerateColumns=!1;f=this._rowIndex-(this._owner.allowAddNew&&this._owner.newRowAtTop?2:1);this._owner.collectionView.beginUpdate()}if(S.rows&&S.rows.length>0){for(o=0;o<S.rows.length;o++)if(i=S.rows[o])if(C&&i.dataItem){p=null!=i.dataItem._itemIdx?i.dataItem._itemIdx:f+o;if(this._owner.itemsSource instanceof wijmo_1.CollectionView){this._owner._updateItemIndexForInsertingRow(this._owner.itemsSource.sourceCollection,p,1);this._owner.itemsSource.sourceCollection.splice(p,0,i.dataItem)}else{this._owner._updateItemIndexForInsertingRow(this._owner.itemsSource,p,1);this._owner.itemsSource.splice(p,0,i.dataItem)}}else this._owner.rows.insert(this._rowIndex+o,i)}else for(o=this._rowIndex+this._count-1;o>=this._rowIndex;o--)if(i=this._owner.rows[o])if(C&&i.dataItem){p=null!=i.dataItem._itemIdx?i.dataItem._itemIdx:o-(this._owner.allowAddNew&&this._owner.newRowAtTop?2:1);if(this._owner.itemsSource instanceof wijmo_1.CollectionView){this._owner.itemsSource.sourceCollection.splice(p,1);this._owner._updateItemIndexForRemovingRow(this._owner.itemsSource.sourceCollection,p)}else{this._owner.itemsSource.splice(p,1);this._owner._updateItemIndexForRemovingRow(this._owner.itemsSource,p)}}else this._owner.rows.removeAt(o);if(C){this._owner._lastCount=this._owner.collectionView.itemCount;this._owner.collectionView.endUpdate(!0);if(S.dataView&&S.dataView.length>0){this._owner.collectionView._view=S.dataView;this._owner.collectionView._pgView=this._owner.collectionView._getPageView();if(!(this._owner.itemsSource instanceof wijmo_1.CollectionView)){this._owner.selectedSheet.grid.collectionView._view=S.dataView;this._owner.selectedSheet.grid.collectionView._pgView=this._owner.selectedSheet.grid.collectionView._getPageView()}this._owner._bindGrid(!1);this._owner.selectedSheet.grid._bindGrid(!1)}this._owner.autoGenerateColumns=m}this._owner.rows.endUpdate()}this._owner.selectedSheet._styledCells=this._owner._cloneObject(S.styledCells);for(g=0;g<S.mergedCells.length;g++)this._owner.selectedSheet._mergedRanges[g]=S.mergedCells[g];for(n=0;n<S.tableSettings.length;n++){r=S.tableSettings[n];if(a=this._owner._getTable(r.name)){a._showHeaderRow=r.setting.showHeaderRow;a._showTotalRow=r.setting.showTotalRow;a._setTableRange(r.range)}}this._affectedFormulas&&(d=e?this._affectedFormulas.oldFormulas:this._affectedFormulas.newFormulas);if(d&&d.length>0)for(l=0;l<d.length;l++)null!=(h=d[l]).point?h.sheet.name===this._owner.selectedSheet.name?this._owner.setCellData(h.point.x,h.point.y,h.formula):h.sheet.grid.setCellData(h.point.x,h.point.y,h.formula):h.row._ubv[h.column._hash]=h.formula;if(this._deletedTables&&this._deletedTables.length>0)for(n=0;n<this._deletedTables.length;n++){a=this._deletedTables[n];e?this._owner.selectedSheet.tables.push(a):this._owner.selectedSheet.tables.remove(a)}this._affectedDefinedNameVals&&(_=e?this._affectedDefinedNameVals.oldDefinedNameVals:this._affectedDefinedNameVals.newDefinedNameVals);if(_&&_.length>0)for(l=0;l<_.length;l++){u=_[l];(c=this._owner._getDefinedNameIndexByName(u.name))>-1&&(this._owner.definedNames[c].value=u.value)}this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.selection=S.selection;this._owner.scrollPosition=S.scrollPosition;this._owner._isUndoing=!1}finally{t&&this._owner.endUpdate()}this._owner._copyRowsToSelectedSheet()}}}exports._RowsChangedAction=_RowsChangedAction;class _CellStyleAction extends _UndoAction{constructor(e,t){super(e);this._oldStyledCells=t?e._cloneObject(t):e.selectedSheet?e._cloneObject(e.selectedSheet._styledCells):null}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._newStyledCells=this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null;return!0}_checkActionState(){return null!=this._oldStyledCells&&null==this._newStyledCells||null==this._oldStyledCells&&null!=this._newStyledCells||null!=this._oldStyledCells&&null!=this._newStyledCells&&this._oldStyledCells.length!==this._newStyledCells.length}_handleUndoRedo(e){var t;if(this._owner.selectedSheet){t=e?this._oldStyledCells:this._newStyledCells;this._owner.selectedSheet._styledCells=this._owner._cloneObject(t);this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells;this._owner.refresh(!1)}}}exports._CellStyleAction=_CellStyleAction;class _CellMergeAction extends _UndoAction{constructor(e){super(e);this._oldMergedCells=e.selectedSheet?e.selectedSheet._cloneMergedCells():null}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._newMergedCells=this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null;return!0}_handleUndoRedo(e){var t,o;if(this._owner.selectedSheet){t=e?this._oldMergedCells:this._newMergedCells;this._owner._clearCalcEngine();if(t){this._owner.selectedSheet._mergedRanges.length=0;for(o=0;o<t.length;o++)this._owner.selectedSheet._mergedRanges[o]=t[o]}this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges;this._owner.refresh(!0)}}_checkActionState(){let e,t,o;if(null!=this._oldMergedCells&&null==this._newMergedCells||null==this._oldMergedCells&&null!=this._newMergedCells)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length!==this._newMergedCells.length)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length===this._newMergedCells.length)for(e=0;e<this._oldMergedCells.length;e++){o=this._oldMergedCells[e];t=this._oldMergedCells[e];if(!o.equals(t))return!0}return!1}}exports._CellMergeAction=_CellMergeAction;class _SortColumnAction extends _UndoAction{constructor(e){super(e);this._saveValues(!0)}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._saveValues(!1);return!0}_saveValues(e){var t,o,i,s,l,n,r,a,h,d=[];for(o=0;o<this._owner.columns.length;o++)d.push(this._owner.columns[o]);if(this._owner.itemsSource){s=this._owner.allowAddNew&&this._owner.newRowAtTop?2:1;l=[];for(let e=0;e<this._owner.rows.length-s;e++)(r=(n=this._owner.rows[e+s]).dataItem)&&(l[null!=r._itemIdx?r._itemIdx:e]=n.visible);e&&(h=this._owner.collectionView._view.slice())}else{i=[];for(t=0;t<this._owner.rows.length;t++)i.push(this._owner.rows[t])}a={sortList:this._owner.sortManager._committedList.slice(),rows:i,columns:d,selection:this._owner.selection.clone(),formulas:this._owner._scanFormulas(),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,rowsVisible:l,dataView:h};e?this._oldValue=a:this._newValue=a}_handleUndoRedo(e){var t,o,i,s,l=this,n=e?l._oldValue:l._newValue,r=!!l._owner.itemsSource,a=this._owner.itemsSource instanceof wijmo_1.CollectionView;if(l._owner.selectedSheet){l._owner._isUndoing=!0;l._owner.deferUpdate(()=>{l._owner._clearCalcEngine();l._owner.sortManager.sortDescriptions.sourceCollection=n.sortList.slice();l._owner.sortManager.commitSort(!1);l._owner.selectedSheet._styledCells=l._owner._cloneObject(n.styledCells);if(r){if(n.dataView&&n.dataView.length>0){l._owner.collectionView._view=n.dataView;l._owner.collectionView._pgView=l._owner.collectionView._getPageView();if(!a){l._owner.selectedSheet.grid.collectionView._view=n.dataView;l._owner.selectedSheet.grid.collectionView._pgView=l._owner.selectedSheet.grid.collectionView._getPageView()}l._owner._bindGrid(!1);l._owner.selectedSheet.grid._bindGrid(!1)}}else{l._owner.rows.clear();l._owner.selectedSheet.grid.rows.clear();for(t=0;t<n.rows.length;t++){i=n.rows[t];l._owner.selectedSheet.grid.rows.push(i);l._owner.rows.push(i)}l._owner.columns.clear();for(o=0;o<n.columns.length;o++){s=n.columns[o];l._owner.columns.push(s)}l._owner._resetFormulas(n.formulas)}l._owner._isUndoing=!1})}}}exports._SortColumnAction=_SortColumnAction;class _MoveCellsAction extends _UndoAction{constructor(e,t,o,i){super(e);if(e.selectedSheet){0===t.topRow&&t.bottomRow===e.rows.length-1?this._isDraggingColumns=!0:this._isDraggingColumns=!1;this._isCopyCells=i;this._dragRange=t;this._dropRange=o;this._saveValues(!0)}}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){if(!this._owner.selectedSheet)return!1;if(this._dropRange){this._saveValues(!1);return!0}return!1}_saveValues(e){var t,o,i,s,l,n,r,a,h,d,_,u;_=[];u={};for(t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(o=this._dropRange.leftCol;o<=this._dropRange.rightCol;o++){this._isDraggingColumns&&(u[o]||(u[o]={dataType:this._owner.columns[o].dataType,align:this._owner.columns[o].align,format:this._owner.columns[o].format}));i=t*this._owner.columns.length+o;l=this._owner.selectedSheet._styledCells[i]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[i]):null;s=this._owner.getCellData(t,o,!1);_.push({rowIndex:t,columnIndex:o,cellContent:s,cellStyle:l})}if(e){this._oldDroppingCells=_;this._oldDroppingColumnSetting=u}else{this._newDroppingCells=_;this._newDroppingColumnSetting=u}if(this._isCopyCells){if(this._isDraggingColumns)if(e){for(t=this._dragRange.topRow;t<=this._dragRange.bottomRow;t++)for(o=this._dragRange.leftCol;o<=this._dragRange.rightCol;o++)if(a=this._owner.selectedSheet.findTable(t,o)){h=a.getRange();d=a.getColumns();if(a.showHeaderRow&&t===h.topRow){this._draggingTableColumns||(this._draggingTableColumns=[]);this._draggingTableColumns.push({rowIndex:t,columnIndex:o,cellContent:d[o-h.leftCol].name})}}}else if(this._draggingTableColumns&&this._draggingTableColumns.length>0&&this._draggingTableColumns&&this._draggingTableColumns.length>0)for(n=0;n<this._draggingTableColumns.length;n++){r=this._draggingTableColumns[n];if(a=this._owner.selectedSheet.findTable(r.rowIndex,r.columnIndex)){h=a.getRange();d=a.getColumns();a.showHeaderRow&&r.rowIndex===h.topRow&&(r.updatedCellContent=d[r.columnIndex-h.leftCol].name)}}}else if(e){this._draggingCells=[];this._draggingColumnSetting={};for(t=this._dragRange.topRow;t<=this._dragRange.bottomRow;t++)for(o=this._dragRange.leftCol;o<=this._dragRange.rightCol;o++){this._isDraggingColumns&&(this._draggingColumnSetting[o]||(this._draggingColumnSetting[o]={dataType:this._owner.columns[o].dataType,align:this._owner.columns[o].align,format:this._owner.columns[o].format}));i=t*this._owner.columns.length+o;l=this._owner.selectedSheet._styledCells[i]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[i]):null;s=this._owner.getCellData(t,o,!1);this._draggingCells.push({rowIndex:t,columnIndex:o,cellContent:s,cellStyle:l})}}else if(this._isDraggingColumns&&this._draggingCells&&this._draggingCells.length>0)for(n=0;n<this._draggingCells.length;n++){r=this._draggingCells[n];if(a=this._owner.selectedSheet.findTable(r.rowIndex,r.columnIndex)){h=a.getRange();d=a.getColumns();a.showHeaderRow&&r.rowIndex===h.topRow&&(r.updatedCellContent=d[r.columnIndex-h.leftCol].name)}}}_handleUndoRedo(e){var t,o,i,s,l,n,r,a,h,d,_=this,u=e?_._oldDroppingCells:_._newDroppingCells,c=e?_._oldDroppingColumnSetting:_._newDroppingColumnSetting;if(_._owner.selectedSheet){_._owner._clearCalcEngine();_._owner.deferUpdate(()=>{var g,w,m;_._affectedFormulas&&(n=e?_._affectedFormulas.oldFormulas:_._affectedFormulas.newFormulas);if(n&&n.length>0)for(t=0;t<n.length;t++)(r=n[t]).sheet.name===_._owner.selectedSheet.name?_._owner.setCellData(r.point.x,r.point.y,r.formula):r.sheet.grid.setCellData(r.point.x,r.point.y,r.formula);_._affectedDefinedNameVals&&(a=e?_._affectedDefinedNameVals.oldDefinedNameVals:_._affectedDefinedNameVals.newDefinedNameVals);if(a&&a.length>0)for(t=0;t<a.length;t++){h=a[t];(d=_._owner._getDefinedNameIndexByName(h.name))>-1&&(_._owner.definedNames[d].value=h.value)}for(t=0;t<u.length;t++){o=u[t];_._owner.setCellData(o.rowIndex,o.columnIndex,o.cellContent);if(g=_._owner.selectedSheet.findTable(o.rowIndex,o.columnIndex)){w=g.getRange();m=g.getColumns();g.showHeaderRow&&o.rowIndex===w.topRow&&(m[o.columnIndex-w.leftCol].name=o.cellContent)}i=o.rowIndex*_._owner.columns.length+o.columnIndex;o.cellStyle?_._owner.selectedSheet._styledCells[i]=o.cellStyle:delete _._owner.selectedSheet._styledCells[i]}_._isDraggingColumns&&c&&Object.keys(c).forEach(e=>{_._owner.columns[+e].dataType=c[+e].dataType?c[+e].dataType:wijmo_1.DataType.Object;_._owner.columns[+e].align=c[+e].align;_._owner.columns[+e].format=c[+e].format});if(_._isCopyCells){if(_._draggingTableColumns&&_._draggingTableColumns.length>0)for(t=0;t<_._draggingTableColumns.length;t++){o=_._draggingTableColumns[t];if(g=_._owner.selectedSheet.findTable(o.rowIndex,o.columnIndex)){w=g.getRange();m=g.getColumns();if(g.showHeaderRow&&o.rowIndex===w.topRow){_._owner.setCellData(o.rowIndex,o.columnIndex,e?o.cellContent:o.updatedCellContent);m[o.columnIndex-w.leftCol].name=e?o.cellContent:o.updatedCellContent}}}}else{for(t=0;t<_._draggingCells.length;t++){o=_._draggingCells[t];if(g=_._owner.selectedSheet.findTable(o.rowIndex,o.columnIndex)){w=g.getRange();m=g.getColumns();if(g.showHeaderRow&&o.rowIndex===w.topRow){_._owner.setCellData(o.rowIndex,o.columnIndex,e?o.cellContent:o.updatedCellContent);m[o.columnIndex-w.leftCol].name=e?o.cellContent:o.updatedCellContent}else _._owner.setCellData(o.rowIndex,o.columnIndex,e?o.cellContent:null)}else _._owner.setCellData(o.rowIndex,o.columnIndex,e?o.cellContent:null);i=o.rowIndex*_._owner.columns.length+o.columnIndex;e?o.cellStyle&&(_._owner.selectedSheet._styledCells[i]=o.cellStyle):_._owner.selectedSheet._styledCells[i]&&delete _._owner.selectedSheet._styledCells[i]}_._isDraggingColumns&&_._draggingColumnSetting&&Object.keys(_._draggingColumnSetting).forEach(t=>{_._owner.columns[+t].dataType=e&&_._draggingColumnSetting[+t].dataType?_._draggingColumnSetting[+t].dataType:wijmo_1.DataType.Object;_._owner.columns[+t].align=e?_._draggingColumnSetting[+t].align:null;_._owner.columns[+t].format=e?_._draggingColumnSetting[+t].format:null});if(e){if(_._isDraggingColumns)if(_._dragRange.leftCol<_._dropRange.leftCol){l=_._dragRange.leftCol;for(s=_._dropRange.leftCol;s<=_._dropRange.rightCol;s++){_._owner._updateColumnFiler(s,l);l++}}else{l=_._dragRange.rightCol;for(s=_._dropRange.rightCol;s>=_._dropRange.leftCol;s--){_._owner._updateColumnFiler(s,l);l--}}}else if(_._isDraggingColumns)if(_._dragRange.leftCol>_._dropRange.leftCol){l=_._dropRange.leftCol;for(s=_._dragRange.leftCol;s<=_._dragRange.rightCol;s++){_._owner._updateColumnFiler(s,l);l++}}else{l=_._dropRange.rightCol;for(s=_._dragRange.rightCol;s>=_._dragRange.leftCol;s--){_._owner._updateColumnFiler(s,l);l--}}}})}}}exports._MoveCellsAction=_MoveCellsAction;class _CutAction extends _UndoAction{constructor(e){super(e);this._oldValues=[];this._mergeAction=new _CellMergeAction(e);this._celltyleAction=new _CellStyleAction(e);this._cutSheet=e._copiedSheet;this._selection=e.selection;this._cutSelection=e.selectionMode===wijmo_grid_1.SelectionMode.ListBox?e._getSelectionForListBoxMode(this._cutSheet.grid):e._copiedRanges[0];this._saveCutValues(!0)}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){var e,t,o;this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid;this._saveCutValues(!1);this._newValues=[];for(e=this._selection.topRow;e<=this._selection.bottomRow;e++)for(t=this._selection.leftCol;t<=this._selection.rightCol;t++){if(!this._owner.columns[t])return!1;o=null==(o=this._owner.getCellData(e,t,!!this._owner.columns[t].dataMap))?"":o;this._newValues.push({row:e,col:t,value:o})}this._mergeAction.saveNewState();this._celltyleAction.saveNewState();return!0}updateForPasting(e){var t=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);t=null==t?"":t;this._oldValues.push({row:e.row,col:e.col,value:t});this._selection.row=Math.min(this._selection.topRow,e.topRow);this._selection.row2=Math.max(this._selection.bottomRow,e.bottomRow);this._selection.col=Math.min(this._selection.leftCol,e.leftCol);this._selection.col2=Math.max(this._selection.rightCol,e.rightCol)}_saveCutValues(e){var t,o,i,s=this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid,l=[];for(t=this._cutSelection.topRow;t<=this._cutSelection.bottomRow;t++)if(null!=s.rows[t])for(o=this._cutSelection.leftCol;o<=this._cutSelection.rightCol;o++){i=null==(i=s.getCellData(t,o,!!s.columns[o].dataMap))?"":i;l.push({row:t,col:o,value:i})}e?this._oldCutValues=l:this._newCutValues=l}_handleUndoRedo(e){var t=this,o=e?t._oldCutValues:t._newCutValues,i=e?t._oldValues:t._newValues;t._owner._clearCalcEngine();t._owner.selectedSheet.selectionRanges.clear();t._owner.deferUpdate(()=>{var s,l,n=t._cutSheet===t._owner.selectedSheet?t._owner:t._cutSheet.grid;t._owner.selectedSheet.selectionRanges.push(t._selection);for(s=0;s<o.length;s++){l=o[s];n.setCellData(l.row,l.col,l.value)}for(s=0;s<i.length;s++){l=i[s];t._owner.setCellData(l.row,l.col,l.value)}if(e){t._mergeAction.undo();t._celltyleAction.undo()}else{t._mergeAction.redo();t._celltyleAction.redo()}t._owner.refresh(!1)})}}exports._CutAction=_CutAction;class _TableSettingAction extends _UndoAction{constructor(e,t){super(e);this._table=t;this._saveValues(!0)}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._saveValues(!1);return!0}_saveValues(e){var t={name:this._table.name,style:this._table.style,showHeaderRow:this._table.showHeaderRow,showTotalRow:this._table.showTotalRow,showbandedRows:this._table.showBandedRows,showBandedColumns:this._table.showBandedColumns,alterFirstColumn:this._table.alterFirstColumn,alterLastColumn:this._table.alterLastColumn};e?this._oldTableSetting=t:this._newTableSetting=t}_handleUndoRedo(e){var t=e?this._oldTableSetting:this._newTableSetting;this._owner.beginUpdate();this._owner._isUndoing=!0;this._table.name=t.name;this._table.style=t.style;this._table.showHeaderRow=t.showHeaderRow;this._table.showTotalRow=t.showTotalRow;this._table.showBandedRows=t.showbandedRows;this._table.showBandedColumns=t.showBandedColumns;this._table.alterFirstColumn=t.alterFirstColumn;this._table.alterLastColumn=t.alterLastColumn;this._owner._isUndoing=!1;this._owner.endUpdate()}}exports._TableSettingAction=_TableSettingAction;class _TableAction extends _UndoAction{constructor(e,t){super(e);this._addedTable=t;t.showHeaderRow&&(this._orgHeaderCellsContent=t._orgHeaderCellsContent.slice())}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}_handleUndoRedo(e){var t,o,i;e?this._owner.selectedSheet.tables.remove(this._addedTable):this._owner.selectedSheet.tables.push(this._addedTable);if(this._addedTable.showHeaderRow){o=this._addedTable.getRange();i=this._addedTable.getColumns();for(t=0;t<o.columnSpan;t++)this._owner.setCellData(o.topRow,o.leftCol+t,e?this._orgHeaderCellsContent[t]:i[t].name)}this._owner.refresh()}}exports._TableAction=_TableAction;class _FilteringAction extends _UndoAction{constructor(e){super(e);this._oldFilterDefinition=e.filter.filterDefinition;this._oldRowsVisible=this._getRowsVisible()}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._newFilterDefinition=this._owner.filter.filterDefinition;this._newRowsVisible=this._getRowsVisible();return!0}_handleUndoRedo(e){let t=e?this._oldFilterDefinition:this._newFilterDefinition;if(this._owner.filter.filterDefinition!==t){this._owner._isUndoing=!0;this._owner.selectedSheet._filterDefinition=t;this._owner.selectedSheet._applyFilterSetting();this._owner._isUndoing=!1;this._owner.filter.apply()}else this._setRowVisible(e)}_getRowsVisible(){let e,t=[],o=0;for(;o<this._owner.rows.length;o++)(e=this._owner.rows[o])&&t.push(e.visible);return t}_setRowVisible(e){let t,o=e?this._oldRowsVisible:this._newRowsVisible,i=0;for(;i<o.length;i++)(t=this._owner.rows[i])&&(t.visible=o[i])}}exports._FilteringAction=_FilteringAction;class _FillAction extends _UndoAction{constructor(e,t){super(e);this._fillSource=t.clone();this._oldCellSettings=e._orgCellSettings}undo(){this._handleUndoRedo(!0)}redo(){this._handleUndoRedo(!1)}saveNewState(){this._fillRange=this._owner.selection.clone();this._newCellSettings=this._owner._getCellSettingsForFill(this._fillSource,this._fillRange);return!0}_handleUndoRedo(e){let t,o,i,s,l,n,r=e?this._oldCellSettings:this._newCellSettings,a=e?this._fillSource:this._fillRange;this._owner.beginUpdate();n=this._fillRange.topRow<this._fillSource.topRow?new wijmo_grid_1.CellRange(this._fillRange.topRow,this._fillRange.col,this._fillSource.topRow-1,this._fillRange.col2):this._fillRange.leftCol===this._fillSource.leftCol&&this._fillRange.rightCol===this._fillSource.rightCol?new wijmo_grid_1.CellRange(this._fillSource.bottomRow+1,this._fillRange.col,this._fillRange.bottomRow,this._fillRange.col2):this._fillRange.leftCol<this._fillSource.leftCol?new wijmo_grid_1.CellRange(this._fillRange.row,this._fillRange.leftCol,this._fillRange.row2,this._fillSource.leftCol-1):new wijmo_grid_1.CellRange(this._fillRange.row,this._fillSource.rightCol+1,this._fillRange.row2,this._fillRange.rightCol);this._owner._resetMergedRange(n);if(r&&r.length>0)for(t=0;t<r.length;t++){i=(o=r[t]).row;s=o.col;l=i*this._owner.columns.length+s;this._owner.selectedSheet._styledCells[l]=o.style;this._owner.setCellData(i,s,o.value);o.mergedCell&&this._owner.mergeRange(o.mergedCell)}this._owner.selection=a;this._owner.endUpdate()}}exports._FillAction=_FillAction;class SortManager{constructor(e){this._owner=e;this._sortDescriptions=new wijmo_1.CollectionView;this._committedList=[new ColumnSortDescription(-1,!0)];this._sortDescriptions.newItemCreator=()=>new ColumnSortDescription(-1,!0)}get sortDescriptions(){return this._sortDescriptions}set sortDescriptions(e){this._sortDescriptions=e;this.commitSort()}addSortLevel(e,t=!0){var o=this._sortDescriptions.addNew();null!=e&&!isNaN(e)&&wijmo_1.isInt(e)&&(o.columnIndex=e);o.ascending=t;this._sortDescriptions.commitNew()}deleteSortLevel(e){var t;(t=null!=e?this._getSortItem(e):this._sortDescriptions.currentItem)&&this._sortDescriptions.remove(t)}copySortLevel(){var e=this._sortDescriptions.currentItem;if(e){var t=this._sortDescriptions.addNew();t.columnIndex=parseInt(e.columnIndex);t.ascending=e.ascending;this._sortDescriptions.commitNew()}}editSortLevel(e,t){null!=e&&(this._sortDescriptions.currentItem.columnIndex=e);null!=t&&(this._sortDescriptions.currentItem.ascending=t)}moveSortLevel(e){var t=this._sortDescriptions.currentItem;if(t){var o=this._sortDescriptions.sourceCollection,i=o.indexOf(t),s=i+e;if(i>-1&&s>-1){o.splice(i,1);o.splice(s,0,t);this._sortDescriptions.refresh();this._sortDescriptions.moveCurrentTo(t)}}}checkSortItemExists(e){for(var t=0,o=this._sortDescriptions.itemCount;t<o;t++)if(+this._sortDescriptions.items[t].columnIndex===e)return t;return-1}commitSort(e=!0){var t,o,i,s,l,n,r,a,h,d,_,u,c,g,w,m=this._owner,f=this._owner.itemsSource instanceof wijmo_1.CollectionView,p={};if(this._owner.selectedSheet&&0!==this._owner.columns.length){var C=null==this._owner.selectedSheet.grid.collectionView;m._needCopyToSheet=!1;n=m.selectedSheet._unboundSortDesc;e&&m.undoStack.stackSize>0&&(r=new _SortColumnAction(m));this._sortDescriptions.itemCount>0?this._committedList=this._cloneSortList(this._sortDescriptions.items):this._committedList=[new ColumnSortDescription(-1,!0)];if(m.collectionView){m._isSorting=!0;m.beginUpdate();(a=m.editableCollectionView)&&a.currentEditItem&&-1!==a.items.indexOf(a.currentEditItem)&&!this._isEmpty(a.currentEditItem)&&a.commitEdit();m.collectionView.beginUpdate();C||m.selectedSheet.grid.collectionView.beginUpdate();(i=m.collectionView.sortDescriptions).clear();h=m.selection.clone();g=m.allowAddNew&&m.newRowAtTop?m.rows[1]:m.rows[0];w=(m.allowAddNew&&m.newRowAtTop?1:0)+(g instanceof HeaderRow?1:0);let e=[];if(m.filter&&m.filter._filteringIsActive())for(l=0;l<m.rows.length-w;l++)(c=(u=m.rows[l+w]).dataItem)&&(e[_=null!=c._itemIdx?c._itemIdx:l]=u.visible);f||(s=C?m.collectionView.sortDescriptions:m.selectedSheet.grid.collectionView.sortDescriptions).clear();m.collectionView.sourceCollection.map((e,t)=>{null==e._itemIdx&&(e._itemIdx=t)});m.selection=h;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){m.collectionView.useStableSort=!0;f||C||(m.selectedSheet.grid.collectionView.useStableSort=!0)}for(l=0;l<this._sortDescriptions.itemCount;l++)if((t=this._sortDescriptions.items[l]).columnIndex>-1&&t.columnIndex<m.columns.length){o=new wijmo_1.SortDescription(m.columns[t.columnIndex].binding,t.ascending);i.push(o);f||s.push(o)}m.selectedSheet.selectionRanges.clear();m.collectionView.endUpdate(!0);C||m.selectedSheet.grid.collectionView.endUpdate(!0);h=m.selection.clone();d=m.collectionView._view.slice();for(l=0;l<d.length;l++){l!==(c=d[l])._itemIdx&&m._updateFormulaForReorderingRows(c._itemIdx+w,l+w);m._updateCellStyleForReorderingRows(c._itemIdx+w,l+w,p)}if(e.length)for(l=0;l<m.rows.length-w;l++)if(c=(u=m.rows[l+w]).dataItem){_=null!=c._itemIdx?c._itemIdx:l;u.visible=e[_]}d.map((e,t)=>{e._itemIdx=t});m.selectedSheet._styledCells=p;m.selection=h;m.endUpdate();m._copyColumnsToSelectedSheet();m._isSorting=!1}else{n.clear();for(l=0;l<this._sortDescriptions.itemCount;l++)(t=this._sortDescriptions.items[l]).columnIndex>-1&&n.push(new _UnboundSortDescription(m.columns[t.columnIndex],t.ascending));m.filter&&!m.filter._filteringIsActive()&&setTimeout(()=>m.filter.apply(),10)}if(r){r.saveNewState();m.undoStack._addAction(r)}m._copiedRanges=null;m._needCopyToSheet=!0}}cancelSort(){this._sortDescriptions.sourceCollection=this._committedList.slice()}clearSort(){this._sortDescriptions.sourceCollection=[];this.commitSort()}_getSortItem(e){var t=this.checkSortItemExists(e);if(t>-1)return this._sortDescriptions.items[t]}_cloneSortList(e){for(var t=[],o=0;o<e.length;o++)t[o]=e[o].clone();return t}_updateSortSortDescription(e,t,o=!0){let i,s;for(i=this._sortDescriptions.items.length-1;i>=0;i--){s=this._sortDescriptions.items[i];o?s.columnIndex>e&&(s.columnIndex+=t):s.columnIndex>=e+t?s.columnIndex-=t:s.columnIndex>=e&&this._sortDescriptions.remove(s)}}_isEmpty(e){var t=Object.prototype.hasOwnProperty;if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var o in e)if(t.call(e,o))return!1;return!0}}exports.SortManager=SortManager;class ColumnSortDescription{constructor(e,t){this._columnIndex=e;this._ascending=t}get columnIndex(){return this._columnIndex}set columnIndex(e){this._columnIndex=+e}get ascending(){return this._ascending}set ascending(e){this._ascending=e}clone(){return new ColumnSortDescription(this._columnIndex,this._ascending)}}exports.ColumnSortDescription=ColumnSortDescription;wijmo_1._addCultureInfo("FlexSheet",{insertRow:"Insert Row",deleteRow:"Delete Rows",insertCol:"Insert Column",deleteCol:"Delete Columns",convertTable:"Convert To Table",insertSheet:"Insert",deleteSheet:"Delete",renameSheet:"Rename",copyCells:"Copy Cells",fillSeries:"Fill Series",fillFormat:"Fill Formatting Only",fillWithoutFormat:"Fill Without Formatting"});var AutoFillOperation,_TokenType,_TokenID,_FlexSheetAggregate,_SubtotalFunction,FlexSheetFunctions=[{name:"abs",description:"Returns the absolute value of a number."},{name:"acos",description:"Returns the arccosine of a number."},{name:"address",description:"Obtains the address of a cell in a worksheet by given specified row and column numbers."},{name:"and",description:"Returns TRUE if all of its arguments are TRUE."},{name:"asin",description:"Returns the arcsine of a number."},{name:"atan",description:"Returns the arctangent of a number."},{name:"atan2",description:"Returns the arctangent from x- and y-coordinates."},{name:"average",description:"Returns the average of its arguments."},{name:"ceiling",description:"Rounds a number to the nearest integer or to the nearest multiple of significance."},{name:"char",description:"Returns the character specified by the code number."},{name:"choose",description:"Chooses a value from a list of values."},{name:"code",description:"Returns a numeric code for the first character in a text string."},{name:"column",description:"Returns the column number of a reference."},{name:"columns",description:"Returns the number of columns in a reference."},{name:"concatenate",description:"Joins several text items into one text item."},{name:"cos",description:"Returns the cosine of a number."},{name:"count",description:"Counts how many numbers are in the list of arguments."},{name:"counta",description:"Counts how many values are in the list of arguments."},{name:"countblank",description:"Counts the number of blank cells within a range."},{name:"countif",description:"Counts the number of cells within a range that meet the given criteria."},{name:"countifs",description:"Counts the number of cells within a range that meet multiple criteria."},{name:"date",description:"Returns the serial number of a particular date."},{name:"datedif",description:"Calculates the number of days, months, or years between two dates."},{name:"day",description:"Converts a serial number to a day of the month."},{name:"dcount",description:"Counts the cells that contain numbers in a database."},{name:"exp",description:"Returns e raised to the power of a given number."},{name:"exact",description:"Compares two text strings and returns TRUE if they are exactly the same, FALSE otherwise."},{name:"false",description:"Returns the logical value FALSE."},{name:"find",description:"Finds one text value within another (case-sensitive)."},{name:"floor",description:"Rounds a number down, toward zero."},{name:"hlookup",description:"Looks in the top row of an array and returns the value of the indicated cell."},{name:"hour",description:"Converts a serial number to an hour."},{name:"if",description:"Specifies a logical test to perform."},{name:"iferror",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{name:"index",description:"Uses an index to choose a value from a reference."},{name:"indirect",description:"Returns the reference specified by a text string. References are immediately evaluated to display their contents."},{name:"iserr",description:"Checks if value is an error (#VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!) excluding #N/A, and returns TRUE or FALSE."},{name:"iserror",description:"Checks if value is an error (#N/A, #VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!), and returns TRUE or FALSE."},{name:"left",description:"Returns the leftmost characters from a text value."},{name:"len",description:"Returns the number of characters in a text string."},{name:"ln",description:"Returns the natural logarithm of a number."},{name:"lower",description:"Converts text to lowercase."},{name:"max",description:"Returns the maximum value in a list of arguments."},{name:"mid",description:"Returns a specific number of characters from a text string starting at the position you specify."},{name:"min",description:"Returns the minimum value in a list of arguments."},{name:"mod",description:"Returns the remainder from division."},{name:"month",description:"Converts a serial number to a month."},{name:"not",description:"Reverses the logic of its argument."},{name:"now",description:"Returns the serial number of the current date and time."},{name:"or",description:"Returns TRUE if any argument is TRUE."},{name:"pi",description:"Returns the value of pi."},{name:"power",description:"Returns the result of a number raised to a power."},{name:"product",description:"Multiplies its arguments."},{name:"proper",description:"Capitalizes the first letter in each word of a text value."},{name:"rand",description:"Returns a random number between 0 and 1."},{name:"rank",description:"Returns the rank of a number in a list of numbers."},{name:"rate",description:"Returns the interest rate per period of an annuity."},{name:"replace",description:"Replaces characters within text."},{name:"rept",description:"Repeats text a given number of times."},{name:"right",description:"Returns the rightmost characters from a text value."},{name:"round",description:"Rounds a number to a specified number of digits."},{name:"rounddown",description:"Rounds a number down, toward zero."},{name:"roundup",description:"Rounds a number up, away from zero."},{name:"row",description:"Returns the row number of a reference."},{name:"rows",description:"Returns the number of rows in a reference."},{name:"search",description:"Finds one text value within another (not case-sensitive)."},{name:"sin",description:"Returns the sine of the given angle."},{name:"sqrt",description:"Returns a positive square root."},{name:"stdev",description:"Estimates standard deviation based on a sample."},{name:"stdevp",description:"Calculates standard deviation based on the entire population."},{name:"substitute",description:"Substitutes new text for old text in a text string."},{name:"subtotal",description:"Returns a subtotal in a list or database."},{name:"sum",description:"Adds its arguments."},{name:"sumif",description:"Adds the cells specified by a given criteria."},{name:"sumifs",description:"Adds the cells in a range that meet multiple criteria."},{name:"sumproduct",description:"Multiplies corresponding components in the given arrays, and returns the sum of those products."},{name:"tan",description:"Returns the tangent of a number."},{name:"text",description:"Formats a number and converts it to text."},{name:"time",description:"Returns the serial number of a particular time."},{name:"today",description:"Returns the serial number of today's date."},{name:"trim",description:"Removes spaces from text."},{name:"true",description:"Returns the logical value TRUE."},{name:"trunc",description:"Truncates a number to an integer."},{name:"upper",description:"Converts text to uppercase."},{name:"value",description:"Converts a text argument to a number."},{name:"var",description:"Estimates variance based on a sample."},{name:"varp",description:"Calculates variance based on the entire population."},{name:"vlookup",description:"Looks in the first column of an array and returns the value of the indicated cell."},{name:"year",description:"Converts a serial number to a year."}];class FlexSheet extends wijmo_grid_1.FlexGrid{constructor(e,t){super(e,t);this._selectedSheetIndex=-1;this._columnHeaderClicked=!1;this._addingSheet=!1;this._mouseMoveHdl=this._mouseMove.bind(this);this._clickHdl=this._click.bind(this);this._touchStartHdl=this._touchStart.bind(this);this._touchEndHdl=this._touchEnd.bind(this);this._keydownHdl=this._keydown.bind(this);this._isContextMenuKeyDown=!1;this._isClicking=!1;this._definedNames=new wijmo_1.ObservableArray;this._builtInTableStylesCache=null;this._needCopyToSheet=!0;this._isSorting=!1;this._fillingData=!1;this._endDragFillOperationHdl=this._endDragFillOperation.bind(this);this._enableDragDrop=!0;this._enableFormulas=!0;this._headerRowRemoved=!1;this._clearCalcCacheOnRefresh=!0;this._copyingTo=!1;this._ignoreBindGrid=!1;this.selectedSheetChanged=new wijmo_1.Event;this.draggingRowColumn=new wijmo_1.Event;this.droppingRowColumn=new wijmo_1.Event;this.beginDroppingRowColumn=new wijmo_1.Event;this.endDroppingRowColumn=new wijmo_1.Event;this.loaded=new wijmo_1.Event;this.unknownFunction=new wijmo_1.Event;this.sheetCleared=new wijmo_1.Event;this.prepareChangingRow=new wijmo_1.Event;this.prepareChangingColumn=new wijmo_1.Event;this.rowChanged=new wijmo_1.Event;this.columnChanged=new wijmo_1.Event;this.autoFilling=new wijmo_1.Event;this.autoFilled=new wijmo_1.Event;this._updateScrollPos=!1;t&&null!=t.allowAutoFill||(this._allowAutoFill=!0);this._needCopyToSheet=!1;this._colorThemes=["FFFFFF","000000","EEECE1","1F497D","4F818D","C0504D","9BBB59","8064A2","4BACC6","F79646"];this._eCt.style.backgroundColor="white";wijmo_1.addClass(this.hostElement,"wj-flexsheet");wijmo_1.setCss(this.hostElement,{fontFamily:"Arial"});this._cf=new _FlexSheetCellFactory;this._bndSortConverter=this._sheetSortConverter.bind(this);this._selHdl=new _FlexSheetSelectionHandler(this);this.quickAutoSize=!1;this._init();this.showSort=!1;this.allowSorting=wijmo_grid_1.AllowSorting.None;this.showGroups=!1;this.showMarquee=!0;this.showSelectedHeaders=wijmo_grid_1.HeadersVisibility.All;this.allowResizing=wijmo_grid_1.AllowResizing.Both;this.allowDragging=wijmo_grid_1.AllowDragging.None;this.keyActionTab=wijmo_grid_1.KeyAction.CycleOut;this._needCopyToSheet=!0}_getProductInfo(){return"R20I,FlexSheet"}get sheets(){this._sheets||(this._sheets=new SheetCollection);return this._sheets}get selectedSheetIndex(){return this._selectedSheetIndex}set selectedSheetIndex(e){if(e!==this._selectedSheetIndex){this._showSheet(e);this._sheets.selectedIndex=e}}get selectedSheet(){return this._selectedSheetIndex>=0?this._sheets[this._selectedSheetIndex]:null}get isFunctionListOpen(){return this._functionListHost&&"none"!==this._functionListHost.style.display}get isTabHolderVisible(){return this._tabHolder.visible}set isTabHolderVisible(e){if(e!==this._tabHolder.visible){this._updateDivContainerHeight(e);e?this._eFocus.removeAttribute("tabindex"):this._eFocus.tabIndex=this._orgTabIndex;this._tabHolder.visible=e;this.invalidate()}}get undoStack(){return this._undoStack}get sortManager(){return this._sortManager}get filter(){return this._filter}get showFilterIcons(){return!!this._filter&&this._filter.showFilterIcons}set showFilterIcons(e){this._filter&&this._filter.showFilterIcons!==e&&(this._filter.showFilterIcons=e)}get definedNames(){return this._definedNames}get enableDragDrop(){return this._enableDragDrop}set enableDragDrop(e){this._enableDragDrop=e}get enableFormulas(){return this._enableFormulas}set enableFormulas(e){if(this._enableFormulas!==e){this._enableFormulas=e;this.refresh()}}get allowAutoFill(){return this._allowAutoFill}set allowAutoFill(e){this._allowAutoFill=wijmo_1.asBoolean(e)}get _lastSelMovePos(){return this._lsmPos}set _lastSelMovePos(e){this._lsmPos=e?e.clone():null}onSelectedSheetChanged(e){this.selectedSheetChanged.raise(this,e)}onDraggingRowColumn(e){this.draggingRowColumn.raise(this,e)}onDroppingRowColumn(e){wijmo_1._deprecated("droppingRowColumn","beginDroppingRowColumn and endDroppingRowColumn");this.droppingRowColumn.raise(this,new wijmo_1.EventArgs)}onBeginDroppingRowColumn(e){this.beginDroppingRowColumn.raise(this,e)}onEndDroppingRowColumn(e){this.endDroppingRowColumn.raise(this,e)}onLoaded(e){if(this._toRefresh){clearTimeout(this._toRefresh);this._toRefresh=null}this._toRefresh=setTimeout(()=>{this._setFlexSheetToDirty();this.invalidate()},10);this.loaded.raise(this,new wijmo_1.EventArgs)}onUnknownFunction(e){this.unknownFunction.raise(this,e)}onSheetCleared(e){this.sheetCleared.raise(this,e)}onPrepareChangingRow(e){this.prepareChangingRow.raise(this,e)}onPrepareChangingColumn(e){this.prepareChangingColumn.raise(this,e)}onRowChanged(e){this.rowChanged.raise(this,e)}onColumnChanged(e){this.columnChanged.raise(this,e)}onAutoFilling(e){this.autoFilling.raise(this,e)}onAutoFilled(e){this.autoFilled.raise(this,e)}refresh(e=!0){var t,o,i;this.hostElement&&this._updateDivContainerHeight(this.isTabHolderVisible);if(!this.preserveSelectedState&&this.selectedSheet){this.selectedSheet.selectionRanges.clear();this.selectedSheet.selectionRanges.push(this.selection)}if(e){this._clearCalcCacheOnRefresh&&this._clearCalcEngine();this._clearCalcCacheOnRefresh=!0}this._lastVisibleFrozenRow=-1;if(this.frozenRows>0)for(var s=this.frozenRows-1;s>=0;s--)if(this.rows[s]&&this.rows[s].isVisible){this._lastVisibleFrozenRow=s;break}this._lastVisibleFrozenColumn=-1;if(this.frozenColumns>0)for(var l=this.frozenColumns-1;l>=0;l--)if(this.columns[l]&&this.columns[l].isVisible){this._lastVisibleFrozenColumn=l;break}if(this.selectedSheet){if(this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows.length>0)for(t=0;t<this.selectedSheet._freezeHiddenRows.length;t++)(o=this.rows[t])instanceof HeaderRow||!this.selectedSheet._freezeHiddenRows[t]||(o.visible=!1);if(this.selectedSheet._freezeHiddenCols&&this.selectedSheet._freezeHiddenCols.length>0)for(i=0;i<this.selectedSheet._freezeHiddenCols.length;i++)this.selectedSheet._freezeHiddenCols[i]&&(this.columns[i].visible=!1)}super.refresh(e);if(this.hostElement){this._tabHolder.adjustSize();this._tabHolder.isDisabled=this.isDisabled;this._tabHolder.sheetControl.isDisabled=this.isDisabled}}setCellData(e,t,o,i=!1,s=!0){var l=_isFormula(o);this._clearCalcEngine();return this.cells.setCellData(e,t,o,i&&!l,s)||this._getHasValidation()}containsFocus(){return this.isFunctionListOpen||super.containsFocus()}addUnboundSheet(e,t,o,i,s){var l=this._addSheet(e,t,o,i,s);0===l.selectionRanges.length&&l.selectionRanges.push(this.selection);return l}addBoundSheet(e,t,o,i){var s=this._addSheet(e,0,0,o,i);if(t){s.itemsSource=t;this.childItemsPath&&(s.grid.childItemsPath=this.childItemsPath)}0===s.selectionRanges.length&&s.selectionRanges.push(this.selection);return s}applyCellsStyle(e,t,o=!1){var i,s,l,n,r,a=null!=t&&t.length>0,h=t||[this.selection];if(this.selectedSheet)if(e||!this._cloneStyle){if(h){if(t||o)o&&!this._cloneStyle&&(this._cloneStyle=this._cloneObject(this.selectedSheet._styledCells));else{this.undoStack.stackSize>0&&(r=new _CellStyleAction(this,this._cloneStyle));this._cloneStyle=null}for(n=0;n<h.length;n++)for(i=(l=h[n]).topRow;i<=l.bottomRow;i++)for(s=l.leftCol;s<=l.rightCol;s++)this._applyStyleForCell(i,s,e,a);if(r){r.saveNewState();this._undoStack._addAction(r)}}t||this.refresh(!1)}else{this.selectedSheet._styledCells=this._cloneObject(this._cloneStyle);this._cloneStyle=null;this.refresh(!1)}}freezeAtCursor(){var e,t,o,i,s,l,n=this;if(n.selectedSheet){this.selectedSheet._freezeHiddenRows=null;this.selectedSheet._freezeHiddenCols=null;if(n.selection&&0===n.frozenRows&&0===n.frozenColumns){if(n._ptScrl.y<0){this.selectedSheet._freezeHiddenRows=[];for(e=0;e<n.selection.topRow-1;e++)if(!((s=n.rows[e])instanceof HeaderRow)){if(!(s._pos+n._ptScrl.y<0&&s.visible))break;s.visible=!1;this.selectedSheet._freezeHiddenRows[e]=!0}}if(n._ptScrl.x<0){this.selectedSheet._freezeHiddenCols=[];for(t=0;t<n.selection.leftCol-1&&((l=n.columns[t])._pos+n._ptScrl.x<0&&l.visible);t++){l.visible=!1;this.selectedSheet._freezeHiddenCols[t]=!0}}o=n.selection.leftCol>0?n.selection.leftCol:0;i=n.selection.topRow>0?n.selection.topRow:0}else{for(e=0;e<n.frozenRows-1;e++)n.rows[e].visible=!0;for(t=0;t<n.frozenColumns-1;t++)n.columns[t].visible=!0;n._filter.apply();o=0;i=0}n.frozenRows=n.selectedSheet.grid.frozenRows=i;n.frozenColumns=n.selectedSheet.grid.frozenColumns=o;setTimeout(()=>{n._setFlexSheetToDirty();n.invalidate();n.scrollIntoView(n.selection.topRow,n.selection.leftCol)},10)}}showColumnFilter(){var e=this.selection.col>0?this.selection.col:0;this.columns.length>0&&this._filter.editColumnFilter(this.columns[e])}clear(){this.beginUpdate();this.selection=new wijmo_grid_1.CellRange;this.sheets.clear();this._selectedSheetIndex=-1;this.columns.clear();this.rows.clear();this.columnHeaders.columns.clear();this.rowHeaders.rows.clear();this._undoStack.clear();this._ptScrl=new wijmo_1.Point;this._clearCalcEngine();this._definedNames.clear();this._builtInTableStylesCache=null;this._copiedRanges=null;this._copiedSheet=null;this._isCutting=!1;this._cutValue=null;this._reservedContent=null;this._lastVisibleFrozenRow=-1;this._lastVisibleFrozenColumn=-1;this.addUnboundSheet();this.endUpdate()}getSelectionFormatState(){var e,t,o=this.rows.length,i=this.columns.length,s={isBold:!1,isItalic:!1,isUnderline:!1,textAlign:"left",isMergedCell:!1};if(0===o||0===i)return s;if(this.selection){if(this.selection.row>=o||this.selection.row2>=o||this.selection.col>=i||this.selection.col2>=i)return s;for(e=this.selection.topRow;e<=this.selection.bottomRow;e++)for(t=this.selection.leftCol;t<=this.selection.rightCol;t++)this._checkCellFormat(e,t,s)}return s}insertRows(e,t){var o,i,s,l,n,r,a,h,d,_=this,u=wijmo_1.isNumber(e)&&e>=0?e:_.selection&&_.selection.topRow>-1?_.selection.topRow:0,c=wijmo_1.isNumber(t)?t:1,g=_.rows[u],w=!1;if(!_.selectedSheet)return;_.rows.length>0?u>=_.rows.length&&(u=_.rows.length-1):u=0;_._clearCalcEngine();_.finishEditing();0===u&&g&&g.constructor===HeaderRow&&(u=1);_.onPrepareChangingRow(new RowColumnChangedEventArgs(u,c,!0,!1));_.undoStack.stackSize>0&&(o=new _RowsChangedAction(_,u,c,!0));_._updateCellsForUpdatingRow(_.rows.length,u,c);if(!_.collectionView||0===_.collectionView.sortDescriptions.length){i=_._updateAffectedFormula(u,c,!0,!0);s=_._updateAffectedNamedRanges(u,c,!0,!0)}if(o){o._affectedFormulas=i;o._affectedDefinedNameVals=s}let m=null==this.selectedSheet.grid.collectionView;if(_.collectionView){_.selectedSheet._dataView=_.collectionView._view.slice();w=!0;n=_.itemsSource instanceof wijmo_1.CollectionView;h=_.autoGenerateColumns;_.autoGenerateColumns=!1;_.collectionView.beginUpdate();if(!n){d=_.selectedSheet.grid.autoGenerateColumns;_.selectedSheet.grid.autoGenerateColumns=!1;m||_.selectedSheet.grid.collectionView.beginUpdate()}for(l=0;l<c;l++){a=Math.max(u-(_.allowAddNew&&_.newRowAtTop?2:1),0);if(n){r=_.itemsSource.newItemCreator?_.itemsSource.newItemCreator():{};_.itemsSource.sourceCollection.splice(a,0,r)}else{r={};_.itemsSource.splice(a,0,r);_.itemsSource!==_.selectedSheet.grid.itemsSource&&_.selectedSheet.grid.itemsSource&&_.selectedSheet.grid.itemsSource.splice(a,0,r)}_.selectedSheet._dataView.splice(a,0,r)}_._updateItemIndexForInsertingRow(_.collectionView.sourceCollection,a,c);if(!n){m||_.selectedSheet.grid.collectionView.endUpdate(!0);_.selectedSheet.grid.autoGenerateColumns=d}_.collectionView.endUpdate(!0);if(_.collectionView.sortDescriptions.length>0){_.collectionView._view=_.selectedSheet._dataView;_.collectionView._pgView=_.collectionView._getPageView();if(!n&&!m){_.selectedSheet.grid.collectionView._view=_.selectedSheet._dataView;_.selectedSheet.grid.collectionView._pgView=_.selectedSheet.grid.collectionView._getPageView()}_._bindGrid(!1);_.selectedSheet.grid._bindGrid(!1)}setTimeout(()=>{_._filter.apply()});_.autoGenerateColumns=h}else{_.rows.beginUpdate();for(l=0;l<c;l++)_.rows.insert(u,new wijmo_grid_1.Row);_.rows.endUpdate()}_._updateTablesForUpdatingRow(u,c);_.selection&&-1!==_.selection.row&&-1!==_.selection.col||(_.selection=new wijmo_grid_1.CellRange(0,0));if(o){o.saveNewState();_._undoStack._addAction(o)}_.onRowChanged(new RowColumnChangedEventArgs(u,c,!0,!1));w&&_.refresh()}deleteRows(e,t){if(!this.selectedSheet||this.rows.length<1)return;let o=e,i=wijmo_1.isArray(e);if(!i)if(wijmo_1.isNumber(e)){if((t=wijmo_1.isNumber(t)?t:1)<1)return;o=[new wijmo_grid_1.CellRange(e,-1,e+t-1,-1)]}else i=(o=this._selections()).length>1;if(!(o=_RangesHelper.validateRowRanges(o,this.rows.length)).length)return;let s=0;o.forEach(e=>{e.col=e.col2=-1;s+=e.rowSpan});this._clearCalcEngine();this.finishEditing();let l,n,r,a=this.selection.topRow,h=i?new RowColumnChangedEventArgs(o,!1,!1):new RowColumnChangedEventArgs(o[0].topRow,o[0].rowSpan,!1,!1);this.onPrepareChangingRow(h);this.undoStack.stackSize>0&&(r=new _RowsChangedAction(this,null,null,!1));let d=s===this.rows.length,_=!!this.collectionView,u=_&&this.itemsSource instanceof wijmo_1.CollectionView,c=null==this.selectedSheet.grid.collectionView;this.rows.beginUpdate();if(_){this.selectedSheet._dataView=this.collectionView._view.slice();l=this.autoGenerateColumns;this.autoGenerateColumns=!1;this.collectionView.beginUpdate();if(!u){n=this.selectedSheet.grid.autoGenerateColumns;this.selectedSheet.grid.autoGenerateColumns=!1;c||this.selectedSheet.grid.collectionView.beginUpdate()}}for(let e=o.length-1;e>=0;e--){let t,i=o[e];if(r){(t=new _RowsChangedAction(this,i.topRow,i.rowSpan,!1))._affectedFormulas=this._updateAffectedFormula(i.bottomRow,i.rowSpan,!1,!0);t._affectedDefinedNameVals=this._updateAffectedNamedRanges(i.bottomRow,i.rowSpan,!1,!0);t._deletedTables=this._updateTablesForUpdatingRow(i.topRow,i.rowSpan,!0);r.addDeleteSubAction(t)}this._updateCellsForUpdatingRow(this.rows.length,i.topRow,i.rowSpan,!0);for(let e=i.bottomRow;e>=i.topRow;e--){let t=this.rows[e];if(!t||(t.constructor!==HeaderRow||d)&&t.isVisible)if(t.dataItem&&this.collectionView){let t=this._getCvIndex(e);if(t>-1){let e,o=this.collectionView.items[t];if(u){e=this.itemsSource.sourceCollection.indexOf(o);this.itemsSource.sourceCollection.splice(e,1)}else{e=this.itemsSource.indexOf(o);this.itemsSource.splice(e,1);this.itemsSource!==this.selectedSheet.grid.itemsSource&&this.selectedSheet.grid.itemsSource&&this.selectedSheet.grid.itemsSource.splice(e,1)}this.selectedSheet._dataView.splice(this.selectedSheet._dataView.indexOf(o),1);this._updateItemIndexForRemovingRow(this.collectionView.sourceCollection,e)}}else this.rows.removeAt(e)}t&&t.saveNewState()}if(_){if(!u){c||this.selectedSheet.grid.collectionView.endUpdate(!0);this.selectedSheet.grid.autoGenerateColumns=n}this.collectionView.endUpdate(!0);if(this.collectionView.sortDescriptions.length>0){this.collectionView._view=this.selectedSheet._dataView;this.collectionView._pgView=this.collectionView._getPageView();if(!u&&!c){this.selectedSheet.grid.collectionView._view=this.selectedSheet._dataView;this.selectedSheet.grid.collectionView._pgView=this.selectedSheet.grid.collectionView._getPageView()}this._bindGrid(!1);this.selectedSheet.grid._bindGrid(!1)}this.autoGenerateColumns=l}this.rows.endUpdate();this.selectedSheet.selectionRanges.clear();let g=this.rows.length;if(0===g){this.select(new wijmo_grid_1.CellRange);"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")}else if(this.selection.topRow>=g)this.select(new wijmo_grid_1.CellRange(g-1,0,g-1,this.columns.length-1));else{let e=a-s+1;e=Math.max(e,o[0].topRow);e=Math.min(e,this.selection.topRow);this.select(new wijmo_grid_1.CellRange(e,this.selection.col,e,this.selection.col2))}r&&this._undoStack._addAction(r);this.onRowChanged(h);_&&this.refresh()}insertColumns(e,t){var o,i,s,l,n,r,a=wijmo_1.isNumber(e)&&e>=0?e:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:0,h=wijmo_1.isNumber(t)?t:1;if(this.selectedSheet){this.columns.length>0?a>=this.columns.length&&(a=this.columns.length-1):a=0;this._clearCalcEngine();this.finishEditing();this.onPrepareChangingColumn(new RowColumnChangedEventArgs(a,h,!0,!0));this.undoStack.stackSize>0&&(o=new _ColumnsChangedAction(this,a,h,!0));this._updateCellsForUpdatingColumn(this.columns.length,a,h);n=this._updateAffectedFormula(a,h,!0,!1);r=this._updateAffectedNamedRanges(a,h,!0,!1);if(o){o._affectedFormulas=n;o._affectedDefinedNameVals=r}this.columns.beginUpdate();for(s=0;s<h;s++){(i=new wijmo_grid_1.Column).isRequired=!1;if(this.itemsSource){i.binding=this._getUniqueColumnName();if(l=this.allowAddNew&&this.newRowAtTop?this.rows[1]:this.rows[0]){l._ubv||(l._ubv={});l._ubv[i._hash]=FlexSheet._getHeaderRowText(i)}}this.columns.insert(a,i)}this.columns.endUpdate();this.selectedSheet._filterDefinition=this._filter.filterDefinition;this.selectedSheet.grid.columns._dirty=!1;this._sortManager._updateSortSortDescription(a,h);this._sortManager.commitSort(!1);this._updateTablesForUpdatingColumn(a,h);this.selection&&-1!==this.selection.row&&-1!==this.selection.col||(this.selection=new wijmo_grid_1.CellRange(0,0));if(o){o.saveNewState();this._undoStack._addAction(o)}this.onColumnChanged(new RowColumnChangedEventArgs(a,h,!0,!0))}}deleteColumns(e,t){if(!this.selectedSheet)return;let o=e,i=wijmo_1.isArray(e);if(!i)if(wijmo_1.isNumber(e)){if((t=wijmo_1.isNumber(t)?t:1)<1)return;o=[new wijmo_grid_1.CellRange(-1,e,-1,e+t-1)]}else i=(o=this._selections()).length>1;if(!(o=_RangesHelper.validateColumnRanges(o,this.columns.length)).length)return;let s=this.selection.leftCol,l=0;o.forEach(e=>{l+=e.columnSpan;e.row=e.row2=-1});this._clearCalcEngine();this.finishEditing();let n,r=i?new RowColumnChangedEventArgs(o,!1,!0):new RowColumnChangedEventArgs(o[0].leftCol,o[0].columnSpan,!1,!0);this.onPrepareChangingColumn(r);this.undoStack.stackSize>0&&(n=new _ColumnsChangedAction(this,null,null,!1));this.columns.beginUpdate();for(let e=o.length-1;e>=0;e--){let t,i=o[e];if(n){(t=new _ColumnsChangedAction(this,i.leftCol,i.columnSpan,!1))._affectedFormulas=this._updateAffectedFormula(i.rightCol,i.columnSpan,!1,!1);t._affectedDefinedNameVals=this._updateAffectedNamedRanges(i.rightCol,i.columnSpan,!1,!1);t._deletedTables=this._updateTablesForUpdatingColumn(i.leftCol,i.columnSpan,!0);n._delSubActions.push(t)}this._updateCellsForUpdatingColumn(this.columns.length,i.leftCol,i.columnSpan,!0);for(let e=i.rightCol;e>=i.leftCol;e--)if(this.columns[e].isVisible){this.columns.removeAt(e);this._sortManager.deleteSortLevel(e)}this._sortManager._updateSortSortDescription(i.leftCol,i.columnSpan,!1)}this.columns.endUpdate();this.selectedSheet._filterDefinition=this._filter.filterDefinition;this.selectedSheet.grid.columns._dirty=!1;this._sortManager.commitSort(!1);this.selectedSheet.selectionRanges.clear();let a=this.columns.length;if(0===a){this.select(new wijmo_grid_1.CellRange);"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")}else if(this.selection.leftCol>=a)this.select(new wijmo_grid_1.CellRange(0,a-1,this.rows.length-1,a-1));else{let e=s-l+1;e=Math.max(e,o[0].leftCol);e=Math.min(e,this.selection.leftCol);this.select(new wijmo_grid_1.CellRange(this.selection.row,e,this.selection.row2,e))}if(n){this._undoStack._addAction(n);n._delSubActions.forEach(e=>e.saveNewState())}this.onColumnChanged(r)}mergeRange(e,t=!1){var o,i,s,l,n,r=e||this.selection,a=-1,h=-1;if(this.selectedSheet){if(r){if(1===r.rowSpan&&1===r.columnSpan)return;for(o=r.topRow;o<=r.bottomRow;o++)for(i=r.leftCol;i<=r.rightCol;i++)if(this.selectedSheet.findTable(o,i))return;if(!e&&!t){this.undoStack.stackSize>0&&(n=new _CellMergeAction(this));this.hostElement.focus()}if(!this._resetMergedRange(r)){for(o=r.topRow;o<=r.bottomRow;o++)if((s=this.rows[o])&&s.isVisible){a=o;break}for(i=r.leftCol;i<=r.rightCol;i++)if((l=this.columns[i])&&l.isVisible){h=i;break}a>-1&&h>-1&&this.selectedSheet._mergedRanges.push(new wijmo_grid_1.CellRange(a,h,r.bottomRow,r.rightCol))}if(n){n.saveNewState();this._undoStack._addAction(n)}}e||this.refresh()}}getMergedRange(e,t,o,i=!0){var s,l,n,r,a=this.selectedSheet?this.selectedSheet._getMergedRange(t,o):null;if(e===this.cells&&a){if(!a.isSingleCell&&(this.frozenRows>0||this.frozenColumns>0)&&(a.topRow<this.frozenRows&&a.bottomRow>=this.frozenRows||a.leftCol<this.frozenColumns&&a.rightCol>=this.frozenColumns)){s=a.topRow;l=a.bottomRow;n=a.leftCol;r=a.rightCol;t>=this.frozenRows&&a.topRow<this.frozenRows&&(s=this.frozenRows);t<this.frozenRows&&a.bottomRow>=this.frozenRows&&(l=this.frozenRows-1);l>=this.rows.length&&(l=this.rows.length-1);o>=this.frozenColumns&&a.leftCol<this.frozenColumns&&(n=this.frozenColumns);o<this.frozenColumns&&a.rightCol>=this.frozenColumns&&(r=this.frozenColumns-1);r>=this.columns.length&&(r=this.columns.length-1);return new wijmo_grid_1.CellRange(s,n,l,r)}return a.bottomRow>=this.rows.length?new wijmo_grid_1.CellRange(a.topRow,a.leftCol,this.rows.length-1,a.rightCol):a.rightCol>=this.columns.length?new wijmo_grid_1.CellRange(a.topRow,a.leftCol,a.bottomRow,this.columns.length-1):a.clone()}return o>=0&&this.columns&&this.columns.length>o&&t>=0&&this.rows&&this.rows.length>t?super.getMergedRange(e,t,o,i):null}evaluate(e,t,o,i=!0){let s=this._evaluate(e,t,o);return i&&null!=s&&!wijmo_1.isPrimitive(s)?s instanceof FormulaError?s.error:s.value:s}getCellValue(e,t,o=!1,i){var s,l,n=i&&i!==this.selectedSheet?i.grid.columns[t]:this.columns[t],r=this._getCellStyle(e,t,i);s=r&&r.format?r.format:"";l=i&&i!==this.selectedSheet?i.grid.getCellData(e,t,!1):this.getCellData(e,t,!1);if(wijmo_1.isString(l)){var a=_FormulaErrorHelper.asError(l);if(a)return a;if(_isFormula(l)&&(l=this._evaluate(l,o?s:"",i,e,t))instanceof FormulaError)return l}if(o){s||null==l||wijmo_1.isPrimitive(l)||(s=l.format);l=this._formatEvaluatedResult(l,n,s)}else null==l||wijmo_1.isPrimitive(l)||(l=l.value);return null==l?"":l}showFunctionList(e){var t,o,i=this,s=i._cumulativeOffset(e),l=i._cumulativeOffset(i._root);if(i._enableFormulas){i._functionTarget=wijmo_1.tryCast(e,HTMLInputElement);if(i._functionTarget&&i._functionTarget.value&&"="===i._functionTarget.value[0]){i._functionList._cv.filter=e=>{var t,o=e.actualvalue.toLowerCase(),s=i._getCurrentFormulaIndex(i._functionTarget.value);-1===s&&(s=0);return(t=i._functionTarget.value.substr(s+1).trim().toLowerCase()).length>0&&0===o.indexOf(t)||"="===i._functionTarget.value};i._functionList.selectedIndex=0;t=s.y+e.clientHeight+2+(wijmo_1.hasClass(e,"wj-grid-editor")?this._ptScrl.y:0);o=s.x+(wijmo_1.hasClass(e,"wj-grid-editor")?this._ptScrl.x:0);wijmo_1.setCss(i._functionListHost,{height:i._functionList._cv.items.length>5?"218px":"auto",display:i._functionList._cv.items.length>0?"block":"none",top:"",left:""});i._functionListHost.scrollTop=0;i._functionListHost.offsetHeight+t>l.y+i._root.offsetHeight?t=t-e.clientHeight-i._functionListHost.offsetHeight-5:t+=5;i._functionListHost.offsetWidth+o>l.x+i._root.offsetWidth&&(o=l.x+i._root.offsetWidth-i._functionListHost.offsetWidth);wijmo_1.setCss(i._functionListHost,{top:t,left:o})}else i.hideFunctionList()}}hideFunctionList(){this._functionListHost.style.display="none"}selectPreviousFunction(){this._functionList.selectedIndex>0&&this._functionList.selectedIndex--}selectNextFunction(){this._functionList.selectedIndex<this._functionList.itemsSource.length&&this._functionList.selectedIndex++}applyFunctionToCell(){var e;if(this._functionTarget){-1===(e=this._getCurrentFormulaIndex(this._functionTarget.value))?e=this._functionTarget.value.indexOf("="):e+=1;this._functionTarget.value=this._functionTarget.value.substring(0,e)+this._functionList.selectedValue+"(";"="!==this._functionTarget.value[0]&&(this._functionTarget.value="="+this._functionTarget.value);this._functionTarget.focus();this.hideFunctionList()}}save(e,t){var o=this._saveToWorkbook(t);e&&o.save(e);return o}saveAsync(e,t,o,i){var s=this._saveToWorkbook(i);s.saveAsync(e,t,o);return s}saveToWorkbookOM(e){return this._saveToWorkbook(e)._serialize()}load(e){var t,o,i=this;if(e instanceof Blob){(o=new FileReader).onload=()=>{var e=o.result;e=mXlsx.Workbook._base64EncArr(new Uint8Array(e));(t=new mXlsx.Workbook).load(e);i._loadFromWorkbook(t)};o.readAsArrayBuffer(e)}else if(e instanceof mXlsx.Workbook)i._loadFromWorkbook(e);else{if(e instanceof ArrayBuffer)e=mXlsx.Workbook._base64EncArr(new Uint8Array(e));else if(!wijmo_1.isString(e))throw"Invalid workbook.";(t=new mXlsx.Workbook).load(e);i._loadFromWorkbook(t)}}loadAsync(e,t,o){var i,s=this;if(e instanceof Blob){(i=new FileReader).onload=()=>{var e=i.result;e=mXlsx.Workbook._base64EncArr(new Uint8Array(e));(new mXlsx.Workbook).loadAsync(e,e=>{s._loadFromWorkbook(e);t&&t(e)},o)};i.readAsArrayBuffer(e)}else if(e instanceof mXlsx.Workbook){s._loadFromWorkbook(e);t&&t(e)}else{if(e instanceof ArrayBuffer)e=mXlsx.Workbook._base64EncArr(new Uint8Array(e));else if(!wijmo_1.isString(e))throw"Invalid workbook.";(new mXlsx.Workbook).loadAsync(e,e=>{s._loadFromWorkbook(e);t&&t(e)},o)}}loadFromWorkbookOM(e){var t;e instanceof mXlsx.Workbook?t=e:(t=new mXlsx.Workbook)._deserialize(e);this._loadFromWorkbook(t)}undo(){var e=this;setTimeout(()=>{e._undoStack.undo()},100)}redo(){var e=this;setTimeout(()=>{e._undoStack.redo()},100)}select(e,t=!0){var o,i,s;if(wijmo_1.isNumber(e)&&wijmo_1.isNumber(t)){e=new wijmo_grid_1.CellRange(e,t);this._lastSelMovePos=e;t=!0}else this._lastSelMovePos=null;if(e.rowSpan!==this.rows.length&&e.columnSpan!==this.columns.length)for(i=e.topRow;i<=e.bottomRow;i++)for(s=e.leftCol;s<=e.rightCol;s++)if((o=this.getMergedRange(this.cells,i,s))&&!e.equals(o)){if(e.row<=e.row2){e.row=Math.min(e.topRow,o.topRow);e.row2=Math.max(e.bottomRow,o.bottomRow)}else{e.row=Math.max(e.bottomRow,o.bottomRow);e.row2=Math.min(e.topRow,o.topRow)}if(e.col<=e.col2){e.col=Math.min(e.leftCol,o.leftCol);e.col2=Math.max(e.rightCol,o.rightCol)}else{e.col=Math.max(e.rightCol,o.rightCol);e.col2=Math.min(e.leftCol,o.leftCol)}}this._isPasting&&this.collectionView&&(this.collectionView._pendingRefresh=!1);!this._enableMulSel&&this.selectedSheet&&this.selectedSheet.selectionRanges.clear();return super.select(e,t)}addCustomFunction(e,t,o,i,s){wijmo_1._deprecated("addCustomFunction","addFunction");this._calcEngine.addCustomFunction(e,t,i,s);this._addCustomFunctionDescription(e,o)}addFunction(e,t,o,i,s){this._calcEngine.addFunction(e,t,i,s);this._addCustomFunctionDescription(e,o)}dispose(){var e=window.navigator.userAgent;this._needCopyToSheet=!1;this.removeEventListener(document.body,"mousemove",this._mouseMoveHdl);this.removeEventListener(document.body,"keydown",this._keydownHdl);this.removeEventListener(document.body,"click",this._clickHdl);if(e.match(/iPad/i)||e.match(/iPhone/i)){this.removeEventListener(document.body,"touchstart",this._touchStartHdl);this.removeEventListener(document.body,"touchend",this._touchEndHdl)}this.hideFunctionList();if(!this.itemsSource){let e=this._selHdl.selection;e.row=e.row2=-1}super.dispose()}getClipString(e){var t,o,i,s,l,n,r="",a=!0;if(!this.selectedSheet)return super.getClipString(e);this._isCutting=!1;if(!e)if(this.selectedSheet.selectionRanges.length>1){if(this._isMultipleRowsSelected()){r="";(t=this._selections()).sort(this._sortByRow);for(i=0;i<t.length;i++){r&&(r+="\n");r+=this.getClipString(t[i])}return r}if(this._isMultipleColumnsSelected()){r="";(t=this._selections()).sort(this._sortByColumn);for(o=(s=t[0]).topRow,a=!0;o<=s.bottomRow;o++){a||(r+="\n");a=!1;for(i=0,u=!0;i<t.length;i++){l=t[i];u||(r+="\t");u=!1;r+=this.getClipString(new wijmo_grid_1.CellRange(o,l.col,o,l.col2))}}return r}wijmo_1.assert(!1,"Copy or Cut operation cannot be used on multiple selections.")}else{e=this.selection;switch(this.selectionMode){case wijmo_grid_1.SelectionMode.Row:case wijmo_grid_1.SelectionMode.RowRange:e.col=0;e.col2=this.columns.length-1;break;case wijmo_grid_1.SelectionMode.ListBox:e.col=0;e.col2=this.columns.length-1;for(var h=0;h<this.rows.length;h++)if(this.rows[h].isSelected&&this.rows[h].isVisible){e.row=e.row2=h;r&&(r+="\n");r+=this.getClipString(e)}return r}}if(!(e=wijmo_1.asType(e,wijmo_grid_1.CellRange)).isValid)return"";var d=e.topRow;for(a=!0;d<=e.bottomRow;d++)if(this.rows[d].isVisible){a||(r+="\n");a=!1;for(var _=e.leftCol,u=!0;_<=e.rightCol;_++)if(this.columns[_].isVisible){u||(r+="\t");u=!1;(n=(n=this.getCellValue(d,_,!0).toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(n='"'+n.replace(/"/g,'""')+'"');r+=n}}return r}setClipString(e,t){var o,i,s,l,n,r,a,h,d,_,u,c,g,w,m,f,p,C,S,b,R,x,y,v=null==t,T=!1,E=this.editableCollectionView;if(this.selectedSheet){t=t?wijmo_1.asType(t,wijmo_grid_1.CellRange):this.selection;x=e=wijmo_1.asString(e).replace(/\r\n/g,"\n").replace(/\r/g,"\n");h=this._edtHdl._parseClipString(wijmo_1.asString(e));v&&!t.isSingleCell&&h.length&&this._edtHdl._expandClipRows(h,t);S=this._containsMultiLineText(h);if(this._copiedRanges&&0!==this._copiedRanges.length&&(x.trim()===this._getRangeString(this._copiedRanges,this._copiedSheet).trim()||this._containsRandFormula(this._copiedRanges,this._copiedSheet))&&!this._cutValue||S){if(this._copiedRanges){var A=this._getRangeString(this._copiedRanges,this._copiedSheet,!1)+"\r\n";A=wijmo_1.asString(A).replace(/\r\n/g,"\n").replace(/\r/g,"\n");h=this._edtHdl._parseClipString(wijmo_1.asString(A));v&&!t.isSingleCell&&h.length&&this._edtHdl._expandClipRows(h,t)}(l=t.topRow+h.length-1)>=this.rows.length&&(l=this.rows.length-1);(n=t.leftCol+h[0].length-1)>=this.columns.length&&(n=this.columns.length-1);o=new wijmo_grid_1.CellRange(t.topRow,t.leftCol,l,n);if(this.onPasting(new wijmo_grid_1.CellRangeEventArgs(this.cells,o,e))){this.beginUpdate();if(S||!this._copiedRanges||this._copiedRanges.length>1||0===this._copiedRanges.length){i=t.topRow;r=(C=this._copiedRanges&&this._copiedRanges.length>1?this._copiedRanges[0]:new wijmo_grid_1.CellRange).topRow;for(u=0;u<h.length&&i<this.rows.length;u++,i++)if(this.rows[i].isVisible){d=h[u];a=C.leftCol;w=(s=t.leftCol)-a;for(c=0;c<d.length&&s<this.columns.length;c++,s++)if(this.columns[s].isVisible){_=d[c];if(!this.columns[s].isReadOnly&&!this.rows[i].isReadOnly){T=this._postSetClipStringProcess(_,i,s,r,a,E);o.row2=Math.max(o.row2,i);o.col2=Math.max(o.col2,s)}a>=0&&a++}else c--;r>=0&&r++}else u--}else if(this._copiedRanges&&1===this._copiedRanges.length){var F=this.selectedSheet===this._copiedSheet?this:this._copiedSheet.grid;b=0;C=this.selectionMode===wijmo_grid_1.SelectionMode.ListBox?this._getSelectionForListBoxMode(F):this._copiedRanges[0];i=t.topRow;for(u=0;u<h.length&&i<this.rows.length;u++,i++){R=0;if(this.rows[i].isVisible){for(;F.rows[C.topRow+b]&&!F.rows[C.topRow+b].isVisible;)b++;b>=C.rowSpan&&(b%=C.rowSpan);if(!F.rows[C.topRow+b])break;g=i-C.topRow-b;d=h[u];s=t.leftCol;for(c=0;c<d.length&&s<this.columns.length;c++,s++)if(this.columns[s]&&this.columns[s].isVisible){R>=C.columnSpan&&(R%=C.columnSpan);if(!F.columns[C.leftCol+R])break;w=s-C.leftCol-R;if(!this.columns[s].isReadOnly&&!this.rows[i].isReadOnly){_=d[c];y=this._getCellStyle(C.topRow+b,C.leftCol+R,this._copiedSheet);if(_isFormula(_)&&(0!==g||0!==w))try{m=this._calcEngine._parse(_);f=new wijmo_grid_1.CellRange(C.topRow+b,C.leftCol+R);p=new wijmo_grid_1.CellRange(C.topRow+b+g,C.leftCol+R+w);m._moveCellRangeExp(this.selectedSheetIndex,f,p,!1,!0)&&(_="="+m._getStringExpression())}catch(e){}F.columns[C.leftCol+R].format&&!this.columns[s].format&&(y?y.format||(y.format=F.columns[C.leftCol+R].format):y={format:F.columns[C.leftCol+R].format});T=this._postSetClipStringProcess(_,i,s,C.topRow+b,C.leftCol+R,E,y);o.row2=Math.max(o.row2,i);o.col2=Math.max(o.col2,s)}R++}else c--;b++}else u--}}if(this._isCutting){this._delCutData(h.length,h[0].length);this._isCutting=!1;this._cutValue=x;this._copiedRanges=null;this._copiedSheet=null}this.endUpdate();this.collectionView&&T&&this.collectionView.refresh();this.select(o);this.onPasted(new wijmo_grid_1.CellRangeEventArgs(this.cells,o))}else{this._cutValue=null;this._copiedRanges=null;this._copiedSheet=null}}else{if(x!==this._cutValue){this._cutValue=null;super.setClipString(e)}this._copiedRanges=null;this._copiedSheet=null}}else super.setClipString(e,t)}getBuiltInTableStyle(e){var t;null==this._builtInTableStylesCache&&(this._builtInTableStylesCache={});if(null==(t=this._builtInTableStylesCache[e.toLowerCase()])){t=this._createBuiltInTableStyle(e);Object.freeze(t);this._builtInTableStylesCache[e.toLowerCase()]=t}return t}onSortingColumn(e){return!1}_getCvIndex(e){return e>-1&&this.collectionView?this.rows[e]instanceof HeaderRow?e:super._getCvIndex(e):-1}_bindGrid(e){if(!this._ignoreBindGrid)if(this.itemsSource)super._bindGrid(e);else{let e=this._selHdl.selection;e.row=e.row2=-1}}_init(){var e=this,t=window.navigator.userAgent,mouseUp=t=>{document.removeEventListener("mouseup",mouseUp);e._mouseUp(t)};e.hostElement.setAttribute("tabindex","-1");e._divContainer=e.hostElement.querySelector('[wj-part="container"]');e._tabHolder=new _TabHolder(e.hostElement.querySelector('[wj-part="tab-holder"]'),e);this._sheets.selectedSheetChanged.addHandler(this._selectedSheetChange,this);this._sheets.collectionChanged.addHandler(this._sourceChange,this);this._sheets.sheetVisibleChanged.addHandler(this._sheetVisibleChange,this);this._sheets.sheetCleared.addHandler(this.onSheetCleared,this);e._contextMenu=new _SheetContextMenu(e.hostElement.querySelector('[wj-part="context-menu"]'),e);e._tabHolder.addEventListener(e._tabHolder.hostElement,"mousedown",()=>{t.match(/iPad/i)||t.match(/iPhone/i)||e._hideContextMenu()});e._gpCells=new FlexSheetPanel(e,wijmo_grid_1.CellType.Cell,e.rows,e.columns,e._eCt);e._gpCHdr=new FlexSheetPanel(e,wijmo_grid_1.CellType.ColumnHeader,e._hdrRows,e.columns,e._eCHdrCt);e._gpRHdr=new FlexSheetPanel(e,wijmo_grid_1.CellType.RowHeader,e.rows,e._hdrCols,e._eRHdrCt);e._gpTL=new FlexSheetPanel(e,wijmo_grid_1.CellType.TopLeft,e._hdrRows,e._hdrCols,e._eTLCt);e._syncSelection=e._flexSheetSyncSelection.bind(e);e._sortManager=new SortManager(e);e._filter=new FlexSheetFilter(e);e._filter.filterApplied.addHandler(()=>{if(e.selectedSheet){e.selectedSheet._filterDefinition=e._filter.filterDefinition;if(e.selectedSheet.itemsSource){e.selectedSheet._storeRowSettings();e.selectedSheet._setRowSettings()}}});e._calcEngine=new _CalcEngine(e);e._calcEngine.unknownFunction.addHandler((t,o)=>{e.onUnknownFunction(o)},e);e._initFuncsList();e._undoStack=new UndoStack(e);e.loadedRows.addHandler(()=>{if(e.collectionView&&!(e.rows[0]instanceof HeaderRow)&&!e._headerRowRemoved){var t,o=new HeaderRow;o.isReadOnly=!0;for(var i=0;i<e.columns.length;i++){t=e.columns[i];o._ubv||(o._ubv={});o._ubv[t._hash]=FlexSheet._getHeaderRowText(t)}e.rows[0]instanceof wijmo_grid_1._NewRowTemplate&&e.newRowAtTop?e.rows.insert(1,o):e.rows.insert(0,o)}e._filter&&e._filter.apply()});e.itemsSourceChanged.addHandler(()=>{var t;for(t=0;t<e.columns.length;t++)e.columns[t].isRequired=!1;e.collectionView&&e.collectionView.currentChanged.removeHandler(this._cvCurrentChanged,this)});e.copied.addHandler((t,o)=>{var i;if(e.selectedSheet){e._copiedSheet=e.selectedSheet;e._needCopyToSheet=!0;if(e.selectedSheet.selectionRanges.length>1)if(e._isMultipleRowsSelected()){(i=e.selectedSheet.selectionRanges.slice(0)).sort(e._sortByRow);e._copiedRanges=i}else if(e._isMultipleColumnsSelected()){(i=e.selectedSheet.selectionRanges.slice(0)).sort(e._sortByColumn);e._copiedRanges=i}else wijmo_1.assert(!1,"Copy operation cannot be used on multiple selections.");else e._copiedRanges=[o.range]}});e.rows.collectionChanged.addHandler((t,o)=>{e._clearForEmptySheet("rows");e.itemsSource||!e.selectedSheet||!e._needCopyToSheet||e._isCopying||e._isUndoing||o.item instanceof wijmo_grid_1._NewRowTemplate||e._copyRowsToSelectedSheet();e.itemsSource&&e.selectedSheet&&o.action===wijmo_1.NotifyCollectionChangedAction.Remove&&o.item instanceof HeaderRow&&(e._headerRowRemoved=!0)},e);e.columns.collectionChanged.addHandler((t,o)=>{e._clearForEmptySheet("columns");e.selectedSheet&&e._needCopyToSheet&&!e._isCopying&&!e._isUndoing&&e._copyColumnsToSelectedSheet()},e);e.definedNames.collectionChanged.addHandler((t,o)=>{if(o.action===wijmo_1.NotifyCollectionChangedAction.Add||o.action===wijmo_1.NotifyCollectionChangedAction.Change){var i=o.action===wijmo_1.NotifyCollectionChangedAction.Add?"inserted":"updated";if(!(o.item instanceof DefinedName)){e.definedNames.remove(o.item);throw"Invalid defined name item object was "+i+".  The DefinedName instance should be "+i+" in the definedNames array."}if(!o.item||!o.item.name||null==o.item.value){e.definedNames.remove(o.item);throw"Invalid defined name was "+i+"."}if(null!=o.item.sheetName&&!e._validateSheetName(o.item.sheetName)){e.definedNames.remove(o.item);throw"The sheet name ("+o.item.sheetName+") does not exist in FlexSheet."}if(e._checkExistDefinedName(o.item.name,o.item.sheetName,o.index)){e.definedNames.remove(o.item);throw"The "+o.item.name+" already existed in definedNames."}}});e.addEventListener(e.hostElement,"mousedown",t=>{document.addEventListener("mouseup",mouseUp);e._isDescendant(e._divContainer,t.target)&&e._mouseDown(t)},!0);e.addEventListener(e.hostElement,"dragend",()=>{e._columnHeaderClicked=!1;e._htDown=null});e.addEventListener(e.hostElement,"contextmenu",t=>{if(!t.defaultPrevented&&e.selectedSheet){if(!e.activeEditor){let o,i;if(e._isContextMenuKeyDown&&e.selection.row>-1&&e.selection.col>-1&&e.rows.length>0&&e.columns.length>0){let t=e.columns[e.selection.col],s=e.rows[e.selection.row],l=e._cumulativeOffset(e.hostElement),n=e._cumulativeScrollOffset(e.hostElement),r=t.pos+e._eCt.offsetLeft+l.x+t.renderSize/2+e._ptScrl.x,a=s.pos+e._eCt.offsetTop+l.y+s.renderSize/2+e._ptScrl.y;i=new wijmo_1.Point(r-n.x,a-n.y);o=e.hitTest(r,a)}else o=e.hitTest(t);t.preventDefault();if(o&&o.cellType!==wijmo_grid_1.CellType.None){let s,l=e.columns.length-1,n=e.rows.length-1;switch(o.cellType){case wijmo_grid_1.CellType.TopLeft:s=new wijmo_grid_1.CellRange(Math.min(0,n),Math.min(0,l),n,l);break;case wijmo_grid_1.CellType.RowHeader:s=new wijmo_grid_1.CellRange(o.row,Math.min(0,l),o.row,l);break;case wijmo_grid_1.CellType.ColumnHeader:s=new wijmo_grid_1.CellRange(e.itemsSource&&e.rows[0]&&!e.rows[0].isVisible?1:Math.min(0,n),o.col,n,o.col);break;case wijmo_grid_1.CellType.Cell:s=new wijmo_grid_1.CellRange(o.row,o.col)}(e.selection.contains(s)||o.cellType==wijmo_grid_1.CellType.Cell&&e._isCellSelected(o.row,o.col))&&(s=null);if(s){if(e.selectedSheet){e.selectedSheet.selectionRanges.clear();e.selectedSheet.selectionRanges.push(s)}e.selection=s}e._contextMenu.show(t,i)}}e._isContextMenuKeyDown=!1}});e.prepareCellForEdit.addHandler(e._prepareCellForEditHandler,e);e.cellEditEnded.addHandler((t,o)=>{(!o.data||46!==o.data.keyCode&&8!==o.data.keyCode)&&setTimeout(()=>{e.hideFunctionList()},200)});e.cellEditEnding.addHandler((t,o)=>{if(o.cancel||o.data&&(46===o.data.keyCode||8===o.data.keyCode))return;let i,s,l;i=e.getCellData(o.row,o.col,!1);s=e.cellFactory.getEditorValue(e);if((null==i||""===i)&&null!=s&&""!==s&&!isNaN(+s)){l=e._updateFormulaBoundaryForEditingCell(o.row,o.col);e._undoStack._pendingAction&&e._undoStack._pendingAction instanceof _EditAction&&(e._undoStack._pendingAction._affectedFormulas=l)}e._clearCalcEngine();this._clearCalcCacheOnRefresh=!1});e.rowEditEnding.addHandler((t,o)=>{let i=e.collectionView;if(i){e._orgRowVisible=e.rows[o.row].visible;(i.sortDescriptions.length>0||e.selectedSheet._dataView)&&(e.selectedSheet._dataView=i._view.slice());i.sortDescriptions.length>0&&(e.selectedSheet._scrollPosition=e.scrollPosition)}});e.rowEditEnded.addHandler((t,o)=>{let i=e.collectionView;if(i){e.selectedSheet._dataView&&(e.selectedSheet._dataView=i._view.slice());if(i.sortDescriptions.length>0){i._view=e.selectedSheet._dataView;i._pgView=i._getPageView();if(!(e.itemsSource instanceof wijmo_1.CollectionView)){e.selectedSheet.grid.collectionView._view=e.selectedSheet._dataView;e.selectedSheet.grid.collectionView._pgView=e.selectedSheet.grid.collectionView._getPageView()}e._bindGrid(!1);e.selectedSheet.grid._bindGrid(!1);e.scrollPosition=e.selectedSheet._scrollPosition}e.rows[o.row]&&(e.rows[o.row].visible=e._orgRowVisible)}});e.pasting.addHandler(()=>{e._needCopyToSheet=!1;e._isPasting=!0});e.pasted.addHandler(()=>{e.selection;e._needCopyToSheet=!0;e._isPasting=!1;e._clearCalcEngine()});e.resizingColumn.addHandler(()=>{e._resizing=!0});e.resizingRow.addHandler(()=>{e._resizing=!0});e.resizedColumn.addHandler(()=>{e._resizing=!1});e.resizedRow.addHandler(()=>{e._resizing=!1});e.selectionChanged.addHandler(()=>{let t=e.selection;t.rightCol>=e.columns.length&&(e.selection=new wijmo_grid_1.CellRange(t.row,Math.min(t.col,e.columns.length-1),t.row2,Math.min(e.selection.col2,e.columns.length-1)));e._enableMulSel||e._isCopying||!e.selectedSheet||e.selectedSheet.selectionRanges.clear()});e.addEventListener(e.hostElement,"keydown",t=>{var o,i,s=!1,l=!1;if(t.ctrlKey){if(89===t.keyCode){e.finishEditing();e.redo();t.preventDefault()}if(90===t.keyCode){e.finishEditing();e.undo();t.preventDefault()}if(e.selectedSheet&&65===t.keyCode){e.selectedSheet.selectionRanges.clear();e.selectedSheet.selectionRanges.push(e.selection)}if(67===t.keyCode||45==t.keyCode){if(e.activeEditor){e._copiedRanges=null;e._copiedSheet=null}e._cutValue=null}if(88===t.keyCode&&!e.activeEditor){t.stopPropagation();if(e.selectionMode===wijmo_grid_1.SelectionMode.ListBox)for(var n=0;n<e.rows.length;n++)if(e.rows[n].isSelected)if(s){if(l)continue;wijmo_1.assert(!1,"Cut operation cannot be used on multiple selections.")}else{s=!0;l=!0}else l&&(l=!1);if(e.selectedSheet.selectionRanges.length>1)wijmo_1.assert(!1,"Cut operation cannot be used on multiple selections.");else{e.finishEditing();o=new wijmo_grid_1.CellRangeEventArgs(e.cells,e.selection);if(e.onCopying(o)){e._cutValue=null;i=e.getClipString();e._isCutting=!0;wijmo_1.Clipboard.copy(i);e.onCopied(o)}}}t.keyCode!==wijmo_1.Key.Space||!e.selection.isValid||e.selectionMode!==wijmo_grid_1.SelectionMode.CellRange&&e.selectionMode!==wijmo_grid_1.SelectionMode.MultiRange||e.select(new wijmo_grid_1.CellRange(0,e.selection.col,e.rows.length-1,e.selection.col))}t.keyCode===wijmo_1.Key.Escape&&e._hideContextMenu();(93===t.keyCode||t.shiftKey&&121===t.keyCode)&&(e._contextMenu.visible&&!wijmo_1.isFirefox()?e._isContextMenuKeyDown=!1:e._isContextMenuKeyDown=!0)});e.addEventListener(document.body,"keydown",e._keydownHdl,!0);e.addEventListener(document.body,"click",e._clickHdl);e.addEventListener(document.body,"mousemove",e._mouseMoveHdl);if(t.match(/iPad/i)||t.match(/iPhone/i)){e.addEventListener(document.body,"touchstart",e._touchStartHdl);e.addEventListener(document.body,"touchend",e._touchEndHdl)}}_flexSheetSyncSelection(e){if(this.collectionView&&this.selectionMode!=wijmo_grid_1.SelectionMode.None){let t=this.selection,o=t.row>-1&&t.row<this.rows.length?this.rows[t.row]:null,i=o?o.dataItem:null;if(this.collectionView instanceof wijmo_1.CollectionView&&this.collectionView.isUpdating)return;(o instanceof HeaderRow||this.newRowAtTop&&o instanceof wijmo_grid_1._NewRowTemplate||i instanceof wijmo_1.CollectionViewGroup)&&(i=null);if((i!=this.collectionView.currentItem||e)&&(!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){let e=this._getRowIndex(this.collectionView.currentPosition);if(e!=t.row){t.row=t.row2=e;this.select(t,!1);this.selectionMode&&!this._copyingTo&&this.scrollIntoView(t.row,-1)}}}}_initFuncsList(){var e=this;e._functionListHost=document.createElement("div");wijmo_1.addClass(e._functionListHost,"wj-flexsheet-formula-list");document.querySelector("body").appendChild(e._functionListHost);e._functionListHost.style.display="none";e._functionListHost.style.position="absolute";e._functionList=new mInput.ListBox(e._functionListHost);e._functionList.isContentHtml=!0;e._functionList.itemsSource=e._getFunctions();e._functionList.displayMemberPath="displayValue";e._functionList.selectedValuePath="actualvalue";e.addEventListener(e._functionListHost,"click",e.applyFunctionToCell.bind(e));e.addEventListener(e._functionListHost,"keydown",t=>{if(t.keyCode===wijmo_1.Key.Escape){e.hideFunctionList();e.hostElement.focus();t.preventDefault()}if(t.keyCode===wijmo_1.Key.Enter){e.applyFunctionToCell();e.hostElement.focus();t.preventDefault();t.stopPropagation()}})}_getFunctions(){for(var e,t=[],o=0;o<FlexSheetFunctions.length;o++){e=FlexSheetFunctions[o];t.push({displayValue:'<div class="wj-flexsheet-formula-name">'+e.name+'</div><div class="wj-flexsheet-formula-description">'+e.description+"</div>",actualvalue:e.name})}return t}_addCustomFunctionDescription(e,t){for(var o={displayValue:'<div class="wj-flexsheet-formula-name">'+e+"</div>"+(t?'<div class="wj-flexsheet-formula-description">'+t+"</div>":""),actualvalue:e},i=this._functionList.itemsSource,s=-1,l=0;l<i.length;l++)if(i[l].actualvalue===e){s=l;break}s>-1?i.splice(s,1,o):i.push(o)}_getCurrentFormulaIndex(e){var t=-1;["+","-","*","/","^","(","&"].forEach(o=>{var i=e.lastIndexOf(o);"/"===o&&(i>=2&&"#N"===e.substr(i-2,2)||i>=4&&"#DIV"===e.substr(i-4,4))||i>t&&(t=i)});return t}_prepareCellForEditHandler(){var e=this,t=e._edtHdl._edt;if(t){e.addEventListener(t,"keydown",t=>{if(e.isFunctionListOpen)switch(t.keyCode){case wijmo_1.Key.Up:e.selectPreviousFunction();t.preventDefault();t.stopPropagation();break;case wijmo_1.Key.Down:e.selectNextFunction();t.preventDefault();t.stopPropagation();break;case wijmo_1.Key.Tab:case wijmo_1.Key.Enter:e.applyFunctionToCell();t.preventDefault();t.stopPropagation();break;case wijmo_1.Key.Escape:e.hideFunctionList();t.preventDefault();t.stopPropagation()}});e.addEventListener(t,"keyup",o=>{(o.keyCode>40||o.keyCode<32)&&o.keyCode!==wijmo_1.Key.Tab&&o.keyCode!==wijmo_1.Key.Escape&&setTimeout(()=>{e.showFunctionList(t)},0)})}}_addSheet(e,t,o,i,s){var l=this,n=new Sheet(l,s,e,t,o);l.sheets.isValidSheetName(n)||n._setValidName(l.sheets.getValidSheetName(n));n.nameChanged.addHandler((e,t)=>{l._updateDefinedNameWithSheetRefUpdating(t.oldValue,t.newValue)});if("number"==typeof i){i<0&&(i=0);i>=l.sheets.length&&(i=l.sheets.length)}else i=l.sheets.length;l.sheets.insert(i,n);return n}_showSheet(e){if(!(!this.sheets||!this.sheets.length||e>=this.sheets.length||e<0||e===this.selectedSheetIndex||this.sheets[e]&&!this.sheets[e].visible)){this.beginUpdate();this.finishEditing();this._clearCalcEngine();this._isCopying=!0;if(this.selectedSheetIndex>-1&&this.selectedSheetIndex<this.sheets.length&&!this._sheets._exchangingPosition){this._copyingTo=!0;try{this._copyTo(this.sheets[this.selectedSheetIndex])}finally{this._copyingTo=!1}}if(this.sheets[e]){this._selectedSheetIndex=e;this._copyFrom(this.sheets[e])}this._isCopying=!1;this.endUpdate();this._filter.closeEditor()}}_selectedSheetChange(e,t){this.beginUpdate();this._showSheet(t.newValue);this._clearCalcCacheOnRefresh=!1;this.endUpdate();this.onSelectedSheetChanged(t)}_sourceChange(e,t){if(!this.sheets._exchangingPosition){this.beginUpdate();if(t.action===wijmo_1.NotifyCollectionChangedAction.Add||t.action===wijmo_1.NotifyCollectionChangedAction.Change){t.item._attachOwner(this);if(t.action===wijmo_1.NotifyCollectionChangedAction.Add){this._addingSheet=!0;t.index<=this.selectedSheetIndex&&(this._selectedSheetIndex+=1)}else t.index===this.selectedSheetIndex&&this._copyFrom(t.item);this.selectedSheetIndex=t.index}else if(t.action===wijmo_1.NotifyCollectionChangedAction.Reset){for(var o=0;o<this.sheets.length;o++)this.sheets[o]._attachOwner(this);if(this.sheets.length>0){0===this.selectedSheetIndex&&this._copyFrom(this.selectedSheet);this.selectedSheetIndex=0}else{this.rows.clear();this.columns.clear();this._selectedSheetIndex=-1}}else if(this.sheets.length>0){if(this.selectedSheetIndex===t.index){this._selectedSheetIndex=-1;this.sheets._setCurrentIdx(-1);this.selectedSheetIndex=t.index>this.sheets.length-1?this.sheets.length-1:t.index}else if(this.selectedSheetIndex>t.index){this._selectedSheetIndex--;this.sheets._setCurrentIdx(this._selectedSheetIndex)}}else{this.rows.clear();this.columns.clear();this._selectedSheetIndex=-1}this._updateDivContainerHeight(this.isTabHolderVisible);this.endUpdate()}}_sheetVisibleChange(e,t){t.item.visible||t.index===this.selectedSheetIndex&&(this.selectedSheetIndex===this.sheets.length-1?this.selectedSheetIndex=t.index-1:this.selectedSheetIndex=t.index+1)}_applyStyleForCell(e,t,o,i=!1){var s,l,n,r=this.rows[e];if(!(null==r||r instanceof HeaderRow||!r.isVisible&&!i)){n=e*this.columns.length+t;(l=this.selectedSheet._getMergedRange(e,t))&&(n=l.topRow*this.columns.length+l.leftCol);(s=this.selectedSheet._styledCells[n])?Object.keys(o).forEach(e=>{let t=o[e];switch(e){case"className":s[e]="normal"===t||null===t||""===t?void 0:t||s[e];break;case"fontStyle":case"fontWeight":case"textDecoration":s[e]="none"===t||null===t||""===t?void 0:t||s[e];break;default:s[e]=null===t||""===t?void 0:t||s[e]}}):this.selectedSheet._styledCells[n]={className:o.className,textAlign:o.textAlign,verticalAlign:o.verticalAlign,fontStyle:o.fontStyle,fontWeight:o.fontWeight,fontFamily:o.fontFamily,fontSize:o.fontSize,textDecoration:o.textDecoration,backgroundColor:o.backgroundColor,color:o.color,format:o.format,whiteSpace:o.whiteSpace,borderTopColor:o.borderTopColor,borderTopStyle:o.borderTopStyle,borderTopWidth:o.borderTopWidth,borderBottomColor:o.borderBottomColor,borderBottomStyle:o.borderBottomStyle,borderBottomWidth:o.borderBottomWidth,borderLeftColor:o.borderLeftColor,borderLeftStyle:o.borderLeftStyle,borderLeftWidth:o.borderLeftWidth,borderRightColor:o.borderRightColor,borderRightStyle:o.borderRightStyle,borderRightWidth:o.borderRightWidth}}}_checkCellFormat(e,t,o){var i,s,l=e*this.columns.length+t;if(this.selectedSheet){if(i=this.selectedSheet._getMergedRange(e,t)){o.isMergedCell=!0;l=i.topRow*this.columns.length+i.leftCol}if(s=this.selectedSheet._styledCells[l]){o.isBold=o.isBold||"bold"===s.fontWeight;o.isItalic=o.isItalic||"italic"===s.fontStyle;o.isUnderline=o.isUnderline||"underline"===s.textDecoration}e===this.selection.row&&t===this.selection.col&&(s&&s.textAlign?o.textAlign=s.textAlign:t>-1&&(o.textAlign=this.columns[t].getAlignment()||o.textAlign))}}_resetMergedRange(e){var t,o,i,s,l=!1;for(t=e.topRow;t<=e.bottomRow;t++)for(o=e.leftCol;o<=e.rightCol;o++)if(s=this.selectedSheet._getMergedRange(t,o)){l=!0;i=this.selectedSheet._mergedRanges.indexOf(s);this.selectedSheet._mergedRanges.splice(i,1)}return l}_updateCellsForUpdatingRow(e,t,o,i){var s,l,n,r,a,h,d,_=e*this.columns.length;if(i)for(l=s=t*this.columns.length;l<_;l++){n=l-o*this.columns.length;if(r=this.selectedSheet._styledCells[l]){l>=(t+o)*this.columns.length&&(this.selectedSheet._styledCells[n]=r);delete this.selectedSheet._styledCells[l]}}else{s=t*this.columns.length-1;for(l=_-1;l>s;l--){n=l+this.columns.length*o;if(r=this.selectedSheet._styledCells[l]){this.selectedSheet._styledCells[n]=r;delete this.selectedSheet._styledCells[l]}}}if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--){a=this.selectedSheet._mergedRanges[h];if(i)if((d=t+o-1)<a.topRow){a.row-=o;a.row2-=o}else if(d>=a.topRow&&d<=a.bottomRow)if(t<=a.topRow&&d>=a.bottomRow)this.selectedSheet._mergedRanges.splice(h,1);else if(t<a.topRow)if(a.row<=a.row2){a.row+=t-a.topRow;a.row2-=o}else{a.row2+=t-a.topRow;a.row-=o}else t===a.topRow&&o===a.rowSpan?this.selectedSheet._mergedRanges.splice(h,1):a.row<=a.row2?a.row2-=o:a.row-=o;else t<=a.topRow?this.selectedSheet._mergedRanges.splice(h,1):t<=a.bottomRow&&(a.row<=a.row2?a.row2+=t-a.bottomRow-1:a.row+=t-a.bottomRow-1);else if(t<=a.topRow){a.row+=o;a.row2+=o}else t>a.topRow&&t<=a.bottomRow&&(a.row<=a.row2?a.row2+=o:a.row+=o)}}_updateCellsForUpdatingColumn(e,t,o,i){var s,l,n,r,a,h,d,_=this.rows.length*e;if(i)for(s=t;s<_;s++){l=s-o*(Math.floor(s/e)+((r=s%e)>=t?1:0));if(n=this.selectedSheet._styledCells[s]){(r<t||r>=t+o)&&(this.selectedSheet._styledCells[l]=n);delete this.selectedSheet._styledCells[s]}}else for(s=_-1;s>=t;s--){l=s+Math.floor(s/e)*o+((r=s%e)>=t?1:0);if(n=this.selectedSheet._styledCells[s]){this.selectedSheet._styledCells[l]=n;delete this.selectedSheet._styledCells[s]}}if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--){a=this.selectedSheet._mergedRanges[h];if(i)if((d=t+o-1)<a.leftCol){a.col-=o;a.col2-=o}else if(d>=a.leftCol&&d<=a.rightCol)if(t<=a.leftCol&&d>=a.rightCol)this.selectedSheet._mergedRanges.splice(h,1);else if(t<a.leftCol)if(a.col<=a.col2){a.col+=t-a.leftCol;a.col2-=o}else{a.col2+=t-a.leftCol;a.col-=o}else t===a.leftCol&&o===a.columnSpan?this.selectedSheet._mergedRanges.splice(h,1):a.col<=a.col2?a.col2-=o:a.col-=o;else t<=a.leftCol?this.selectedSheet._mergedRanges.splice(h,1):t<=a.rightCol&&(a.col<=a.col2?a.col2-=a.rightCol-t+1:a.col-=a.rightCol-t+1);else if(t<=a.leftCol){a.col+=o;a.col2+=o}else t>a.leftCol&&t<=a.rightCol&&(a.col<=a.col2?a.col2+=o:a.col+=o)}}_cloneObject(e){var t;if(null==e||!wijmo_1.isObject(e))return e;t={};for(var o in e)e.hasOwnProperty(o)&&null!=e[o]&&(e[o].clone?t[o]=e[o].clone():t[o]=this._cloneObject(e[o]));return t}_evaluate(e,t,o,i,s){if(e&&e.length>1&&this._enableFormulas){e="="===e[0]?e:"="+e;return this._calcEngine.evaluate(e,t,o,i,s)}return e}_clearAndCheckItemsOwner(e){if(e&&e.length){let t=e[0]._list;e.clear();this._checkCollectionOwner(t)}}_checkCollectionOwner(e,t=!0){if(e&&e.length&&(!e[0]._list||!t&&e[0]._list!=e))for(let t=0,o=e.length;t<o;t++)e[t]._list=e}_checkCollectionsOwner(){this._checkCollectionOwner(this.columns,!1);this._checkCollectionOwner(this.rows,!1);this._checkCollectionOwner(this.columnFooters.columns,!1);this._checkCollectionOwner(this.columnFooters.rows,!1);this._checkCollectionOwner(this.columnHeaders.columns,!1);this._checkCollectionOwner(this.columnHeaders.rows,!1);this._checkCollectionOwner(this.rowHeaders.columns,!1);this._checkCollectionOwner(this.rowHeaders.rows,!1)}_copyTo(e){var t,o=e.grid.autoGenerateColumns;this.beginUpdate();e._storeRowSettings();this._selHdl.extendedSelection.clear();t=this.selection.clone();e.grid.select(new wijmo_grid_1.CellRange,!1);this._clearAndCheckItemsOwner(e.grid.rows);this._clearAndCheckItemsOwner(e.grid.columns);this._clearAndCheckItemsOwner(e.grid.columnHeaders.columns);this._clearAndCheckItemsOwner(e.grid.rowHeaders.rows);e._ownerHeaderRowRemoved=this._headerRowRemoved;if(this.itemsSource){e.grid.autoGenerateColumns=!1;e.itemsSource=this.itemsSource;this.collectionView.sortDescriptions.length>0&&(e._dataView=this.collectionView._view.slice());e.grid.collectionView.beginUpdate()}else{e.itemsSource=null;for(var i=0;i<this.rows.length;i++)e.grid.rows.push(this.rows[i])}e._sortList=this.sortManager._committedList.slice();e._getFilterSetting();for(var s=0;s<this.columns.length;s++)e.grid.columns.push(this.columns[s]);if(e.grid.collectionView){this._resetMappedColumns(e.grid);e.grid.collectionView.endUpdate(!0)}e.grid.autoGenerateColumns=o;e.grid.frozenRows=this.frozenRows;e.grid.frozenColumns=this.frozenColumns;e.grid.allowAddNew=this.allowAddNew;null!=this.newRowAtTop&&(e.grid.newRowAtTop=this.newRowAtTop);e.grid.select(t,!1);e._scrollPosition=this.scrollPosition;this._setFlexSheetToDirty();this.endUpdate()}_copyFrom(e,t=!0){var o,i,s,l,n,r,a=this,h=this.autoGenerateColumns;this._isCopying=!0;this._dragable=!1;t&&this.beginUpdate();this.itemsSource=null;this._clearAndCheckItemsOwner(this.rows);this._clearAndCheckItemsOwner(this.columns);this._clearAndCheckItemsOwner(this.columnHeaders.columns);this._clearAndCheckItemsOwner(this.rowHeaders.rows);n=e.grid.selection.clone();this._selHdl.select(new wijmo_grid_1.CellRange,!1);e.selectionRanges.length>1&&(this.selectionMode===wijmo_grid_1.SelectionMode.CellRange||this.selectionMode===wijmo_grid_1.SelectionMode.MultiRange)&&(this._enableMulSel=!0);this._headerRowRemoved=e._ownerHeaderRowRemoved;if(e.itemsSource){this.autoGenerateColumns=!1;this._ignoreBindGrid=wijmo_1.isArray(e.itemsSource)||e.itemsSource instanceof wijmo_1.CollectionView;this.itemsSource=e.itemsSource;this._ignoreBindGrid=!1;this.collectionView.beginUpdate()}else for(i=0;i<e.grid.rows.length;i++)this.rows.push(e.grid.rows[i]);this.sortManager.sortDescriptions.sourceCollection=e._sortList.slice();this.sortManager._committedList=e._sortList.slice();for(o=0;o<e.grid.columns.length;o++){(l=e.grid.columns[o]).isRequired=!1;this.columns.push(l)}if(this.collectionView){if(e.grid.collectionView){this.collectionView.sortDescriptions.clear();e.grid.collectionView.sortDescriptions.forEach(e=>this.collectionView.sortDescriptions.push(e))}this.collectionView.moveCurrentToPosition(this._getCvIndex(n.row));this._resetMappedColumns(this);this.collectionView.endUpdate(!0);if(e._dataView){this.collectionView._view=e._dataView;this.collectionView._pgView=this.collectionView._getPageView();if(!(this.itemsSource instanceof wijmo_1.CollectionView)){e.grid.collectionView._view=e._dataView;e.grid.collectionView._pgView=e.grid.collectionView._getPageView()}this._bindGrid(!1);e.grid._bindGrid(!1)}this.collectionView.collectionChanged.addHandler((e,t)=>{t.action===wijmo_1.NotifyCollectionChangedAction.Reset&&setTimeout(()=>{a.invalidate()},10)},this)}if(this.rows.length&&this.columns.length){this._selHdl.select(n,!1);if(this.selectionMode===wijmo_grid_1.SelectionMode.MultiRange){this._selHdl.extendedSelection.beginUpdate();for(var d=0;d<e.selectionRanges.length;d++)this.selection.equals(e.selectionRanges[d])||this._selHdl.extendedSelection.push(e.selectionRanges[d]);this._selHdl.extendedSelection.endUpdate()}}e._applyFilterSetting();for(i=0;i<this.rows.length;i++)if(s=e._rowSettings[i]){let e=this.rows[i];r=e instanceof HeaderRow;e.height=s.height;e.allowMerging=s.allowMerging;e.visible=s.visible;e instanceof wijmo_grid_1.GroupRow&&(e.isCollapsed=!!s.isCollapsed);e.isSelected=!!s.isSelected;e.isReadOnly=r||!!s.readOnly}this.autoGenerateColumns=h;this.frozenRows=e.grid.frozenRows;this.frozenColumns=e.grid.frozenColumns;this._isCopying=!1;if(t){this.cells.hostElement.style.overflow="hidden";this._setFlexSheetToDirty();this.endUpdate();if(this._addingSheet){clearTimeout(this._toRefresh);this._toRefresh=setTimeout(()=>{this._setFlexSheetToDirty();this.invalidate()},wijmo_1.Control._REFRESH_INTERVAL);this._addingSheet=!1}}this._updateScrollPos=!0}onUpdatedLayout(e){if(this._updateScrollPos){this.cells.hostElement.style.overflow="";this._updateScrollPos=!1;let e=this.selectedSheet;if(e){this.scrollPosition=e._scrollPosition;this._ptScrl=e._scrollPosition}}super.onUpdatedLayout(e)}_resetMappedColumns(e){var t,o,i=0;e._mappedColumns=null;if(e.collectionView){o=e.collectionView.sortDescriptions;for(;i<o.length;i++)if((t=e.columns.getColumn(o[i].property))&&t.dataMap){e._mappedColumns||(e._mappedColumns={});e._mappedColumns[t.binding]=t.dataMap}}}_loadFromWorkbook(e){if(null!=e.sheets&&0!==e.sheets.length){this.beginUpdate();this.clear();this._reservedContent=e.reservedContent;if(e.colorThemes&&e.colorThemes.length>0)for(let t=0;t<this._colorThemes.length;t++)this._colorThemes[t]=e.colorThemes[t];for(let t=0,o=e.sheets.length;t<o;t++){t>0&&this.addUnboundSheet();let o=this.selectedSheet,i=o.grid,s=i.wj_sheetInfo={};wijmo_grid_xlsx_1.FlexGridXlsxConverter.load(i,e,{sheetIndex:t,includeColumnHeaders:!1});o.name=s.name;o.visible=s.visible;o._styledCells=s.styledCells;if(s.mergedRanges){for(let e=0;e<s.mergedRanges.length;e++)o._mergedRanges[e]=s.mergedRanges[e];s.mergedRanges=o._mergedRanges}this._copyFrom(o);if(s.tables&&s.tables.length>0)for(let e=0;e<s.tables.length;e++)this._parseFromWorkbookTable(s.tables[e],o)}null!=e.activeWorksheet&&e.activeWorksheet>-1&&e.activeWorksheet<this.sheets.length?this.selectedSheetIndex=e.activeWorksheet:this.selectedSheetIndex=0;e.definedNames&&e.definedNames.forEach(e=>{this.definedNames.push(new DefinedName(this,e.name,e.value,e.sheetName))});this.endUpdate();this.onLoaded()}}_saveToWorkbook(e){var t,o,i,s,l,n,r=this,a=!(!e||!e.includeFormulaValues),evaluateFormula=e=>r.evaluate(e,null,s);if(0===r.sheets.length)throw"The flexsheet is empty.";s=r.sheets[0];a&&(s.grid.wj_sheetInfo.evaluateFormula=evaluateFormula);if(0===r.selectedSheetIndex){s._storeRowSettings();s.itemsSource instanceof wijmo_1.CollectionView||r._copyRowsToSelectedSheet()}s._setRowSettings();if(s.tables.length>0){s.grid.wj_sheetInfo.tables=[];for(n=0;n<s.tables.length;n++)s.grid.wj_sheetInfo.tables.push(r._parseToWorkbookTable(s.tables[n]))}t=wijmo_grid_xlsx_1.FlexGridXlsxConverter.save(s.grid,{sheetName:s.name,sheetVisible:s.visible,includeColumnHeaders:!1});r._checkTableHeaderRow(s.tables,t);s.grid.wj_sheetInfo.evaluateFormula&&(s.grid.wj_sheetInfo.evaluateFormula=null);t.reservedContent=r._reservedContent;for(l=1;l<r.sheets.length;l++){s=r.sheets[l];a&&(s.grid.wj_sheetInfo.evaluateFormula=evaluateFormula);if(r.selectedSheetIndex===l){s._storeRowSettings();s.itemsSource instanceof wijmo_1.CollectionView||r._copyRowsToSelectedSheet()}s._setRowSettings();if(s.tables.length>0){s.grid.wj_sheetInfo.tables=[];for(n=0;n<s.tables.length;n++)s.grid.wj_sheetInfo.tables.push(r._parseToWorkbookTable(s.tables[n]))}o=wijmo_grid_xlsx_1.FlexGridXlsxConverter.save(s.grid,{sheetName:s.name,sheetVisible:s.visible,includeColumnHeaders:!1});r._checkTableHeaderRow(s.tables,o);s.grid.wj_sheetInfo.evaluateFormula&&(s.grid.wj_sheetInfo.evaluateFormula=null);t._addWorkSheet(o.sheets[0],l)}t.activeWorksheet=r.selectedSheetIndex;for(n=0;n<r.definedNames.length;n++){var h=r.definedNames[n];(i=new mXlsx.DefinedName).name=h.name;i.value=h.value;i.sheetName=h.sheetName;t.definedNames.push(i)}if(r._colorThemes&&r._colorThemes.length>0)for(n=0;n<r._colorThemes.length;n++)t.colorThemes[n]=r._colorThemes[n];return t}_mouseDown(e){var t,o,i=window.navigator.userAgent,s=this.hitTest(e);this.columns;this.selectedSheet&&(this.selectedSheet._scrollPosition=this.scrollPosition);s.cellType!==wijmo_grid_1.CellType.None&&(this._isClicking=!0);if(this._dragable){this._isDragging=!0;this._draggingMarker=document.createElement("div");wijmo_1.setCss(this._draggingMarker,{position:"absolute",display:"none",borderStyle:"dotted",cursor:"move"});document.body.appendChild(this._draggingMarker);this._draggingTooltip=new wijmo_1.Tooltip;this._draggingCells=this.selection;this.selectedSheet&&this.selectedSheet.selectionRanges.clear();this.onDraggingRowColumn(new DraggingRowColumnEventArgs(this.selection.clone(),this._draggingRow,e.shiftKey));e.preventDefault()}else if("crosshair"!==this.hostElement.style.cursor||null!=this._fillingMarker){if(this.selectionMode===wijmo_grid_1.SelectionMode.CellRange||this.selectionMode===wijmo_grid_1.SelectionMode.MultiRange){if(e.ctrlKey){if(!this._enableMulSel){this._enableMulSel=!0;0===this.selectedSheet.selectionRanges.length&&this.selectedSheet.selectionRanges.push(this.selection)}}else if(s.cellType!==wijmo_grid_1.CellType.None){this.selectedSheet&&(3===e.which&&this._isCellSelected(s.row,s.col)||this.selectedSheet.selectionRanges.clear());this._enableMulSel&&this.refresh(!1);this._enableMulSel=!1}}else{this._enableMulSel=!1;this.selectedSheet&&this.selectedSheet.selectionRanges.clear()}this._htDown=s;if(0!==this.rows.length&&0!==this.columns.length){i.match(/iPad/i)||i.match(/iPhone/i)||this._hideContextMenu();if(3!==e.which&&(this.selectionMode===wijmo_grid_1.SelectionMode.CellRange||this.selectionMode===wijmo_grid_1.SelectionMode.MultiRange)&&(s.cellType===wijmo_grid_1.CellType.ColumnHeader||s.cellType===wijmo_grid_1.CellType.None)&&!(s.col>-1&&this.columns[s.col].isSelected)&&wijmo_1.hasClass(e.target,"wj-cell")&&!s.edgeRight){this._columnHeaderClicked=!0;o=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0;e.target.focus();if(e.shiftKey)this._multiSelectColumns(s);else{t=new wijmo_grid_1.CellRange(o,s.col,this.rows.length-1,s.col);if(3===e.which&&this.selection.contains(t))return;this.select(t)}this._eCt.children[o]&&this._eCt.children[o].children[s.col]&&this._eCt.children[o].children[s.col].focus()}}}else{this.finishEditing();this._fillingData=!0;this._fillingPoint=new wijmo_1.Point(e.clientX-this.scrollPosition.x,e.clientY-this.scrollPosition.y);this._fillingSource=this.selection.clone();this._fillingMarker=document.createElement("div");wijmo_1.setCss(this._fillingMarker,{position:"absolute",display:"none",border:"2px dashed"});this._root.appendChild(this._fillingMarker);this._fillingTooltip=new wijmo_1.Tooltip;e.preventDefault()}}_mouseMove(e){var t,o=this.hitTest(e),i=this.selection.clone(),s=this.rows.length,l=this.columns.length,n=this.hostElement.style.cursor;if(0!==this.rows.length&&0!==this.columns.length)if(this._isDragging){this.hostElement.style.cursor="move";this._showDraggingMarker(e)}else if(!this._isClicking&&o.edgeBottom&&o.edgeRight&&o.row===i.bottomRow&&o.col===i.rightCol&&this.allowAutoFill)this.hostElement.style.cursor="crosshair";else if(this._fillingData){this.hostElement.style.cursor="crosshair";this._showFillMarker(e)}else{t=this.itemsSource?0===i.topRow||1===i.topRow:0===i.topRow;if(!this._isClicking&&i&&o.cellType!==wijmo_grid_1.CellType.None&&!this.itemsSource&&!this.isReadOnly&&this._enableDragDrop){this._draggingColumn=t&&i.bottomRow===s-1;this._draggingRow=0===i.leftCol&&i.rightCol===l-1;if(o.cellType===wijmo_grid_1.CellType.Cell){this._draggingColumn&&((o.col===i.leftCol-1||o.col===i.rightCol)&&o.edgeRight||o.row===s-1&&o.edgeBottom)&&(n="move");this._draggingRow&&!this._containsGroupRows(i)&&((o.row===i.topRow-1||o.row===i.bottomRow)&&o.edgeBottom||o.col===l-1&&o.edgeRight)&&(n="move")}else o.cellType===wijmo_grid_1.CellType.ColumnHeader?o.edgeBottom&&(this._draggingColumn&&o.col>=i.leftCol&&o.col<=i.rightCol?n="move":this._draggingRow&&0===i.topRow&&(n="move")):o.cellType===wijmo_grid_1.CellType.RowHeader&&o.edgeRight&&(this._draggingColumn&&0===i.leftCol?n="move":this._draggingRow&&o.row>=i.topRow&&o.row<=i.bottomRow&&!this._containsGroupRows(i)&&(n="move"));this._dragable="move"===n;this.hostElement.style.cursor=n}if(this._htDown&&this._htDown.panel){o=new wijmo_grid_1.HitTestInfo(this._htDown.panel,e);this._multiSelectColumns(o);o.cellType===wijmo_grid_1.CellType.Cell&&this.scrollIntoView(o.row,o.col)}}else{this._dragable=!1;o.cellType===wijmo_grid_1.CellType.Cell&&(this.hostElement.style.cursor="default")}}_mouseUp(e){try{if(this._isDragging){if(this._dropRange&&!this._draggingCells.equals(this._dropRange)){let t=new DroppingRowColumnEventArgs(this._dropRange.clone(),this._draggingRow),o=new wijmo_1.CancelEventArgs;this.onBeginDroppingRowColumn(t);o.cancel=t.cancel;t.cancel||this._handleDropping(e);this.onEndDroppingRowColumn(o)}}else if(this._fillingData){let e,t,o=AutoFillOperation.CopyContent,i=this._fillingRange,s=this._fillingSource;this._orgCellSettings=null;if(this._fillingRange&&this._fillingRange.isValid){wijmo_1.assert(this._canDoFillOperation(),"To do this, all the merged cells need be the same size.");(e=s.leftCol===i.leftCol&&s.rightCol===i.rightCol)?s.row!==s.row2&&(o=AutoFillOperation.FillSeries):s.col!==s.col2&&(o=AutoFillOperation.FillSeries);this._orgCellSettings=this._getCellSettingsForFill();t=new _FillAction(this,this._fillingSource);this._undoStack._addAction(t);o=AutoFillOperation.CopyFormat|o;this._fillData(o)&&this._showFillMenuSmartTag(o)}}}finally{if(this._isDragging){this._draggingCells=null;this._dropRange=null;document.body.removeChild(this._draggingMarker);this._draggingMarker=null;this._draggingTooltip.hide();this._draggingTooltip=null;this._isDragging=!1;this._draggingColumn=!1;this._draggingRow=!1}if(this._htDown&&this._htDown.cellType!==wijmo_grid_1.CellType.None&&this.selectedSheet){this._htDown.cellType!==wijmo_grid_1.CellType.TopLeft||this.selectionMode!==wijmo_grid_1.SelectionMode.CellRange&&this.selectionMode!==wijmo_grid_1.SelectionMode.MultiRange||(this.selection=new wijmo_grid_1.CellRange(0,0,this.rows.length-1,this.columns.length-1));this.selection.isValid&&this.selectedSheet._addSelection(this.selection);this._enableMulSel=!1}if(this._fillingData){this._fillingData=!1;this._fillingPoint=null;this._fillingRange=null;this._root.removeChild(this._fillingMarker);this._fillingMarker=null;this._fillingTooltip.hide();this._fillingTooltip=null;this.hostElement.style.cursor="default"}this._isClicking=!1;this._columnHeaderClicked=!1;this._htDown=null}}_click(){var e=this,t=window.navigator.userAgent;t.match(/iPad/i)||t.match(/iPhone/i)||e._hideContextMenu();setTimeout(()=>{e.hideFunctionList()},200)}_touchStart(e){var t=this;wijmo_1.hasClass(e.target,"wj-context-menu-item")||t._hideContextMenu();t._longClickTimer=setTimeout(()=>{var o;if(t._isDescendant(t._divContainer,e.target)&&(o=t.hitTest(e))&&o.cellType!==wijmo_grid_1.CellType.None&&!t._resizing){if(o.cellType===wijmo_grid_1.CellType.TopLeft){t.selection=new wijmo_grid_1.CellRange(0,0,t.rows.length-1,t.columns.length-1);if(t.selectedSheet){t.selectedSheet.selectionRanges.clear();t.selectedSheet.selectionRanges.push(t.selection)}}t._contextMenu.show(null,new wijmo_1.Point(e.pageX+10,e.pageY+10))}},500)}_touchEnd(){clearTimeout(this._longClickTimer)}_keydown(e){this._endDragFillOperation(e);if((this._isDescendant(this.hostElement,e.target)||this.hostElement===e.target)&&!this._edtHdl.activeEditor&&!(e.target instanceof HTMLInputElement)&&this.selectedSheet&&(e.keyCode===wijmo_1.Key.Delete||e.keyCode===wijmo_1.Key.Back)){this._delSeletionContent(e);e.preventDefault()}let t=this._contextMenu.visible?this._contextMenu:this._tabHolder.sheetControl._contextMenu.visible?this._tabHolder.sheetControl._contextMenu:null;if(t){e.keyCode===wijmo_1.Key.Down&&t.moveToNext();e.keyCode===wijmo_1.Key.Up&&t.moveToPrev();e.keyCode===wijmo_1.Key.Home&&t.moveToFirst();e.keyCode===wijmo_1.Key.End&&t.moveToLast();e.keyCode===wijmo_1.Key.Enter&&t.handleContextMenu();e.preventDefault()}}_showDraggingMarker(e){var t,o,i,s,l,n,r,a,h,d=new wijmo_grid_1.HitTestInfo(this.cells,e),_=this.selection,u=this.columns.length,c=this.rows.length,g=this._cumulativeScrollOffset(this.hostElement),w=this._root.getBoundingClientRect(),m=w.left+g.x,f=w.top+g.y;this.scrollIntoView(d.row,d.col);if(this._draggingColumn){o=_.rightCol-_.leftCol+1;l=0;((i=d.col)<0||i+o>u)&&(i=u-o);t=this.cells.getCellBoundingRect(0,i);n=this._root.offsetHeight-this._eCHdr.offsetHeight;s=(s=this.cells.height)>n?n:s;for(r=0;r<o;r++)l+=this.columns[i+r].renderSize;a=FlexSheet.convertNumberToAlpha(i)+" : "+FlexSheet.convertNumberToAlpha(i+o-1);if(this._dropRange){this._dropRange.col=i;this._dropRange.col2=i+o-1}else this._dropRange=new wijmo_grid_1.CellRange(0,i,this.rows.length-1,i+o-1)}else if(this._draggingRow){o=_.bottomRow-_.topRow+1;s=0;((i=d.row)<0||i+o>c)&&(i=c-o);t=this.cells.getCellBoundingRect(i,0);n=this._root.offsetWidth-this._eRHdr.offsetWidth;for(r=0;r<o;r++)s+=this.rows[i+r].renderSize;l=(l=this.cells.width)>n?n:l;a=i+1+" : "+(i+o);if(this._dropRange){this._dropRange.row=i;this._dropRange.row2=i+o-1}else this._dropRange=new wijmo_grid_1.CellRange(i,0,i+o-1,this.columns.length-1)}if(t){h={display:"inline",zIndex:"9999",opacity:.5,top:t.top-(this._draggingColumn?this._ptScrl.y:0)+g.y,left:t.left-(this._draggingRow?this._ptScrl.x:0)+g.x,height:s,width:l};t.top=t.top-(this._draggingColumn?this._ptScrl.y:0);t.left=t.left-(this._draggingRow?this._ptScrl.x:0);if(this.rightToLeft&&this._draggingRow){h.left=h.left-l+t.width+2*this._ptScrl.x;t.left=t.left+2*this._ptScrl.x}if(this._draggingRow){if(m+this._eRHdr.offsetWidth!==h.left||f+this._root.offsetHeight+1<h.top+h.height)return}else if(f+this._eCHdr.offsetHeight!==h.top||m+this._root.offsetWidth+1<h.left+h.width)return;wijmo_1.setCss(this._draggingMarker,h);this._draggingTooltip.show(this.hostElement,a,t)}}_showFillMarker(e){let t,o,i,s,l,n,r,a,h=new wijmo_grid_1.HitTestInfo(this.cells,e);if(h.row>-1&&h.col>-1){t=e.clientX-this.scrollPosition.x-this._fillingPoint.x;o=e.clientY-this.scrollPosition.y-this._fillingPoint.y;if(Math.abs(t)>=Math.abs(o)){i=this._fillingSource.topRow;l=this._fillingSource.bottomRow;s=t>=0?this._fillingSource.leftCol:h.col;n=t>=0?h.col:this._fillingSource.rightCol}else{i=o>=0?this._fillingSource.topRow:h.row;l=o>=0?h.row:this._fillingSource.bottomRow;s=this._fillingSource.leftCol;n=this._fillingSource.rightCol}r=this.cells.getCellBoundingRect(i,s,!0);a=this.cells.getCellBoundingRect(l,n,!0);wijmo_1.setCss(this._fillingMarker,{left:r.left+this.cells.hostElement.offsetLeft-2,top:r.top+this.cells.hostElement.offsetTop-2,width:a.right-r.left+4,height:a.bottom-r.top+4,display:"",zIndex:"9999"});this._fillingRange=new wijmo_grid_1.CellRange(i,s,l,n);this.scrollIntoView(h.row,h.col);this._showFillTooltip()}}_showFillTooltip(){let e,t,o,i,s,l,n,r,a,h,d,_,u=this._fillingSource,c=this._fillingRange;this._fillingTooltip.hide();if(!c.equals(u)&&!u.contains(c)){if(t=u.leftCol===c.leftCol&&u.rightCol===c.rightCol){if(c.bottomRow>u.bottomRow){(e=this.cells.getCellBoundingRect(c.bottomRow,c.rightCol)).top=e.bottom+10;o=c.bottomRow-u.topRow}else{(e=this.cells.getCellBoundingRect(c.topRow,c.rightCol)).top+=10;o=c.topRow-u.topRow}e.left=e.right;(i=o%u.rowSpan)<0&&(i+=u.rowSpan);u.row===u.row2&&(s=!0);a=this.selectedSheet.getCellStyle(u.topRow+i,u.leftCol);h=this.getMergedRange(this.cells,u.topRow+i,u.leftCol);d=this.columns[u.leftCol];_=a&&a.format?a.format:d.format;if(s)r=_isFormula(r=this.getCellData(h?h.topRow:u.topRow+i,u.leftCol,!1))?"":wijmo_1.Globalize.format(r,_);else{l=this.getCellData(u.topRow+i,u.leftCol,!1);if(wijmo_1.isNumber(l)||wijmo_1.isDate(l))if(n=this._getFillSeries(t,0,i)){r=this._getFillData(i,o,u,t,n,!0);r=wijmo_1.Globalize.format(r,_)}else r="";else _isFormula(r=l)&&(r="")}}else{if(c.rightCol>u.rightCol){e=this.cells.getCellBoundingRect(c.bottomRow,c.rightCol);o=c.rightCol-u.leftCol}else{e=this.cells.getCellBoundingRect(c.bottomRow,c.leftCol);o=c.leftCol-u.leftCol}e.top=e.bottom+10;(i=o%u.columnSpan)<0&&(i+=u.columnSpan);u.col===u.col2&&(s=!0);a=this.selectedSheet.getCellStyle(u.topRow,u.leftCol+i);h=this.getMergedRange(this.cells,u.topRow,u.leftCol+i);d=this.columns[u.leftCol+i];_=a&&a.format?a.format:d.format;if(s)r=_isFormula(r=this.getCellData(u.topRow,h?h.leftCol:u.leftCol+i,!1))?"":wijmo_1.Globalize.format(r,_);else{l=this.getCellData(u.topRow,u.leftCol+i,!1);if(wijmo_1.isNumber(l)||wijmo_1.isDate(l))if(n=this._getFillSeries(t,0,i)){r=this._getFillData(i,o,u,t,n,!0);r=wijmo_1.Globalize.format(r,_)}else r="";else _isFormula(r=l)&&(r="")}}e.top+=this.cells.hostElement.offsetTop;this._fillingTooltip.show(this.hostElement,r,e)}}_showFillMenuSmartTag(e){let t=this,o=document.createElement("img"),i=document.createElement("img"),s=t.selection,l=t.cells.getCellBoundingRect(s.bottomRow,s.rightCol,!0),n=l.right+t.cells.hostElement.offsetLeft,r=l.bottom+t.cells.hostElement.offsetTop;t.addEventListener(document.body,"mousedown",t._endDragFillOperationHdl,!0);t._fillSmartTagHost=document.createElement("div");wijmo_1.addClass(t._fillSmartTagHost,"wj-flexsheet-smart-tag");n+t._ptScrl.x+32+(t.cells.hostElement.offsetHeight>t._root.offsetHeight?17:0)>t._root.offsetWidth&&(n-=32);r+t._ptScrl.y+18+(t.cells.hostElement.offsetWidth>t._root.offsetWidth?17:0)>t._root.offsetHeight&&(r-=18);wijmo_1.setCss(t._fillSmartTagHost,{left:n,top:r});o.setAttribute("src","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFJJREFUeNrclEEKACAIBOfp/Xy7i4WSRnRYBIVRVhFJVIhyEAxllQa5E/wBSnsU6Rza2nugqNmASi57C/KKNg/Iqn+iVWzx6M4bOdUEAAD//wMAAYRMfiNaiqEAAAAASUVORK5CYII=");wijmo_1.setCss(o,{float:"left",height:18,margin:0});i.setAttribute("src","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAcAAAASCAYAAACXScT7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGCSURBVHjafNFPKKRxHAbw5/v7GYdBYUQjLm5SkoNykCQHtcx431/KgdKumJvSrAO7Nwc3RQ5kd3OkHJC/hUJREluonVcToqRh3sRFPA6M1Mbhc3z6Pj1fkMRHQNJL0uPeul731lU37o1y49cqHr8GvvgWQRLBsmpM/P0j4XAXiooKcXl1CZDEzl4EJBEwAZBUwWAQsVgsFSRR11gmM8trimSa3WypzZ31l5v2/vfk/4oAcv9aSGyUSz4gg/AIAOET0YQswIQWaNrnH+2OeSaY0BJN2+wDTi/OpCrwkxX1vW8q63p5cnaaB+Z/09u7x0nFJTVMiEajPsNCQaC6Ryb8THKcw/Tikho6zj//0RGUNV6gMZ1H8fmpH5iTHDlwsiOhO7FrN5RdP6aBIUj/pvJ2bkFbkxAzBzELELNCQQqgrJ5ST1/jqmYOJcHa7dYYGV5TrQ3d+vfUU+b7IfrOIRCGBYD0o1VGmaHaB6DZkqvMD2hUfF1UAISkvE/+yqbCZ89+HgBtwgFOrBUzJgAAAABJRU5ErkJggg==");wijmo_1.setCss(i,{float:"left",margin:0,height:18,display:"none"});t._fillSmartTagHost.appendChild(o);t._fillSmartTagHost.appendChild(i);t._root.appendChild(t._fillSmartTagHost);t.addEventListener(t._fillSmartTagHost,"mouseover",()=>{t._fillSmartTagHost.style.width="32px";i.style.display=""});t.addEventListener(t._fillSmartTagHost,"mouseleave",()=>{if(!t._fillMenuHost){t._fillSmartTagHost.style.width="18px";i.style.display="none"}});t.addEventListener(t._fillSmartTagHost,"mousedown",o=>{if(wijmo_1.hasClass(t._fillSmartTagHost,"wj-flexsheet-smart-tag-active")){wijmo_1.removeClass(t._fillSmartTagHost,"wj-flexsheet-smart-tag-active");t._fillMenuHost.style.display="none"}else{wijmo_1.addClass(t._fillSmartTagHost,"wj-flexsheet-smart-tag-active");t._showFillMenu(e);e=null}o.preventDefault()},!0)}_selections(){var e=[];if(!this.selectedSheet)return e;if(this.selectionMode==wijmo_grid_1.SelectionMode.ListBox)for(let t=0,o=this.rows.length,i=this.columns.length-1;t<o;t++)this.rows[t].isSelected&&e.push(new wijmo_grid_1.CellRange(t,0,t,i));else e=this.selectedSheet.selectionRanges.slice();return e.length?e:[this.selection]}_isCellSelected(e,t){return this._selections().some(o=>o.contains(e,t))}_showFillMenu(e){let t,o,i=wijmo_1.culture.FlexSheet,s=this,l=s._fillSmartTagHost.offsetLeft,n=s._fillSmartTagHost.offsetTop+18;if(!s._fillMenuHost){s._fillMenuHost=document.createElement("div");wijmo_1.setCss(s._fillMenuHost,{display:"none",zIndex:100});s._fillMenuHost.innerHTML='<div class="wj-flexsheet-fill-menu-item">'+i.copyCells+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillSeries+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillFormat+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillWithoutFormat+"</div>";wijmo_1.addClass(s._fillMenuHost,"wj-flexsheet-fill-menu");s._root.appendChild(s._fillMenuHost);for(let e=0;e<s._fillMenuHost.childElementCount;e++){t=s._fillMenuHost.childNodes[e];s.addEventListener(t,"mousedown",t=>{let o;s._removeActiveStyleForFillMenuItem();wijmo_1.addClass(t.target,"wj-flexsheet-fill-menu-item-active");switch(e){case 0:o=AutoFillOperation.CopyFormat|AutoFillOperation.CopyContent;break;case 1:o=AutoFillOperation.CopyFormat|AutoFillOperation.FillSeries;break;case 2:o=AutoFillOperation.CopyFormat;break;case 3:o=AutoFillOperation.FillSeries}s._fillData(o);s._fillMenuHost.style.display="none";wijmo_1.removeClass(s._fillSmartTagHost,"wj-flexsheet-smart-tag-active");t.preventDefault()},!0)}}if(e){s._removeActiveStyleForFillMenuItem();switch(e){case AutoFillOperation.CopyFormat|AutoFillOperation.CopyContent:o=0;break;case AutoFillOperation.CopyFormat|AutoFillOperation.FillSeries:o=1;break;case AutoFillOperation.CopyFormat:o=2;break;case AutoFillOperation.FillSeries:o=3}wijmo_1.addClass(s._fillMenuHost.childNodes[o],"wj-flexsheet-fill-menu-item-active")}wijmo_1.setCss(s._fillMenuHost,{display:""});l+s._ptScrl.x+s._fillMenuHost.offsetWidth+(s.cells.hostElement.offsetHeight>s._root.offsetHeight?17:0)>s._root.offsetWidth&&(l=l-s._fillMenuHost.offsetWidth+s._fillSmartTagHost.offsetWidth);n+s._ptScrl.y+s._fillMenuHost.offsetHeight+ +(s.cells.hostElement.offsetWidth>s._root.offsetWidth?17:0)>s._root.offsetHeight&&(n=s._fillSmartTagHost.offsetTop-s._fillMenuHost.offsetHeight);s._fillMenuHost.style.left=l+"px";s._fillMenuHost.style.top=n+"px"}_endDragFillOperation(e){if(this._fillSmartTagHost&&(!(e instanceof MouseEvent)||e.target!==this._fillSmartTagHost&&!this._isDescendant(this._fillSmartTagHost,e.target)&&e.target!==this._fillMenuHost&&!this._isDescendant(this._fillMenuHost,e.target))){this.removeEventListener(document.body,"mousedown",this._endDragFillOperationHdl);this._disposeFillSmartTag();this._fillMenuHost&&this._disposeFillMenu();this._undoStack._updateCurrentAction(_FillAction)}}_removeActiveStyleForFillMenuItem(){let e;for(let t=0;t<this._fillMenuHost.childElementCount;t++){e=this._fillMenuHost.childNodes[t];wijmo_1.removeClass(e,"wj-flexsheet-fill-menu-item-active")}}_disposeFillSmartTag(){this.removeEventListener(this._fillSmartTagHost);this._root.removeChild(this._fillSmartTagHost);this._fillSmartTagHost=null;this._orgCellSettings=null}_disposeFillMenu(){let e;for(let t=0;t<this._fillMenuHost.childElementCount;t++){e=this._fillMenuHost.childNodes[t];this.removeEventListener(e)}this._root.removeChild(this._fillMenuHost);this._fillMenuHost=null}_handleDropping(e){var t,o,i,s,l,n,r;if(this.selectedSheet&&this._draggingCells&&this._dropRange&&!this._containsMergedCells(this._draggingCells)&&!this._containsMergedCells(this._dropRange)){this._clearCalcEngine();if(this._draggingColumn&&this._draggingCells.leftCol>this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow>this._dropRange.topRow)if(e.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!0)){console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");return}if(this._draggingColumn){s=this._dropRange.leftCol;for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++){this.columns.moveElement(o,s);s++}this._exchangeTableColumns(!0)}else if(this._draggingRow){i=this._dropRange.topRow;for(t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++){this.rows.moveElement(t,i);i++}}this._exchangeCellStyle(!0)}else{this.undoStack.stackSize>0&&(l=new _MoveCellsAction(this,this._draggingCells,this._dropRange,e.ctrlKey));i=this._dropRange.topRow;for(t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++){s=this._dropRange.leftCol;for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++){this._moveCellContent(t,o,i,s,e.ctrlKey);if(this._draggingColumn&&i===this._dropRange.topRow){this.columns[s].dataType=this.columns[o].dataType?this.columns[o].dataType:wijmo_1.DataType.Object;this.columns[s].align=this.columns[o].align;this.columns[s].format=this.columns[o].format;if(!e.ctrlKey){this.columns[o].dataType=wijmo_1.DataType.Object;this.columns[o].align=null;this.columns[o].format=null}}s++}i++}if(this._draggingColumn&&!e.ctrlKey){s=this._dropRange.leftCol;for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++){this._updateColumnFiler(o,s);s++}}}else if(this._draggingColumn&&this._draggingCells.leftCol<this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow<this._dropRange.topRow)if(e.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!1)){console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");return}if(this._draggingColumn){s=this._dropRange.rightCol;for(o=this._draggingCells.rightCol;o>=this._draggingCells.leftCol;o--){this.columns.moveElement(o,s);s--}this._exchangeTableColumns(!1)}else if(this._draggingRow){i=this._dropRange.bottomRow;for(t=this._draggingCells.bottomRow;t>=this._draggingCells.topRow;t--){this.rows.moveElement(t,i);i--}}this._exchangeCellStyle(!1)}else{this.undoStack.stackSize>0&&(l=new _MoveCellsAction(this,this._draggingCells,this._dropRange,e.ctrlKey));i=this._dropRange.bottomRow;for(t=this._draggingCells.bottomRow;t>=this._draggingCells.topRow;t--){s=this._dropRange.rightCol;for(o=this._draggingCells.rightCol;o>=this._draggingCells.leftCol;o--){this._moveCellContent(t,o,i,s,e.ctrlKey);if(this._draggingColumn&&i===this._dropRange.bottomRow){this.columns[s].dataType=this.columns[o].dataType?this.columns[o].dataType:wijmo_1.DataType.Object;this.columns[s].align=this.columns[o].align;this.columns[s].format=this.columns[o].format;if(!e.ctrlKey){this.columns[o].dataType=wijmo_1.DataType.Object;this.columns[o].align=null;this.columns[o].format=null}}s--}i--}if(this._draggingColumn&&!e.ctrlKey){s=this._dropRange.rightCol;for(o=this._draggingCells.rightCol;o>=this._draggingCells.leftCol;o--){this._updateColumnFiler(o,s);s--}}}if(!e.ctrlKey){n=this._updateFormulaForDropping(e.shiftKey);r=this._updateNamedRangesForDropping(e.shiftKey)}if(l&&l.saveNewState()){l._affectedFormulas=n;l._affectedDefinedNameVals=r;this._undoStack._addAction(l)}if(this._undoStack._pendingAction){this._undoStack._pendingAction._affectedFormulas=n;this._undoStack._pendingAction._affectedDefinedNameVals=r}this.select(this._dropRange);this.selectedSheet._addSelection(this.selection);this.hostElement.focus()}}_moveCellContent(e,t,o,i,s){var l,n,r,a,h,d,_,u,c,g=this.getCellData(e,t,!1),w=e*this.columns.length+t,m=o*this.columns.length+i,f=this.selectedSheet._styledCells[w],p=!0;if(n=this.selectedSheet.findTable(o,i)){_=n.getRange();u=n.getColumns();if(n.showHeaderRow&&o===_.topRow){h=u[a=i-_.leftCol].name;null==g||""===g?p=!1:u[a].name=g}}if(p){if(s&&_isFormula(g)&&m-w!=0)try{(c=this._calcEngine._parse(g))._moveCellRangeExp(this.selectedSheetIndex,new wijmo_grid_1.CellRange(e,t),new wijmo_grid_1.CellRange(o,i),!1,!0)&&(g="="+c._getStringExpression())}catch(e){}this.setCellData(o,i,g)}else p=!0;f?this.selectedSheet._styledCells[m]=this._cloneObject(f):delete this.selectedSheet._styledCells[m];if(s){if(l=this.selectedSheet.findTable(e,t)){d=l.getRange();if(l===n&&e===o&&l.showHeaderRow&&e===d.topRow){r=t-d.leftCol;l._updateColumnName(r,g)}}}else{delete this.selectedSheet._styledCells[w];if(l=this.selectedSheet.findTable(e,t)){d=l.getRange();if(l===n&&e===o&&l.showHeaderRow&&e===d.topRow){r=t-d.leftCol;l._updateColumnName(r,h);return}if(l.showHeaderRow&&e===d.topRow)return}this.setCellData(e,t,null)}}_allowExchangeCells(e,t){let o,i,s,l,n,r,a=this.selectedSheet.tables;for(o=0;o<a.length;o++){i=a[o];if(e){s=i.getRange(TableSection.Data);r=this._draggingCells.rowSpan;l=new wijmo_grid_1.CellRange(this._draggingCells.topRow,s.leftCol,this._draggingCells.bottomRow,s.rightCol);n=new wijmo_grid_1.CellRange(this._dropRange.topRow,s.leftCol,this._dropRange.bottomRow,s.rightCol)}else{s=i.getRange();r=this._draggingCells.columnSpan;l=new wijmo_grid_1.CellRange(s.topRow,this._draggingCells.leftCol,s.bottomRow,this._draggingCells.rightCol);n=new wijmo_grid_1.CellRange(s.topRow,this._dropRange.leftCol,s.bottomRow,this._dropRange.rightCol)}if(s.intersects(l)&&!s.contains(l)||s.intersects(n)&&!s.contains(n)||s.contains(l)&&!s.contains(n)||!s.contains(l)&&s.contains(n))return!1}return!0}_exchangeTableColumns(e){let t,o,i,s,l,n,r=this.selectedSheet.tables;for(t=0;t<r.length;t++)if((i=(o=r[t]).getRange()).leftCol<=this._draggingCells.leftCol&&i.rightCol>=this._draggingCells.rightCol){s=(e?this._draggingCells.leftCol:this._draggingCells.rightCol)-i.leftCol;l=(e?this._dropRange.leftCol:this._dropRange.rightCol)-i.leftCol;for(n=0;n<this._draggingCells.columnSpan;n++){o._moveColumns(s,l);if(e){s++;l++}else{s--;l--}}}}_exchangeCellStyle(e){var t,o,i,s,l,n=0,r=[];for(t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++)for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++){i=t*this.columns.length+o;if(this.selectedSheet._styledCells[i]){r.push(this._cloneObject(this.selectedSheet._styledCells[i]));delete this.selectedSheet._styledCells[i]}else r.push(void 0)}if(e){if(this._draggingColumn){l=this._draggingCells.rightCol-this._draggingCells.leftCol+1;for(o=this._draggingCells.leftCol-1;o>=this._dropRange.leftCol;o--)for(t=0;t<this.rows.length;t++){i=t*this.columns.length+o;s=t*this.columns.length+o+l;if(this.selectedSheet._styledCells[i]){this.selectedSheet._styledCells[s]=this._cloneObject(this.selectedSheet._styledCells[i]);delete this.selectedSheet._styledCells[i]}else delete this.selectedSheet._styledCells[s]}}else if(this._draggingRow){l=this._draggingCells.bottomRow-this._draggingCells.topRow+1;for(t=this._draggingCells.topRow-1;t>=this._dropRange.topRow;t--)for(o=0;o<this.columns.length;o++){i=t*this.columns.length+o;s=(t+l)*this.columns.length+o;if(this.selectedSheet._styledCells[i]){this.selectedSheet._styledCells[s]=this._cloneObject(this.selectedSheet._styledCells[i]);delete this.selectedSheet._styledCells[i]}else delete this.selectedSheet._styledCells[s]}}}else if(this._draggingColumn){l=this._draggingCells.rightCol-this._draggingCells.leftCol+1;for(o=this._draggingCells.rightCol+1;o<=this._dropRange.rightCol;o++)for(t=0;t<this.rows.length;t++){i=t*this.columns.length+o;s=t*this.columns.length+o-l;if(this.selectedSheet._styledCells[i]){this.selectedSheet._styledCells[s]=this._cloneObject(this.selectedSheet._styledCells[i]);delete this.selectedSheet._styledCells[i]}else delete this.selectedSheet._styledCells[s]}}else if(this._draggingRow){l=this._draggingCells.bottomRow-this._draggingCells.topRow+1;for(t=this._draggingCells.bottomRow+1;t<=this._dropRange.bottomRow;t++)for(o=0;o<this.columns.length;o++){i=t*this.columns.length+o;s=(t-l)*this.columns.length+o;if(this.selectedSheet._styledCells[i]){this.selectedSheet._styledCells[s]=this._cloneObject(this.selectedSheet._styledCells[i]);delete this.selectedSheet._styledCells[i]}else delete this.selectedSheet._styledCells[s]}}for(t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(o=this._dropRange.leftCol;o<=this._dropRange.rightCol;o++){i=t*this.columns.length+o;r[n]?this.selectedSheet._styledCells[i]=r[n]:delete this.selectedSheet._styledCells[i];n++}}_containsMergedCells(e,t){var o,i;if(!(t=t||this.selectedSheet))return!1;for(o=0;o<t._mergedRanges.length;o++){i=t._mergedRanges[o];if(e.intersects(i))return!0}return!1}_multiSelectColumns(e){var t;if(e&&this._columnHeaderClicked){(t=new wijmo_grid_1.CellRange(e.row,e.col)).row=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0;t.row2=this.rows.length-1;t.col2=this.selection.col2;this.select(t)}}_cumulativeOffset(e){var t=0,o=0;do{t+=e.offsetTop||0;o+=e.offsetLeft||0;e=e.offsetParent}while(e);return new wijmo_1.Point(o,t)}_cumulativeScrollOffset(e){var t=0,o=0;do{t+=e.scrollTop||0;o+=e.scrollLeft||0;e=e.offsetParent}while(e&&!(e instanceof HTMLBodyElement));t+=document.body.scrollTop||document.documentElement.scrollTop;o+=document.body.scrollLeft||document.documentElement.scrollLeft;return new wijmo_1.Point(o,t)}_checkHitWithinSelection(e){var t;if(null!=e&&e.cellType===wijmo_grid_1.CellType.Cell){if((t=this.getMergedRange(this.cells,e.row,e.col))&&t.contains(this.selection))return!0;if(this.selection.row===e.row&&this.selection.col===e.col)return!0}return!1}_clearForEmptySheet(e){if(this.selectedSheet&&0===this[e].length&&!0!==this._isCopying&&!0!==this._isUndoing&&!0!==this._isSorting){this.selectedSheet._mergedRanges.length=0;this.selectedSheet._styledCells=null;this.select(new wijmo_grid_1.CellRange)}}_containsGroupRows(e){var t;for(t=e.topRow;t<=e.bottomRow;t++)if(this.rows[t]instanceof wijmo_grid_1.GroupRow)return!0;return!1}_delSeletionContent(e){var t,o,i,s,l,n,r,a,h,d,_,u=!1,c=new _EditAction(this),g=this.editableCollectionView,w=!1,m=this.scrollPosition;if(!this.isReadOnly)if(this.allowDelete&&this.selection.isValid&&0===this.selection.leftCol&&this.selection.rightCol===this.columns.length-1)this.deleteRows(this._selections());else{this.beginUpdate();this.undoStack.stackSize>0&&(c=new _EditAction(this));var f=this._selections();for(i=0;i<f.length;i++){t=f[i];o=new wijmo_grid_1.CellRange;d=new wijmo_grid_1.CellEditEndingEventArgs(this.cells,o,e);if((a=this.selectedSheet.tables.length)>0)for(n=a-1;n>=0;n--){r=this.selectedSheet.tables[n];if(t.contains(r.getRange())){c&&c._storeDeletedTables(r);this.selectedSheet.tables.remove(r)}}for(l=t.topRow;l<=t.bottomRow;l++)if((_=this.rows[l])&&!_.isReadOnly&&(_.visible||this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows[l]))for(s=t.leftCol;s<=t.rightCol;s++)if((h=this._getBindingColumn(this.cells,l,this.columns[s]))&&!h.isReadOnly&&(!1===h.isRequired||null==h.isRequired&&h.dataType==wijmo_1.DataType.String)&&(h.visible||this.selectedSheet._freezeHiddenCols&&this.selectedSheet._freezeHiddenCols[s])&&this.getCellData(l,s,!0)){o.setRange(l,s);d.cancel=!1;if(this.onBeginningEdit(d)){if(g){if(!w){w=!0;g.beginUpdate()}g.editItem(_.dataItem);this._edtHdl._edItem=g.currentEditItem}this.setCellData(l,s,"",!0);u=!0;this.onCellEditEnding(d);this.onCellEditEnded(d)}}if(w){g.endUpdate(!0);g._pendingRefresh=!1;t.rowSpan>1&&g.commitEdit()}}if(u&&c){c.saveNewState();this._undoStack._addAction(c)}this.selection=t;this.scrollPosition=m;this.endUpdate()}}_updateAffectedFormula(e,t,o,i,s){var l,n,r,a,h,d,_,u,c,g=[],w=[],m=this.selection.clone();this.selectedSheet._storeRowSettings();this.beginUpdate();for(l=0;l<this.sheets.length;l++){r=(n=this.sheets[l]).grid;for(a=0;a<r.rows.length;a++)for(h=0;h<r.columns.length;h++)if(_isFormula(u=r.getCellData(a,h,!1))&&(c=this._updateCellRef(u,l,e,t,o,i,s))){g.push({sheet:n,point:new wijmo_1.Point(a,h),formula:u});d=a;_=h;if(l===this.selectedSheetIndex){i?a>=e&&(o?d+=t:d-=t):h>=e&&(o?_+=t:_-=t);if(!o&&(i&&a<=e&&a>=e-t+1||!i&&h<=e&&h>=e-t+1))continue}r.setCellData(a,h,c,!1);w.push({sheet:n,point:new wijmo_1.Point(d,_),formula:c})}}this.selection=m;this.endUpdate();return{oldFormulas:g,newFormulas:w}}_updateAffectedNamedRanges(e,t,o,i){var s,l,n,r,a=[],h=[];for(s=0;s<this.definedNames.length;s++)if((n=(l=this.definedNames[s]).value)&&wijmo_1.isString(n)&&(r=this._updateCellRef(n,this.selectedSheetIndex,e,t,o,i))){a.push({name:l.name,value:n});l.value=r;h.push({name:l.name,value:r})}return{oldDefinedNameVals:a,newDefinedNameVals:h}}_updateFormulaBoundaryForEditingCell(e,t){let o,i,s,l,n=[],r=[];this.beginUpdate();for(o=e;o<this.rows.length;o++)if(_isFormula(s=this.getCellData(o,t,!1))&&(l=this._updateCellBoundary(s,e,t))){n.push({point:new wijmo_1.Point(o,t),formula:s});this.setCellData(o,t,l,!1);r.push({point:new wijmo_1.Point(o,t),formula:l})}for(i=t;i<this.columns.length;i++)if(_isFormula(s=this.getCellData(e,i,!1))&&(l=this._updateCellBoundary(s,e,t))){n.push({point:new wijmo_1.Point(e,i),formula:s});this.setCellData(e,i,l,!1);r.push({point:new wijmo_1.Point(e,i),formula:l})}this.endUpdate();return{oldFormulas:n,newFormulas:r}}_updateColumnFiler(e,t){for(var o=JSON.parse(this._filter.filterDefinition),i=0;i<o.filters.length;i++){var s=o.filters[i];if(s.columnIndex===e){s.columnIndex=t;break}}this._filter.filterDefinition=JSON.stringify(o)}_isDescendant(e,t){for(var o=t.parentNode;null!=o;){if(o===e)return!0;o=o.parentNode}return!1}_clearCalcEngine(){this._calcEngine._clearExpressionCache()}_getRangeString(e,t,o=!0){var i,s,l,n,r,a="",h=!0,d=t&&t!==this.selectedSheet?t.grid:this;if(wijmo_1.isArray(e))if(e.length>1){if(this._isMultipleRowsSelected(e,t)){a="";for(s=0;s<e.length;s++){a&&(a+="\n");a+=this._getRangeString(e[s],t)}return a}if(!this._isMultipleColumnsSelected(e,t))return"";a="";for(i=0,h=!0;i<d.rows.length;i++){h||(a+="\n");h=!1;for(s=0,g=!0;s<e.length;s++){(l=e[s].clone()).row=l.row2=i;g||(a+="\t");g=!1;a+=this._getRangeString(e[s],t)}return a}}else{r=e[0];switch(this.selectionMode){case wijmo_grid_1.SelectionMode.Row:case wijmo_grid_1.SelectionMode.RowRange:r.col=0;r.col2=t.grid.columns.length-1;break;case wijmo_grid_1.SelectionMode.ListBox:r.col=0;r.col2=t.grid.columns.length-1;for(var _=0;_<t.grid.rows.length;_++)if(t.grid.rows[_].isSelected&&t.grid.rows[_].isVisible){r.row=r.row2=_;a&&(a+="\n");a+=this._getRangeString(r,t)}return a}}for(var u=(r=wijmo_1.asType(wijmo_1.isArray(e)?e[0]:e,wijmo_grid_1.CellRange)).topRow;u<=r.bottomRow;u++)if(d.rows[u]&&d.rows[u].isVisible){h||(a+="\n");h=!1;for(var c=r.leftCol,g=!0;c<=r.rightCol;c++)if(d.columns[c]&&d.columns[c].isVisible){g||(a+="\t");g=!1;var w=this._getCellStyle(u,c,t),m=w?w.format:"",f=d.columns[c];if(o){_isFormula(n=d.getCellData(u,c,!1))&&(n=this._evaluate(n,m,t,u,c));n=this._formatEvaluatedResult(n,f,m)}else{n=d.getCellData(u,c,!1);wijmo_1.isDate(n)&&(n=wijmo_1.Globalize.format(n,m||f.format));f.dataMap&&(n=f.dataMap.getDisplayValue(n))}(n=(n=null==n?"":n.toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(n='"'+n.replace(/"/g,'""')+'"');a+=n}}return a}_getSelectionForListBoxMode(e){let t,o=0;for(;o<e.rows.length;o++)e.rows[o].isSelected&&(t?t.row2=o:t=new wijmo_grid_1.CellRange(o,0,o,e.columns.length-1));return t}_containsRandFormula(e,t){for(var o=0;o<e.length;o++)for(var i=e[o],s=i.topRow;s<=i.bottomRow&&s<t.grid.rows.length;s++)for(var l=i.leftCol;l<=i.rightCol&&l<t.grid.columns.length;l++){var n=t.grid.getCellData(s,l,!1);if(_isFormula(n)&&-1!==n.search(/rand/i))return!0}return!1}_isMultipleRowsSelected(e,t){var o,i,s;e&&e.length>1?s=e:this.selectedSheet.selectionRanges.length>1&&(s=this.selectedSheet.selectionRanges);o=s[0];for(var l=1;l<s.length;l++)if((i=s[l]).leftCol!==o.leftCol||i.rightCol!==o.rightCol)return!1;return!0}_isMultipleColumnsSelected(e,t){var o,i,s;e&&e.length>1?s=e:this.selectedSheet.selectionRanges.length>1&&(s=this.selectedSheet.selectionRanges);o=s[0];for(var l=0;l<s.length;l++)if((i=s[l]).topRow!==o.topRow||i.bottomRow!==o.bottomRow)return!1;return!0}_postSetClipStringProcess(e,t,o,i,s,l,n){var r,a=new wijmo_grid_1.CellRangeEventArgs(this.cells,new wijmo_grid_1.CellRange(t,o),e);if(this.onPastingCell(a)){if(i>=0&&s>=0&&this._copiedSheet&&(r=this._copiedSheet._getMergedRange(i,s))&&r.topRow===i&&r.leftCol===s){var h=t+r.rowSpan-1;h=h<this.rows.length?h:this.rows.length-1;var d=o+r.columnSpan-1;d=d<this.columns.length?d:this.columns.length-1;let e=new wijmo_grid_1.CellRange(t,o,h,d);for(let t=e.topRow;t<=e.bottomRow;t++)for(let o=e.leftCol;o<=e.rightCol;o++){let i=this.getMergedRange(this.cells,t,o);if(null!=i&&!i.equals(e)){console.error("We can't paste the merged cell to another merged cell.");return!1}}this.mergeRange(new wijmo_grid_1.CellRange(t,o,h,d),!0)}l&&l.editItem(this.rows[t].dataItem);var _=this.cells.setCellData(t,o,n&&n.format?new _ValWithFormat(a.data,n.format):a.data);if(_){if(wijmo_1.isString(a.data)&&"\n"!==a.data){var u=a.data.match(/\n/g);if(u&&u.length>0){n?n.whiteSpace="pre":n={whiteSpace:"pre"};this.rows[t].height=this.rows.defaultSize*(u.length+1)}}var c=(r=this.selectedSheet._getMergedRange(t,o))?r.topRow*this.columns.length+r.leftCol:t*this.columns.length+o;this.selectedSheet._styledCells[c]=n?this._cloneObject(n):void 0;this.onPastedCell(a)}}return _}_delCutData(e,t){var o,i,s,l,n=this._copiedSheet===this.selectedSheet?this:this._copiedSheet.grid;for(o=(l=this.selectionMode===wijmo_grid_1.SelectionMode.ListBox?this._getSelectionForListBoxMode(n):this._copiedRanges[0]).topRow;o<=l.bottomRow;o++)if(null!=n.rows[o])for(i=l.leftCol;i<=l.rightCol;i++)(this._copiedSheet!==this.selectedSheet||o<this.selection.topRow||o>this.selection.topRow+e-1||i<this.selection.leftCol||i>this.selection.leftCol+t-1)&&(0==(s=n._getBindingColumn(n.cells,o,n.columns[i])).isRequired||null==s.isRequired&&s.dataType==wijmo_1.DataType.String)&&n.getCellData(o,i,!0)&&n.setCellData(o,i,"",!0)}_containsMultiLineText(e){for(var t=0;t<e.length;t++)for(var o=e[t],i=0;i<o.length;i++)if(o[i].indexOf("\n")>0)return!0;return!1}_sortByRow(e,t){return e.topRow>t.topRow?1:e.topRow<t.topRow?-1:0}_sortByColumn(e,t){return e.leftCol>t.leftCol?1:e.leftCol<t.leftCol?-1:0}_setFlexSheetToDirty(){this.columns._dirty=!0;this.rows._dirty=!0;this.rowHeaders.columns._dirty=!0;this.rowHeaders.rows._dirty=!0;this.columnHeaders.columns._dirty=!0;this.columnHeaders.rows._dirty=!0}static convertNumberToAlpha(e){var t,o,i="";if(e>=0)do{t=Math.floor(e/26);o=e%26;i=String.fromCharCode(o+65)+i;e=t-1}while(t);return i}_updateFormulaForReorderingRows(e,t,o=!1){var i,s,l=o?e-t:t-e;this.beginUpdate();for(var n=0;n<this.columns.length;n++)if(_isFormula(i=this.getCellData(t,n,!1))&&0!==l){try{s=this._calcEngine._parse(i)}catch(e){continue}s._updateCellRangeExpForReorderingRows(l)&&this.setCellData(t,n,"="+s._getStringExpression())}this.endUpdate()}_updateFormulaForDropping(e){var t,o,i,s,l,n,r,a,h,d=[],_=[];this.beginUpdate();for(i=0;i<this.sheets.length;i++){o=(t=this.sheets[i]).grid;for(s=0;s<o.rows.length;s++)for(n=0;n<o.columns.length;n++)if(_isFormula(a=o.getCellData(s,n,!1))&&(h=this._updateCellRefForDropping(a,i,e))){o.setCellData(s,n,h,!1);if(e&&i===this.selectedSheetIndex){l=o.rows[s];r=o.columns[n];d.push({sheet:t,row:l,column:r,formula:a});_.push({sheet:t,row:l,column:r,formula:h})}else{d.push({sheet:t,point:new wijmo_1.Point(s,n),formula:a});_.push({sheet:t,point:new wijmo_1.Point(s,n),formula:h})}}}this.endUpdate();return{oldFormulas:d,newFormulas:_}}_updateNamedRangesForDropping(e){var t,o,i,s,l=[],n=[];for(t=0;t<this.definedNames.length;t++)if((i=(o=this.definedNames[t]).value)&&wijmo_1.isString(i)&&(s=this._updateCellRefForDropping(i,this.selectedSheetIndex,e))){l.push({name:o.name,value:i});o.value=s;n.push({name:o.name,value:s})}return{oldDefinedNameVals:l,newDefinedNameVals:n}}_updateCellRefForDropping(e,t,o=!1){let i;try{i=this._calcEngine._parse(e)}catch(e){return null}return i._moveCellRangeExp(t,this._draggingCells,this._dropRange,o)?"="+i._getStringExpression():null}_updateCellStyleForReorderingRows(e,t,o){let i,s,l,n=this.columns.length;for(i=0;i<n;i++)(l=this._getCellStyle(e,i))&&(o[s=t*n+i]=l)}_scanFormulas(){for(var e=[],t=0;t<this.rows.length;t++)for(var o=0;o<this.columns.length;o++){var i=this.getCellData(t,o,!1);_isFormula(i)&&e.push({row:t,column:o,formula:i})}return e}_resetFormulas(e){var t=this;e&&t.deferUpdate(()=>{for(var o=0;o<e.length;o++){var i=e[o];t.setCellData(i.row,i.column,i.formula)}})}_getCellStyle(e,t,o){return(o=o||this.selectedSheet)?o.getCellStyle(e,t):null}_validateSheetName(e){for(let t=0;t<this.sheets.length;t++)if(this.sheets[t].name===e)return!0;return!1}_checkExistDefinedName(e,t,o=-1){for(let i=0;i<this.definedNames.length;i++)if(this.definedNames[i].name===e&&this.definedNames[i].sheetName===t&&i!==o)return!0;return!1}_updateDefinedNameWithSheetRefUpdating(e,t){for(var o,i,s,l=0;l<this.definedNames.length;l++){(o=this.definedNames[l]).sheetName===e&&null!=o.sheetName&&(o._sheetName=t);if((i=o.value.match(/(\w+)\!\$?[A-Za-z]+\$?\d+/g))&&i.length>0)for(var n=0;n<i.length;n++)(s=i[n]).substring(0,s.indexOf("!"))===e&&(o.value=o.value.replace(s,s.replace(e,t)))}}_updateFormulasWithNameUpdating(e,t,o=!1){let i,s,l,n,r,a,h,d,_,u,c,g=this.selection.clone(),w=!1;c=o?/\[/:/\w/;this.selectedSheet._storeRowSettings();this.beginUpdate();for(i=0;i<this.sheets.length;i++){r=(n=this.sheets[i]).grid;for(s=0;s<r.rows.length;s++)for(l=0;l<r.columns.length;l++)if(_isFormula(a=r.getCellData(s,l,!1))){w=!1;h=a.indexOf(e);u=new RegExp(e,"g");for(;h>-1;){d="";_="";h>0&&(d=a[h-1]);h+e.length<a.length&&(_=a[h+e.length]);if(!/\w/.test(d)&&(o&&c.test(_)||!o&&!c.test(_))){a=a.replace(u,(o,i)=>i===h?t:e);w=!0}h=a.indexOf(e,h+e.length)}w&&r.setCellData(s,l,a,!1)}}this.selection=g;this.endUpdate()}_getDefinedNameIndexByName(e){for(var t=0;t<this.definedNames.length;t++)if(this.definedNames[t].name===e)return t;return-1}_updateTablesForUpdatingRow(e,t,o){var i,s,l,n,r;if(this.selectedSheet.tables.length>0)for(i=this.selectedSheet.tables.length-1;i>=0;i--){l=(s=this.selectedSheet.tables[i]).getRange();if(o){if((n=e+t-1)<l.topRow)s._updateTableRange(-t,-t,0,0);else if(n>=l.topRow&&n<=l.bottomRow){if(e<=l.topRow&&n===l.bottomRow){null==r&&(r=[]);r.push(s);this.selectedSheet.tables.remove(s);continue}if(e<l.topRow){s.showHeaderRow&&(s._showHeaderRow=!1);s._updateTableRange(e-l.topRow,-t,0,0)}else{e===l.topRow&&s.showHeaderRow&&(s._showHeaderRow=!1);n===l.bottomRow&&s.showTotalRow&&(s._showTotalRow=!1);s._updateTableRange(0,-t,0,0)}}else if(e<=l.topRow){null==r&&(r=[]);r.push(s);this.selectedSheet.tables.remove(s)}else if(e<=l.bottomRow){s.showTotalRow&&(s._showTotalRow=!1);s._updateTableRange(0,e-l.bottomRow-1,0,0)}}else e<=l.topRow?s._updateTableRange(t,t,0,0):e>l.topRow&&e<=l.bottomRow&&s._updateTableRange(0,t,0,0)}return r}_updateTablesForUpdatingColumn(e,t,o){var i,s,l,n,r,a,h,d;if(this.selectedSheet.tables.length>0)for(i=this.selectedSheet.tables.length-1;i>=0;i--){l=(s=this.selectedSheet.tables[i]).getRange();if(o){if((n=e+t-1)<l.leftCol)s._updateTableRange(0,0,-t,-t);else if(n>=l.leftCol&&n<=l.rightCol){if(e<=l.leftCol&&n===l.rightCol){null==d&&(d=[]);d.push(s);this.selectedSheet.tables.remove(s);continue}if(e<l.leftCol){r=t-l.leftCol+e;a=l.leftCol;s._updateTableRange(0,0,e-l.leftCol,-t)}else{r=t;a=e;s._updateTableRange(0,0,0,-r)}s._columns.splice(a-l.leftCol,r)}else if(e<=l.leftCol){null==d&&(d=[]);d.push(s);this.selectedSheet.tables.remove(s)}else if(e<=l.rightCol){r=l.rightCol-e+1;s._updateTableRange(0,0,0,-r);s._columns.splice(e,r)}}else if(e<=l.leftCol)s._updateTableRange(0,0,t,t);else if(e>l.leftCol&&e<=l.rightCol){s._updateTableRange(0,0,0,t);a=e-l.leftCol;for(h=0;h<t;h++)s._addColumn(a+h)}}return d}_updateDivContainerHeight(e){let t=this._divContainer.parentElement.clientHeight;e&&(t-=this._tabHolder.getSheetBlanketSize());this._divContainer.style.height=t+"px"}_isDisableDeleteRow(e,t){var o,i,s;if(this.selectedSheet.tables.length>0)for(o=0;o<this.selectedSheet.tables.length;o++){s=(i=this.selectedSheet.tables[o]).getRange();if(i.showHeaderRow&&s.topRow>=e&&s.topRow<=t)return!0}return!1}_copy(e,t){var o,i;if("columns"==e){super._copy(e,t);if(this.itemsSource&&(o=this.rows[0])instanceof HeaderRow){o._ubv=null;o._ubv={};for(var s=0;s<this.columns.length;s++){i=this.columns[s];o._ubv[i._hash]=FlexSheet._getHeaderRowText(i)}}return!0}return!1}_getTableSheetIndex(e,t){this.sheets;for(let o=0;o<e.length;o++)if(e[o].indexOf(t)>-1)return o;return-1}_sheetSortConverter(e,t,o,i){_isFormula(o=super._sortConverter(e,t,o,i))&&(o=this.evaluate(o));return o}_formatEvaluatedResult(e,t,o){if(wijmo_1.isPrimitive(e)){t.dataMap&&(e=t.dataMap.getDisplayValue(e));let i=o||t.format;if(!wijmo_1.isInt(e)||i||t.dataMap){if((o&&"@"!==o||t.format&&"@"!==t.format)&&wijmo_1.isString(e)&&!wijmo_1.isNullOrWhiteSpace(e)){let t=+e;isNaN(t)||(e=t)}e=null!=e?wijmo_1.Globalize.format(e,i):""}else e=e.toString()}else if(e){if(e instanceof FormulaError)return e.error;let i=o||e.format||t.format;if(!wijmo_1.isInt(e.value)||i||t.dataMap){if(wijmo_1.isString(e.value)){let t=+e.value;isNaN(t)||(e.value=t)}e=null!=e.value?wijmo_1.Globalize.format(e.value,i):""}else e=e.value.toString()}return e}_updateCellRef(e,t,o,i,s,l,n){let r;try{r=this._calcEngine._parse(e)}catch(e){return null}return r._updateCellRangeExp(t,o,i,s,l,n)?"="+r._getStringExpression():null}_updateCellBoundary(e,t,o){let i;try{i=this._calcEngine._parse(e)}catch(e){return null}return i instanceof _FunctionExpression&&i._updateCellBoundary(t,o)?"="+i._getStringExpression():null}_fillData(e=AutoFillOperation.CopyFormat|AutoFillOperation.FillSeries){let t=this._fillingRange||this.selection,o=this._fillingSource,i=0!=(e&AutoFillOperation.CopyFormat),s=0!=(e&AutoFillOperation.CopyContent),l=0!=(e&AutoFillOperation.FillSeries),n=o.leftCol===t.leftCol&&o.rightCol===t.rightCol,r=[],a=new AutoFillingEventArgs(t,e);this.onAutoFilling(a);if(a.cancel)return!1;this.beginUpdate();this._resetCellsForFillRange(e);for(let a=0;a<t.rowSpan;a++){let h=t.topRow+a,d=h-o.topRow,_=d%o.rowSpan;_<0&&(_+=o.rowSpan);for(let u=0;u<t.columnSpan;u++){let c=t.leftCol+u,g=c-o.leftCol;if(d>=0&&d<o.rowSpan&&g>=0&&g<o.columnSpan)continue;let w=g%o.columnSpan;w<0&&(w+=o.columnSpan);let m,f=!1,p=this.getMergedRange(this.cells,o.topRow+_,o.leftCol+w);if(p&&(f=p.topRow===o.topRow+_&&p.leftCol===o.leftCol+w)){this.getMergedRange(this.cells,h,c)||this.mergeRange(new wijmo_grid_1.CellRange(h,c,h+p.rowSpan-1,c+p.columnSpan-1))}if(i){let e=this.selectedSheet.getCellStyle(o.topRow+_,o.leftCol+w),t=e?this._cloneObject(e):null,i=h*this.columns.length+c;this.selectedSheet._styledCells[i]=t}if((!p||f)&&(!this.isReadOnly&&!this.rows[h].isReadOnly&&!this.columns[c].isReadOnly))if(s)_isFormula(m=this.getCellData(o.topRow+_,o.leftCol+w,!1))?this._fillFormula(m,o.topRow+_,o.leftCol+w,h,c):this.setCellData(h,c,m);else if(l){let t,i;if(n){t=u;i=_}else{t=a;i=w}if(null==(m=this.getCellData(o.topRow+_,o.leftCol+w,!1))||wijmo_1.isString(m)){_isFormula(m)?this._fillFormula(m,o.topRow+_,o.leftCol+w,h,c):this.setCellData(h,c,m);r[t]=null}else{r[t]||(r[t]=this._getFillSeries(n,t,i));let s=r[t];if(s){if(n){m=this._getFillData(_,d,o,n,s,null!=e||0===t);s.endIndex===o.topRow+_&&(r[t]=null)}else{m=this._getFillData(w,g,o,n,s,null!=e||0===t);s.endIndex===o.leftCol+w&&(r[t]=null)}this.setCellData(h,c,m)}}}}}this._fillingRange&&this.select(this._fillingRange,!1);this.endUpdate();this.onAutoFilled(a);return!0}_getFillData(e,t,o,i,s,l){let n,r,a=s.items;if(1===a.length&&!l)return a[0];n=i?Math.floor(t/o.rowSpan)*s.itemIndexes[s.itemIndexes.length-1]+o.topRow+e-s.startIndex+1:Math.floor(t/o.columnSpan)*s.itemIndexes[s.itemIndexes.length-1]+o.leftCol+e-s.startIndex+1;r=this._getLinearBestFitTrendData(a,s.itemIndexes,n);"date"===s.type&&(r=FlexSheet._fromOADate(r));return r}_fillFormula(e,t,o,i,s){let l,n,r;try{l=this._calcEngine._parse(e);n=new wijmo_grid_1.CellRange(t,o);r=new wijmo_grid_1.CellRange(i,s);l._moveCellRangeExp(this.selectedSheetIndex,n,r,!1,!0)&&(e="="+l._getStringExpression())}catch(e){}finally{this.setCellData(i,s,e)}}_getFillSeries(e,t,o){let i,s,l,n,r,a,h,d,_=this._fillingSource,u=[],c=[];if(e){o=_.topRow+o;n=0;for(r=_.topRow;r<=_.bottomRow;r++){if(a=this.getMergedRange(this.cells,r,_.leftCol+t))if(h&&!a.equals(h)){n+=h.rowSpan;h=a;if(a.leftCol!==_.leftCol+t)continue}else{if(a.topRow!==r||a.leftCol!==_.leftCol+t)continue;n+=1;h=a}else if(h){n+=h.rowSpan;h=null}else n+=1;if(null!=(d=this.getCellData(r,_.leftCol+t,!1))&&""!==d)if(wijmo_1.isNumber(d)||wijmo_1.isDate(d)){i=wijmo_1.isNumber(d)?"number":"date";wijmo_1.isDate(d)&&(d=FlexSheet._toOADate(d));if(0===u.length){l=r;s=i;u.push(d);c.push(n)}else if(i===s){u.push(d);c.push(n)}else{if(o>=l&&o<=r)return{type:s,startIndex:l,endIndex:r-1,items:u,itemIndexes:c};u.splice(0,u.length);c.splice(0,c.length)}}else if(u.length>0){if(o>=l&&o<=r)return{type:s,startIndex:l,endIndex:r-1,items:u,itemIndexes:c};u.splice(0,u.length);c.splice(0,c.length)}}}else{o=_.leftCol+o;n=0;for(r=_.leftCol;r<=_.rightCol;r++){if(a=this.getMergedRange(this.cells,_.topRow+t,r))if(h&&!a.equals(h)){n+=h.columnSpan;h=a;if(a.topRow!==_.topRow+t)continue}else{if(a.leftCol!==r||a.topRow!==_.topRow+t)continue;n+=1;h=a}else if(h){n+=h.columnSpan;h=null}else n+=1;if(null!=(d=this.getCellData(_.topRow+t,r,!1))&&""!==d)if(wijmo_1.isNumber(d)||wijmo_1.isDate(d)){i=wijmo_1.isNumber(d)?"number":"date";wijmo_1.isDate(d)&&(d=FlexSheet._toOADate(d));if(0===u.length){l=r;s=i;u.push(d);c.push(n)}else if(i===s){u.push(d);c.push(n)}else{if(o>=l&&o<=r)return{type:s,startIndex:l,endIndex:r-1,items:u,itemIndexes:c};u.splice(0,u.length);c.splice(0,c.length)}}else if(u.length>0){if(o>=l&&o<=r)return{type:s,startIndex:l,endIndex:r-1,items:u,itemIndexes:c};u.splice(0,u.length);c.splice(0,c.length)}}}return u.length>0?{type:s,startIndex:l,endIndex:r-1,items:u,itemIndexes:c}:null}_getLinearBestFitTrendData(e,t,o){let i,s,l,n,r,a,h=0,d=0,_=0,u=0;if(1===(n=e.length))return e[0]+o-1;for(i=0;i<t.length;i++){h+=s=t[i];_+=s*s;d+=l=e[i];u+=s*l}return o*(r=(n*u-h*d)/(n*_-h*h))+(a=(d*_-h*u)/(n*_-h*h))}_getCellSettingsForFill(e,t){let o,i,s,l,n,r;e||(e=this._fillingSource);t||(t=this._fillingRange);n=[];for(o=t.topRow;o<=t.bottomRow;o++)for(i=t.leftCol;i<=t.rightCol;i++)if(!(o>=e.topRow&&o<=e.bottomRow&&i>=e.leftCol&&i<=e.rightCol)){s=this.getCellData(o,i,!1);l=this._cloneObject(this.selectedSheet.getCellStyle(o,i));(r=this.getMergedRange(this.cells,o,i))&&r.topRow===o&&r.leftCol===i||(r=null);n.push({row:o,col:i,value:s,style:l,mergedCell:r?r.clone():null})}return n}_resetCellsForFillRange(e){let t=0!=(e&AutoFillOperation.CopyFormat),o=0!=(e&AutoFillOperation.CopyContent),i=0!=(e&AutoFillOperation.FillSeries);if(this._orgCellSettings&&this._orgCellSettings.length>0)for(let e=0;e<this._orgCellSettings.length;e++){let s=this._orgCellSettings[e],l=s.row,n=s.col;if(!t){let e=l*this.columns.length+n;this.selectedSheet._styledCells[e]=s.style}o||i||this.setCellData(l,n,s.value)}}_canDoFillOperation(){let e,t,o,i,s,l,n,r,a,h,d,_,u,c,g,w=this._fillingSource,m=this._fillingRange,f=!1;for(e=w.topRow;e<=w.bottomRow;e++)for(t=w.leftCol;t<=w.rightCol;t++){h=this.getMergedRange(this.cells,e,t);if(d){if(!h||!d.equals(h)){f=!0;break}}else d=h}for(o=m.topRow;o<=m.bottomRow;o++){(i=(s=o-w.topRow)%w.rowSpan)<0&&(i+=w.rowSpan);i+=w.topRow;for(l=m.leftCol;l<=m.rightCol;l++){r=l-w.leftCol;if(!(s>=0&&s<w.rowSpan&&r>=0&&r<w.columnSpan)){(n=r%w.columnSpan)<0&&(n+=w.columnSpan);n+=w.leftCol;h=this.getMergedRange(this.cells,i,n);if(a=this.getMergedRange(this.cells,o,l)){if(f||!h)return!1;_=a?o-a.topRow:NaN;u=a?l-a.leftCol:NaN;c=h?i-h.topRow:NaN;g=h?n-h.leftCol:NaN;if(_!==c||u!==g)return!1}}}}return!0}_updateItemIndexForInsertingRow(e,t,o){let i,s;for(i=0;i<e.length;i++)(s=e[i])&&null!=s._itemIdx&&s._itemIdx>=t&&(s._itemIdx+=o)}_updateItemIndexForRemovingRow(e,t){let o,i;for(o=0;o<e.length;o++)(i=e[o])&&null!=i._itemIdx&&i._itemIdx>=t&&(i._itemIdx-=1)}_copyRowsToSelectedSheet(){var e,t=this;if(t.selectedSheet){t.selectedSheet.grid.rows.clear();for(e=0;e<t.rows.length;e++){let o=t.rows[e];t.selectedSheet.grid.rows.push(o);o._list=t.rows}setTimeout(()=>{t._setFlexSheetToDirty();t.invalidate()},10)}}_copyColumnsToSelectedSheet(){var e,t=this;if(t.selectedSheet){t.selectedSheet.grid.columns.clear();for(e=0;e<t.columns.length;e++){let o=t.columns[e];t.selectedSheet.grid.columns.push(o);o._list=t.columns}setTimeout(()=>{t._setFlexSheetToDirty();t.invalidate()},10)}}_getUniqueColumnName(){let e=1;for(;null!=this.columns.getColumn("col"+e);)e++;return"col"+e}_hideContextMenu(){this._contextMenu.hide();this._tabHolder.sheetControl._contextMenu.hide()}_parseFromWorkbookTable(e,t){var o,i,s,l,n,r,a,h,d,_,u,c=t===this.selectedSheet?this:t.grid;s=(i=e.range.split(":"))[0];l=i[1];n=mXlsx.Workbook.tableAddress(s);o=new wijmo_grid_1.CellRange(n.row,n.col);r=mXlsx.Workbook.tableAddress(l);o.row2=r.row;o.col2=r.col;if(o.bottomRow>=t.rowCount){u=o.bottomRow-t.rowCount+1;for(g=0;g<u;g++)c.rows.push(new wijmo_grid_1.Row)}if(o.rightCol>=t.columnCount){u=o.rightCol-t.columnCount+1;for(g=0;g<u;g++)c.columns.push(new wijmo_grid_1.Column)}if(e.columns&&e.columns.length>0){a=[];for(var g=0;g<e.columns.length;g++){h=e.columns[g];a[g]=new TableColumn(h.name,h.totalRowLabel,h.totalRowFunction,h.showFilterButton)}}null!=e.style&&(d=this._isBuiltInStyleName(e.style.name)?this.getBuiltInTableStyle(e.style.name):this._parseFromWorkbookTableStyle(e.style));_=new Table(e.name,o,d,a,{showHeaderRow:e.showHeaderRow,showTotalRow:e.showTotalRow,showBandedColumns:e.showBandedColumns,showBandedRows:e.showBandedRows,alterFirstColumn:e.alterFirstColumn,alterLastColumn:e.alterLastColumn});t.tables.push(_);return _}_parseFromWorkbookTableStyle(e){var t=new TableStyle(e.name);null!=e.firstBandedColumnStyle&&(t.firstBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedColumnStyle));null!=e.firstBandedRowStyle&&(t.firstBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedRowStyle));null!=e.firstColumnStyle&&(t.firstColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstColumnStyle));null!=e.firstHeaderCellStyle&&(t.firstHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.firstHeaderCellStyle));null!=e.firstTotalCellStyle&&(t.firstTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.firstTotalCellStyle));null!=e.headerRowStyle&&(t.headerRowStyle=this._parseFromWorkbookTableStyleElement(e.headerRowStyle));null!=e.lastColumnStyle&&(t.lastColumnStyle=this._parseFromWorkbookTableStyleElement(e.lastColumnStyle));null!=e.lastHeaderCellStyle&&(t.lastHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.lastHeaderCellStyle));null!=e.lastTotalCellStyle&&(t.lastTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.lastTotalCellStyle));null!=e.secondBandedColumnStyle&&(t.secondBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedColumnStyle));null!=e.secondBandedRowStyle&&(t.secondBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedRowStyle));null!=e.totalRowStyle&&(t.totalRowStyle=this._parseFromWorkbookTableStyleElement(e.totalRowStyle));null!=e.wholeTableStyle&&(t.wholeTableStyle=this._parseFromWorkbookTableStyleElement(e.wholeTableStyle));return t}_parseFromWorkbookTableStyleElement(e){var t;t={fontWeight:e.font&&e.font.bold?"bold":"none",fontStyle:e.font&&e.font.italic?"italic":"none",textDecoration:e.font&&e.font.underline?"underline":"none",fontFamily:e.font&&e.font.family?e.font.family:"",fontSize:e.font&&e.font.size?e.font.size+"px":"",color:e.font&&e.font.color?e.font.color:"",backgroundColor:e.fill&&e.fill.color?e.fill.color:""};if(e.borders){if(e.borders.left){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.left.style,"Left",t);t.borderLeftColor=e.borders.left.color}if(e.borders.right){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.right.style,"Right",t);t.borderRightColor=e.borders.right.color}if(e.borders.top){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.top.style,"Top",t);t.borderTopColor=e.borders.top.color}if(e.borders.bottom){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.bottom.style,"Bottom",t);t.borderBottomColor=e.borders.bottom.color}if(e.borders.vertical){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.vertical.style,"Vertical",t);t.borderVerticalColor=e.borders.vertical.color}if(e.borders.horizontal){wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseBorderStyle(e.borders.horizontal.style,"Horizontal",t);t.borderHorizontalColor=e.borders.horizontal.color}}null!=e.size&&(t.size=e.size);return t}_parseToWorkbookTable(e){var t,o,i=new mXlsx.WorkbookTable,s=e.getRange(),l=e.getColumns();i.name=e.name;t=mXlsx.Workbook.xlsxAddress(s.topRow,s.leftCol);o=mXlsx.Workbook.xlsxAddress(s.bottomRow,s.rightCol);i.range=t+":"+o;if(null!=e.style)if(e.style.isBuiltIn){i.style=new mXlsx.WorkbookTableStyle;i.style.name=e.style.name}else i.style=this._parseToWorkbookTableStyle(e.style);i.showBandedColumns=e.showBandedColumns;i.showBandedRows=e.showBandedRows;i.showHeaderRow=e.showHeaderRow;i.showTotalRow=e.showTotalRow;i.alterFirstColumn=e.alterFirstColumn;i.alterLastColumn=e.alterLastColumn;for(var n=0;n<l.length;n++){var r=l[n],a=new mXlsx.WorkbookTableColumn;a.name=r.name;a.totalRowLabel=r.totalRowLabel;a.totalRowFunction=r.totalRowFunction;a.showFilterButton=r.showFilterButton;i.columns.push(a)}return i}_parseToWorkbookTableStyle(e){var t=new mXlsx.WorkbookTableStyle;t.name=e.name;null!=e.firstBandedColumnStyle&&(t.firstBandedColumnStyle=this._parseToWorkbookTableStyleElement(e.firstBandedColumnStyle,!0));null!=e.firstBandedRowStyle&&(t.firstBandedRowStyle=this._parseToWorkbookTableStyleElement(e.firstBandedRowStyle,!0));null!=e.firstColumnStyle&&(t.firstColumnStyle=this._parseToWorkbookTableStyleElement(e.firstColumnStyle));null!=e.firstHeaderCellStyle&&(t.firstHeaderCellStyle=this._parseToWorkbookTableStyleElement(e.firstHeaderCellStyle));null!=e.firstTotalCellStyle&&(t.firstTotalCellStyle=this._parseToWorkbookTableStyleElement(e.firstTotalCellStyle));null!=e.headerRowStyle&&(t.headerRowStyle=this._parseToWorkbookTableStyleElement(e.headerRowStyle));null!=e.lastColumnStyle&&(t.lastColumnStyle=this._parseToWorkbookTableStyleElement(e.lastColumnStyle));null!=e.lastHeaderCellStyle&&(t.lastHeaderCellStyle=this._parseToWorkbookTableStyleElement(e.lastHeaderCellStyle));null!=e.lastTotalCellStyle&&(t.lastTotalCellStyle=this._parseToWorkbookTableStyleElement(e.lastTotalCellStyle));null!=e.secondBandedColumnStyle&&(t.secondBandedColumnStyle=this._parseToWorkbookTableStyleElement(e.secondBandedColumnStyle,!0));null!=e.secondBandedRowStyle&&(t.secondBandedRowStyle=this._parseToWorkbookTableStyleElement(e.secondBandedRowStyle,!0));null!=e.totalRowStyle&&(t.totalRowStyle=this._parseToWorkbookTableStyleElement(e.totalRowStyle));null!=e.wholeTableStyle&&(t.wholeTableStyle=this._parseToWorkbookTableStyleElement(e.wholeTableStyle));return t}_parseToWorkbookTableStyleElement(e,t=!1){var o,i=wijmo_grid_xlsx_1.FlexGridXlsxConverter._parseCellStyle(e,!0);t?(o=new mXlsx.WorkbookTableBandedStyle).size=e.size:o=new mXlsx.WorkbookTableCommonStyle;o._deserialize(i);return o}_isBuiltInStyleName(e){var t;if(0===e.search(/TableStyleLight/i)){t=+e.substring(15);if(!isNaN(t)&&t>=1&&t<=21)return!0}else if(0===e.search(/TableStyleMedium/i)){t=+e.substring(16);if(!isNaN(t)&&t>=1&&t<=28)return!0}else if(0===e.search(/TableStyleDark/i)){t=+e.substring(14);if(!isNaN(t)&&t>=1&&t<=11)return!0}return!1}_getTable(e){for(var t,o,i,s=0;s<this.sheets.length;s++){o=this.sheets[s].tables;for(i=0;i<o.length;i++)if((t=o[i]).name.toLowerCase()===e.toLowerCase())return t}return null}_checkTableHeaderRow(e,t){let o,i,s,l,n;for(i=0;i<e.length;i++)if((o=e[i]).showHeaderRow){s=(n=o.getRange(TableSection.Header)).row;for(l=n.leftCol;l<=n.rightCol;l++)t.sheets[0].rows[s].cells[l].isDate=!1}}_getThemeColor(e,t){var o,i=this._colorThemes[e];if(null!=t){(o=new wijmo_1.Color("#"+i).getHsl())[2]=t<0?o[2]*(1+t):o[2]*(1-t)+(1-1*(1-t));return wijmo_1.Color.fromHsl(o[0],o[1],o[2]).toString()}return"#"+i}_createBuiltInTableStyle(e){var t;if(0===e.search(/TableStyleLight/i)){t=+e.substring(15);if(!isNaN(t)&&t>=1&&t<=21)return t<=7?this._generateTableLightStyle1(t-1,e,!0):t<=14?this._generateTableLightStyle2(t-8,e):this._generateTableLightStyle1(t-15,e,!1)}else if(0===e.search(/TableStyleMedium/i)){t=+e.substring(16);if(!isNaN(t)&&t>=1&&t<=28)return t<=7?this._generateTableMediumStyle1(t-1,e):t<=14?this._generateTableMediumStyle2(t-8,e):t<=21?this._generateTableMediumStyle3(t-15,e):this._generateTableMediumStyle4(t-22,e)}else if(0===e.search(/TableStyleDark/i)){t=+e.substring(14);if(!isNaN(t)&&t>=1&&t<=11)return t<=7?this._generateTableDarkStyle1(t-1,e):this._generateTableDarkStyle2(t-8,e)}return null}_generateTableLightStyle1(e,t,o){var i=new TableStyle(t,!0),s=0===e?1:e+3,l=o?"1px":"2px",n=o?"solid":"double",r=o?"1px":"3px";i.wholeTableStyle={borderTopColor:this._getThemeColor(s),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(s),borderBottomStyle:"solid",borderBottomWidth:"1px"};i.firstColumnStyle={fontWeight:"bold"};i.lastColumnStyle={fontWeight:"bold"};i.headerRowStyle={borderBottomColor:this._getThemeColor(s),borderBottomStyle:"solid",borderBottomWidth:l,fontWeight:"bold"};i.totalRowStyle={borderTopColor:this._getThemeColor(s),borderTopStyle:n,borderTopWidth:r,fontWeight:"bold"};if(0===e){i.wholeTableStyle.color=this._getThemeColor(s);i.firstColumnStyle.color=this._getThemeColor(s);i.lastColumnStyle.color=this._getThemeColor(s);i.headerRowStyle.color=this._getThemeColor(s);i.totalRowStyle.color=this._getThemeColor(s);i.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)};i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}}else{if(o){i.wholeTableStyle.color=this._getThemeColor(s,-.25);i.firstColumnStyle.color=this._getThemeColor(s,-.25);i.lastColumnStyle.color=this._getThemeColor(s,-.25);i.headerRowStyle.color=this._getThemeColor(s,-.25);i.totalRowStyle.color=this._getThemeColor(s,-.25)}else{i.wholeTableStyle.color=this._getThemeColor(1);i.firstColumnStyle.color=this._getThemeColor(1);i.lastColumnStyle.color=this._getThemeColor(1);i.headerRowStyle.color=this._getThemeColor(1);i.totalRowStyle.color=this._getThemeColor(1)}i.firstBandedRowStyle={backgroundColor:this._getThemeColor(s,.8)};i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(s,.8)}}if(!o){i.wholeTableStyle.borderLeftColor=this._getThemeColor(s);i.wholeTableStyle.borderLeftStyle="solid";i.wholeTableStyle.borderLeftWidth="1px";i.wholeTableStyle.borderRightColor=this._getThemeColor(s);i.wholeTableStyle.borderRightStyle="solid";i.wholeTableStyle.borderRightWidth="1px";i.wholeTableStyle.borderHorizontalColor=this._getThemeColor(s);i.wholeTableStyle.borderHorizontalStyle="solid";i.wholeTableStyle.borderHorizontalWidth="1px";i.wholeTableStyle.borderVerticalColor=this._getThemeColor(s);i.wholeTableStyle.borderVerticalStyle="solid";i.wholeTableStyle.borderVerticalWidth="1px"}return i}_generateTableLightStyle2(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3;o.wholeTableStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(i),borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightColor:this._getThemeColor(i),borderRightStyle:"solid",borderRightWidth:"1px",color:this._getThemeColor(1)};o.firstBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"};o.secondBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"};o.firstBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"};o.secondBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"};o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};o.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return o}_generateTableMediumStyle1(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3;o.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)};if(0===e){o.wholeTableStyle.borderTopColor=this._getThemeColor(i);o.wholeTableStyle.borderBottomColor=this._getThemeColor(i);o.wholeTableStyle.borderLeftColor=this._getThemeColor(i);o.wholeTableStyle.borderRightColor=this._getThemeColor(i);o.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}}else{o.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.8)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.8)}}o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};o.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return o}_generateTableMediumStyle2(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3;o.wholeTableStyle={borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderVerticalColor:this._getThemeColor(0),borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",borderHorizontalColor:this._getThemeColor(0),color:this._getThemeColor(1)};if(0===e){o.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}}else{o.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}}o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};o.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};o.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};return o}_generateTableMediumStyle3(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3;o.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"2px",borderTopColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",borderBottomColor:this._getThemeColor(1),color:this._getThemeColor(1)};if(0===e){o.wholeTableStyle.borderLeftColor=this._getThemeColor(1);o.wholeTableStyle.borderLeftStyle="solid";o.wholeTableStyle.borderLeftWidth="1px";o.wholeTableStyle.borderRightColor=this._getThemeColor(1);o.wholeTableStyle.borderRightStyle="solid";o.wholeTableStyle.borderRightWidth="1px";o.wholeTableStyle.borderVerticalColor=this._getThemeColor(1);o.wholeTableStyle.borderVerticalStyle="solid";o.wholeTableStyle.borderVerticalWidth="1px";o.wholeTableStyle.borderHorizontalColor=this._getThemeColor(1);o.wholeTableStyle.borderHorizontalStyle="solid";o.wholeTableStyle.borderHorizontalWidth="1px"}o.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)};o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)};o.headerRowStyle={borderBottomColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)};o.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px"};return o}_generateTableMediumStyle4(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3;o.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)};if(0===e){o.wholeTableStyle.borderTopColor=this._getThemeColor(i);o.wholeTableStyle.borderBottomColor=this._getThemeColor(i);o.wholeTableStyle.borderLeftColor=this._getThemeColor(i);o.wholeTableStyle.borderRightColor=this._getThemeColor(i);o.wholeTableStyle.borderVerticalColor=this._getThemeColor(i);o.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i);o.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}}else{o.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderVerticalColor=this._getThemeColor(i,.4);o.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4);o.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8);o.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}}o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.headerRowStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(1)};return o}_generateTableDarkStyle1(e,t){var o=new TableStyle(t,!0),i=0===e?1:e+3,s=0===e?.25:-.25;o.wholeTableStyle={color:this._getThemeColor(0)};o.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,s)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,s)};o.firstColumnStyle={borderRightColor:this._getThemeColor(0),borderRightStyle:"solid",borderRightWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,s)};o.lastColumnStyle={borderLeftColor:this._getThemeColor(0),borderLeftStyle:"solid",borderLeftWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,s)};o.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(1)};o.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0)};if(0===e){o.wholeTableStyle.backgroundColor=this._getThemeColor(i,.5);o.totalRowStyle.backgroundColor=this._getThemeColor(i,.15)}else{o.wholeTableStyle.backgroundColor=this._getThemeColor(i);o.totalRowStyle.backgroundColor=this._getThemeColor(i,-.5)}return o}_generateTableDarkStyle2(e,t){var o=new TableStyle(t,!0),i=0===e?0:2*e+2,s=0===e?1:2*e+3,l=0===e?-.15:.8;o.wholeTableStyle={backgroundColor:this._getThemeColor(i,l)};o.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,l-.2)};o.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,l-.2)};o.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)};o.headerRowStyle={color:this._getThemeColor(0),backgroundColor:this._getThemeColor(s)};o.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)};return o}static _getHeaderRowText(e){let t=e.binding,o=e._hdr;null!=o&&""!=o.trim()||(o=wijmo_1.toHeaderCase(t||""));return o}static _toOADate(e){let t,o=new Date(1900,0,0),i=Date.UTC(1900,0,0),s=o.getTime()-i-6e4*o.getTimezoneOffset(),l=6e4*(e.getTimezoneOffset()-o.getTimezoneOffset());t=(e.getTime()-o.getTime()-(0!==l?l-s:0))/864e5;return t+=t>59?1:0}static _fromOADate(e){let t,o,i,s=new Date(1900,0,0),l=Date.UTC(1900,0,0),n=s.getTime()-l-6e4*s.getTimezoneOffset();o=e>59?1:0;return 0!==(t=6e4*((i=new Date(s.getTime()+864e5*(e-o))).getTimezoneOffset()-s.getTimezoneOffset()))?new Date(s.getTime()+t-n+864e5*(e-o)):i}}FlexSheet.controlTemplate='<div style="width:100%;height:100%"><div wj-part="container" style="width:100%">'+wijmo_grid_1.FlexGrid.controlTemplate+'</div><div wj-part="tab-holder" class="wj-tabholder" style="width:100%; min-width:100px"></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>';exports.FlexSheet=FlexSheet;class DraggingRowColumnEventArgs extends wijmo_1.EventArgs{constructor(e,t,o){super();this._draggingRange=e;this._isDraggingRows=t;this._isShiftKey=o}get draggingRange(){return this._draggingRange}get isDraggingRows(){return this._isDraggingRows}get isShiftKey(){return this._isShiftKey}}exports.DraggingRowColumnEventArgs=DraggingRowColumnEventArgs;class DroppingRowColumnEventArgs extends wijmo_1.CancelEventArgs{constructor(e,t){super();this._droppingRange=e;this._isDroppingRows=t}get droppingRange(){return this._droppingRange}get isDroppingRows(){return this._isDroppingRows}}exports.DroppingRowColumnEventArgs=DroppingRowColumnEventArgs;class UnknownFunctionEventArgs extends wijmo_1.EventArgs{constructor(e,t){super();this._funcName=e;this._params=t}get funcName(){return this._funcName}get params(){return this._params}}exports.UnknownFunctionEventArgs=UnknownFunctionEventArgs;class RowColumnChangedEventArgs extends wijmo_1.EventArgs{constructor(e,t,o,i){super();if(wijmo_1.isArray(e)){this._ranges=e;this._added=t;if(1===e.length){let t=e[0];if(o){this._index=t.leftCol;this._count=t.columnSpan}else{this._index=t.topRow;this._count=t.rowSpan}}else{this._index=-1;this._count=-1}}else{this._index=e;this._count=t;this._added=o;this._ranges=i?[new wijmo_grid_1.CellRange(-1,this._index,-1,this._index+this._count-1)]:[new wijmo_grid_1.CellRange(this._index,-1,this._index+this._count-1,-1)]}}get ranges(){return this._ranges}get index(){return this._index}get count(){return this._count}get added(){return this._added}get isAdd(){wijmo_1._deprecated("RowColumnChangedEventArgs.isAdd","RowColumnChangedEventArgs.added");return this._added}}exports.RowColumnChangedEventArgs=RowColumnChangedEventArgs;class AutoFillingEventArgs extends wijmo_1.CancelEventArgs{constructor(e,t){super();this._range=e;this._op=t}get range(){return this._range}get operation(){return this._op}}exports.AutoFillingEventArgs=AutoFillingEventArgs;class AutoFilledEventArgs extends wijmo_1.EventArgs{constructor(e,t){super();this._range=e;this._op=t}get range(){return this._range}get operation(){return this._op}}exports.AutoFilledEventArgs=AutoFilledEventArgs;class FlexSheetPanel extends wijmo_grid_1.GridPanel{constructor(e,t,o,i,s){super(e,t,o,i,s)}getSelectedState(e,t,o){if(!this.grid)return;let i=this.grid.selectedSheet,s=i?i.selectionRanges:null,l=s?s.length:0,n=super.getSelectedState(e,t,o);if(n===wijmo_grid_1.SelectedState.None&&l>0){let o=this.grid.getMergedRange(this,e,t),i=this.columns.length-1,n=this.rows.length-1;for(let r=0;r<s.length;r++){let a=s[r];if(a&&a instanceof wijmo_grid_1.CellRange){if(this.cellType===wijmo_grid_1.CellType.Cell){if(o){if(o.contains(a.row,a.col))return r!==l-1||this.grid._isClicking?wijmo_grid_1.SelectedState.Selected:this.grid.showMarquee?wijmo_grid_1.SelectedState.None:wijmo_grid_1.SelectedState.Cursor;if(o.intersects(a))return wijmo_grid_1.SelectedState.Selected}if(a.row===e&&a.col===t)return r!==l-1||this.grid._isClicking?wijmo_grid_1.SelectedState.Selected:this.grid.showMarquee?wijmo_grid_1.SelectedState.None:wijmo_grid_1.SelectedState.Cursor;if(a.contains(e,t))return wijmo_grid_1.SelectedState.Selected}if(this.cellType===wijmo_grid_1.CellType.RowHeader&&this.grid.showSelectedHeaders&wijmo_grid_1.HeadersVisibility.Row&&t===i&&a.containsRow(e))return wijmo_grid_1.SelectedState.Selected;if(this.cellType===wijmo_grid_1.CellType.ColumnHeader&&this.grid.showSelectedHeaders&wijmo_grid_1.HeadersVisibility.Column&&e===n&&a.containsColumn(t))return wijmo_grid_1.SelectedState.Selected}}}return n}getCellData(e,t,o){if(wijmo_1.isString(t)&&(t=this.columns.indexOf(t))<0)throw"Invalid column name or binding.";if(e>=this.rows.length||wijmo_1.asNumber(t,!1,!0)>=this.columns.length)return null;if(this.cellType===wijmo_grid_1.CellType.RowHeader)return e+1+"";let i=this.columns[wijmo_1.asNumber(t,!1,!0)],s=this.grid?this.grid._getBindingColumn(this,e,i):i,l=this.grid;if(this.cellType===wijmo_grid_1.CellType.ColumnHeader){let n=this.rows[e];if(n&&n._ubv&&null!=n._ubv[i._hash])return super.getCellData(e,t,o);let r=l&&l.selectedSheet;if(r&&r.itemsSource||l&&l.itemsSource){let e=s._hdr;return r&&r._showDefaultHeader||null==e||e===s.binding||e===wijmo_1.toHeaderCase(s.binding)?FlexSheet.convertNumberToAlpha(t):e}return r&&r._showDefaultHeader||null==s.header?FlexSheet.convertNumberToAlpha(t):s.header}{let i,n=!1;if(o&&(!s||!s.dataMap)){let o=super.getCellData(e,t,!1),r=this.grid.editRange;if(wijmo_1.isDate(o)&&(!r||!r.contains(e,t))||wijmo_1.isNumber(o)){let r=l&&l._getCellStyle(e,t),a=r?r.format:"";""===a&&(a=s?s.format:"");n=!0;i=wijmo_1.Globalize.format(o,a)}}n||(i=super.getCellData(e,t,o));return i}}setCellData(e,t,o,i=!0,s=!0){if(e>=this.rows.length||t>=this.columns.length)return!1;let l,n=this.grid._isPasting,r=this.columns[t],a=this.grid?this.grid._getBindingColumn(this,e,r):r,h=this.rows[e];if(o instanceof _ValWithFormat){l=o.format;o=o.value}if(this.grid&&this.grid.selectedSheet){let i=this.grid.selectedSheet.findTable(e,t);if(i&&i.showHeaderRow){let l=i.getRange(TableSection.Header);if(e===l.row&&t>=l.leftCol&&t<=l.rightCol){if(null==o||wijmo_1.isString(o)&&wijmo_1.isNullOrWhiteSpace(o)&&!a.dataMap)return;if(!(h instanceof HeaderRow))return super.setCellData(e,t,o.toString(),!1,s);h._ubv[a._hash]=o.toString()}}}if((i||n)&&o&&wijmo_1.isString(o)&&"'"!==o[0]&&"="!==o[0]){if(this.getCellData(e,t,!0)===o)return!1;let s=(this.grid?this.grid._getCellStyle(e,t):null)||{},n=l||s.format||a.format,r=null;n&&/[yYMhsmt\:-]/.test(n)&&(r=wijmo_1.Globalize.parseDate(o,n));null==r&&(r=wijmo_1.Globalize.parseDate(o,""));if(r)o=r;else{let s=!1,l=!1;if(a.dataType===wijmo_1.DataType.String||wijmo_1.isNullOrWhiteSpace(o)||!(l="%"===o[o.length-1])&&!(s=o.indexOf(wijmo_1.culture.Globalize.numberFormat.currency.symbol)>=0)&&/[^-\d,\.]/.test(o))a.dataType===wijmo_1.DataType.Boolean&&(o=wijmo_1.changeType(o,wijmo_1.DataType.Boolean,null));else{let r=wijmo_1.changeType(o,wijmo_1.DataType.Number,"");if(wijmo_1.isNumber(r)){o=r;n||(s?this.grid.applyCellsStyle({format:"C"+(wijmo_1.isInt(o)?"0":"")},[new wijmo_grid_1.CellRange(e,t)]):l&&this.grid.applyCellsStyle({format:"P"+(wijmo_1.isInt(100*o)?"0":"")},[new wijmo_grid_1.CellRange(e,t)]))}else i=!1}}}(_isFormula(o)||wijmo_1.isString(o)&&"'"===o[0]||!a.dataType)&&(i=!1);if(!(h instanceof HeaderRow))return super.setCellData(e,t,o,i&&!n,s);h._ubv[a._hash]=o}_renderCell(e,t,o,i,s,l){var n,r,a,h,d=t*this.grid.columns.length+o,_=this.grid.getMergedRange(this,t,o);h=super._renderCell(e,t,o,i,s,l);if(this.cellType!==wijmo_grid_1.CellType.Cell)return h;if(_&&d>_.topRow*this.grid.columns.length+_.leftCol)return h;if(this.columns[o].renderSize<=0&&(!_||_.getRenderSize(this).width<=0))return h;if(n=e.childNodes[l]){null!=this.grid.editRange&&this.grid.editRange.contains(t,o)||this.grid.selectedSheet&&(a=this.grid.selectedSheet.findTable(t,o))&&a._updateCell(t,o,n);if(wijmo_1.hasClass(n,"wj-state-selected")||wijmo_1.hasClass(n,"wj-state-multi-selected")){n.style.backgroundColor="";n.style.color=""}else if(this.grid.selectedSheet&&(r=this.grid.selectedSheet._styledCells[d])){""!==r.backgroundColor&&(n.style.backgroundColor=r.backgroundColor);""!==r.color&&(n.style.color=r.color)}}return h}}exports.FlexSheetPanel=FlexSheetPanel;class HeaderRow extends wijmo_grid_1.Row{constructor(){super();this.isReadOnly=!0}}exports.HeaderRow=HeaderRow;class DefinedName{constructor(e,t,o,i){this._owner=e;this._name=t;this._value=o;if(null!=i){if(!e._validateSheetName(i))throw"The sheet name:("+i+") does not exist in FlexSheet.";this._sheetName=i}}get name(){return this._name}set name(e){var t;if(this._name!==e){if(this._owner._checkExistDefinedName(name,this._sheetName))throw"The "+name+" already existed in definedNames.";t=this._name;this._name=e;this._owner._updateFormulasWithNameUpdating(t,this._name)}}get value(){return this._value}set value(e){this._value!==e&&(this._value=e)}get sheetName(){return this._sheetName}}exports.DefinedName=DefinedName;function _isFormula(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]}exports._isFormula=_isFormula;!function(e){e[e.CopyFormat=1]="CopyFormat";e[e.CopyContent=2]="CopyContent";e[e.FillSeries=4]="FillSeries"}(AutoFillOperation=exports.AutoFillOperation||(exports.AutoFillOperation={}));class _RangesHelper{static validateRowRanges(e,t){return this._validateCellRanges(e,t,"topRow","bottomRow","row2")}static validateColumnRanges(e,t){return this._validateCellRanges(e,t,"leftCol","rightCol","col2")}static _validateCellRanges(e,t,o,i,s){let l=(e=e.filter(e=>e&&e[o]>=0&&e[i]>=0&&e[o]<t&&e[i]<t)).length;if(l>1){let t=[];for(let n=(e=e.sort((e,t)=>t[o]>=e[o]&&t[i]<=e[i]?-1:e[o]-t[o]))[0].clone(),r=1;r<l;r++){let a=e[r];if(a[o]>=n[o]&&a[i]<=n[i]);else if(a[o]<=n[i]+1)n[s]=a[i];else{t.push(n);n=a.clone()}r===l-1&&t.push(n)}e=t}return e}}class _ValWithFormat{constructor(e,t){this.value=e;this.format=t}}class UndoStack{constructor(e){this.MAX_STACK_SIZE=500;this._stack=[];this._pointer=-1;this._resizingTriggered=!1;this.undoStackChanged=new wijmo_1.Event;let t=this;t._owner=e;t._owner.prepareCellForEdit.addHandler(t._initCellEditAction,t);t._owner.cellEditEnded.addHandler((e,o)=>{t._pendingAction&&(!o.data||46!==o.data.keyCode&&8!==o.data.keyCode)&&t._pendingAction instanceof _EditAction&&!t._pendingAction.isPaste&&t._afterProcessCellEditAction(t)},t);t._owner.pasting.addHandler(t._initCellEditActionForPasting,t);t._owner.pastingCell.addHandler((e,o)=>{t._pendingAction&&(t._pendingAction instanceof _EditAction?t._pendingAction.updateForPasting(o.range):t._pendingAction instanceof _CutAction&&t._pendingAction.updateForPasting(o.range))},t);t._owner.pasted.addHandler(()=>{if(t._pendingAction)if(t._pendingAction instanceof _EditAction&&t._pendingAction.isPaste)t._afterProcessCellEditAction(t);else if(t._pendingAction instanceof _CutAction){t._pendingAction.saveNewState();t._addAction(t._pendingAction);t._pendingAction=null}},t);t._owner.resizingColumn.addHandler((e,o)=>{if(0!==t.stackSize&&t._owner.selectedSheet&&!t._resizingTriggered){t._pendingAction=new _ColumnResizeAction(t._owner,o.panel,o.col);t._resizingTriggered=!0}},t);t._owner.resizedColumn.addHandler((e,o)=>{t._pendingAction instanceof _ColumnResizeAction&&t._pendingAction.saveNewState()&&t._addAction(t._pendingAction);t._pendingAction=null;t._resizingTriggered=!1},t);t._owner.resizingRow.addHandler((e,o)=>{if(0!==t.stackSize&&t._owner.selectedSheet&&!t._resizingTriggered){t._pendingAction=new _RowResizeAction(t._owner,o.panel,o.row);t._resizingTriggered=!0}},t);t._owner.resizedRow.addHandler((e,o)=>{t._pendingAction instanceof _RowResizeAction&&t._pendingAction.saveNewState()&&t._addAction(t._pendingAction);t._pendingAction=null;t._resizingTriggered=!1},t);t._owner.draggingRowColumn.addHandler((e,o)=>{0!==t.stackSize&&t._owner.selectedSheet&&o.isShiftKey&&(o.isDraggingRows?t._pendingAction=new _RowsChangedAction(t._owner):t._pendingAction=new _ColumnsChangedAction(t._owner))},t);t._owner.endDroppingRowColumn.addHandler((e,o)=>{!o.cancel&&t._pendingAction&&t._pendingAction.saveNewState()&&t._addAction(t._pendingAction);t._pendingAction=null},t)}get stackSize(){return null==this._stackSize?this.MAX_STACK_SIZE:this._stackSize}set stackSize(e){wijmo_1.isNumber(e)&&(e<0?this._stackSize=0:e>this.MAX_STACK_SIZE?this._stackSize=this.MAX_STACK_SIZE:this._stackSize=Math.floor(e))}get canUndo(){return this._pointer>-1&&this._pointer<this._stack.length}get canRedo(){return this._pointer+1>-1&&this._pointer+1<this._stack.length}onUndoStackChanged(e){this.undoStackChanged.raise(this,e)}undo(){let e;if(this.canUndo){e=this._stack[this._pointer];this._beforeUndoRedo(e);e.undo();this._pointer--;this.onUndoStackChanged()}}redo(){let e;if(this.canRedo){this._pointer++;e=this._stack[this._pointer];this._beforeUndoRedo(e);e.redo();this.onUndoStackChanged()}}clear(){this._stack.length=0}_addAction(e){this._stack.length>0&&this._stack.length>this._pointer+1&&this._stack.splice(this._pointer+1,this._stack.length-this._pointer-1);this._stack.length>=this.stackSize&&this._stack.splice(0,this._stack.length-this.stackSize+1);this._pointer=this._stack.length;this._stack.push(e);this.onUndoStackChanged()}_pop(){let e;if(this._pointer<0)return null;e=this._stack[this._pointer];this._pointer--;return e}_updateCurrentAction(e){let t;this._pointer<0||(t=this._stack[this._pointer])instanceof e&&t.saveNewState()}_initCellEditAction(e,t){0!==this.stackSize&&this._owner.selectedSheet&&(this._pendingAction=new _EditAction(this._owner,t.range))}_initCellEditActionForPasting(){if(0!==this.stackSize&&this._owner.selectedSheet)if(this._owner._isCutting)this._pendingAction=new _CutAction(this._owner);else{this._pendingAction=new _EditAction(this._owner);this._pendingAction.markIsPaste()}}_afterProcessCellEditAction(e){if(e._pendingAction){e._pendingAction instanceof _EditAction&&e._pendingAction.saveNewState()&&e._addAction(this._pendingAction);e._pendingAction=null}}_beforeUndoRedo(e){this._owner.selectedSheetIndex=e.sheetIndex}}exports.UndoStack=UndoStack;class FlexSheetValueFilterEditor extends wijmo_grid_filter_1.ValueFilterEditor{updateEditor(){var e=this.filter.column,t=e.grid,o=e.index,i=[],s={};if(this.filter.uniqueValues||null!=t.itemsSource&&null!=t.childItemsPath)super.updateEditor();else{for(var l=0;l<t.rows.length;l++){let e=this.filter.apply(l),n=this.filter.showValues;this.filter.showValues=null;let r=t.filter._filter(l);this.filter.showValues=n;let a=t.rows[l];if(a instanceof HeaderRow||a instanceof wijmo_grid_1.GroupRow||a instanceof wijmo_grid_1._NewRowTemplate||!a.visible&&(e||!r))continue;let h=l,d=o,_=t.getMergedRange(t.cells,h,d);if(_){if(_.leftCol!==o)continue;h=_.topRow;d=_.leftCol}let u,c=t.getCellValue(h,d);u=this.filter.dataMap?this.filter.dataMap.getDisplayValue(c):t.getCellValue(h,d,!0);c=""===c?null:c;let g,w=t.getCellData(h,d,!0);if(!s[u]){s[u]=!0;g=w&&"="===w[0]?l+"_"+o:"";i.push({value:c,text:u,cellRef:g})}}var n=this.filter.showValues;if(n&&0!=Object.keys(n).length){for(var r in n)for(l=0;l<i.length;l++)if(n[r]&&""!==i[l].cellRef&&i[l].cellRef===n[r].cellRef){n[i[l].text]={show:!0,cellRef:i[l].cellRef};i[l].show=!0;i[l].text!=r&&delete n[r]}else if(i[l].text==r){i[l].show=!0;break}}else for(var l=0;l<i.length;l++)i[l].show=!0;this._lbValues.isContentHtml=e.isContentHtml;this._cmbFilter.text=this.filter.filterText;this._filterText=this._cmbFilter.text.toLowerCase();this._view.pageSize=this.filter.maxValues;this._view.sourceCollection=i}}updateFilter(){var e=null,t=this._view.items;if(this._filterText||this._cbSelectAll.indeterminate){e={};for(var o=0;o<t.length;o++){var i=t[o];i.show&&(e[i.text]={show:!0,cellRef:i.cellRef})}}this._filter.showValues=e;this._filter.filterText=this._filterText}}exports.FlexSheetValueFilterEditor=FlexSheetValueFilterEditor;class FlexSheetConditionFilter extends wijmo_grid_filter_1.ConditionFilter{constructor(e){super(e)}apply(e){var t,o,i,s,l=this.column,n=l.grid,r=this.condition1,a=this.condition2;if(!(n instanceof FlexSheet))return!0;if(!this.isActive)return!0;if(n.rows[e]instanceof wijmo_grid_1._NewRowTemplate)return!0;""===(t=n.getCellValue(e,l.index))&&l.dataType!==wijmo_1.DataType.String&&(t=null);o=i=t;if(s=this.dataMap||l.dataMap)o=i=t=s.getDisplayValue(t);else if(wijmo_1.isDate(t))(wijmo_1.isString(r.value)||wijmo_1.isString(a.value))&&(o=i=t=n.getCellValue(e,l.index,!0));else if(wijmo_1.isNumber(t)){o=i=t=wijmo_1.Globalize.parseFloat(n.getCellValue(e,l.index,!0));if(0===t&&!l.dataType){r.isActive&&""===r.value&&(o=t.toString());a.isActive&&""===a.value&&(i=i.toString())}}else if(null==t){r.isActive&&wijmo_1.isNumber(r.value)&&(o=NaN);a.isActive&&wijmo_1.isNumber(a.value)&&(i=NaN)}var h=r.apply(o),d=a.apply(i);return r.isActive&&a.isActive?this.and?h&&d:h||d:r.isActive?h:!a.isActive||d}}exports.FlexSheetConditionFilter=FlexSheetConditionFilter;class FlexSheetValueFilter extends wijmo_grid_filter_1.ValueFilter{constructor(e){super(e)}apply(e){var t,o=this.column.grid;if(!(o instanceof FlexSheet))return!0;if(!this.showValues||!Object.keys(this.showValues).length)return!0;if(o.rows[e]instanceof wijmo_grid_1._NewRowTemplate)return!0;e=(t=this.dataMap||this.column.dataMap)?t.getDisplayValue(o.getCellValue(e,this.column.index)):o.getCellValue(e,this.column.index,!0);return null!=this.showValues[e]}}exports.FlexSheetValueFilter=FlexSheetValueFilter;class FlexSheetColumnFilter extends wijmo_grid_filter_1.ColumnFilter{constructor(e,t){super(e,t);this._valueFilter=new FlexSheetValueFilter(t);this._valueFilter.exclusiveValueSearch=e.exclusiveValueSearch;this._conditionFilter=new FlexSheetConditionFilter(t)}}exports.FlexSheetColumnFilter=FlexSheetColumnFilter;class FlexSheetColumnFilterEditor extends wijmo_grid_filter_1.ColumnFilterEditor{constructor(e,t,o=!0){super(e,t,o);var i,s,l=this;o&&(this._divSort.style.display="");i=this.cloneElement(this._btnAsc);s=this.cloneElement(this._btnDsc);this._btnAsc.parentNode.replaceChild(i,this._btnAsc);this._btnDsc.parentNode.replaceChild(s,this._btnDsc);i.addEventListener("click",e=>{l._sortBtnClick(e,!0)});s.addEventListener("click",e=>{l._sortBtnClick(e,!1)})}_showFilter(e){e==wijmo_grid_filter_1.FilterType.Value&&null==this._edtVal&&(this._edtVal=new FlexSheetValueFilterEditor(this._divEdtVal,this.filter.valueFilter));super._showFilter(e)}_sortBtnClick(e,t){var o,i,s=this.filter.column,l=s.grid.sortManager;e.preventDefault();e.stopPropagation();if((o=l.checkSortItemExists(s.index))>-1){l.sortDescriptions.moveCurrentToPosition(o);l.sortDescriptions.currentItem.ascending=t;i=-o}else{l.addSortLevel(s.index,t);i=-(l.sortDescriptions.items.length-1)}l.moveSortLevel(i);l.commitSort();this.onButtonClicked()}cloneElement(e){for(var t=e.cloneNode();e.firstChild;)t.appendChild(e.lastChild);return t}}exports.FlexSheetColumnFilterEditor=FlexSheetColumnFilterEditor;class FlexSheetFilter extends wijmo_grid_filter_1.FlexGridFilter{get filterDefinition(){for(var e={filters:[]},t=0;t<this._filters.length;t++){var o=this._filters[t];if(o&&o.column&&this.grid.columns.indexOf(o.column)>-1)if(o.conditionFilter.isActive){var i=o.conditionFilter;e.filters.push({columnIndex:o.column.index,type:"condition",condition1:{operator:i.condition1.operator,value:i.condition1.value},and:i.and,condition2:{operator:i.condition2.operator,value:i.condition2.value}})}else if(o.valueFilter.isActive){var s=o.valueFilter;e.filters.push({columnIndex:o.column.index,type:"value",filterText:s.filterText,showValues:s.showValues})}}return JSON.stringify(e)}set filterDefinition(e){var t=JSON.parse(wijmo_1.asString(e));this.clear();for(var o=0;o<t.filters.length;o++){var i=t.filters[o],s=this.grid.columns[i.columnIndex],l=this.getColumnFilter(s,!0);if(l)switch(i.type){case"condition":var n=l.conditionFilter;n.condition1.value=s.dataType==wijmo_1.DataType.Date?wijmo_1.changeType(i.condition1.value,s.dataType,null):i.condition1.value;n.condition1.operator=i.condition1.operator;n.and=i.and;n.condition2.value=s.dataType==wijmo_1.DataType.Date?wijmo_1.changeType(i.condition2.value,s.dataType,null):i.condition2.value;n.condition2.operator=i.condition2.operator;break;case"value":var r=l.valueFilter;r.filterText=i.filterText;r.showValues=i.showValues}}this.apply()}apply(){var e=this;e.grid.deferUpdate(()=>{for(var t,o,i,s=-1,l=0;l<e.grid.rows.length;l++)if(!((t=e.grid.rows[l])instanceof HeaderRow||l<=s)){s=-1;o=e._filter(l);if(t instanceof wijmo_grid_1.GroupRow){i=t.getCellRange();if(null==t.dataItem||t.dataItem instanceof wijmo_1.CollectionViewGroup)t.visible=e._checkGroupVisible(i);else{t.visible=o;s=i.bottomRow;if(i.isValid)for(var n=i.topRow;n<=i.bottomRow;n++)e.grid.rows[n].visible=o}}else t.visible=o}e.grid._isCopying||e.grid._isUndoing||e.grid._isSorting||e.onFilterApplied()})}editColumnFilter(e,t){var o=this,i=o.grid;o.closeEditor();e=o._asColumn(e);var s=document.createElement("div"),l=o.getColumnFilter(e),n=new FlexSheetColumnFilterEditor(s,l,o.showSortButtons);wijmo_1.addClass(s,"wj-dropdown-panel");o._divEdt=s;o._edtCol=e;var r=new wijmo_grid_1.CellRangeEventArgs(i.cells,new wijmo_grid_1.CellRange(-1,e.index));o.onFilterChanging(r);if(r.cancel){o._divEdt=null;o._edtCol=null;return}r.cancel=!0;i.undoStack.stackSize>0&&(o._undoAcion=new _FilteringAction(i));i.rightToLeft&&(s.dir="rtl");n.filterChanged.addHandler(()=>{r.cancel=!1;o._filterChanged=!0;setTimeout(()=>{if(!r.cancel){o.apply();if(o._undoAcion){o._undoAcion.saveNewState();i.undoStack._addAction(o._undoAcion);o._undoAcion=null}}})});n.buttonClicked.addHandler(()=>{o.closeEditor();i.focus();o.onFilterChanged(r)});n.lostFocus.addHandler(()=>{setTimeout(()=>{var e=wijmo_1.Control.getControl(o._divEdt);e&&!e.containsFocus()&&o.closeEditor()},10)});i._edtHdl._commitRowEdits();i.scrollIntoView(-1,e.index,!0);var a=o.grid.columnHeaders,h=t?t.row:a.rows.length-1,d=t?t.col:e.index,_=a.getCellBoundingRect(h,d),u=document.elementFromPoint(_.left+_.width/2,_.top+_.height/2);(u=wijmo_1.closest(u,".wj-cell"))?wijmo_1.showPopup(s,u,!1,!1,!1):wijmo_1.showPopup(s,_);o._setAriaExpanded(u,!0);o._setAriaExpanded(i.cells.getCellElement(-1,d),!0);let c=n.hostElement.querySelectorAll("input");for(let e=0;e<c.length;e++){let t=c[e];if(t.offsetHeight>0&&t.tabIndex>-1&&!t.disabled){t.focus();break}}n.containsFocus()||n.focus()}closeEditor(){this._undoAcion&&!this._filterChanged&&(this._undoAcion=null);super.closeEditor()}getColumnFilter(e,t=!0){wijmo_1.isString(e)?e=this.grid.columns.getColumn(e):wijmo_1.isNumber(e)&&(e=this.grid.columns[e]);if(!e)return null;e=wijmo_1.asType(e,wijmo_grid_1.Column);for(var o=0;o<this._filters.length;o++)if(this._filters[o].column==e)return this._filters[o];if(t){var i=new FlexSheetColumnFilter(this,e);this._filters.push(i);return i}return null}_filteringIsActive(){return this._filters.some(e=>e.column&&(e.conditionFilter.isActive||e.valueFilter.isActive)&&this.grid.columns.indexOf(e.column)>=0)}_checkGroupVisible(e){for(var t,o=!0,i=e.topRow+1;i<=e.bottomRow;i++)if(t=this.grid.rows[i])if(t instanceof wijmo_grid_1.GroupRow)o=this._checkGroupVisible(t.getCellRange());else if(o=this._filter(i))break;return o}}exports.FlexSheetFilter=FlexSheetFilter;class _FlexSheetSelectionHandler extends wijmo_grid_1._SelectionHandler{constructor(e){let t=e.selectionMode;super(e);this._mode=t;this._fs=e}moveSelection(e,t,o){let i=this._fs;!o&&i._lastSelMovePos&&this.selection.copy(i._lastSelMovePos);i._lastSelMovePos=null;super.moveSelection(e,t,o)}}exports._FlexSheetSelectionHandler=_FlexSheetSelectionHandler;class _ContextMenu extends wijmo_1.Control{constructor(e,t){super(e);this._idx=-1;this._owner=t}get visible(){return"none"!==this.hostElement.style.display}show(e,t){if(!this._owner.selectedSheet)return;let o=(t?t.x:e.clientX)+(e?window.pageXOffset:0),i=(t?t.y:e.clientY)+(e?window.pageYOffset:0);this.hostElement.style.position="absolute";this.hostElement.style.display="inline";i+this.hostElement.clientHeight>window.innerHeight+(e?window.pageYOffset:0)&&(i-=this.hostElement.clientHeight);o+this.hostElement.clientWidth>window.innerWidth+(e?window.pageXOffset:0)&&(o-=this.hostElement.clientWidth);this.hostElement.style.top=i+"px";this.hostElement.style.left=o+"px"}hide(){this._idx=-1;let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this.hostElement.style.display="none"}moveToNext(){let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this._idx++;for(;e[this._idx]&&("none"===e[this._idx].style.display||wijmo_1.hasClass(e[this._idx],"wj-state-disabled"));)this._idx++;this._idx>=e.length&&(this._idx=0);wijmo_1.addClass(e[this._idx],"wj-context-menu-item-selected")}moveToPrev(){let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this._idx--;this._idx<0&&(this._idx=e.length-1);for(;this._idx>0&&("none"===e[this._idx].style.display||wijmo_1.hasClass(e[this._idx],"wj-state-disabled"));)this._idx--;wijmo_1.addClass(e[this._idx],"wj-context-menu-item-selected")}moveToFirst(){let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this._idx=0;wijmo_1.addClass(e[this._idx],"wj-context-menu-item-selected")}moveToLast(){let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e);this._idx=e.length-1;e[this._idx]&&"none"===e[this._idx].style.display&&this._idx--;wijmo_1.addClass(e[this._idx],"wj-context-menu-item-selected")}handleContextMenu(){if(-1===this._idx)this.moveToNext();else{let e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._handleMenuItemOperation(e);this.hide();this._owner.hostElement.focus()}}refresh(e=!0){super.refresh(e);this._localize()}_init(){let e=this,t=e.hostElement.querySelectorAll(".wj-context-menu-item");e.hostElement.style.zIndex="9999";document.body.appendChild(e.hostElement);e.addEventListener(document.body,"mousemove",()=>{e._removeSelectedState(t)});e.addEventListener(e.hostElement,"contextmenu",e=>{e.preventDefault()});this._localize()}_handleMenuItemOperation(e){}_localize(){}_removeSelectedState(e){for(let t=0;t<e.length;t++)wijmo_1.removeClass(e[t],"wj-context-menu-item-selected")}}exports._ContextMenu=_ContextMenu;class _SheetContextMenu extends _ContextMenu{constructor(e,t){super(e,t);this._isDisableDelRow=!1;this._isDisableConvertTable=!1;this.applyTemplate("",this.getTemplate(),{_insRows:"insert-rows",_delRows:"delete-rows",_insCols:"insert-columns",_delCols:"delete-columns",_splitter:"splitter",_convertTable:"convert-table"});this._init()}show(e,t){if(this._owner.selectedSheet){if(this._owner._isDisableDeleteRow(this._owner.selection.topRow,this._owner.selection.bottomRow)){this._isDisableDelRow=!0;wijmo_1.addClass(this._delRows,"wj-state-disabled")}this._showTableOperation();if(!this._owner.selection.isValid){this._isDisableConvertTable=!0;wijmo_1.addClass(this._convertTable,"wj-state-disabled")}super.show(e,t)}}hide(){super.hide();this._isDisableDelRow=!1;this._isDisableConvertTable=!1;wijmo_1.removeClass(this._delRows,"wj-state-disabled");wijmo_1.removeClass(this._convertTable,"wj-state-disabled")}_init(){super._init();let e=this;e.addEventListener(e._insRows,"click",t=>{e._owner.insertRows();e.hide();e._owner.hostElement.focus()});e.addEventListener(e._delRows,"click",t=>{e._isDisableDelRow||e._owner.deleteRows();e.hide();e._owner.hostElement.focus()});e.addEventListener(e._insCols,"click",t=>{e._owner.insertColumns();e.hide();e._owner.hostElement.focus()});e.addEventListener(e._delCols,"click",t=>{e._owner.deleteColumns();e.hide();e._owner.hostElement.focus()});e.addEventListener(e._convertTable,"click",t=>{e._isDisableConvertTable||e._addTable();e.hide();e._owner.hostElement.focus()})}_handleMenuItemOperation(e){switch(e[this._idx]){case this._insCols:this._owner.insertColumns();break;case this._insRows:this._owner.insertRows();break;case this._delCols:this._owner.deleteColumns();break;case this._delRows:this._isDisableDelRow||this._owner.deleteRows();break;case this._convertTable:this._addTable()}}_localize(){super._localize();let e=wijmo_1.culture.FlexSheet;this._insRows.textContent=e.insertRow;this._delRows.textContent=e.deleteRow;this._insCols.textContent=e.insertCol;this._delCols.textContent=e.deleteCol;this._convertTable.textContent=e.convertTable}_showTableOperation(){let e=this._owner.selection;for(let t=e.topRow;t<=e.bottomRow;t++)for(let o=e.leftCol;o<=e.rightCol;o++){if(null!=this._owner.selectedSheet.findTable(t,o)){this._convertTable.style.display="none";this._splitter.style.display="none";return}}if(e.isSingleCell||this._owner._containsMergedCells(e)){this._convertTable.style.display="none";this._splitter.style.display="none"}else{this._convertTable.style.display="";this._splitter.style.display=""}}_addTable(){let e=this._owner.selectedSheet._addTable(this._owner.selection);if(e){if(0===this._owner.undoStack.stackSize)return;let t=new _TableAction(this._owner,e);this._owner.undoStack._addAction(t)}}}_SheetContextMenu.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-rows"></div><div class="wj-context-menu-item" wj-part="delete-rows"></div><div class="wj-context-menu-item" wj-part="insert-columns"></div><div class="wj-context-menu-item" wj-part="delete-columns"></div><div class="wj-state-disabled" wj-part="splitter" style="width:100%;height:1px;background-color:lightgray;"></div><div class="wj-context-menu-item" wj-part="convert-table"></div></div>';exports._SheetContextMenu=_SheetContextMenu;class _SheetTabContextMenu extends _ContextMenu{constructor(e,t){super(e,t);this.applyTemplate("",this.getTemplate(),{_insSheet:"insert-sheet",_delSheet:"delete-sheet",_renameSheet:"rename-sheet"});this._init()}_init(){let e=wijmo_1.culture.FlexSheet,t=this;t._insSheet.textContent=e.insertSheet;t._delSheet.textContent=e.deleteSheet;t._renameSheet.textContent=e.renameSheet;super._init();t.addEventListener(t._insSheet,"click",e=>{t._owner.addUnboundSheet(null,null,null,t._owner.selectedSheetIndex);t.hide();t._owner.hostElement.focus()});t.addEventListener(t._delSheet,"click",e=>{t._owner.sheets.removeAt(t._owner.selectedSheetIndex);t.hide();t._owner.hostElement.focus()});t.addEventListener(t._renameSheet,"click",e=>{t._owner._tabHolder.sheetControl._startEditingSheetName(t._owner.selectedSheetIndex);t.hide()})}_handleMenuItemOperation(e){switch(e[this._idx]){case this._insSheet:this._owner.addUnboundSheet(null,null,null,this._owner.selectedSheetIndex);break;case this._delSheet:this._owner.sheets.removeAt(this._owner.selectedSheetIndex);break;case this._renameSheet:this._owner._tabHolder.sheetControl._startEditingSheetName(this._owner.selectedSheetIndex)}}_localize(){super._localize();let e=wijmo_1.culture.FlexSheet;this._insSheet.textContent=e.insertSheet;this._delSheet.textContent=e.deleteSheet;this._renameSheet.textContent=e.renameSheet}}_SheetTabContextMenu.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-sheet"></div><div class="wj-context-menu-item" wj-part="delete-sheet"></div><div class="wj-context-menu-item" wj-part="rename-sheet"></div><div>';exports._SheetTabContextMenu=_SheetTabContextMenu;class Sheet{constructor(e,t,o,i,s){this._visible=!0;this._unboundSortDesc=new wijmo_1.ObservableArray;this._currentStyledCells={};this._currentMergedRanges=[];this._isEmptyGrid=!1;this._rowSettings=[];this._scrollPosition=new wijmo_1.Point;this._showDefaultHeader=!1;this._ownerHeaderRowRemoved=!1;this.nameChanged=new wijmo_1.Event;this.visibleChanged=new wijmo_1.Event;var l=this;l._owner=e;l._name=o;l._sortList=[new ColumnSortDescription(-1,!0)];wijmo_1.isNumber(i)&&!isNaN(i)&&i>=0?l._rowCount=i:l._rowCount=200;wijmo_1.isNumber(s)&&!isNaN(s)&&s>=0?l._columnCount=s:l._columnCount=20;if(t){l._showDefaultHeader=!0;l._grid=t;l._addHeaderRow(!0)}else l._grid=this._createGrid();l._grid.loadedRows.addHandler(()=>{l._owner&&l._owner._checkCollectionsOwner();l._addHeaderRow();l._setRowSettings()});l._grid.refreshed.addHandler(()=>{l._owner&&l._owner._checkCollectionsOwner()});l._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this);l._unboundSortDesc.collectionChanged.addHandler(()=>{var e,t,o=l._unboundSortDesc,i={};for(e=0;e<o.length;e++)if(!wijmo_1.tryCast(o[e],_UnboundSortDescription))throw"sortDescriptions array must contain SortDescription objects.";if(l._owner){l._owner.rows.beginUpdate();l._owner.rows.sort(l._compareRows());if(!l._owner._isUndoing){for(e=0;e<l._owner.rows.length;e++){e!==(t=l._owner.rows[e])._idx&&l._owner._updateFormulaForReorderingRows(t._idx,e);l._owner._updateCellStyleForReorderingRows(t._idx,e,i)}l._currentStyledCells=i}l._owner.rows.endUpdate();l._owner.rows._dirty=!0;l._owner.rows._update();if(l._owner.selectedSheet){l._owner._copyTo(l._owner.selectedSheet);l._owner._copyFrom(l._owner.selectedSheet)}}});l.tables.collectionChanged.addHandler((e,t)=>{if(null!=t.item&&!(t.item instanceof Table))throw"The tables only allows to handle Table instance.";if(l._owner)if(t.action===wijmo_1.NotifyCollectionChangedAction.Add||t.action===wijmo_1.NotifyCollectionChangedAction.Change){if(t.item){let e,o,i,s=t.item,n=s.getRange(),r=l===l._owner.selectedSheet?l._owner:l.grid;try{if(n.topRow>=r.rows.length||n.leftCol>=r.columns.length)throw"";if(n.leftCol+n.columnSpan>r.columns.length)throw"";if(n.topRow+n.rowSpan>r.rows.length)throw"";for(e=n.topRow;e<=n.bottomRow;e++)for(o=n.leftCol;o<=n.rightCol;o++)if((i=l.findTable(e,o))!==s)throw"";s._attachSheet(l)}catch(e){l.tables.removeAt(t.index)}}}else t.action===wijmo_1.NotifyCollectionChangedAction.Remove&&t.item&&t.item._detachSheet()})}get grid(){null==this._grid.wj_sheetInfo&&(this._grid.wj_sheetInfo={});return this._grid}get name(){return this._name}set name(e){if(!wijmo_1.isNullOrWhiteSpace(e)&&(this._name&&this._name.toLowerCase()!==e.toLowerCase()||!this._name)){var t=new wijmo_1.PropertyChangedEventArgs("sheetName",this._name,e);this._name=e;this.grid.wj_sheetInfo.name=e;this.onNameChanged(t)}}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;this.grid.wj_sheetInfo.visible=e;this.onVisibleChanged(new wijmo_1.EventArgs)}}get rowCount(){return null!=this._grid?this._grid.rows.length:0}set rowCount(e){var t;if(!this.itemsSource&&wijmo_1.isNumber(e)&&!isNaN(e)&&e>=0&&this._rowCount!==e){if(this._rowCount<e)for(t=0;t<e-this._rowCount;t++)this.grid.rows.push(new wijmo_grid_1.Row);else this.grid.rows.splice(e,this._rowCount-e);this._rowCount=e;this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this)}}get columnCount(){return null!=this._grid?this._grid.columns.length:0}set columnCount(e){var t;if(!this.itemsSource&&wijmo_1.isNumber(e)&&!isNaN(e)&&e>=0&&this._columnCount!==e){if(this._columnCount<e)for(t=0;t<e-this._columnCount;t++)this._grid.columns.push(new wijmo_grid_1.Column);else this._grid.columns.splice(e,this._columnCount-e);this._columnCount=e;this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this)}}get selectionRanges(){if(!this._selectionRanges){this._selectionRanges=new wijmo_1.ObservableArray;this._selectionRanges.collectionChanged.addHandler(()=>{var e,t;if(this._owner&&!this._owner._isClicking){(e=this._selectionRanges.length)>0&&(t=this._selectionRanges[e-1])&&t instanceof wijmo_grid_1.CellRange&&(this._owner.selection=t);if(e>1){this._owner._enableMulSel=!0;this._owner.refresh(!1)}this._owner._enableMulSel=!1}},this)}return this._selectionRanges}get itemsSource(){return null!=this._grid?this._grid.itemsSource:null}set itemsSource(e){if(!this._grid||this._grid.itemsSource!=e){if(null==this._grid){this._createGrid();this._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this)}this._owner&&this._owner._isCopying||(this._dataView=null);this._isEmptyGrid&&this._clearGrid();this._grid.itemsSource=e}}get filterSetting(){this._owner&&this===this._owner.selectedSheet&&this._getFilterSetting();return this._filterSetting}set filterSetting(e){this._filterSetting=e;this._owner&&this===this._owner.selectedSheet&&this._applyFilterSetting()}get tables(){null==this._tables&&(this._tables=new wijmo_1.ObservableArray);return this._tables}get _styledCells(){this._currentStyledCells||(this._currentStyledCells={});return this._currentStyledCells}set _styledCells(e){this._currentStyledCells=e}get _mergedRanges(){this._currentMergedRanges||(this._currentMergedRanges=[]);return this._currentMergedRanges}onNameChanged(e){this.nameChanged.raise(this,e)}onVisibleChanged(e){this.visibleChanged.raise(this,e)}dispose(){this._clearGrid();this._grid.wj_sheetInfo=null;this._grid.dispose();this._grid=null;if(null!=this._tables){for(let e=0;e<this._tables.length;e++)this._tables[e]=null;this._tables=null}}getCellStyle(e,t){var o,i=this._grid.rows.length,s=this._grid.columns.length;if(e>=i||t>=s)return null;o=e*s+t;return this._styledCells[o]}addTableFromArray(e,t,o,i,s,l,n,r=!0){let a,h,d,_,u,c,g,w,m,f,p,C,S,b=!1;if(!this._owner)return;C=this===this._owner.selectedSheet?this._owner:this.grid;if(null==o||0===o.length)throw"Invalid array to load.";if(!(null!=i&&0!==i.length||null!=(i=Object.keys(o[0]))&&0!==i.length))throw"Invalid array to load.";if(e>=this.rowCount||t>=this.columnCount)return null;let R=null==(n&&n.showHeaderRow)||n.showHeaderRow,x=!(!n||!n.showTotalRow),y=e+(R?1:0),v=y+o.length-1+(x?1:0);h=[];for(f=0;f<i.length;f++){p=i[f];d=new TableColumn(p);0===f?d._totalRowLabel="Total":f===i.length-1&&(d._totalRowFunction="Sum");h.push(d)}_=new wijmo_grid_1.CellRange(e,t,v,t+i.length-1);if(0!==(u=this._needShiftForTable(_))){if(!r)return null;if(!this._canShiftCells(_))return null;c=this._needAddRowCountForAddTable(u,_);if(C.collectionView){S=C.itemsSource instanceof wijmo_1.CollectionView;C.collectionView.beginUpdate();for(w=0;w<c;w++)S?C.itemsSource.sourceCollection.push({}):C.itemsSource.push({});C.collectionView.endUpdate(!0)}else for(w=0;w<c;w++)C.rows.push(new wijmo_grid_1.Row);b=!0}if(t+i.length>=C.columns.length){if(!r)return null;g=t+i.length-C.columns.length+1;if(this.itemsSource&&g>0)return null;C.columns.beginUpdate();for(w=0;w<g;w++)C.columns.push(new wijmo_grid_1.Column);C.columns.endUpdate()}C.beginUpdate();b&&this._moveDownCells(u,_);if(R)for(f=0;f<i.length;f++){p=i[f];C.setCellData(e,t+f,p)}for(m=0;m<o.length;m++)for(f=0;f<i.length;f++){p=i[f];C.setCellData(y+m,t+f,o[m][p])}C.endUpdate();return a=this._addTable(_,s,l,h,n)}findTable(e,t){var o,i;if(this._tables&&this._tables.length>0)for(var s=0;s<this._tables.length;s++)if(e>=(i=(o=this._tables[s]).getRange()).topRow&&e<=i.bottomRow&&t>=i.leftCol&&t<=i.rightCol)return o;return null}_attachOwner(e){if(this._owner!==e){this._owner=e;if(this._owner){var t=!1;this._owner.loadedRows.addHandler(()=>{if(!t){t=!0;this._addHeaderRow()}})}}}_setValidName(e){this._name=e;this.grid.wj_sheetInfo.name=e}_storeRowSettings(){var e,t=0;if(this._owner){this._rowSettings=[];for(;t<this._grid.rows.length;t++)(e=this._owner.rows[t])&&(this._rowSettings[t]={height:e.height,allowMerging:e.allowMerging,isCollapsed:e instanceof wijmo_grid_1.GroupRow?e.isCollapsed:null,visible:e.visible,isSelected:e.isSelected,readOnly:e.isReadOnly})}}_setRowSettings(){for(var e,t,o,i=0;i<this._rowSettings.length;i++)if((t=this._rowSettings[i])&&(e=this._grid.rows[i])){o=e instanceof HeaderRow;e.height=t.height;e.allowMerging=t.allowMerging;e.visible=t.visible;e instanceof wijmo_grid_1.GroupRow&&(e.isCollapsed=!!t.isCollapsed);e.isSelected=!!t.isSelected;e.isReadOnly=o||!!t.readOnly}}_addTable(e,t,o,i,s){if(!e.isValid||!this._owner)return null;let l;null!=t&&null==this._owner._getTable(t)||(t=this._getUniqueTableName());l=new Table(t,e,o,i,s);this.tables.push(l);return l}_addSelection(e){let t,o;this.selectionRanges.beginUpdate();for(o=this.selectionRanges.length-1;o>=0;o--){t=this.selectionRanges[o];e.contains(t)&&this.selectionRanges.removeAt(o)}e.isValid&&this.selectionRanges.push(e);this.selectionRanges.endUpdate()}_compareRows(){var e=this,t=this._unboundSortDesc;return function(o,i){for(var s=0;s<t.length;s++){var l=t[s],n=o._ubv&&l.column?o._ubv[l.column._hash]:"",r=i._ubv&&l.column?i._ubv[l.column._hash]:"";_isFormula(n)&&(n=e._owner.evaluate(n));_isFormula(r)&&(r=e._owner.evaluate(r));n!=n&&(n=null);r!=r&&(r=null);wijmo_1.isString(n)&&(n=n.toLowerCase()+n);wijmo_1.isString(r)&&(r=r.toLowerCase()+r);if(""===n||null==n)return 1;if(""===r||null==r)return-1;var a=n<r?-1:n>r?1:0;wijmo_1.isString(n)&&wijmo_1.isNumber(r)&&(a=1);wijmo_1.isString(r)&&wijmo_1.isNumber(n)&&(a=-1);if(0!==a)return l.ascending?+a:-a}return 0}}_createGrid(){var e,t,o,i,s=document.createElement("div");this._isEmptyGrid=!0;s.style.visibility="hidden";document.body.appendChild(s);e=new wijmo_grid_1.FlexGrid(s);document.body.removeChild(s);for(i=0;i<this._rowCount;i++)e.rows.push(new wijmo_grid_1.Row);for(o=0;o<this._columnCount;o++){(t=new wijmo_grid_1.Column).isRequired=!1;e.columns.push(t)}e.wj_sheetInfo={name:this.name,visible:this.visible,styledCells:this._styledCells,mergedRanges:this._mergedRanges};return e}_clearGrid(){this._grid.rows.clear();this._grid.columns.clear();this._grid.columnHeaders.columns.clear();this._grid.rowHeaders.rows.clear()}_gridItemsSourceChanged(){var e=this;if(this._owner&&!this._owner._isCopying&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name){this._owner.filter.clear();this._owner._copyFrom(this,!1);setTimeout(()=>{e._owner._setFlexSheetToDirty();e._owner.invalidate()},10)}}_addHeaderRow(e=!1){if(this._needAddHeaderRow()||e){var t,o;(t=new HeaderRow).isReadOnly=!0;for(var i=0;i<this._grid.columns.length;i++){o=this._grid.columns[i];t._ubv||(t._ubv={});t._ubv[o._hash]=FlexSheet._getHeaderRowText(o)}this._grid.rows.insert(0,t)}}_needAddHeaderRow(){let e=this._grid.allowAddNew&&this._grid.newRowAtTop?this._grid.rows[1]:this._grid.rows[0];if(!this._grid.collectionView||this._grid.collectionView.isEmpty||e instanceof HeaderRow)return!1;if(null==this._owner||!this._owner.rows.length)return!0;return(this._owner.allowAddNew&&this._owner.newRowAtTop?this._owner.rows[1]:this._owner.rows[0])instanceof HeaderRow}_getUniqueTableName(){for(var e="Table1",t=2;;){if(null==this._owner._getTable(e))break;e="Table"+t;t+=1}return e}_needShiftForTable(e){let t,o,i,s=0,l=0,n=this===this._owner.selectedSheet?this._owner:this.grid;for(t=e.topRow;t<=e.bottomRow;t++){if(t>=n.rows.length)return s=e.rowSpan-l;for(o=e.leftCol;o<=e.rightCol&&o<n.columns.length;o++)if(null!=(i=n.getCellData(t,o,!1))&&""!==i)return s=e.rowSpan-l;l++}return s}_needAddRowCountForAddTable(e,t){var o,i,s,l,n,r=this===this._owner.selectedSheet?this._owner:this.grid;for(o=1;o<=e;o++){i=r.rows.length-o;for(s=t.leftCol;s<=t.rightCol&&s<r.columns.length;s++){l=r.getCellData(i,s,!1);n=this.getCellStyle(i,s);if(null!=l&&""!==l||null!=n)return e-o+1}}return 0}_moveDownTable(e){var t,o,i,s,l=e.getRange(),n=this===this._owner.selectedSheet?this._owner:this.grid;for(t=l.bottomRow;t>=l.topRow;t--)for(o=l.leftCol;o<=l.rightCol;o++){s=null!=n.columns[o].dataMap;i=n.getCellData(t,o,s);n.setCellData(t+1,o,i);n.setCellData(t,o,"")}e._updateTableRange(1,1,0,0)}_moveDownCells(e,t){var o,i,s,l,n,r,a,h,d,_,u=this===this._owner.selectedSheet?this._owner:this.grid;for(o=u.rows.length-1-e;o>=t.topRow;o--)for(i=t.leftCol;i<=t.rightCol&&i<u.columns.length;i++){_=null!=u.columns[i].dataMap;s=u.getCellData(o,i,_);u.setCellData(o+e,i,s);u.setCellData(o,i,"");l=this.getCellStyle(o,i);r=(o+e)*u.columns.length+i;n=o*u.columns.length+i;if(l){this._styledCells[r]=l;this._styledCells[n]=null}if(a=this._mergedRanges[n]){a.row+=e;a.row2+=e;this._mergedRanges[r]=a;this._mergedRanges[n]=null}(h=this.findTable(o,i))&&(d=h.getRange()).topRow===o&&d.leftCol===i&&h._updateTableRange(e,e,0,0)}}_moveUpCells(e,t){var o,i,s,l,n,r,a,h,d,_,u=this===this._owner.selectedSheet?this._owner:this.grid;for(o=t.topRow;o<u.rows.length;o++)for(i=t.leftCol;i<=t.rightCol&&i<u.columns.length;i++){_=null!=u.columns[i].dataMap;s=u.getCellData(o,i,_);u.setCellData(o-e,i,s);u.setCellData(o,i,"");l=this.getCellStyle(o,i);r=(o-e)*u.columns.length+i;n=o*u.columns.length+i;if(l){this._styledCells[r]=l;this._styledCells[n]=null}if(a=this._mergedRanges[n]){a.row-=e;a.row2-=e;this._mergedRanges[r]=a;this._mergedRanges[n]=null}(h=this.findTable(o,i))&&(d=h.getRange()).topRow===o&&d.leftCol===i&&h._updateTableRange(-e,-e,0,0)}}_moveDownCellsWithinTable(e,t,o){var i,s,l,n,r=this===this._owner.selectedSheet?this._owner:this.grid;for(i=o.bottomRow;i>o.topRow+e;i--)for(s=o.leftCol;s<=o.rightCol;s++){n=null!=r.columns[s].dataMap;l=r.getCellData(i,s,n);r.setCellData(i+t,s,l);r.setCellData(i,s,"");(i+t)*r.columns.length+s;i*r.columns.length+s;void 0}}_moveUpCellsWithinTable(e,t,o){var i,s,l,n,r=o.topRow+e,a=this===this._owner.selectedSheet?this._owner:this.grid;for(i=r;i<=o.bottomRow;i++)for(s=o.leftCol;s<=o.rightCol;s++){if(i>=r+t){n=null!=a.columns[s].dataMap;l=a.getCellData(i,s,n);a.setCellData(i-t,s,l)}a.setCellData(i,s,"");(i-t)*a.columns.length+s;i*a.columns.length+s;void 0}}_canShiftCells(e){var t,o,i,s,l,n,r=this===this._owner.selectedSheet?this._owner:this.grid;for(t=e.topRow;t<r.rows.length;t++)for(o=e.leftCol;o<=e.rightCol&&o<r.columns.length;o++){if((l=this.findTable(t,o))&&((n=l.getRange()).leftCol<e.leftCol||n.rightCol>e.rightCol))return!1;i=t*r.columns.length+o;if((s=this._mergedRanges[i])&&(s.leftCol<e.leftCol||s.rightCol>e.rightCol))return!1}return!0}_needMoveDownTable(e){var t,o,i=e.getRange(),s=e.getColumns(),l=this===this._owner.selectedSheet?this._owner:this.grid;if(0===i.topRow)return!0;for(t=0;t<s.length;t++)if(null!=(o=l.getCellData(i.topRow-1,i.leftCol+t,!1))&&""!==o)return!0;return!1}_needAddRowCountForInsertTableRows(e,t){var o,i,s,l,n,r=this===this._owner.selectedSheet?this._owner:this.grid;for(o=1;o<=e;o++){if((i=r.rows.length-o)<=t.bottomRow)return e;for(s=t.leftCol;s<=t.rightCol&&s<r.columns.length;s++){l=r.getCellData(i,s,!1);n=this.getCellStyle(i,s);if(null!=l&&""!==l||null!=n)return e-o+1}}return 0}_getFilterSetting(){let e,t=0;this._filterDefinition=this._owner.filter.filterDefinition;this._filterSetting={};this._filterSetting.filterColumns=this._owner.filter.filterColumns;this._filterSetting.columnFilterSettings||(this._filterSetting.columnFilterSettings=[]);for(;t<this._owner.filter._filters.length;t++)(e=this._owner.filter._filters[t])&&this._filterSetting.columnFilterSettings.push({column:e.column,filterType:e.filterType,dataMap:e.dataMap,valueFilterSetting:{maxValues:e.valueFilter.maxValues,uniqueValues:e.valueFilter.uniqueValues,sortValues:e.valueFilter.sortValues,dataMap:e.valueFilter.dataMap,exclusiveValueSearch:e.valueFilter.exclusiveValueSearch},conditionFilterSetting:{dataMap:e.conditionFilter.dataMap}})}_applyFilterSetting(){let e,t,o,i,s,l,n,r,a,h,d=0;if(null==this._filterSetting)this._clearFilterSetting();else{this._owner.filter.filterColumns=this._filterSetting.filterColumns;this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition);if(null!=(e=this._filterSetting.columnFilterSettings)&&e.length>0)for(;d<e.length;d++)if((t=e[d])&&null!=t.column&&(s=this._owner.filter.getColumnFilter(t.column))){l=s.valueFilter.showValues;n=s.valueFilter.filterText;r={operator:s.conditionFilter.condition1.operator,value:s.conditionFilter.condition1.value};a={operator:s.conditionFilter.condition2.operator,value:s.conditionFilter.condition2.value};h=s.conditionFilter.and;null!=t.dataMap&&(s.dataMap=t.dataMap);null!=t.filterType&&(s.filterType=t.filterType);if(o=t.valueFilterSetting){o.dataMap&&(s.valueFilter.dataMap=o.dataMap);null!=o.maxValues&&(s.valueFilter.maxValues=o.maxValues);null!=o.sortValues&&(s.valueFilter.sortValues=o.sortValues);o.uniqueValues&&(s.valueFilter.uniqueValues=o.uniqueValues);s.valueFilter.exclusiveValueSearch=o.exclusiveValueSearch}(i=t.conditionFilterSetting)&&i.dataMap&&(s.conditionFilter.dataMap=i.dataMap);s.valueFilter.showValues=l;s.valueFilter.filterText=n;s.conditionFilter.condition1.operator=r.operator;s.conditionFilter.condition1.value=r.value;s.conditionFilter.condition2.operator=a.operator;s.conditionFilter.condition2.value=a.value;s.conditionFilter.and=h}}}_clearFilterSetting(){this._owner.filter._filters=[];this._owner.filter.filterColumns=null;this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition)}_cloneMergedCells(){let e,t=0,o=[];for(;t<this._mergedRanges.length;t++){e=this._mergedRanges[t];o.push(e.clone())}return o}_getMergedRange(e,t){let o,i;for(o=0;o<this._mergedRanges.length;o++)if(e>=(i=this._mergedRanges[o]).topRow&&e<=i.bottomRow&&t>=i.leftCol&&t<=i.rightCol)return i;return null}}exports.Sheet=Sheet;class SheetCollection extends wijmo_1.ObservableArray{constructor(){super(...arguments);this._current=-1;this.sheetCleared=new wijmo_1.Event;this.selectedSheetChanged=new wijmo_1.Event;this.sheetNameChanged=new wijmo_1.Event;this.sheetVisibleChanged=new wijmo_1.Event}onSheetCleared(){this.sheetCleared.raise(this)}get selectedIndex(){return this._current}set selectedIndex(e){this._moveCurrentTo(+e)}onSelectedSheetChanged(e){this.selectedSheetChanged.raise(this,e)}insert(e,t){var o=t.name?this.getValidSheetName(t):this._getUniqueName();o!==t.name&&(t.name=o);super.insert(e,t);this._postprocessSheet(t)}push(...e){for(var t=0;t<e.length;t++){var o=e[t].name?this.getValidSheetName(e[t]):this._getUniqueName();o!==e[t].name&&(e[t].name=o);super.push(e[t]);this._postprocessSheet(e[t])}return this.length}splice(e,t,...o){o.forEach(e=>{e.name=e.name?this.getValidSheetName(e):this._getUniqueName();this._postprocessSheet(e)});return super.splice(e,t,...o)}onCollectionChanged(e){this._current>=this.length&&(this._current=this.length-1);super.onCollectionChanged(e)}onSheetNameChanged(e){this.sheetNameChanged.raise(this,e)}onSheetVisibleChanged(e){this.sheetVisibleChanged.raise(this,e)}selectFirst(){return this._moveCurrentTo(0)}selectLast(){return this._moveCurrentTo(this.length-1)}selectPrevious(){return this._moveCurrentTo(this._current-1)}selectNext(){return this._moveCurrentTo(this._current+1)}hide(e){if(e<0&&e>=this.length)return!1;if(!this[e].visible)return!1;this[e].visible=!1;return!0}show(e){if(e<0&&e>=this.length)return!1;this[e].visible=!0;this._moveCurrentTo(e);return!0}clear(){let e;for(let t=0;t<this.length;t++){(e=this[t]).dispose();e=null}super.clear();this._current=-1;this.onSheetCleared()}isValidSheetName(e){var t=this._getSheetIndexFrom(e.name),o=this.indexOf(e);return-1===t||t===o}getValidSheetName(e){for(var t,o=e.name,i=1,s=this.indexOf(e);;){if(-1===(t=this._getSheetIndexFrom(o))||t===s)break;o=e.name.concat((i+1).toString());i+=1}return o}_setCurrentIdx(e){this._current=e}_moveCurrentTo(e){var t,o=e;if(e<0||e>=this.length)return!1;if(this._current<o||0===o)for(;o<this.length&&!this[o].visible;)o++;else if(this._current>o)for(;o>=0&&!this[o].visible;)o--;if(o===this.length){o=e;for(;o>=0&&!this[o].visible;)o--}if(o<0)return!1;if(o!==this._current){t=new wijmo_1.PropertyChangedEventArgs("sheetIndex",this._current,o);this._current=o;this.onSelectedSheetChanged(t)}return!0}_getSheetIndexFrom(e){var t;if(!e)return-1;e=e.toLowerCase();for(var o=0;o<this.length;o++)if(((t=this[o]).name?t.name.toLowerCase():"")===e)return o;return-1}_postprocessSheet(e){let t=this;e.nameChanged.removeHandler(null);e.nameChanged.addHandler(()=>{let o,i=t._getSheetIndexFrom(e.name);t.isValidSheetName(e)||e._setValidName(t.getValidSheetName(e));o=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,e,wijmo_1.isNumber(i)?i:t.length-1);t.onSheetNameChanged(o)});e.visibleChanged.removeHandler(null);e.visibleChanged.addHandler(()=>{let o=t._getSheetIndexFrom(e.name),i=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,e,wijmo_1.isNumber(o)?o:t.length-1);t.onSheetVisibleChanged(i)})}_getUniqueName(){for(var e="Sheet1",t=2;;){if(-1===this._getSheetIndexFrom(e))break;e="Sheet"+t;t+=1}return e}}exports.SheetCollection=SheetCollection;class _SheetTabs extends wijmo_1.Control{constructor(e,t,o){super(e,o);this._rtl=!1;this._sheetTabClicked=!1;this._owner=t;this._sheets=t.sheets;this._rtl="rtl"==getComputedStyle(t.hostElement).direction;this._initControl();this.deferUpdate(()=>{this.initialize(o)})}refresh(e){this._tabContainer.innerHTML="";this._tabContainer.innerHTML=this._getSheetTabs();this._rtl&&this._adjustSheetsPosition();this._adjustSize()}_sourceChanged(e,t=wijmo_1.NotifyCollectionChangedEventArgs.reset){var o=t;switch(o.action){case wijmo_1.NotifyCollectionChangedAction.Add:o.index-1<0&&0;this._tabContainer.innerHTML="";this._tabContainer.innerHTML=this._getSheetTabs();this._rtl&&this._adjustSheetsPosition();this._adjustSize();break;case wijmo_1.NotifyCollectionChangedAction.Remove:this._tabContainer.removeChild(this._tabContainer.children[o.index]);this._adjustSize();break;default:this.invalidate()}}_selectedSheetChanged(e,t){this._updateTabActive(t.oldValue,!1);this._updateTabActive(t.newValue,!0);this._sheetTabClicked?this._sheetTabClicked=!1:this._scrollToActiveSheet(t.newValue,t.oldValue);this._adjustSize()}_initControl(){var e=this,t=e.hostElement;e.applyTemplate("",e.getTemplate(),{_sheetContainer:"sheet-container",_tabContainer:"container",_sheetPage:"sheet-page",_newSheet:"new-sheet",_contextMenuHost:"context-menu"});e._contextMenu=new _SheetTabContextMenu(e._contextMenuHost,e._owner);if(e._rtl){e._sheetPage.style.right="0px";e._tabContainer.parentElement.style.right=e._sheetPage.clientWidth+"px";e._tabContainer.style.right="0px";e._tabContainer.style.cssFloat="right";e._newSheet.style.right=e._sheetPage.clientWidth+e._tabContainer.parentElement.clientWidth+"px"}e._adjustNavigationButtons(e._rtl);e.addEventListener(t,"mousedown",()=>{e._owner._mouseHdl._htDown=null});e.addEventListener(t,"dragstart",t=>{t.dataTransfer.setData("text","foo");t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target)?e._dragSrcIdx=e._getItemIndex(e._tabContainer,t.target):e._dragSrcIdx=-1});e.addEventListener(t,"dragover",e=>{e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation()});e.addEventListener(t,"drop",t=>{let o,i,s;if(e._dragSrcIdx>-1){if(t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target))o=e._getItemIndex(e._tabContainer,t.target);else{s=e._tabContainer.getBoundingClientRect();o=t.clientX<s.left?0:t.clientX>s.right?e._sheets.length-1:-1}if(o!==e._dragSrcIdx){i=e._sheets[e._dragSrcIdx];e._sheets._exchangingPosition=!0;e._sheets.beginUpdate();e._sheets.splice(e._dragSrcIdx,1);e._sheets.splice(o,0,i);e._sheets.endUpdate();e._owner.selectedSheetIndex=o;e._sheets._exchangingPosition=!1}}e._dragSrcIdx=-1;t.preventDefault();t.stopPropagation()});e.addEventListener(e._newSheet,"click",t=>{var o=e._owner.selectedSheetIndex;e._owner.addUnboundSheet();e._scrollToActiveSheet(e._owner.selectedSheetIndex,o)});e._sheets.collectionChanged.addHandler(e._sourceChanged,e);e._sheets.selectedSheetChanged.addHandler(e._selectedSheetChanged,e);e._sheets.sheetNameChanged.addHandler(e._updateSheetName,e);e._sheets.sheetVisibleChanged.addHandler(e._updateTabShown,e);e._initSheetPage();e._initSheetTab()}_initSheetTab(){let e=this;e.addEventListener(e._tabContainer,"mousedown",t=>{let o,i=t.target;if(i instanceof HTMLLIElement){e._sheetTabClicked=!0;o=e._getItemIndex(e._tabContainer,i);e._scrollSheetTabContainer(i);o>-1&&(e._sheets.selectedIndex=o)}});e.addEventListener(e._tabContainer,"dblclick",t=>{let o,i=t.target;if(i instanceof HTMLLIElement){o=e._getItemIndex(e._tabContainer,i);e._scrollSheetTabContainer(i);o>-1&&e._startEditingSheetName(o)}});e.addEventListener(e._tabContainer,"contextmenu",t=>{t.preventDefault();e._contextMenu.show(t)})}_initSheetPage(){var e=this;e.hostElement.querySelector("div.wj-sheet-page").addEventListener("click",t=>{var o="[object HTMLButtonElement]"===t.target.toString()?t.target:t.target.parentElement,i=e._getItemIndex(e._sheetPage,o);if(0!==e._sheets.length)switch(i){case 0:e._sheets.selectFirst();break;case 1:e._sheets.selectPrevious();break;case 2:e._sheets.selectNext();break;case 3:e._sheets.selectLast()}})}_getSheetTabs(){var e,t="";for(e=0;e<this._sheets.length;e++)t+=this._getSheetElement(this._sheets[e],this._sheets.selectedIndex===e);return t}_getSheetElement(e,t=!1){var o="<li";e.visible?t&&(o+=' class="active"'):o+=' class="hidden"';return o+=' draggable="true">'+e.name+"</li>"}_updateTabActive(e,t){e>=0&&e<this._tabContainer.children.length&&wijmo_1.toggleClass(this._tabContainer.children[e],"active",t)}_updateTabShown(e,t){if(!(t.index<0||t.index>=this._tabContainer.children.length)){t.item.visible?wijmo_1.removeClass(this._tabContainer.children[t.index],"hidden"):wijmo_1.addClass(this._tabContainer.children[t.index],"hidden");this._adjustSize()}}_adjustSize(){var e,t,o,i=this._tabContainer.childElementCount,s=0;if("none"!==this.hostElement.style.display){o=this._tabContainer.parentElement.scrollLeft;this._tabContainer.parentElement.style.width="";this._tabContainer.style.width="";this._sheetPage.parentElement.style.width="";for(e=0;e<i;e++)s+=this._tabContainer.children[e].offsetWidth+1;t=this.hostElement.offsetWidth-this._sheetPage.offsetWidth-this._newSheet.offsetWidth-2;this._tabContainer.parentElement.style.width=(s>t?t:s)+"px";this._tabContainer.style.width=s+"px";this._sheetPage.parentElement.style.width=this._sheetPage.offsetWidth+this._newSheet.offsetWidth+this._tabContainer.parentElement.offsetWidth+3+"px";this._tabContainer.parentElement.scrollLeft=o}}_getItemIndex(e,t){for(var o=0;o<e.children.length;o++)if(e.children[o]===t)return o;return-1}_updateSheetName(e,t){this._tabContainer.querySelectorAll("li")[t.index].textContent=t.item.name;this._adjustSize()}_scrollSheetTabContainer(e){var t,o=this._tabContainer.parentElement.scrollLeft,i=this._sheetPage.offsetWidth,s=this._newSheet.offsetWidth,l=this._tabContainer.parentElement.offsetWidth;if(this._rtl)switch(wijmo_grid_1.FlexGrid._getRtlMode()){case"rev":(t=-this._tabContainer.offsetLeft)+e.offsetLeft+e.offsetWidth>l+o?this._tabContainer.parentElement.scrollLeft+=e.offsetWidth:t+e.offsetLeft<o&&(this._tabContainer.parentElement.scrollLeft-=e.offsetWidth);break;case"neg":e.offsetLeft<o?this._tabContainer.parentElement.scrollLeft-=e.offsetWidth:e.offsetLeft+e.offsetWidth>l+o&&(this._tabContainer.parentElement.scrollLeft+=e.offsetWidth);break;default:e.offsetLeft-s+o<0?this._tabContainer.parentElement.scrollLeft+=e.offsetWidth:e.offsetLeft+e.offsetWidth-s+o>l&&(this._tabContainer.parentElement.scrollLeft-=e.offsetWidth)}else e.offsetLeft+e.offsetWidth-i>l+o?this._tabContainer.parentElement.scrollLeft+=e.offsetWidth:e.offsetLeft-i<o&&(this._tabContainer.parentElement.scrollLeft-=e.offsetWidth)}_adjustSheetsPosition(){var e,t,o=this._tabContainer.querySelectorAll("li"),i=0;for(t=0;t<o.length;t++){(e=o[t]).style.cssFloat="right";e.style.right=i+"px";i+=o[t].clientWidth}}_scrollToActiveSheet(e,t){var o,i,s,l=this._tabContainer.querySelectorAll("li");i=this._tabContainer.clientWidth>this._tabContainer.parentElement.clientWidth?this._tabContainer.clientWidth-this._tabContainer.parentElement.clientWidth:0;if(l.length>0&&e<l.length&&t<l.length){if(0===e&&!this._rtl||e===l.length-1&&this._rtl){if(this._rtl)switch(wijmo_grid_1.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=0;break;case"neg":this._tabContainer.parentElement.scrollLeft=-i;break;default:this._tabContainer.parentElement.scrollLeft=i}else this._tabContainer.parentElement.scrollLeft=0;return}if(0===e&&this._rtl||e===l.length-1&&!this._rtl){if(this._rtl)switch(wijmo_grid_1.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=i;break;case"neg":default:this._tabContainer.parentElement.scrollLeft=0}else this._tabContainer.parentElement.scrollLeft=i;return}if(e>=t)for(s=t+1;s<=e;s++){o=l[s];this._scrollSheetTabContainer(o)}else for(s=t-1;s>=e;s--){o=l[s];this._scrollSheetTabContainer(o)}}}_adjustNavigationButtons(e){var t,o=this.hostElement.querySelectorAll(".wj-sheet-page button");if(o&&4===o.length)if(e){t=o[0].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-step-backward");wijmo_1.addClass(t,"wj-glyph-step-forward");t=o[1].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-left");wijmo_1.addClass(t,"wj-glyph-right");t=o[2].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-right");wijmo_1.addClass(t,"wj-glyph-left");t=o[3].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-step-forward");wijmo_1.addClass(t,"wj-glyph-step-backward")}else{t=o[0].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-step-forward");wijmo_1.addClass(t,"wj-glyph-step-backward");t=o[1].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-right");wijmo_1.addClass(t,"wj-glyph-left");t=o[2].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-left");wijmo_1.addClass(t,"wj-glyph-right");t=o[3].querySelector("span");wijmo_1.removeClass(t,"wj-glyph-step-backward");wijmo_1.addClass(t,"wj-glyph-step-forward")}}_startEditingSheetName(e){let t,o=this,i=o._tabContainer.children[e],s=i.textContent;o._editingSheetTab=i;o._measureEle=document.createElement("span");o._measureEle.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true");o._measureEle.style.visibility="hidden";o.hostElement.appendChild(o._measureEle);i.innerHTML='<input type="text" style="width: '+(i.offsetWidth-40)+'px;"/>';t=i.children[0];wijmo_1.addClass(t,"wj-sheet-name-editor wj-form-control");t.value=s;wijmo_1.setSelectionRange(t,0,s.length);o.addEventListener(t,"keydown",e=>{e.keyCode===wijmo_1.Key.Enter?o._commitSheetName():o._measureInputWidth(e.key)});o.addEventListener(t,"blur",o._commitSheetName.bind(o))}_commitSheetName(){let e,t,o;if(this._editingSheetTab){o=this._editingSheetTab.children[0];this.removeEventListener(o);e=o.value;t=this._getItemIndex(this._tabContainer,this._editingSheetTab);if(null!=e&&""!==e&&-1===this._sheets._getSheetIndexFrom(e)){this._sheets[t].name=e;this._editingSheetTab.textContent=e}else this._editingSheetTab.textContent=this._sheets[t].name;this._editingSheetTab=null;wijmo_1.removeChild(this._measureEle);this._measureEle=null;this._adjustSize()}}_measureInputWidth(e){let t,o,i,s;if(this._editingSheetTab&&!(e.length>1)){o=(t=this._editingSheetTab.children[0]).selectionStart;i=t.selectionEnd;if(null!=(s=(s=t.value).substring(0,o)+e+s.substring(i))&&""!==s){this._measureEle.textContent=s;t.style.width=this._measureEle.offsetWidth+"px";this._adjustSize()}}}}_SheetTabs.controlTemplate='<div wj-part="sheet-container" class="wj-sheet" style="height:100%;position:relative"><div wj-part="sheet-page" class="wj-btn-group wj-sheet-page"><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-backward"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-left"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-right"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-forward"></span></button></div><div class="wj-sheet-tab" style="height:100%;overflow:hidden"><ul wj-part="container"></ul></div><div wj-part="new-sheet" class="wj-new-sheet"><span class="wj-sheet-icon wj-glyph-file"></span></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>';exports._SheetTabs=_SheetTabs;class _UnboundSortDescription{constructor(e,t){this._column=e;this._ascending=t}get column(){return this._column}get ascending(){return this._ascending}}exports._UnboundSortDescription=_UnboundSortDescription;class _TabHolder extends wijmo_1.Control{constructor(e,t){super(e);this._splitterMousedownHdl=this._splitterMousedownHandler.bind(this);this._owner=t;this.applyTemplate("",this.getTemplate(),{_divSheet:"left",_divSplitter:"splitter",_divRight:"right"});this._init()}get sheetControl(){return this._sheetControl}get visible(){return"none"!==this.hostElement.style.display}set visible(e){this.hostElement.style.display=e?"block":"none";this._divSheet.style.display=e?"block":"none"}getSheetBlanketSize(){return 20}adjustSize(){var e=this._owner.scrollSize.width-this._owner.clientSize.width,t=(this._owner.scrollSize.height,this._owner.clientSize.height,this._divSplitter.parentElement);if(e<=0){t.style.minWidth="100px";this._divSplitter.style.display="none";this._divRight.style.display="none";this._divSheet.style.width="100%";this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0)}else{t.style.minWidth="300px";this._divSplitter.style.display="none";this._divRight.style.display="none";this._divSheet.style.width="100%";this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0);this._divSplitter.addEventListener("mousedown",this._splitterMousedownHdl,!0)}this._sheetControl._adjustSize()}_init(){var e=this;e._funSplitterMousedown=function(t){e._splitterMouseupHandler(t)};e._divSplitter.parentElement.style.height=e.getSheetBlanketSize()+"px";e._sheetControl=new _SheetTabs(e._divSheet,this._owner)}_splitterMousedownHandler(e){this._startPos=e.pageX;document.addEventListener("mousemove",this._splitterMousemoveHandler.bind(this),!0);document.addEventListener("mouseup",this._funSplitterMousedown,!0);e.preventDefault()}_splitterMousemoveHandler(e){null!==this._startPos&&void 0!==this._startPos&&this._adjustDis(e.pageX-this._startPos)}_splitterMouseupHandler(e){document.removeEventListener("mousemove",this._splitterMousemoveHandler,!0);document.removeEventListener("mouseup",this._funSplitterMousedown,!0);this._adjustDis(e.pageX-this._startPos);this._startPos=null}_adjustDis(e){var t=this._divRight.offsetWidth-e,o=this._divSheet.offsetWidth+e;if(t<=100){t=100;e=this._divRight.offsetWidth-t;o=this._divSheet.offsetWidth+e}else if(o<=100){e=(o=100)-this._divSheet.offsetWidth;t=this._divRight.offsetWidth-e}if(0!=e){this._divRight.style.width=t+"px";this._divSheet.style.width=o+"px";this._startPos=this._startPos+e}}}_TabHolder.controlTemplate='<div><div wj-part="left" style="float:left;height:100%;overflow:hidden"></div><div wj-part="splitter" style="float:left;height:100%;width:6px;background-color:#e9eaee;padding:2px;cursor:e-resize"><div style="background-color:#8a9eb2;height:100%"></div></div><div wj-part="right" style="float:left;height:100%;background-color:#e9eaee"></div></div>';exports._TabHolder=_TabHolder;class _Expression{constructor(e){this._token=e?e instanceof _Token?e:new _Token(e,_TokenID.ATOM,_TokenType.LITERAL):new _Token(null,_TokenID.ATOM,_TokenType.IDENTIFIER)}get token(){return this._token}evaluate(e,t,o){if(this._token.tokenType===_TokenType.ERROR)throw this._token.value;if(this._token.tokenType!==_TokenType.LITERAL)throw new SyntaxError(exports._ErrorMessages.BadExpression);return this._token.value}static toString(e,t,o,i){var s=e.evaluate(t,o,i);if(s instanceof FormulaError)throw s;wijmo_1.isPrimitive(s)||(s=s.value);return null!=s?s.toString():""}static toNumber(e,t,o,i){var s=e.evaluate(t,o,i);if(s instanceof FormulaError)throw s;wijmo_1.isPrimitive(s)||(s=s.value);if(wijmo_1.isNumber(s))return s;if(wijmo_1.isBoolean(s))return s?1:0;if(wijmo_1.isDate(s))return FlexSheet._toOADate(s);if(wijmo_1.isString(s)){if(wijmo_1.isNullOrWhiteSpace(s))return s;if(!isNaN(+s))return+s;if(this.isDateValue(s))return FlexSheet._toOADate(new Date(s))}return wijmo_1.changeType(s,wijmo_1.DataType.Number,"")}static toBoolean(e,t,o,i){var s=e.evaluate(t,o,i);if(s instanceof FormulaError)throw s;wijmo_1.isPrimitive(s)||(s=s.value);return wijmo_1.isBoolean(s)?s:wijmo_1.isNumber(s)?0!==s:wijmo_1.changeType(s,wijmo_1.DataType.Boolean,"")}static toDate(e,t,o,i){var s=e.evaluate(t,o,i);if(s instanceof FormulaError)throw s;wijmo_1.isPrimitive(s)||(s=s.value);return wijmo_1.isDate(s)?s:wijmo_1.isNumber(s)?FlexSheet._fromOADate(s):wijmo_1.changeType(s,wijmo_1.DataType.Date,"")}static isDateValue(e){let t,o=["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];wijmo_1.isPrimitive(e)||(e=e.value);if(!(t=wijmo_1.isDate(e))&&wijmo_1.isString(e)&&!wijmo_1.isNullOrWhiteSpace(e)&&isNaN(e)&&!(t=!isNaN(Date.parse(e))))for(let i in o)if(e.indexOf(o[i])>-1){t=!0;break}return t}_updateCellRangeExp(e,t,o,i,s,l){return!1}_moveCellRangeExp(e,t,o,i=!1,s=!1){return!1}_updateCellRangeExpForReorderingRows(e){return!1}_updateCellBoundary(e,t){return!1}_getStringExpression(){return null==this._token.value?"":wijmo_1.isString(this._token.value)?'"'+this._token.value+'"':this._token.value.toString()}}exports._Expression=_Expression;class _UnaryExpression extends _Expression{constructor(e,t){super(e);this._expr=t}evaluate(e,t,o){if(this._expr.token.tokenType===_TokenType.ERROR)throw this._expr.token.value;if(this.token.tokenID===_TokenID.SUB){if(null==this._evaluatedValue){let i=_Expression.toNumber(this._expr,e,t,o);this._evaluatedValue=wijmo_1.isString(i)?NaN:-i}return this._evaluatedValue}if(this.token.tokenID===_TokenID.ADD){if(null==this._evaluatedValue){let i=_Expression.toNumber(this._expr,e,t,o);this._evaluatedValue=wijmo_1.isString(i)?NaN:+i}return this._evaluatedValue}throw new SyntaxError(exports._ErrorMessages.BadExpression)}_updateCellRangeExp(e,t,o,i,s,l){return this._expr._updateCellRangeExp(e,t,o,i,s,l)}_moveCellRangeExp(e,t,o,i=!1,s=!1){return this._expr._moveCellRangeExp(e,t,o,i,s)}_updateCellRangeExpForReorderingRows(e){return this._expr._updateCellRangeExpForReorderingRows(e)}_getStringExpression(){return this.token.tokenID===_TokenID.SUB?(this._inGroup?"(":"")+"-"+this._expr._getStringExpression()+(this._inGroup?")":""):this.token.tokenID===_TokenID.ADD?(this._inGroup?"(":"")+"+"+this._expr._getStringExpression()+(this._inGroup?")":""):""}}exports._UnaryExpression=_UnaryExpression;class _BinaryExpression extends _Expression{constructor(e,t,o){super(e);this._leftExpr=t;this._rightExpr=o}evaluate(e,t,o){var i,s,l,n,r,a,h,d,_;if(null!=this._evaluatedValue)return this._evaluatedValue;if(this._leftExpr.token.tokenType===_TokenType.ERROR)throw this._leftExpr.token.value;if(this._rightExpr.token.tokenType===_TokenType.ERROR)throw this._rightExpr.token.value;i=_Expression.toString(this._leftExpr,e,t,o);s=_Expression.toString(this._rightExpr,e,t,o);if(this.token.tokenType===_TokenType.CONCAT){this._evaluatedValue=i+s;return this._evaluatedValue}l=this._leftExpr.evaluate(e,t,o);if(!wijmo_1.isPrimitive(l)){r=l.format;l=l.value}n=this._rightExpr.evaluate(e,t,o);if(!wijmo_1.isPrimitive(n)){a=n.format;n=n.value}if(_=_Expression.isDateValue(l)||_Expression.isDateValue(n)){h=wijmo_1.isDate(l)?FlexSheet._toOADate(l):wijmo_1.isNumber(l)?l:FlexSheet._toOADate(new Date(l));d=wijmo_1.isDate(n)?FlexSheet._toOADate(n):wijmo_1.isNumber(n)?n:FlexSheet._toOADate(new Date(n))}else{h=_Expression.toNumber(this._leftExpr,e,t,o);d=_Expression.toNumber(this._rightExpr,e,t,o)}if(this.token.tokenType===_TokenType.COMPARE){let e;e=0!==l&&wijmo_1.isNullOrWhiteSpace(l)||0!==n&&wijmo_1.isNullOrWhiteSpace(n)?l===n?0:l<n?-1:1:h-d;switch(this.token.tokenID){case _TokenID.GT:return e>0;case _TokenID.LT:return e<0;case _TokenID.GE:return e>=0;case _TokenID.LE:return e<=0;case _TokenID.EQ:if(isNaN(e)){this._evaluatedValue=i.toLowerCase()===s.toLowerCase();return this._evaluatedValue}this._evaluatedValue=0===e;return this._evaluatedValue;case _TokenID.NE:if(isNaN(e)){this._evaluatedValue=i.toLowerCase()!==s.toLowerCase();return this._evaluatedValue}this._evaluatedValue=0!==e;return this._evaluatedValue}}switch(this.token.tokenID){case _TokenID.ADD:this._evaluatedValue=h+d;break;case _TokenID.SUB:this._evaluatedValue=h-d;break;case _TokenID.MUL:this._evaluatedValue=h*d;break;case _TokenID.DIV:if(0===d)throw this._evaluatedValue=new DivideByZeroError;this._evaluatedValue=h/d;break;case _TokenID.DIVINT:if(0===d)throw this._evaluatedValue=new DivideByZeroError;this._evaluatedValue=Math.floor(h/d);break;case _TokenID.MOD:if(0===d)throw this._evaluatedValue=new DivideByZeroError;this._evaluatedValue=Math.floor(h%d);break;case _TokenID.POWER:0===d&&(this._evaluatedValue=1);.5===d&&(this._evaluatedValue=Math.sqrt(h));1===d&&(this._evaluatedValue=h);2===d&&(this._evaluatedValue=h*h);3===d&&(this._evaluatedValue=h*h*h);4===d&&(this._evaluatedValue=h*h*h*h);this._evaluatedValue=Math.pow(h,d);break;default:this._evaluatedValue=NaN}if(!isNaN(this._evaluatedValue)){_&&(this._evaluatedValue={value:FlexSheet._fromOADate(this._evaluatedValue),format:r||a});return this._evaluatedValue}throw new SyntaxError(exports._ErrorMessages.BadExpression)}_updateCellRangeExp(e,t,o,i,s,l){let n,r=!1;n=this._leftExpr._updateCellRangeExp(e,t,o,i,s,l);r=r||n;n=this._rightExpr._updateCellRangeExp(e,t,o,i,s,l);return r||n}_moveCellRangeExp(e,t,o,i=!1,s=!1){let l,n=!1;l=this._leftExpr._moveCellRangeExp(e,t,o,i,s);n=n||l;l=this._rightExpr._moveCellRangeExp(e,t,o,i,s);return n||l}_updateCellRangeExpForReorderingRows(e){let t,o=!1;t=this._leftExpr._updateCellRangeExpForReorderingRows(e);o=o||t;t=this._rightExpr._updateCellRangeExpForReorderingRows(e);return o||t}_getStringExpression(){let e;switch(this.token.tokenID){case _TokenID.GT:e=">";break;case _TokenID.LT:e="<";break;case _TokenID.GE:e=">=";break;case _TokenID.LE:e="<=";break;case _TokenID.EQ:e="=";break;case _TokenID.NE:e="<>";break;case _TokenID.ADD:e="+";break;case _TokenID.SUB:e="-";break;case _TokenID.MUL:e="*";break;case _TokenID.DIV:e="/";break;case _TokenID.DIVINT:e="\\";break;case _TokenID.POWER:e="^";break;case _TokenID.CONCAT:e="&";break;default:return""}return(this._inGroup?"(":"")+this._leftExpr._getStringExpression()+e+this._rightExpr._getStringExpression()+(this._inGroup?")":"")}}exports._BinaryExpression=_BinaryExpression;class _CellRangeExpression extends _Expression{constructor(e,t,o,i=!0,s=!1,l=!1,n=!1,r=!1,a){super();this._cells=new wijmo_grid_1.CellRange(e.topRow,e.leftCol,e.bottomRow,e.rightCol);this._sheetRef=t;this._flex=o;this._evalutingRange={};this._isCellRange=i;this._absRow=s;this._absCol=l;this._absRow2=n;this._absCol2=r;this._isWholeRow=a}evaluate(e,t,o){let i=this._cells.clone();if(null==this._evaluatedValue){if(null!=this._isWholeRow)if(this._isWholeRow){i.col=0;i.col2=o?o.grid.columns.length-1:this._flex.columns.length-1}else{i.row=0;i.row2=o?o.grid.rows.length-1:this._flex.rows.length-1}this._evaluatedValue=this._getCellValue(i,o,e,t)}return this._evaluatedValue}getValues(e=!0,t,o){var i,s,l,n,r,a=[],h=0;if(!(o=this._getSheet()||o||this._flex.selectedSheet))return null;r=this._cells.clone();if(null!=this._isWholeRow)if(this._isWholeRow){r.col=0;r.col2=o.grid.columns.length-1}else{r.row=0;r.row2=o.grid.rows.length-1}l=null==t||isNaN(+t)?r.leftCol:t;n=null==t||isNaN(+t)?r.rightCol:t;for(s=r.topRow;s<=r.bottomRow&&s<o.grid.rows.length;s++)if(e||!1!==o.grid.rows[s].isVisible)for(t=l;t<=n&&t<o.grid.columns.length;t++){i=this._getCellValue(new wijmo_grid_1.CellRange(s,t),o);wijmo_1.isPrimitive(i)||(i=i.value);a[h]=i;h++}return a}getValuseWithTwoDimensions(e=!0,t){var o,i,s,l,n,r=[],a=0,h=0;if(!(t=this._getSheet()||t||this._flex.selectedSheet))return null;n=this._cells.clone();if(null!=this._isWholeRow)if(this._isWholeRow){n.col=0;n.col2=t.grid.columns.length-1}else{n.row=0;n.row2=t.grid.rows.length-1}for(s=n.topRow;s<=n.bottomRow&&s<t.grid.rows.length;s++)if(e||!1!==t.grid.rows[s].isVisible){i=[];h=0;for(l=n.leftCol;l<=n.rightCol&&l<t.grid.columns.length;l++)if(e||!1!==t.grid.columns[l].isVisible){o=this._getCellValue(new wijmo_grid_1.CellRange(s,l),t);wijmo_1.isPrimitive(o)||(o=o.value);i[h]=o;h++}else h++;r[a]=i;a++}else a++;return r}get cells(){return this._cells}get sheetRef(){return this._sheetRef}_getCellValue(e,t,o,i){var s,l,n,r,a;if(!(t=this._getSheet()||t||this._flex.selectedSheet))return null;if(e.isSingleCell){l=e.row;n=e.col}else{if(null!=o&&o>=e.topRow&&o<=e.bottomRow&&e.col===e.col2){l=o;n=e.col}if(null!=i&&i>=e.leftCol&&i<=e.rightCol&&e.row===e.row2){l=e.row;n=i}}if(null==l||null==n)throw new ReferenceError(exports._ErrorMessages.InvalidCellRef);s=t.name+":"+l+","+n+"-"+l+","+n;if(this._evalutingRange[s])throw new SyntaxError(exports._ErrorMessages.CircRef);try{if(this._flex){this._evalutingRange[s]=!0;let e=t===this._flex.selectedSheet?this._flex:t.grid;if(l<e.rows.length&&n<e.columns.length){r=t.grid.columns[n];if((a=this._flex.getCellValue(l,n,!1,t))instanceof FormulaError)throw a;r.dataMap&&(a=r.dataMap.getDisplayValue(a));return a}return 0}}finally{delete this._evalutingRange[s]}}_getSheet(){var e,t=0;if(!this._sheetRef)return null;for(;t<this._flex.sheets.length;t++)if((e=this._flex.sheets[t]).name.toLowerCase()===this._sheetRef)return e;throw new ReferenceError(exports._ErrorMessages.InvalidSheetRef)}_updateCellRangeExp(e,t,o,i,s,l){let n=this._cells,r=!1;if(this._tableParams&&this._tableParams.length>0)return!1;if(e===this._flex.selectedSheetIndex){if(this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1}else if(!this._sheetRef||this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;if(s){if(null==this._isWholeRow||this._isWholeRow){if(l&&(n.leftCol>l.rightCol||n.rightCol<l.leftCol))return!1;if(i){if(n.topRow>=t){n.row+=o;n.row2+=o;r=!0}else if(n.topRow<t&&n.bottomRow>=t){n.row2+=o;r=!0}}else if(n.topRow>t){n.row-=o;n.row2-=o;r=!0}else if(n.isSingleCell){if(n.row>=t-o+1){n.row=t-o+1;n.row2=t-o+1;r=!0}}else if(n.topRow>=t-o+1){n.row=t-o+1;n.row2-=o;r=!0}else if(n.topRow<t-o+1&&n.bottomRow>=t-o+1){n.bottomRow>t?n.row2-=o:n.row2=t-o;r=!0}}}else if(null==this._isWholeRow||!this._isWholeRow){if(l&&(n.topRow>l.bottomRow||n.bottomRow<l.topRow))return!1;if(i){if(n.leftCol>=t){n.col+=o;n.col2+=o;r=!0}else if(n.leftCol<t&&n.rightCol>=t){n.col2+=o;r=!0}}else if(n.leftCol>t){n.col-=o;n.col2-=o;r=!0}else if(n.isSingleCell){if(n.col>=t-o+1){n.col=t-o+1;n.col2=t-o+1;r=!0}}else if(n.leftCol>=t-o+1){n.col=t-o+1;n.col2-=o;r=!0}else if(n.leftCol<t-o+1&&n.rightCol>=t-o+1){n.rightCol>t?n.col2-=o:n.col2=t-o;r=!0}}return r}_moveCellRangeExp(e,t,o,i=!1,s=!1){let l,n,r=this._cells,a=!1;if(this._tableParams&&this._tableParams.length>0)return!1;if(this._flex.selectedSheetIndex!=e&&(!this._sheetRef||this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase()))return!1;if(!s&&this._flex.selectedSheetIndex==e&&this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;l=o.topRow-t.topRow;n=o.leftCol-t.leftCol;if(s){if(0!==l&&(null==this._isWholeRow||this._isWholeRow)){r.row+=s&&this._absRow?0:l;r.row2+=this._isCellRange?s&&this._absRow2?0:l:s&&this._absRow?0:l;a=!0}if(0!==n&&(null==this._isWholeRow||!this._isWholeRow)){r.col+=s&&this._absCol?0:n;r.col2+=this._isCellRange?s&&this._absCol2?0:n:s&&this._absCol?0:n;a=!0}return a}if(t.contains(r)){if(0!==l&&(null==this._isWholeRow||this._isWholeRow)){r.row+=l;r.row2+=l;a=!0}if(0!==n&&(null==this._isWholeRow||!this._isWholeRow)){r.col+=n;r.col2+=n;a=!0}}else if(t.intersects(r)){if(t.intersectsRow(r)){var h=t.topRow>=r.topRow&&t.bottomRow<=r.bottomRow;if(0!==l&&(null==this._isWholeRow||this._isWholeRow))if(t.topRow<=r.topRow){if(l<0){r.row+=l;a=!0}else if(l>0){var d=h&&o.bottomRow<r.bottomRow;if(i&&!d){t.topRow<r.topRow&&(r.row-=r.topRow-t.topRow);r.row2-=t.rowSpan;a=!0}}}else if(t.bottomRow>=r.bottomRow){if(l>0){r.row2+=l;a=!0}else if(l<0){var _=h&&o.topRow>r.topRow;if(i&&!_){t.bottomRow>r.bottomRow&&(r.row2+=t.bottomRow-r.bottomRow);r.row+=t.rowSpan;a=!0}}}else if(i){l<0&&o.topRow<=r.topRow&&(r.row+=t.rowSpan);l>0&&o.bottomRow>=r.bottomRow&&(r.row2-=t.rowSpan);a=!0}}if(t.intersectsColumn(r)&&0!==n&&(null==this._isWholeRow||!this._isWholeRow))if(t.leftCol<=r.leftCol){if(n<0){r.col+=n;a=!0}else if(n>0&&i){t.leftCol<r.leftCol&&(r.col-=r.leftCol-t.leftCol);r.col2-=t.columnSpan;a=!0}}else if(t.rightCol>=r.rightCol){if(n>0){r.col2+=n;a=!0}else if(n<0&&i){t.rightCol>r.rightCol&&(r.col2+=t.rightCol-r.rightCol);r.col+=t.columnSpan;a=!0}}else if(i){n<0?r.col+=t.columnSpan:r.col2-=t.columnSpan;a=!0}}else if(i){if(null==this._isWholeRow||this._isWholeRow)if(r.row!==r.row2&&r.containsRow(o.topRow)){l<0?r.row2+=o.rowSpan:r.row=Math.max(0,r.row-o.rowSpan);a=!0}else{if(r.topRow>=o.topRow&&r.topRow<t.topRow&&l<0){r.row+=o.rowSpan;r.row2+=o.rowSpan;a=!0}if(r.topRow>t.bottomRow&&r.bottomRow<=o.bottomRow&&l>0){r.row-=o.rowSpan;r.row2-=o.rowSpan;a=!0}}if(null==this._isWholeRow||!this._isWholeRow)if(r.col!==r.col2&&r.containsColumn(o.leftCol)){n<0?r.col2+=o.columnSpan:r.col=Math.max(0,r.col-o.columnSpan);a=!0}else{if(r.leftCol>=o.leftCol&&r.leftCol<t.leftCol&&n<0){r.col+=o.columnSpan;r.col2+=o.columnSpan;a=!0}if(r.leftCol>t.rightCol&&r.rightCol<=o.rightCol&&n>0){r.col-=o.columnSpan;r.col2-=o.columnSpan;a=!0}}}return a}_updateCellRangeExpForReorderingRows(e){let t,o=this._cells;if(null==this._isWholeRow||this._isWholeRow){(t=this._cells.row+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1);o.row=t;this._isCellRange&&((t=this._cells.row2+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1));o.row2=t}return!0}_updateCellBoundary(e,t){let o=this._cells;if(this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;if(o.row===o.row2&&o.row===e&&t===o.col2+1){o.col2+=1;return!0}if(o.col===o.col2&&o.col===t&&e===o.row2+1){o.row2+=1;return!0}return!1}_getStringExpression(){return this._tableParams&&this._tableParams.length>0?this._getTableParamsStringExpression():(this._sheetRef?this._sheetRef+"!":"")+wijmo_xlsx_1.Workbook.xlsxAddress(this._cells.row,this._cells.col,this._absRow,this._absCol,this._isWholeRow)+(this._isCellRange?":"+wijmo_xlsx_1.Workbook.xlsxAddress(this._cells.row2,this._cells.col2,this._absRow2,this._absCol2,this._isWholeRow):"")}_getTableParamsStringExpression(){let e,t=0,o="",i=this._tableParams.length,s=!1;for(;t<i;t++)if("#"===(e=this._tableParams[t])[0]){o+="["+e+"]";t<i-1&&(o+=", ")}else if(s)o+=": ["+e+"]";else{o+="["+e+"]";s=!0}i>1&&(o="["+o+"]");this._tableName&&(o=this._tableName+o);return o}}exports._CellRangeExpression=_CellRangeExpression;class _FunctionExpression extends _Expression{constructor(e,t,o,i=!0){super();this._funcId=e;this._funcDefinition=t;this._params=o;this._needCacheEvaluatedVal=i}evaluate(e,t,o){if(!this._needCacheEvaluatedVal)return this._funcDefinition.func(this._params,o,e,t);null==this._evaluatedValue&&(this._evaluatedValue=this._funcDefinition.func(this._params,o,e,t));return this._evaluatedValue}_updateCellRangeExp(e,t,o,i,s,l){let n,r,a,h=!1;if(this._params&&this._params.length>0)for(n=0;n<this._params.length;n++){a=(r=this._params[n])._updateCellRangeExp(e,t,o,i,s,l);h||(h=h||a)}return h}_moveCellRangeExp(e,t,o,i=!1,s=!1){let l,n,r,a=!1;if(this._params&&this._params.length>0)for(l=0;l<this._params.length;l++){r=(n=this._params[l])._moveCellRangeExp(e,t,o,i,s);a||(a=a||r)}return a}_updateCellRangeExpForReorderingRows(e){let t,o,i,s=!1;if(this._params&&this._params.length>0)for(t=0;t<this._params.length;t++){i=(o=this._params[t])._updateCellRangeExpForReorderingRows(e);s||(s=s||i)}return s}_updateCellBoundary(e,t){let o;return!!(this._params&&1===this._params.length&&(o=this._params[0])instanceof _CellRangeExpression)&&o._updateCellBoundary(e,t)}_getStringExpression(){return this._funcId+this._parseParamsExpToString()}_parseParamsExpToString(){let e,t,o;if(this._params&&this._params.length>0){o="";for(e=0;e<this._params.length;e++){0===e&&(o+="(");o+=(t=this._params[e])._getStringExpression();e<this._params.length-1?o+=", ":o+=")"}return o}return"()"}}exports._FunctionExpression=_FunctionExpression;class _CalcEngine{constructor(e){this._expressionCache={};this._idChars="$:!";this._functionTable={};this._cacheSize=0;this._tableRefStart=!1;this.unknownFunction=new wijmo_1.Event;this._owner=e;this._buildSymbolTable();this._registerAggregateFunction();this._registerMathFunction();this._registerLogicalFunction();this._registerTextFunction();this._registerDateFunction();this._registLookUpReferenceFunction();this._registFinacialFunction();this._registAddressRelatedFunction();this._registerErrorFunctions()}onUnknownFunction(e,t){var o,i;if(t&&t.length>0){o=[];for(var s=0;s<t.length;s++)o[s]=t[s].evaluate(this._rowIndex,this._columnIndex)}i=new UnknownFunctionEventArgs(e,o);this.unknownFunction.raise(this,i);if(null!=i.value)return new _Expression(i.value);throw new NameError(exports._ErrorMessages.UnkFuncName(e))}evaluate(e,t,o,i,s){var l,n;if(!this._owner.enableFormulas)return e;try{if(_isFormula(e)){this._containsCellRef=!1;this._rowIndex=i;this._columnIndex=s;this._sheet=o||this._owner.selectedSheet;n=(l=this._checkCache(e)).evaluate(i,s,o);for(;n instanceof _Expression;)n=n.evaluate(i,s,o);return t&&wijmo_1.isPrimitive(n)?wijmo_1.Globalize.format(n,t):n}return e||""}catch(e){var r=e instanceof FormulaError?e:new UnknownError(e);l&&(l._evaluatedValue=r);return r}}addCustomFunction(e,t,o,i){var s=this;e=e.toLowerCase();this._functionTable[e]=new _FunctionDefinition(e=>{var o,i=[];if(e&&e.length>0)for(var l=0;l<e.length;l++){o=e[l];i[l]=o instanceof _CellRangeExpression?o.cells:o.evaluate(s._rowIndex,s._columnIndex)}return t.apply(s,i)},i,o)}addFunction(e,t,o,i){var s=this;e=e.toLowerCase();this._functionTable[e]=new _FunctionDefinition(e=>{var o,i=[];if(e&&e.length>0)for(var l=0;l<e.length;l++){o=e[l];i[l]=o instanceof _CellRangeExpression?o.getValuseWithTwoDimensions():[[o.evaluate(s._rowIndex,s._columnIndex)]]}return t.apply(s,i)},i,o)}_clearExpressionCache(){this._expressionCache=null;this._expressionCache={};this._cacheSize=0}_parse(e){this._expression=e;this._expressLength=e?e.length:0;this._pointer=0;this._expressLength>0&&"="===this._expression[0]&&this._pointer++;return this._parseExpression()}_buildSymbolTable(){if(!this._tokenTable){this._tokenTable={};this._addToken("+",_TokenID.ADD,_TokenType.ADDSUB);this._addToken("-",_TokenID.SUB,_TokenType.ADDSUB);this._addToken("(",_TokenID.OPEN,_TokenType.GROUP);this._addToken(")",_TokenID.CLOSE,_TokenType.GROUP);this._addToken("*",_TokenID.MUL,_TokenType.MULDIV);this._addToken(",",_TokenID.COMMA,_TokenType.GROUP);this._addToken(".",_TokenID.PERIOD,_TokenType.GROUP);this._addToken("/",_TokenID.DIV,_TokenType.MULDIV);this._addToken("\\",_TokenID.DIVINT,_TokenType.MULDIV);this._addToken("=",_TokenID.EQ,_TokenType.COMPARE);this._addToken(">",_TokenID.GT,_TokenType.COMPARE);this._addToken("<",_TokenID.LT,_TokenType.COMPARE);this._addToken("^",_TokenID.POWER,_TokenType.POWER);this._addToken("<>",_TokenID.NE,_TokenType.COMPARE);this._addToken(">=",_TokenID.GE,_TokenType.COMPARE);this._addToken("<=",_TokenID.LE,_TokenType.COMPARE);this._addToken("&",_TokenID.CONCAT,_TokenType.CONCAT);this._addToken("[",_TokenID.OPEN,_TokenType.SQUAREBRACKETS);this._addToken("]",_TokenID.CLOSE,_TokenType.SQUAREBRACKETS)}}_registerAggregateFunction(){var e=this;e._functionTable.sum=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Sum,t,o));e._functionTable.average=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Avg,t,o));e._functionTable.max=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Max,t,o));e._functionTable.min=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Min,t,o));e._functionTable.var=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Var,t,o));e._functionTable.varp=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.VarPop,t,o));e._functionTable.stdev=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.Std,t,o));e._functionTable.stdevp=new _FunctionDefinition((t,o)=>e._getAggregateResult(wijmo_1.Aggregate.StdPop,t,o));e._functionTable.count=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.Count,t,o));e._functionTable.counta=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.CountA,t,o));e._functionTable.countblank=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.ConutBlank,t,o));e._functionTable.countif=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.CountIf,t,o),2,2);e._functionTable.countifs=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.CountIfs,t,o),254,2);e._functionTable.sumif=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.SumIf,t,o),3,2);e._functionTable.sumifs=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.SumIfs,t,o),255,2);e._functionTable.rank=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.Rank,t,o),3,2);e._functionTable.product=new _FunctionDefinition((t,o)=>e._getFlexSheetAggregateResult(_FlexSheetAggregate.Product,t,o),255,1);e._functionTable.subtotal=new _FunctionDefinition((t,o)=>e._handleSubtotal(t,o),255,2);e._functionTable.dcount=new _FunctionDefinition((t,o)=>e._handleDCount(t,o),3,3);e._functionTable.sumproduct=new _FunctionDefinition((t,o)=>e._getSumProduct(t,o),255,1)}_registerMathFunction(){var e=this;e._functionTable.pi=new _FunctionDefinition(()=>Math.PI,0,0);e._functionTable.rand=new _FunctionDefinition(()=>Math.random(),0,0);e._functionTable.power=new _FunctionDefinition((t,o)=>Math.pow(_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o),_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o)),2,2);e._functionTable.atan2=new _FunctionDefinition((t,o)=>{var i=_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o),s=_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o);if(0===i&&0===s)throw new DivideByZeroError(exports._ErrorMessages.Atan2ArgsLessThanZero);return Math.atan2(s,i)},2,2);e._functionTable.mod=new _FunctionDefinition((t,o)=>{let i=_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o),s=_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o),l=Math.abs(s);if(0===l)throw new DivideByZeroError;let n=Math.abs(i)%l;s<0&&(n=-n);return n},2,2);e._functionTable.trunc=new _FunctionDefinition((t,o)=>{var i,s,l,n=_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o),r=2===t.length?_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o):0;if(0===r){l="n0";s=n>=0?Math.floor(n):Math.ceil(n)}else{l="n"+((r=r>0?Math.floor(r):Math.ceil(r))>0?r:0);i=Math.pow(10,r);s=n>=0?Math.floor(n*i)/i:Math.ceil(n*i)/i}if(null!=s)return{value:s,format:l}},2,1);["ceiling","floor"].forEach(t=>{e._functionTable[t]=new _FunctionDefinition((o,i)=>{var s,l,n=_Expression.toNumber(o[0],e._rowIndex,e._columnIndex,i),r=2===o.length?_Expression.toNumber(o[1],e._rowIndex,e._columnIndex,i):1;if(isNaN(n))throw new ValueError(exports._ErrorMessages.InvalidParameter("number"));if(isNaN(r))throw new ValueError(exports._ErrorMessages.InvalidParameter("significance"));if(n>0&&r<0)throw new NumericError(exports._ErrorMessages.InvalidParameter("significance"));if(0===n||0===r)return 0;l=1;if(0!==(s=r-Math.floor(r)))for(;s<1;){l*=10;s*=10}return r*l*("ceiling"===t?Math.ceil(n/r):Math.floor(n/r))/l},2,1)});["round","rounddown","roundup"].forEach(t=>{e._functionTable[t]=new _FunctionDefinition((o,i)=>{var s,l,n,r,a=_Expression.toNumber(o[0],e._rowIndex,e._columnIndex,i),h=_Expression.toNumber(o[1],e._rowIndex,e._columnIndex,i);if(0===h){switch(t){case"rounddown":s=a>=0?Math.floor(a):Math.ceil(a);break;case"roundup":s=a>=0?Math.ceil(a):Math.floor(a);break;case"round":r=a>=0?0:.1;s=Math.round(a-r);break;default:s=Math.floor(a)}l="n0"}else{h=h>0?Math.floor(h):Math.ceil(h);n=Math.pow(10,h);switch(t){case"rounddown":s=a>=0?Math.floor(a*n)/n:Math.ceil(a*n)/n;break;case"roundup":s=a>=0?Math.ceil(a*n)/n:Math.floor(a*n)/n;break;case"round":r=a>=0?0:1*n/10;s=Math.round(a*n-r)/n}l="n"+(h>0?h:0)}if(null!=s)return{value:s,format:l}},2,2)});["abs","acos","asin","atan","cos","exp","ln","sin","sqrt","tan"].forEach(t=>{e._functionTable[t]=new _FunctionDefinition((o,i)=>"ln"===t?Math.log(_Expression.toNumber(o[0],e._rowIndex,e._columnIndex,i)):Math[t](_Expression.toNumber(o[0],e._rowIndex,e._columnIndex,i)),1,1)})}_registerLogicalFunction(){var e=this;e._functionTable.and=new _FunctionDefinition((t,o)=>{var i,s=!0;for(i=0;i<t.length&&(s=s&&_Expression.toBoolean(t[i],e._rowIndex,e._columnIndex,o));i++);return s},Number.MAX_VALUE,1);e._functionTable.or=new _FunctionDefinition((t,o)=>{var i,s=!1;for(i=0;i<t.length&&!(s=s||_Expression.toBoolean(t[i],e._rowIndex,e._columnIndex,o));i++);return s},Number.MAX_VALUE,1);e._functionTable.not=new _FunctionDefinition((t,o)=>!_Expression.toBoolean(t[0],e._rowIndex,e._columnIndex,o),1,1);e._functionTable.if=new _FunctionDefinition((t,o)=>3===t.length?_Expression.toBoolean(t[0],e._rowIndex,e._columnIndex,o)?t[1].evaluate(e._rowIndex,e._columnIndex,o):t[2].evaluate(e._rowIndex,e._columnIndex,o):!!_Expression.toBoolean(t[0],e._rowIndex,e._columnIndex,o)&&t[1].evaluate(e._rowIndex,e._columnIndex,o),3,2);e._functionTable.true=new _FunctionDefinition(()=>!0,0,0);e._functionTable.false=new _FunctionDefinition(()=>!1,0,0)}_registerTextFunction(){var e=this;e._functionTable.char=new _FunctionDefinition((t,o)=>{var i,s="";for(i=0;i<t.length;i++)s+=String.fromCharCode(_Expression.toNumber(t[i],e._rowIndex,e._columnIndex,o));return s},Number.MAX_VALUE,1);e._functionTable.code=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);return i&&i.length>0?i.charCodeAt(0):-1},1,1);e._functionTable.concatenate=new _FunctionDefinition((t,o)=>{var i,s="";for(i=0;i<t.length;i++)s=s.concat(_Expression.toString(t[i],e._rowIndex,e._columnIndex,o));return s},Number.MAX_VALUE,1);e._functionTable.left=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),s=null==t[1]?1:Math.floor(_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o));return i&&i.length>0?i.slice(0,s):null},2,1);e._functionTable.right=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),s=null==t[1]?1:Math.floor(_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o));return i&&i.length>0?s?i.slice(-s):"":null},2,1);e._functionTable.find=new _FunctionDefinition((t,o)=>{var i,s=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),l=_Expression.toString(t[1],e._rowIndex,e._columnIndex,o),n=null!=t[2]?wijmo_1.asInt(_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o)):0;return null!=l&&null!=s&&(i=!isNaN(n)&&n>0&&n<=l.length?l.indexOf(s,n-1):l.indexOf(s))>-1?i+1:-1},3,2);e._functionTable.search=new _FunctionDefinition((t,o)=>{var i,s,l,n=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),r=_Expression.toString(t[1],e._rowIndex,e._columnIndex,o),a=null!=t[2]?wijmo_1.asInt(_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o)):0;if(null!=r&&null!=n){s=new RegExp(n,"i");if(!isNaN(a)&&a>0&&a<r.length){r=r.substring(a-1);i=a}else i=1;if((l=r.search(s))>-1)return l+i}return-1},3,2);e._functionTable.len=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);return null!=i?i.length:-1},1,1);e._functionTable.mid=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),s=Math.floor(_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o)),l=Math.floor(_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o));return i&&i.length>0&&s>0?i.substr(s-1,l):null},3,3);e._functionTable.lower=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);return i&&i.length>0?i.toLowerCase():null},1,1);e._functionTable.upper=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);return i&&i.length>0?i.toUpperCase():null},1,1);e._functionTable.proper=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);if(i&&i.length>0){i=(i=i.toLowerCase())[0].toUpperCase()+i.substring(1);for(var s=1;s<i.length;s++)if(rgLetter.test(i[s])&&!rgLetter.test(i[s-1])){i=i.substr(0,s)+i[s].toUpperCase()+i.substring(s+1);s++}return i}return null},1,1);e._functionTable.trim=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);return i&&i.length>0?i.trim().replace(/\s+/gm," "):null},1,1);e._functionTable.replace=new _FunctionDefinition((t,o)=>{var i=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),s=Math.floor(_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o)),l=Math.floor(_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o)),n=_Expression.toString(t[3],e._rowIndex,e._columnIndex,o);return i&&i.length>0&&s>0?i.substring(0,s-1)+n+i.slice(s-1+l):null},4,4);e._functionTable.substitute=new _FunctionDefinition((t,o)=>{var i,s=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),l=_Expression.toString(t[1],e._rowIndex,e._columnIndex,o),n=_Expression.toString(t[2],e._rowIndex,e._columnIndex,o),r=4===t.length?_Expression.toNumber(t[3],e._rowIndex,e._columnIndex,o):null,a=0;if(null!=r&&r<1||isNaN(r))throw new ValueError(exports._ErrorMessages.InvalidParameter("instance_num"));if(s&&s.length>0&&l&&l.length>0){i=new RegExp(l,"g");return s.replace(i,e=>{a++;if(null!=r){r=Math.floor(r);return a===r?n:e}return n})}return null},4,3);e._functionTable.rept=new _FunctionDefinition((t,o)=>{var i,s=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o),l=Math.floor(_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o)),n="";if(s&&s.length>0&&l>0)for(i=0;i<l;i++)n=n.concat(s);return n},2,2);e._functionTable.text=new _FunctionDefinition((t,o)=>{var i,s=t[0].evaluate(e._rowIndex,e._columnIndex,o),l=_Expression.toString(t[1],e._rowIndex,e._columnIndex,o);!wijmo_1.isPrimitive(s)&&s&&(s=s.value);if(wijmo_1.isDate(s))l=l.replace(/\[\$\-.+\]/g,"").replace(/(\\)(.)/g,"$2").replace(/H+/g,e=>e.toLowerCase()).replace(/m+/g,e=>e.toUpperCase()).replace(/S+/g,e=>e.toLowerCase()).replace(/AM\/PM/gi,"tt").replace(/A\/P/gi,"t").replace(/\.000/g,".fff").replace(/\.00/g,".ff").replace(/\.0/g,".f").replace(/\\[\-\s,]/g,e=>e.substring(1)).replace(/Y+/g,e=>e.toLowerCase()).replace(/D+/g,e=>e.toLowerCase()).replace(/M+:?|:?M+/gi,e=>e.indexOf(":")>-1?e.toLowerCase():e).replace(/g+e/gi,e=>e.substring(0,e.length-1)+"yy");else{if(!wijmo_1.isNumber(s))return s;if((i=l.match(/^(\d+)(\.\d+)?\E\+(\d+)(\.\d+)?$/))&&5===i.length)return e._parseToScientificValue(s,i[1],i[2],i[3],i[4]);/M{1,4}|d{1,4}|y{1,4}/.test(l)?s=new Date(1900,0,s-1):l&&!/[ncpfdg]\d?/i.test(l)&&(l=wijmo_xlsx_1.Workbook.fromXlsxFormat(l)[0])}if(wijmo_1.isDate(s))switch(l){case"d":return s.getDate();case"M":return s.getMonth()+1;case"y":l="yy";break;case"yyy":l="yyyy"}return wijmo_1.Globalize.format(s,l)},2,2);e._functionTable.value=new _FunctionDefinition((t,o)=>{var i,s=_Expression.toString(t[0],e._rowIndex,e._columnIndex,o);if((s=s.replace(/(\,\d{3})/g,e=>e.substring(1))).length>0){if(s[0]===wijmo_1.culture.Globalize.numberFormat.currency.symbol)return+(s=s.substring(1));if("%"===s[s.length-1])return+(s=s.substring(0,s.length-1))/100}i=+s;return isNaN(i)?_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o):i},1,1);e._functionTable.exact=new _FunctionDefinition((t,o)=>{return _Expression.toString(t[0],e._rowIndex,e._columnIndex,o)==_Expression.toString(t[1],e._rowIndex,e._columnIndex,o)},2,2)}_registerDateFunction(){var e=this;e._functionTable.now=new _FunctionDefinition(()=>({value:new Date,format:"M/d/yyyy h:mm"}),0,0);e._functionTable.today=new _FunctionDefinition(()=>{var e=new Date;return{value:new Date(e.getFullYear(),e.getMonth(),e.getDate()),format:"M/d/yyyy"}},0,0);e._functionTable.year=new _FunctionDefinition((t,o)=>{var i=_Expression.toDate(t[0],e._rowIndex,e._columnIndex,o);return!wijmo_1.isPrimitive(i)&&i?i.value:wijmo_1.isDate(i)?i.getFullYear():1900},1,1);e._functionTable.month=new _FunctionDefinition((t,o)=>{var i=_Expression.toDate(t[0],e._rowIndex,e._columnIndex,o);return!wijmo_1.isPrimitive(i)&&i?i.value:wijmo_1.isDate(i)?i.getMonth()+1:1},1,1);e._functionTable.day=new _FunctionDefinition((t,o)=>{var i=_Expression.toDate(t[0],e._rowIndex,e._columnIndex,o);return!wijmo_1.isPrimitive(i)&&i?i.value:wijmo_1.isDate(i)?i.getDate():0},1,1);e._functionTable.hour=new _FunctionDefinition((t,o)=>{var i=t[0].evaluate(e._rowIndex,e._columnIndex,o);if(wijmo_1.isNumber(i)&&!isNaN(i))return Math.floor(24*(i-Math.floor(i)));if(wijmo_1.isDate(i))return i.getHours();i=_Expression.toDate(t[0],e._rowIndex,e._columnIndex,o);!wijmo_1.isPrimitive(i)&&i&&(i=i.value);if(wijmo_1.isDate(i))return i.getHours();throw new ValueError(exports._ErrorMessages.InvalidParameter("serial_number"))},1,1);e._functionTable.time=new _FunctionDefinition((t,o)=>{var i=t[0].evaluate(e._rowIndex,e._columnIndex,o),s=t[1].evaluate(e._rowIndex,e._columnIndex,o),l=t[2].evaluate(e._rowIndex,e._columnIndex,o);if(wijmo_1.isNumber(i)&&wijmo_1.isNumber(s)&&wijmo_1.isNumber(l)){i%=24;s%=60;l%=60;return{value:new Date(0,0,0,i,s,l),format:"h:mm tt"}}throw new ValueError(exports._ErrorMessages.InvalidParameters)},3,3);e._functionTable.date=new _FunctionDefinition((t,o)=>{var i=t[0].evaluate(e._rowIndex,e._columnIndex,o),s=t[1].evaluate(e._rowIndex,e._columnIndex,o),l=t[2].evaluate(e._rowIndex,e._columnIndex,o);if(wijmo_1.isNumber(i)&&wijmo_1.isNumber(s)&&wijmo_1.isNumber(l))return{value:new Date(i,s-1,l),format:"M/d/yyyy"};throw new ValueError(exports._ErrorMessages.InvalidParameters)},3,3);e._functionTable.datedif=new _FunctionDefinition((t,o)=>{var i,s,l,n,r,a=_Expression.toDate(t[0],e._rowIndex,e._columnIndex,o),h=_Expression.toDate(t[1],e._rowIndex,e._columnIndex,o),d=t[2].evaluate(e._rowIndex,e._columnIndex,o);!wijmo_1.isPrimitive(a)&&a&&(a=a.value);!wijmo_1.isPrimitive(h)&&h&&(h=h.value);if(wijmo_1.isDate(a)&&wijmo_1.isDate(h)&&wijmo_1.isString(d)){if((i=a.getTime())>(s=h.getTime()))throw new NumericError(exports._ErrorMessages.InvalidParameter("start_date"));l=h.getDate()-a.getDate();n=h.getMonth()-a.getMonth();r=h.getFullYear()-a.getFullYear();switch(d.toUpperCase()){case"Y":return n>0?r:n<0?r-1:l>=0?r:r-1;case"M":return l>=0?12*r+n:12*r+n-1;case"D":return(s-i)/864e5;case"YM":return(n=l>=0?12*r+n:12*r+n-1)%12;case"YD":return n>0?(new Date(a.getFullYear(),h.getMonth(),h.getDate()).getTime()-a.getTime())/864e5:n<0?(new Date(a.getFullYear()+1,h.getMonth(),h.getDate()).getTime()-a.getTime())/864e5:l>=0?l:(new Date(a.getFullYear()+1,h.getMonth(),h.getDate()).getTime()-a.getTime())/864e5;case"MD":return l>=0?l:l=new Date(h.getFullYear(),h.getMonth(),0).getDate()-new Date(h.getFullYear(),h.getMonth()-1,1).getDate()+1+l;default:throw new NumericError(exports._ErrorMessages.InvalidParameter("unit"))}}throw new ValueError(exports._ErrorMessages.InvalidParameters)},3,3)}_registLookUpReferenceFunction(){var e=this;e._functionTable.column=new _FunctionDefinition((t,o,i,s)=>{var l;if(null==t)return s+1;l=t[0];if((l=e._ensureNonFunctionExpression(l,o))instanceof _CellRangeExpression)return l.cells.col+1;throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},1,0);e._functionTable.columns=new _FunctionDefinition((t,o)=>{var i=t[0];if((i=e._ensureNonFunctionExpression(i,o))instanceof _CellRangeExpression)return i.cells.columnSpan;throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},1,1);e._functionTable.row=new _FunctionDefinition((t,o,i,s)=>{var l;if(null==t)return i+1;l=t[0];if((l=e._ensureNonFunctionExpression(l,o))instanceof _CellRangeExpression)return l.cells.row+1;throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},1,0);e._functionTable.rows=new _FunctionDefinition((t,o)=>{var i=t[0];if((i=e._ensureNonFunctionExpression(i,o))instanceof _CellRangeExpression)return i.cells.rowSpan;throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},1,1);e._functionTable.choose=new _FunctionDefinition((t,o)=>{var i=_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o);if(isNaN(i))throw new ValueError(exports._ErrorMessages.InvalidParameter("index_num"));if(i<1||i>=t.length)throw new ValueError(exports._ErrorMessages.ParameterIsOutOfRange("index_num"));return t[i=Math.floor(i)].evaluate(e._rowIndex,e._columnIndex,o)},255,2);e._functionTable.index=new _FunctionDefinition((t,o)=>{var i,s=t[0],l=_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o),n=null!=t[2]?_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o):0;if(isNaN(l)||l<0)throw new ValueError(exports._ErrorMessages.InvalidParameter("row_num"));if(isNaN(n)||n<0)throw new ValueError(exports._ErrorMessages.InvalidParameter("column_num"));if((s=e._ensureNonFunctionExpression(s,o))instanceof _CellRangeExpression){if(l>(i=s.cells).rowSpan)throw new ReferenceError(exports._ErrorMessages.ParameterIsOutOfRange("row_num"));if(n>i.columnSpan)throw new ReferenceError(exports._ErrorMessages.ParameterIsOutOfRange("column_num"));if(l>0&&n>0)return e._owner.getCellValue(i.topRow+l-1,i.leftCol+n-1,!0,o);if(0===l&&0===n)return s;if(0===l)return new _CellRangeExpression(new wijmo_grid_1.CellRange(i.topRow,i.leftCol+n-1,i.bottomRow,i.leftCol+n-1),s.sheetRef,e._owner);if(0===n)return new _CellRangeExpression(new wijmo_grid_1.CellRange(i.topRow+l-1,i.leftCol,i.topRow+l-1,i.rightCol),s.sheetRef,e._owner)}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},4,2);e._functionTable.hlookup=new _FunctionDefinition((t,o)=>e._handleHLookup(t,o),4,3);e._functionTable.vlookup=new _FunctionDefinition((t,o)=>e._handleVLookup(t,o),4,3)}_registFinacialFunction(){var e=this;e._functionTable.rate=new _FunctionDefinition((t,o)=>{return{value:e._calculateRate(t,o),format:"p2"}},6,3)}_registAddressRelatedFunction(){let e=this;e._functionTable.indirect=new _FunctionDefinition((t,o)=>{let i,s,l,n,r,a,h,d,_=e._ensureNonFunctionExpression(t[0],o);if(_ instanceof _CellRangeExpression){i=_.cells;s=_.evaluate(i.row,i.col,o)}else s=_.evaluate(e._rowIndex,e._columnIndex,o);if(wijmo_1.isString(s)){if(2===(l=s.split("!")).length){n=l[0].toLowerCase();r=l[1].toLowerCase()}else r=l[0].toLowerCase();a=e._getDefinedName(r,n||e._sheet.name.toLowerCase());o=o||e._owner.selectedSheet;if(a){if(a.sheetName&&a.sheetName.toLowerCase()!==o.name.toLowerCase())throw new ReferenceError(exports._ErrorMessages.InvalidCellRef);s=a.value}if(h=e._getCellRange(s)){if(h.sheetRef){for(let t=0;t<e._owner.sheets.length;t++)if(e._owner.sheets[t].name.toLowerCase()===h.sheetRef.toLowerCase()){d=e._owner.sheets[t];break}}else d=e._owner.selectedSheet;if(d)return e._owner.getCellValue(h.cellRef.cellRange.row,h.cellRef.cellRange.col,!0,o)}}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)},2,1);e._functionTable.address=new _FunctionDefinition((t,o)=>{let i,s,l=_Expression.toNumber(t[0],e._rowIndex,e._columnIndex,o),n=_Expression.toNumber(t[1],e._rowIndex,e._columnIndex,o),r=!1,a=!1;if(isNaN(l)||!wijmo_1.isInt(l)||l<1||l>1048576)throw new ValueError(exports._ErrorMessages.InvalidParameter("row_num"));if(isNaN(n)||!wijmo_1.isInt(n)||n<1||n>16384)throw new ValueError(exports._ErrorMessages.InvalidParameter("column_num"));if(null!=t[2]){i=_Expression.toNumber(t[2],e._rowIndex,e._columnIndex,o);if(isNaN(i)||!wijmo_1.isInt(i)||i<1||i>4)throw new ValueError(exports._ErrorMessages.InvalidParameter("abs_num"))}null!=t[4]&&(s=_Expression.toString(t[4],e._rowIndex,e._columnIndex,o));if(null==i||1===i){r=!0;a=!0}else 2===i?r=!0:3===i&&(a=!0);return(null!=s?s+"!":"")+(a?"$":"")+e._numAlpha(n)+(r?"$":"")+l.toString()},5,2)}_registerErrorFunctions(){var isError=(e,t)=>{var o;try{o=e.evaluate(this._rowIndex,this._columnIndex,t)}catch(e){e instanceof FormulaError&&(o=e)}return o};this._functionTable.iserror=new _FunctionDefinition((e,t)=>isError(e[0],t)instanceof FormulaError,1,1);this._functionTable.iserr=new _FunctionDefinition((e,t)=>{var o=isError(e[0],t);return o instanceof FormulaError&&!(o instanceof NotAvailableError)},1,1);this._functionTable.iferror=new _FunctionDefinition((e,t)=>{var o=isError(e[0],t);return o instanceof FormulaError?e[1].evaluate(this._rowIndex,this._columnIndex,t):o},2,2)}_addToken(e,t,o){var i=new _Token(e,t,o);this._tokenTable[e]=i}_parseExpression(){this._getToken();return this._parseCompareOrConcat()}_parseCompareOrConcat(){for(var e,t,o=this._parseAddSub();this._token.tokenType===_TokenType.COMPARE||this._token.tokenType===_TokenType.CONCAT;){e=this._token;this._getToken();t=this._parseAddSub();o=new _BinaryExpression(e,o,t)}return o}_parseAddSub(){for(var e,t,o=this._parseMulDiv();this._token.tokenType===_TokenType.ADDSUB;){e=this._token;this._getToken();t=this._parseMulDiv();o=new _BinaryExpression(e,o,t)}return o}_parseMulDiv(){for(var e,t,o=this._parsePower();this._token.tokenType===_TokenType.MULDIV;){e=this._token;this._getToken();t=this._parsePower();o=new _BinaryExpression(e,o,t)}return o}_parsePower(){for(var e,t,o=this._parseUnary();this._token.tokenType===_TokenType.POWER;){e=this._token;this._getToken();t=this._parseUnary();o=new _BinaryExpression(e,o,t)}return o}_parseUnary(){var e,t;if(this._token.tokenID===_TokenID.ADD||this._token.tokenID===_TokenID.SUB){e=this._token;this._getToken();t=this._parseAtom();return new _UnaryExpression(e,t)}return this._parseAtom()}_parseAtom(){var e,t,o,i,s,l,n,r,a,h,d,_,u,c=null;switch(this._token.tokenType){case _TokenType.LITERAL:case _TokenType.ERROR:c=new _Expression(this._token);break;case _TokenType.IDENTIFIER:e=this._token.value.toString().toLowerCase();if(t=this._functionTable[e]){o=this._getParameters();if(this._token.tokenType===_TokenType.GROUP&&this._token.tokenID===_TokenID.CLOSE){i=o?o.length:0;if(-1!==t.paramMin&&i<t.paramMin)throw new SyntaxError(exports._ErrorMessages.TooFewParameters);if(-1!==t.paramMax&&i>t.paramMax)throw new SyntaxError(exports._ErrorMessages.TooManyParameters);"rand"!==e&&("column"!==e&&"row"!==e||0!==i)||(this._containsCellRef=!0);c=new _FunctionExpression(e,t,o);break}if("true"===e||"false"===e){c=new _FunctionExpression(e,t,o,!1);break}}if(2===(h=e.split("!")).length){_=h[0];d=h[1]}else d=h[0];if(l=this._getDefinedName(d,_||this._sheet.name.toLowerCase())){if(l.sheetName&&l.sheetName!==this._sheet.name&&l.sheetName.toLowerCase()!==_)throw new NameError(exports._ErrorMessages.DefNameInvalidSheet(l.sheetName));a=this._pointer;r=this._expressLength;n=this._expression;this._pointer=0;c=this._checkCache(l.value);this._pointer=a;this._expressLength=r;this._expression=n;break}_="";if(null!=(u=this._owner._getTable(e))){if(""===(_=u.sheet.name))throw new NameError(exports._ErrorMessages.InvalidTable(e));this._getToken();if(this._token.tokenType!==_TokenType.SQUAREBRACKETS||this._token.tokenID!==_TokenID.OPEN)throw new SyntaxError(exports._ErrorMessages.InvalidTableRef);this._tableRefStart=!0;c=this._getTableReference(u,_);break}if(s=this._getCellRange(e)){this._containsCellRef=!0;c=new _CellRangeExpression(s.cellRef.cellRange,s.sheetRef,this._owner,e.indexOf(":")>-1,s.cellRef.absRow,s.cellRef.absCol,s.cellRef.absRow2,s.cellRef.absCol2,s.isWholeRow);break}o=this._getParameters();c=this.onUnknownFunction(e,o);break;case _TokenType.GROUP:if(this._token.tokenID!==_TokenID.OPEN)throw new SyntaxError(exports._ErrorMessages.ExpressionExpected);this._getToken();c=this._parseCompareOrConcat();if(this._token.tokenID!==_TokenID.CLOSE)throw new SyntaxError(exports._ErrorMessages.UnbalancedParenthesis);c._inGroup=!0;break;case _TokenType.SQUAREBRACKETS:if(this._token.tokenID!==_TokenID.OPEN)throw new ValueError(exports._ErrorMessages.TableReferencesExpected);if(null!=(u=this._sheet.findTable(this._rowIndex,this._columnIndex))){_=u.sheet.name;this._tableRefStart=!0;c=this._getTableReference(u,_,!1)}}if(null===c)throw new SyntaxError(exports._ErrorMessages.BadExpression);this._getToken();return c}_getToken(){for(var e,t,o,i,s,l,n="",r="",a=new RegExp("[　-〿぀-ゟ゠-ヿ＀-ﾟ一-龯㐀-䶿]");this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if(this._pointer>=this._expressLength)this._token=new _Token(null,_TokenID.END,_TokenType.GROUP);else{l=(t=this._expression[this._pointer])>="0"&&t<="9"||"."==t;if(!(s=t>="a"&&t<="z"||t>="A"&&t<="Z"||a.test(t))&&!l){var h=this._tokenTable[t];if(h){this._token=h;this._pointer++;if(this._pointer<this._expressLength&&(">"===t||"<"===t)&&(h=this._tokenTable[this._expression.substring(this._pointer-1,this._pointer+1)])){this._token=h;this._pointer++}return}}if(l){i=this._pointer;this._parseDigit();if(":"!==this._expression[this._pointer])return;this._pointer=i}if('"'!==t){if(("'"!==t||(r=this._parseSheetRef()))&&("#"!==t||!this._parseError()))if("#"!==t){if(!s&&!l&&"_"!==t&&this._idChars.indexOf(t)<0&&!r)throw new SyntaxError(exports._ErrorMessages.IdentifierExpected);for(e=1;e+this._pointer<this._expressLength;e++){s=(t=this._expression[this._pointer+e])>="a"&&t<="z"||t>="A"&&t<="Z"||a.test(t);l=t>="0"&&t<="9";if("'"!==t||":"!==o){o=t;if(!s&&!l&&"_"!==t&&this._idChars.indexOf(t)<0)break}else{n=r+this._expression.substring(this._pointer,this._pointer+e);this._pointer+=e;r=this._parseSheetRef();e=0}}n+=r+this._expression.substring(this._pointer,this._pointer+e);this._pointer+=e;this._token=new _Token(n,_TokenID.ATOM,_TokenType.IDENTIFIER)}else this._parseDate()}else this._parseString()}}_getTableToken(){for(var e,t,o,i="",s=!1;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if("@"===(t=this._expression[this._pointer])){i=t;this._pointer++}"["===(t=this._expression[this._pointer])&&(s=!0);for(e=1;e+this._pointer<this._expressLength;e++){t=this._expression[this._pointer+e];if(s&&","===t)throw new SyntaxError(exports._ErrorMessages.InvalidTableRef);if("]"===t)break}o=i+this._expression.substring(this._pointer+(s?1:0),this._pointer+e);this._pointer+=e+(s?1:0);this._token=new _Token(o,_TokenID.ATOM,_TokenType.IDENTIFIER)}_parseDigit(){var e,t,o=-1,i=!1,s=!1,l=0;for(e=0;e+this._pointer<this._expressLength;e++)if((t=this._expression[this._pointer+e])>="0"&&t<="9"){l=10*l+(+t-0);o>-1&&(o*=10)}else if("."===t&&o<0)o=1;else{if("E"!==t&&"e"!==t||i){if("%"===t){s=!0;e++;break}break}i=!0;"+"!==(t=this._expression[this._pointer+e+1])&&"-"!==t||e++}if(i)l=+this._expression.substring(this._pointer,this._pointer+e);else{o>1&&(l/=o);s&&(l/=100)}this._token=new _Token(l,_TokenID.ATOM,_TokenType.LITERAL);this._pointer+=e}_parseString(){var e,t,o;for(e=1;e+this._pointer<this._expressLength;e++)if('"'===(t=this._expression[this._pointer+e])){if('"'!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if('"'!==t)throw new SyntaxError(exports._ErrorMessages.CantFindFinalQuote);o=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;if("!"===this._expression[this._pointer])throw new SyntaxError(exports._ErrorMessages.IllegalCrossSheetReference);this._token=new _Token(o.replace('""','"'),_TokenID.ATOM,_TokenType.LITERAL)}_parseDate(){var e,t,o;for(e=1;e+this._pointer<this._expressLength&&"#"!==(t=this._expression[this._pointer+e]);e++);if("#"!==t)throw new SyntaxError(exports._ErrorMessages.CantFindFinalDateDelimiter);o=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;this._token=new _Token(Date.parse(o),_TokenID.ATOM,_TokenType.LITERAL)}_parseError(){var e,t=this._pointer;for(e=t+1;e<this._expressLength;e++){var o=this._expression[e],i=this._expression[e-1];if(!(o>="a"&&o<="z"||o>="A"&&o<="Z"||("0"===o||"?"===o||"!"===o||"/"===o)&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||"/"===i||"0"===i)))break}var s=e-t;if(s>3){var l=this._expression.substring(t,t+s),n=_FormulaErrorHelper.asError(l);if(n){this._token=new _Token(n,_TokenID.ATOM,_TokenType.ERROR);this._pointer+=s;return!0}}return!1}_parseSheetRef(){var e,t,o;for(e=1;e+this._pointer<this._expressLength;e++)if("'"===(t=this._expression[this._pointer+e])){if("'"!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if("'"!==t)throw new SyntaxError(exports._ErrorMessages.CantFindFinalQuote);o=this._expression.substring(this._pointer+1,this._pointer+e);this._pointer+=e+1;return"!"===this._expression[this._pointer]?o.replace(/\'\'/g,"'"):""}_getCellRange(e){var t,o,i,s,l;if(e&&(t=e.split(":")).length>0&&t.length<3){if(null==(o=this._parseCell(t[0])).cellRef)return null;s=o.cellRef.cellRange;if(null!=o.cellRef.isWholeRow&&1===t.length)return null;if(s&&2===t.length){l=(i=this._parseCell(t[1])).cellRef.cellRange;if(null!=o.cellRef.isWholeRow&&o.cellRef.isWholeRow!==i.cellRef.isWholeRow)return null;o.sheetRef&&!i.sheetRef&&(i.sheetRef=o.sheetRef);if(o.sheetRef!==i.sheetRef)throw new ReferenceError(exports._ErrorMessages.CellRefMustBeInSameSheet);if(l){s.col2=l.col;s.row2=l.row}else s=null}}return null==s?null:{cellRef:{cellRange:s,absRow:o.cellRef.absRow,absCol:o.cellRef.absCol,absRow2:i?i.cellRef.absRow:null,absCol2:i?i.cellRef.absCol:null},sheetRef:o.sheetRef,isWholeRow:o.cellRef.isWholeRow}}_parseCellRange(e){var t,o,i,s,l=-1,n=-1,r=!1,a=!1;for(t=0;t<e.length;t++)if("$"!==(i=e[t])||r){if(!(i>="a"&&i<="z"||i>="A"&&i<="Z"))break;l<0&&(l=0);l=26*l+(i.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1)}else r=!0;for(;t<e.length;t++)if("$"!==(i=e[t])||a){if(!(i>="0"&&i<="9"))break;n<0&&(n=0);n=10*n+(+i-0)}else a=!0;if(t<e.length)return null;if(n>-1&&l>-1)o=new wijmo_grid_1.CellRange(n-1,l-1);else if(-1===l){s=!0;o=new wijmo_grid_1.CellRange(n-1,0)}else if(-1===n){s=!1;o=new wijmo_grid_1.CellRange(0,l-1)}return{cellRange:o,absRow:a,absCol:r,isWholeRow:s}}_parseCell(e){var t,o,i;if((t=e.lastIndexOf("!"))>0&&t<e.length-1){i=e.substring(0,t);o=e.substring(t+1)}else{if(!(t<=0))return null;o=e}return{cellRef:this._parseCellRange(o),sheetRef:i}}_getParameters(){var e,t,o=this._pointer,i=this._token;this._getToken();if(this._token.tokenType!==_TokenType.SQUAREBRACKETS||this._token.tokenID!==_TokenID.OPEN){if(this._token.tokenID!==_TokenID.OPEN){this._pointer=o;this._token=i;return null}o=this._pointer;this._getToken();if(this._token.tokenID===_TokenID.CLOSE)return null;this._pointer=o;e=new Array;t=this._parseExpression();e.push(t);for(;this._token.tokenID===_TokenID.COMMA;){t=this._parseExpression();e.push(t)}if(this._token.tokenID!==_TokenID.CLOSE)throw new SyntaxError(exports._ErrorMessages.SyntaxError);return e}}_getTableReference(e,t,o=!0){var i,s,l=[],n=this._getTableParameter(),r=!1;if(null==n)throw new SyntaxError(exports._ErrorMessages.InvalidTableRef);l.push(n);for(;this._tableRefStart&&(this._token.tokenID===_TokenID.COMMA||":"===this._token.value);){":"===this._token.value&&(r=!0);if(null==(n=this._getTableParameter()))throw new SyntaxError(exports._ErrorMessages.InvalidTableRef);if(r){l[l.length-1]+=":"+n;r=!1}else l.push(n)}if(this._token.tokenType!==_TokenType.SQUAREBRACKETS||this._token.tokenID!==_TokenID.CLOSE)throw new SyntaxError(exports._ErrorMessages.UnbalancedSquareBrackets);this._tableRefStart=!1;i=this._getTableRange(e,l);this._containsCellRef=!0;(s=new _CellRangeExpression(i,t.toLowerCase(),this._owner))._tableParams=l;o&&(s._tableName=e.name);return s}_getTableParameter(){var e;for(this._pointer;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if("]"===this._expression[this._pointer]){this._tableRefStart=!1;return null}this._getTableToken();e=this._token.value;this._getToken();return e}_getTableRange(e,t){for(var o,i,s,l,n,r,a=0;a<t.length;a++){if(i)throw new ValueError(exports._ErrorMessages.InvalidTableRef);n=null;if("#"===(o=t[a].toLowerCase())[0]){switch(o){case"#all":n=e.getRange();break;case"#data":n=e.getRange(TableSection.Data);break;case"#headers":n=e.getRange(TableSection.Header);break;case"#totals":n=e.getRange(TableSection.Footer);break;case"#this row":l=e.getRange();if(!(this._rowIndex>=l.topRow&&this._rowIndex<=l.bottomRow))throw new ValueError(exports._ErrorMessages.RowIsOutOfTableRange(e.name));n=new wijmo_grid_1.CellRange(this._rowIndex,l.leftCol,this._rowIndex,l.rightCol);break;default:throw new ValueError(exports._ErrorMessages.InvalidTableRef)}if(null==n)throw new ValueError(exports._ErrorMessages.InvalidTableRef);if(null==s)s=n;else{s.row=s.topRow<n.topRow?s.topRow:n.topRow;s.row2=s.bottomRow>n.bottomRow?s.bottomRow:n.bottomRow}}else{i=!0;r=o.split(":");for(var h=0;h<r.length;h++){if(r.length>2)throw new ValueError(exports._ErrorMessages.InvalidTableColRef);if("@"===(o=r[h])[0]){if(null==(n=e.getRange(TableSection.Data,o.substring(1))))throw new ValueError(exports._ErrorMessages.InvalidTableRef);if(!(this._rowIndex>=n.topRow&&this._rowIndex<=n.bottomRow))throw new ValueError(exports._ErrorMessages.RowIsOutOfTableRange(name));n.row=this._rowIndex;n.row2=this._rowIndex}else if(null==(n=e.getRange(TableSection.Data,o)))throw new ValueError(exports._ErrorMessages.InvalidTableRef);0===h&&(null==s?s=n:s.col=n.col);s.col2=n.col;n=null}}}return s}_getAggregateResult(e,t,o){var i,s=this._getItemList(t,o);i=wijmo_1.getAggregate(e,s.items);s.isDate&&(i={value:i=new Date(i),format:s.format||"M/d/yyyy"});return i}_getFlexSheetAggregateResult(e,t,o){var i,s,l,n;switch(e){case _FlexSheetAggregate.Count:i=this._getItemList(t,o,!0,!1);return this._countNumberCells(i.items);case _FlexSheetAggregate.CountA:return(i=this._getItemList(t,o,!1,!1)).items.length;case _FlexSheetAggregate.ConutBlank:i=this._getItemList(t,o,!1,!0);return this._countBlankCells(i.items);case _FlexSheetAggregate.Rank:l=_Expression.toNumber(t[0],this._rowIndex,this._columnIndex,o);n=t[2]?_Expression.toNumber(t[2],this._rowIndex,this._columnIndex,o):0;if(isNaN(l))throw new ValueError(exports._ErrorMessages.InvalidParameter("number"));if(isNaN(n))throw new ValueError(exports._ErrorMessages.InvalidParameter("order"));t[1]=this._ensureNonFunctionExpression(t[1],o);if(t[1]instanceof _CellRangeExpression){i=this._getItemList([t[1]],o);return this._getRankOfCellRange(l,i.items,n)}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);case _FlexSheetAggregate.CountIf:t[0]=this._ensureNonFunctionExpression(t[0],o);if(t[0]instanceof _CellRangeExpression){i=this._getItemList([t[0]],o,!1);return this._countCellsByCriteria([i.items],[t[1]],o)}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);case _FlexSheetAggregate.CountIfs:return this._handleCountIfs(t,o);case _FlexSheetAggregate.SumIf:t[0]=this._ensureNonFunctionExpression(t[0],o);if(t[0]instanceof _CellRangeExpression){let e=!1;t[2]=this._ensureNonFunctionExpression(t[2],o);null!=t[2]&&t[2]instanceof _CellRangeExpression&&(s=this._getItemList([t[2]],o,void 0,e=!0));i=this._getItemList([t[0]],o,!1,e);return this._sumCellsByCriteria([i.items],[t[1]],s?s.items:null,o)}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);case _FlexSheetAggregate.SumIfs:return this._handleSumIfs(t,o);case _FlexSheetAggregate.Product:i=this._getItemList(t,o);return this._getProductOfNumbers(i.items)}throw"Invalid aggregate type."}_getItemList(e,t,o=!0,i=!1,s=!0,l){var n,r,a,h,d,_,u,c,g,w,m,f=new Array;for(r=0;r<e.length;r++){d=e[r];if((d=this._ensureNonFunctionExpression(d,t))instanceof _CellRangeExpression){h=d.getValues(s,l,t);if(0===r){(g=(c=d._getSheet()||t||this._sheet).getCellStyle(d.cells.topRow,d.cells.leftCol))&&(u=g.format);u||(w=c.grid.columns[d.cells.leftCol])&&(u=w.format)}e:for(a=0;a<h.length;a++){n=h[a];if(null==_&&null!=n&&!wijmo_1.isString(n)){_=wijmo_1.isDate(n);break e}}for(a=0;a<h.length;a++){n=h[a];if(i||null!=n&&""!==n){m=wijmo_1.isString(n)?_?wijmo_1.changeType(n,wijmo_1.DataType.Date,""):wijmo_1.changeType(n,wijmo_1.DataType.Number,""):n;o&&!wijmo_1.isBoolean(m)?isNaN(+m)||f.push(+m):f.push(n)}}}else{n=d instanceof _Expression?d.evaluate(this._rowIndex,this._columnIndex,t):d;wijmo_1.isPrimitive(n)||(n=n.value);if(!i&&(null==n||""===n))continue;o?isNaN(+n)||f.push(+n):f.push(n);null==_&&f.length>0&&(_=n instanceof Date)}}0===f.length&&(_=!1);return{isDate:_,items:f,format:u}}_countBlankCells(e){for(var t,o=0,i=0;o<e.length;o++)(null==(t=e[o])||wijmo_1.isString(t)&&""===t||wijmo_1.isNumber(t)&&isNaN(t))&&i++;return i}_countNumberCells(e){for(var t,o=0,i=0;o<e.length;o++)null!=(t=e[o])&&wijmo_1.isNumber(t)&&!isNaN(t)&&i++;return i}_getRankOfCellRange(e,t,o=0){var i,s=0,l=0;o?t.sort((e,t)=>isNaN(e)||isNaN(t)?-1:e-t):t.sort((e,t)=>isNaN(e)||isNaN(t)?1:t-e);for(;s<t.length;s++){i=t[s];if(!isNaN(i)){l++;if(e===i)return l}}throw new ValueError(exports._ErrorMessages.ParameterIsOutOfRange("number"))}_handleCountIfs(e,t){var o,i,s,l,n=0,r=[],a=[];if(e.length%2!=0)throw new ValueError(exports._ErrorMessages.InvalidParameters);for(;n<e.length/2;n++){i=e[2*n];if(!((i=this._ensureNonFunctionExpression(i,t))instanceof _CellRangeExpression))throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);if(0===n){if(!i.cells)throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);s=i.cells.rowSpan;l=i.cells.columnSpan}else{if(!i.cells)throw new SyntaxError(exports._ErrorMessages.InvalidCellRef);if(i.cells.rowSpan!==s||i.cells.columnSpan!==l)throw new ValueError(exports._ErrorMessages.RangesMustBeTheSame)}o=this._getItemList([i],t,!1);r[n]=o.items;a[n]=e[2*n+1]}return this._countCellsByCriteria(r,a,t)}_countCellsByCriteria(e,t,o,i){for(var s,l,n,r,a=0,h=0,d=0,_=e[0].length,u=[];h<t.length;h++)"*"===(r=_Expression.toString(t[h],this._rowIndex,this._columnIndex,o))?u.push(r):u.push(this._parseRightExpr(r));for(;a<_;a++){s=!1;e:for(h=0;h<e.length;h++){n=e[h][a];if("string"==typeof(r=u[h])){if("*"!==r&&(null==n||""===n)){s=!1;break e}if(!(s="*"===r||this.evaluate(this._combineExpr(n,r),null,o,this._rowIndex,this._columnIndex)))break e}else if(!(s=s=r.reg.test(n.toString())===r.checkMathces))break e}s&&(i?null!=(l=i[a])&&wijmo_1.isNumber(l)&&!isNaN(l)&&d++:d++)}return d}_handleSumIfs(e,t){var o,i,s,l,n,r,a=1,h=[],d=[];if(e.length%2!=1)throw new ValueError(exports._ErrorMessages.InvalidParameters);s=e[0];if(!((s=this._ensureNonFunctionExpression(s,t))instanceof _CellRangeExpression))throw new ValueError(exports._ErrorMessages.InvalidParameter("Sum_range"));if(!s.cells)throw new ValueError(exports._ErrorMessages.InvalidParameter("Sum_range"));n=s.cells.rowSpan;r=s.cells.columnSpan;i=this._getItemList([s],t,!1);for(;a<(e.length+1)/2;a++){l=e[2*a-1];if(!((l=this._ensureNonFunctionExpression(l,t))instanceof _CellRangeExpression))throw new ValueError(exports._ErrorMessages.InvalidParameter("Criteria_range"+a));if(!l.cells)throw new ValueError(exports._ErrorMessages.InvalidParameter("Criteria_range"+a));if(l.cells.rowSpan!==n||l.cells.columnSpan!==r)throw new ValueError(exports._ErrorMessages.RangesMustBeTheSame);o=this._getItemList([l],t,!1);h[a-1]=o.items;d[a-1]=e[2*a]}return this._sumCellsByCriteria(h,d,i.items,t)}_sumCellsByCriteria(e,t,o,i){var s,l,n,r,a=0,h=0,d=0,_=e[0].length,u=[];null==o&&(o=e[0]);for(;h<t.length;h++)"*"===(r=_Expression.toString(t[h],this._rowIndex,this._columnIndex,i))?u.push(r):u.push(this._parseRightExpr(r));for(;a<_;a++){l=!1;s=o[a];e:for(h=0;h<e.length;h++){n=e[h][a];if("string"==typeof(r=u[h])){if("*"!==r&&(null==n||""===n)){l=!1;break e}if(!(l="*"===r||this.evaluate(this._combineExpr(n,r),null,i,this._rowIndex,this._columnIndex)))break e}else if(!(l=r.reg.test(n.toString())===r.checkMathces))break e}l&&wijmo_1.isNumber(+s)&&!isNaN(+s)&&(d+=+s)}return d}_getProductOfNumbers(e){var t,o=0,i=1,s=!1;if(e)for(;o<e.length;o++){t=e[o];if(wijmo_1.isNumber(t)&&!isNaN(t)){i*=t;s=!0}}return s?i:0}_handleSubtotal(e,t){var o,i,s,l,n=!0,r=!0;if((o=_Expression.toNumber(e[0],this._rowIndex,this._columnIndex,t))>=1&&o<=11||o>=101&&o<=111){o>=101&&o<=111&&(n=!1);(o=wijmo_1.asEnum(o,_SubtotalFunction))!==_SubtotalFunction.CountA&&o!==_SubtotalFunction.CountAWithoutHidden||(r=!1);i=this._getItemList(e.slice(1),t,r,!1,n);switch(o){case _SubtotalFunction.Count:case _SubtotalFunction.CountWithoutHidden:return this._countNumberCells(i.items);case _SubtotalFunction.CountA:case _SubtotalFunction.CountAWithoutHidden:return i.items.length;case _SubtotalFunction.Product:case _SubtotalFunction.ProductWithoutHidden:return this._getProductOfNumbers(i.items);case _SubtotalFunction.Average:case _SubtotalFunction.AverageWithoutHidden:s=wijmo_1.Aggregate.Avg;break;case _SubtotalFunction.Max:case _SubtotalFunction.MaxWithoutHidden:s=wijmo_1.Aggregate.Max;break;case _SubtotalFunction.Min:case _SubtotalFunction.MinWithoutHidden:s=wijmo_1.Aggregate.Min;break;case _SubtotalFunction.Std:case _SubtotalFunction.StdWithoutHidden:s=wijmo_1.Aggregate.Std;break;case _SubtotalFunction.StdPop:case _SubtotalFunction.StdPopWithoutHidden:s=wijmo_1.Aggregate.StdPop;break;case _SubtotalFunction.Sum:case _SubtotalFunction.SumWithoutHidden:s=wijmo_1.Aggregate.Sum;break;case _SubtotalFunction.Var:case _SubtotalFunction.VarWithoutHidden:s=wijmo_1.Aggregate.Var;break;case _SubtotalFunction.VarPop:case _SubtotalFunction.VarPopWithoutHidden:s=wijmo_1.Aggregate.VarPop}l=wijmo_1.getAggregate(s,i.items);i.isDate&&(l=new Date(l));return l}throw new ValueError(exports._ErrorMessages.InvalidParameter("Function_num"))}_handleDCount(e,t){var o,i,s,l=e[0],n=e[2];l=this._ensureNonFunctionExpression(l,t);n=this._ensureNonFunctionExpression(n,t);if(l instanceof _CellRangeExpression&&n instanceof _CellRangeExpression){o=e[1].evaluate(this._rowIndex,this._columnIndex,t);i=this._getColumnIndexByField(l,o);return(s=this._getItemList([l],t,!0,!1,!0,i)).items&&s.items.length?this._DCountWithCriteria(s.items,l,n):0}throw new ValueError(exports._ErrorMessages.InvalidParameter("Database"))}_DCountWithCriteria(e,t,o){var i,s,l,n,r,a,h,d,_,u,c,g=o.cells,w=0;i=this._getSheet(t.sheetRef);s=this._getSheet(o.sheetRef);if(g.rowSpan>1){l=g.topRow;for(n=g.bottomRow;n>g.topRow;n--){u=[];c=[];for(r=g.leftCol;r<=g.rightCol;r++)if(null!=(h=this._owner.getCellValue(n,r,!1,s))&&""!==h){c.push(new _Expression(h));d=this._owner.getCellValue(l,r,!1,s);a=this._getColumnIndexByField(t,d);if(!(null!=(_=this._getItemList([t],i,!1,!1,!0,a)).items&&_.items.length>1))throw new ValueError("Criteria");u.push(_.items.slice(1))}w+=this._countCellsByCriteria(u,c,i,e)}return w}throw new ValueError("Criteria")}_getColumnIndexByField(e,t){var o,i,s,l,n;if(-1===(n=(o=e.cells).topRow))throw new ValueError(exports._ErrorMessages.InvalidParameter("Database"));if(wijmo_1.isInt(t)&&!isNaN(t)){if(t>=1&&t<=o.columnSpan)return s=o.leftCol+t-1}else{i=this._getSheet(e.sheetRef);for(s=o.leftCol;s<=o.rightCol;s++){l=this._owner.getCellValue(n,s,!1,i);if((t=wijmo_1.isString(t)?t.toLowerCase():t)===(l=wijmo_1.isString(l)?l.toLowerCase():l))return s}}throw new ValueError(exports._ErrorMessages.InvalidParameter("Field"))}_getSumProduct(e,t){var o,i,s,l=0,n=this._getItemListForSumProduct(e,t);if(n.length>0){i=n[0].length;s=n.length;for(var r=0;r<i;r++){o=1;for(var a=0;a<s;a++)o*=n[a][r];l+=o}}return l}_getItemListForSumProduct(e,t){var o,i,s,l,n,r,a=[new Array];for(s=0;s<e.length;s++){r=e[s];o=new Array;if((r=this._ensureNonFunctionExpression(r,t))instanceof _CellRangeExpression){n=r.getValues(!0,null,t);for(l=0;l<n.length;l++){i=n[l];o.push(+i)}}else{i=r instanceof _Expression?r.evaluate(this._rowIndex,this._columnIndex,t):r;o.push(+i)}if(s>0&&o.length!==a[0].length)throw new ValueError(exports._ErrorMessages.RangesMustBeTheSame);a[s]=o}return a}_getSheet(e){var t,o=0;if(e)for(;o<this._owner.sheets.length&&(t=this._owner.sheets[o]).name!==e;o++);return t}_parseRightExpr(e){var t,o,i=!1;if(e.indexOf("?")>-1||e.indexOf("*")>-1){if(null==(t=e.match(/=?([\?\*]*)(\w*)([\?\*]*)(\w*)([\?\*]*)/))||6!==t.length)throw new ValueError(exports._ErrorMessages.InvalidParameter("Criteria"));o=new RegExp("^"+(t[1].length>0?this._parseRegCriteria(t[1]):"")+t[2]+(t[3].length>0?this._parseRegCriteria(t[3]):"")+t[4]+(t[5].length>0?this._parseRegCriteria(t[5]):"")+"$","i");/^[<>=]/.test(e)?"="===e.trim()[0]&&(i=!0):i=!0;return{reg:o,checkMathces:i}}if(isNaN(+e))if(/^\w/.test(e))e='="'+e+'"';else{if(!/^[<>=]{1,2}\s*-?.+$/.test(e))throw new ValueError(exports._ErrorMessages.InvalidParameter("Criteria"));e=e.replace(/([<>=]{1,2})\s*(-?.+)/,'$1"$2"')}else e="="+ +e;return e}_combineExpr(e,t){(wijmo_1.isString(e)||wijmo_1.isDate(e))&&(e='"'+e+'"');return(e="="+e)+t}_parseRegCriteria(e){for(var t=0,o=0,i="";t<e.length;t++)if("*"===e[t]){if(o>0){i+="\\w{"+o+"}";o=0}i+="\\w*"}else"?"===e[t]&&o++;o>0&&(i+="\\w{"+o+"}");return i}_calculateRate(e,t){var o,i,s,l,n,r,a,h,d,_,u=0,c=0;s=_Expression.toNumber(e[0],this._rowIndex,this._columnIndex,t);l=_Expression.toNumber(e[1],this._rowIndex,this._columnIndex,t);n=_Expression.toNumber(e[2],this._rowIndex,this._columnIndex,t);r=null!=e[3]?_Expression.toNumber(e[3],this._rowIndex,this._columnIndex,t):0;a=null!=e[4]?_Expression.toNumber(e[4],this._rowIndex,this._columnIndex,t):0;i=null!=e[5]?_Expression.toNumber(e[5],this._rowIndex,this._columnIndex,t):.1;Math.abs(i)<1e-7?n*(1+s*i)+l*(1+i*a)*s+r:n*(h=Math.exp(s*Math.log(1+i)))+l*(1/i+a)*(h-1)+r;d=n+l*s+r;_=n*h+l*(1/i+a)*(h-1)+r;o=i;for(;Math.abs(d-_)>1e-7&&u<20;){i=(_*c-d*o)/(_-d);c=o;o=i;d=_;_=Math.abs(i)<1e-7?n*(1+s*i)+l*(1+i*a)*s+r:n*(h=Math.exp(s*Math.log(1+i)))+l*(1/i+a)*(h-1)+r;++u}if(Math.abs(d-_)>1e-7&&20===u)throw new NumericError(exports._ErrorMessages.RateCriteriaFails);return i}_handleHLookup(e,t){return this._handleLookup(e,t,{base:e=>e.topRow,span:e=>e.rowSpan,iterStart:e=>e.leftCol,iterEnd:e=>e.rightCol,getValue:(e,o)=>this._owner.getCellValue(e,o,!1,t)})}_handleVLookup(e,t){return this._handleLookup(e,t,{base:e=>e.leftCol,span:e=>e.columnSpan,iterStart:e=>e.topRow,iterEnd:e=>e.bottomRow,getValue:(e,o)=>this._owner.getCellValue(o,e,!1,t)})}_handleLookup(e,t,o){var i=e[0].evaluate(this._rowIndex,this._columnIndex,t),s=e[1],l=_Expression.toNumber(e[2],this._rowIndex,this._columnIndex,t),n=null==e[3]||_Expression.toBoolean(e[3],this._rowIndex,this._columnIndex,t);if(null==i||""==i)throw new ValueError(exports._ErrorMessages.InvalidParameter("Lookup_value"));if(isNaN(l)||l<0)throw new ValueError(exports._ErrorMessages.InvalidParameter("index_num"));if((s=this._ensureNonFunctionExpression(s,t))instanceof _CellRangeExpression){var r,a=s.cells;if(l>o.span(a))throw new ValueError(exports._ErrorMessages.ParameterIsOutOfRange("index_num"));n?-1===(r=this._exactMatch(i,a,!1,o))&&(r=this._approximateMatch(i,a,o)):r=this._exactMatch(i,a,!0,o);if(-1===r)throw new NotAvailableError;return o.getValue(o.base(a)+l-1,r)}throw new SyntaxError(exports._ErrorMessages.InvalidCellRef)}_exactMatch(e,t,o,i){var s,l=i.base(t);wijmo_1.isString(e)&&(e=e.toLowerCase());if(o&&wijmo_1.isString(e)&&(e.indexOf("?")>-1||e.indexOf("*")>-1)){var n=e.match(/([\?\*]*)(\w+)([\?\*]*)(\w+)([\?\*]*)/);if(null==n||6!==n.length)throw new ValueError(exports._ErrorMessages.InvalidParameter("Lookup_value"));s=new RegExp("^"+(n[1].length>0?this._parseRegCriteria(n[1]):"")+n[2]+(n[3].length>0?this._parseRegCriteria(n[3]):"")+n[4]+(n[5].length>0?this._parseRegCriteria(n[5]):"")+"$","i")}for(var r=i.iterStart(t);r<=i.iterEnd(t);r++){var a=i.getValue(l,r);if(null!=s){if(s.test(a))return r}else{wijmo_1.isString(a)&&(a=a.toLowerCase());if(e===a)return r}}return-1}_approximateMatch(e,t,o){var i=o.base(t),s=[];wijmo_1.isString(e)&&(e=e.toLowerCase());for(var l=o.iterStart(t);l<=o.iterEnd(t);l++){var n=o.getValue(i,l);n=isNaN(+n)?n:+n;s.push({value:n,index:l})}s.sort((e,t)=>{wijmo_1.isString(e.value)&&(e.value=e.value.toLowerCase());wijmo_1.isString(t.value)&&(t.value=t.value.toLowerCase());return e.value>t.value?-1:e.value===t.value?t.index-e.index:1});for(var r=0;r<s.length;r++){n=s[r];wijmo_1.isString(n.value)&&(n.value=n.value.toLowerCase());if(e>n.value)return n.index}throw new NotAvailableError}_parseToScientificValue(e,t,o,i,s){var l,n,r,a,h=0;if(Math.abs(e)>=1){n="+";l=Math.pow(10,t.length);for(;e>l;){e/=l;h+=t.length}}else{n="-";l=Math.pow(10,t.length);for(;e*l<l;){e*=l;h+=t.length}}r=wijmo_1.Globalize.format(e,"D"+t.length);if(o){if((r+=wijmo_1.Globalize.format(e-Math.floor(e),t+o).substring(1)).indexOf(".")>-1)a=r.length-1-r.indexOf(".");else{r+=".";a=0}for(;a<o.length-1;){r+="0";a++}}r+="E"+n+wijmo_1.Globalize.format(h,"D"+i.length);if(s){r+=".";for(var d=1;d<s.length;d++)r+="0"}return r}_checkCache(e,t,o,i){null!=t&&(this._sheet=this._owner.sheets[t]);null!=o&&(this._rowIndex=o);null!=i&&(this._columnIndex=i);var s=this._expressionCache[this._sheet.name+":"+e]||this._expressionCache[this._sheet.name+"_"+this._rowIndex+"_"+this._columnIndex+":"+e];if(s){if(s.token.tokenType===_TokenType.ERROR)throw s.token.value;return s}s=this._parse(e);if(this._token.tokenID!==_TokenID.END||this._token.tokenType!==_TokenType.GROUP)throw new SyntaxError(exports._ErrorMessages.InvalidExpression(e));this._cacheSize>1e4&&this._clearExpressionCache();this._expressionCache[this._sheet.name+(this._containsCellRef?"_"+this._rowIndex+"_"+this._columnIndex:"")+":"+e]=s;this._cacheSize++;return s}_ensureNonFunctionExpression(e,t){for(;e instanceof _FunctionExpression;)e=e.evaluate(this._rowIndex,this._columnIndex,t);return e}_getDefinedName(e,t){for(var o,i,s=0;s<this._owner.definedNames.length;s++)if((o=this._owner.definedNames[s]).name.toLowerCase()===e)if(o.sheetName){if(o.sheetName.toLowerCase()===t)return o}else i=o;return i}_numAlpha(e){let t=Math.floor((e-1)/26);return(t>0?this._numAlpha(t):"")+String.fromCharCode((e-1)%26+65)}}exports._CalcEngine=_CalcEngine;class _Token{constructor(e,t,o){this._value=e;this._tokenID=t;this._tokenType=o}get value(){return this._value}get tokenID(){return this._tokenID}get tokenType(){return this._tokenType}}exports._Token=_Token;class _FunctionDefinition{constructor(e,t,o){this._paramMax=Number.MAX_VALUE;this._paramMin=Number.MIN_VALUE;this._func=e;wijmo_1.isNumber(t)&&!isNaN(t)&&(this._paramMax=t);wijmo_1.isNumber(o)&&!isNaN(o)&&(this._paramMin=o)}get paramMax(){return this._paramMax}get paramMin(){return this._paramMin}get func(){return this._func}}exports._FunctionDefinition=_FunctionDefinition;!function(e){e[e.COMPARE=0]="COMPARE";e[e.ADDSUB=1]="ADDSUB";e[e.MULDIV=2]="MULDIV";e[e.POWER=3]="POWER";e[e.CONCAT=4]="CONCAT";e[e.GROUP=5]="GROUP";e[e.LITERAL=6]="LITERAL";e[e.IDENTIFIER=7]="IDENTIFIER";e[e.ERROR=8]="ERROR";e[e.SQUAREBRACKETS=9]="SQUAREBRACKETS"}(_TokenType=exports._TokenType||(exports._TokenType={}));!function(e){e[e.GT=0]="GT";e[e.LT=1]="LT";e[e.GE=2]="GE";e[e.LE=3]="LE";e[e.EQ=4]="EQ";e[e.NE=5]="NE";e[e.ADD=6]="ADD";e[e.SUB=7]="SUB";e[e.MUL=8]="MUL";e[e.DIV=9]="DIV";e[e.DIVINT=10]="DIVINT";e[e.MOD=11]="MOD";e[e.POWER=12]="POWER";e[e.CONCAT=13]="CONCAT";e[e.OPEN=14]="OPEN";e[e.CLOSE=15]="CLOSE";e[e.END=16]="END";e[e.COMMA=17]="COMMA";e[e.PERIOD=18]="PERIOD";e[e.ATOM=19]="ATOM"}(_TokenID=exports._TokenID||(exports._TokenID={}));!function(e){e[e.Count=0]="Count";e[e.CountA=1]="CountA";e[e.ConutBlank=2]="ConutBlank";e[e.CountIf=3]="CountIf";e[e.CountIfs=4]="CountIfs";e[e.Rank=5]="Rank";e[e.SumIf=6]="SumIf";e[e.SumIfs=7]="SumIfs";e[e.Product=8]="Product"}(_FlexSheetAggregate||(_FlexSheetAggregate={}));!function(e){e[e.Average=1]="Average";e[e.Count=2]="Count";e[e.CountA=3]="CountA";e[e.Max=4]="Max";e[e.Min=5]="Min";e[e.Product=6]="Product";e[e.Std=7]="Std";e[e.StdPop=8]="StdPop";e[e.Sum=9]="Sum";e[e.Var=10]="Var";e[e.VarPop=11]="VarPop";e[e.AverageWithoutHidden=101]="AverageWithoutHidden";e[e.CountWithoutHidden=102]="CountWithoutHidden";e[e.CountAWithoutHidden=103]="CountAWithoutHidden";e[e.MaxWithoutHidden=104]="MaxWithoutHidden";e[e.MinWithoutHidden=105]="MinWithoutHidden";e[e.ProductWithoutHidden=106]="ProductWithoutHidden";e[e.StdWithoutHidden=107]="StdWithoutHidden";e[e.StdPopWithoutHidden=108]="StdPopWithoutHidden";e[e.SumWithoutHidden=109]="SumWithoutHidden";e[e.VarWithoutHidden=110]="VarWithoutHidden";e[e.VarPopWithoutHidden=111]="VarPopWithoutHidden"}(_SubtotalFunction||(_SubtotalFunction={}));var rgLetter=/[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/;class _FlexSheetCellFactory extends wijmo_grid_1.CellFactory{updateCell(e,t,o,i,s){var l=e.grid,n=/^border/;e.cellType===wijmo_grid_1.CellType.Cell&&this._resetCellStyle(i);super.updateCell(e,t,o,i,s);if(s&&!s.isSingleCell){t=s.row;o=s.col}switch(e.cellType){case wijmo_grid_1.CellType.ColumnHeader:let _=e.getCellData(t,o,!0);i.textContent?i.innerHTML=i.innerHTML.replace(wijmo_1.escapeHtml(i.textContent),_).replace(i.textContent,_):i.innerHTML+=_;i.style.textAlign="center";break;case wijmo_grid_1.CellType.Cell:let u=l.selectedSheet,c=l._getBindingColumn(e,t,e.columns[o]),g=t*l.columns.length+o,w=u&&u._styledCells?u._styledCells[g]:null;if(s&&!s.isSingleCell){let e=this._getFirstVisibleCell(l,s);t=e.row;o=e.col}if(e.rows[t]instanceof HeaderRow){(e.columns[o].dataMapEditor===wijmo_grid_1.DataMapEditor.RadioButtons&&i.firstElementChild instanceof HTMLLabelElement||e.columns[o].dataType===wijmo_1.DataType.Boolean&&1===i.childElementCount&&i.firstElementChild instanceof HTMLLabelElement&&i.firstElementChild.firstElementChild instanceof HTMLInputElement&&"checkbox"===i.firstElementChild.firstElementChild.type||e.columns[o].dataType!==wijmo_1.DataType.Boolean&&!i.innerHTML)&&(i.innerHTML=wijmo_1.escapeHtml(l.getCellValue(t,o)));wijmo_1.addClass(i,"wj-header-row")}else{let _=l.getCellValue(t,o,!1),u=_isFormula(l.getCellData(t,o,!1)),g=e.rows[t]instanceof wijmo_grid_1.GroupRow,m=(w?w.format:null)||(g?null:c.format);if(l.editRange&&l.editRange.contains(t,o)){if(wijmo_1.isNumber(_)&&!c.dataMap&&!u){m&&(_=this._getFormattedValue(_,m));let e=i.querySelector("input");e&&(e.value=_)}}else if(e.columns[o].dataType===wijmo_1.DataType.Boolean){let e=i.querySelector('[type="checkbox"]');if(e){e.checked=l.getCellValue(t,o);e.disabled=e.disabled||!l.canEditCell(t,o)}}else if(c.dataMap&&!g){_=l.getCellValue(t,o,!0);let e=i.firstChild;e&&3===e.nodeType&&e.nodeValue!==_&&(e.nodeValue=_)}else if(0===i.childElementCount&&i.textContent===l.getCellData(t,o,!0)){if(""!==(_=l.getCellValue(t,o,!0))&&wijmo_1.isNumber(+_)&&!isNaN(+_)&&/[hsmy\:]/i.test(m)){let e=FlexSheet._fromOADate(+_);isNaN(e.getTime())||(_=wijmo_1.Globalize.formatDate(e,m))}if(m||!g){_=wijmo_1.isString(_)?_.replace(/^(\')(\s*[\w|=])/,"$2"):_;wijmo_1.isString(_)?_&&this._isURL(_)?i.innerHTML='<a href="'+_+'" target="_blank">'+wijmo_1.escapeHtml(_)+"</a>":i.innerHTML=wijmo_1.escapeHtml(_):i.innerHTML=_}}if(w){var r,a=i.style;for(var h in w)if("className"===h)w.className&&wijmo_1.addClass(i,w.className);else if("format"!==h&&(r=w[h]))if(!wijmo_1.hasClass(i,"wj-state-selected")&&!wijmo_1.hasClass(i,"wj-state-multi-selected")||"color"!==h&&"backgroundColor"!==h)if("whiteSpace"===h&&"normal"===r)a[h]="";else{if(n.test(h))continue;a[h]=r}else a[h]=""}var d=this._getCellBorders(l,l.selectedSheet,s||new wijmo_grid_1.CellRange(t,o));if(d)for(let e in d)i.style[e]=d[e]}if(i.style.backgroundColor||i.style.color){if(!w){w={};u&&u._styledCells[g]}i.style.backgroundColor&&(w.backgroundColor=i.style.backgroundColor);i.style.color&&(w.color=i.style.color)}}if(e.cellType===wijmo_grid_1.CellType.Cell){t!==l._lastVisibleFrozenRow||wijmo_1.hasClass(i,"wj-frozen-row")||wijmo_1.addClass(i,"wj-frozen-row");o!==l._lastVisibleFrozenColumn||wijmo_1.hasClass(i,"wj-frozen-col")||wijmo_1.addClass(i,"wj-frozen-col")}}_resetCellStyle(e){var t=e.style;t.fontFamily="";t.fontSize="";t.fontStyle="";t.fontWeight="";t.textDecoration="";t.textAlign="";t.verticalAlign="";t.backgroundColor="";t.color="";t.whiteSpace="";t.borderLeftStyle="";t.borderLeftColor="";t.borderLeftWidth="";t.borderRightStyle="";t.borderRightColor="";t.borderRightWidth="";t.borderTopStyle="";t.borderTopColor="";t.borderTopWidth="";t.borderBottomStyle="";t.borderBottomColor="";t.borderBottomWidth=""}_getFormattedValue(e,t){e!==Math.round(e)&&(t=t.replace(/([a-z])(\d*)(.*)/gi,"$0112$3"));return wijmo_1.Globalize.formatNumber(e,t,!0)}_getFirstVisibleCell(e,t){var o,i;for(o=t.topRow;o<=t.bottomRow&&!e.rows[o].isVisible;o++);for(i=t.leftCol;i<=t.rightCol&&!e.columns[i].isVisible;i++);return new wijmo_grid_1.CellRange(o,i)}_isURL(e){return new RegExp("^(https|http|ftp|rtsp|mms)://(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*").test(e)}_getCellBorders(e,t,o){let i=t&&t._styledCells;if(!i)return null;let s=o.topRow,l=o.leftCol,n=o.bottomRow,r=o.rightCol,a=e.columns.length,h=i[s*a+l],d=i[n*a+r],_=l>0?i[s*a+l-1]:null,u=r+1<a?i[s*a+r+1]:null,c=s>0?i[(s-1)*a+l]:null,g=i[(n+1)*a+l];if(!(h||d||_||u||c||g))return null;let w={},m=h&&h.borderLeftStyle&&"none"!==h.borderLeftStyle&&!(!h.borderLeftColor&&!h.borderLeftWidth),f=_&&_.borderRightStyle&&"none"!==_.borderRightStyle&&!(!_.borderRightColor&&!_.borderRightWidth);if(!m&&f||m&&f&&parseInt(_.borderRightWidth||1)>parseInt(h.borderLeftWidth||1)){if("double"!==_.borderRightStyle){w.borderLeftColor=_.borderRightColor;w.borderLeftStyle=_.borderRightStyle;w.borderLeftWidth=Math.floor(parseInt(_.borderRightWidth||1)/2)+"px"}}else if(m){w.borderLeftColor=h.borderLeftColor;w.borderLeftStyle=h.borderLeftStyle;w.borderLeftWidth="double"!==h.borderLeftStyle?Math.ceil(parseInt(h.borderLeftWidth||1)/2)+"px":w.borderLeftWidth=h.borderLeftWidth}let p=h&&h.borderTopStyle&&"none"!==h.borderTopStyle&&!(!h.borderTopColor&&!h.borderTopWidth),C=c&&c.borderBottomStyle&&"none"!==c.borderBottomStyle&&!(!c.borderBottomColor&&!c.borderBottomWidth);if(!p&&C||p&&C&&parseInt(c.borderBottomWidth||1)>parseInt(h.borderTopWidth||1)){if("double"!==c.borderBottomStyle){w.borderTopColor=c.borderBottomColor;w.borderTopStyle=c.borderBottomStyle;w.borderTopWidth=Math.floor(parseInt(c.borderBottomWidth||1)/2)+"px"}}else if(p){w.borderTopColor=h.borderTopColor;w.borderTopStyle=h.borderTopStyle;w.borderTopWidth="double"!==h.borderTopStyle?Math.ceil(parseInt(h.borderTopWidth||1)/2)+"px":h.borderTopStyle}let S=d&&d.borderRightStyle&&"none"!==d.borderRightStyle&&!(!d.borderRightColor&&!d.borderRightWidth),b=u&&u.borderLeftStyle&&"none"!==u.borderLeftStyle&&!(!u.borderLeftColor&&!u.borderLeftWidth);if(!S&&b||S&&b&&parseInt(u.borderLeftWidth||1)>=parseInt(d.borderRightWidth||1)){if("double"!==u.borderLeftStyle){w.borderRightColor=u.borderLeftColor;w.borderRightStyle=u.borderLeftStyle;w.borderRightWidth=Math.floor(parseInt(u.borderLeftWidth||1)/2)+"px"}}else if(S){w.borderRightColor=d.borderRightColor;w.borderRightStyle=d.borderRightStyle;w.borderRightWidth="double"!==d.borderRightStyle?Math.ceil(parseInt(d.borderRightWidth||1)/2)+"px":d.borderRightWidth}let R=d&&d.borderBottomStyle&&"none"!==d.borderBottomStyle&&!(!d.borderBottomColor&&!d.borderBottomWidth),x=g&&g.borderTopStyle&&"none"!==g.borderTopStyle&&!(!g.borderTopColor&&!g.borderTopWidth);if(!R&&x||R&&x&&parseInt(g.borderTopWidth||1)>=parseInt(d.borderBottomWidth||1)){if("double"!==g.borderTopStyle){w.borderBottomColor=g.borderTopColor;w.borderBottomStyle=g.borderTopStyle;w.borderBottomWidth=Math.floor(parseInt(g.borderTopWidth||1)/2)+"px"}}else if(R){w.borderBottomColor=d.borderBottomColor;w.borderBottomStyle=d.borderBottomStyle;w.borderBottomWidth="double"!==d.borderBottomStyle?Math.ceil(parseInt(d.borderBottomWidth||1)/2)+"px":d.borderBottomWidth}return w}}exports._FlexSheetCellFactory=_FlexSheetCellFactory;wijmo_1._registerModule("wijmo.grid.sheet",selfModule);