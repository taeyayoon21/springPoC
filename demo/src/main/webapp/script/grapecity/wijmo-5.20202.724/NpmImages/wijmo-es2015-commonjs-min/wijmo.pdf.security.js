/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),selfModule=require("wijmo/wijmo.pdf.security");var K_MAX_LENGTH=2147483647;function createBuffer(e){if(e>K_MAX_LENGTH)throw new RangeError('The value "'+e+'" is invalid for option "size"');var r=new Uint8Array(e);Object.setPrototypeOf(r,Buffer.prototype);return r}function Buffer(e,r,t){if("number"==typeof e){if("string"==typeof r)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,r,t)}exports.Buffer=Buffer;function from(e,r,t){if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return fromArrayBuffer(e,r,t);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(e,SharedArrayBuffer)||e&&isInstance(e.buffer,SharedArrayBuffer)))return fromArrayBuffer(e,r,t);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,r,t);var o=fromObject(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),r,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}Buffer.from=function(e,r,t){return from(e,r,t)};Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype);Object.setPrototypeOf(Buffer,Uint8Array);function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function allocUnsafe(e){assertSize(e);return createBuffer(e<0?0:0|checked(e))}function fromArrayLike(e){for(var r=e.length<0?0:0|checked(e.length),t=createBuffer(r),n=0;n<r;n+=1)t[n]=255&e[n];return t}function fromArrayBuffer(e,r,t){if(r<0||e.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<r+(t||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===r&&void 0===t?new Uint8Array(e):void 0===t?new Uint8Array(e,r):new Uint8Array(e,r,t);Object.setPrototypeOf(n,Buffer.prototype);return n}function fromObject(e){if(Buffer.isBuffer(e)){var r=0|checked(e.length),t=createBuffer(r);if(0===t.length)return t;e.copy(t,0,0,r);return t}return void 0!==e.length?"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e):"Buffer"===e.type&&Array.isArray(e.data)?fromArrayLike(e.data):void 0}function checked(e){if(e>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|e}Buffer.isBuffer=function isBuffer(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype};function slowToString(e,r,t){var n=!1;(void 0===r||r<0)&&(r=0);if(r>this.length)return"";(void 0===t||t>this.length)&&(t=this.length);if(t<=0)return"";if((t>>>=0)<=(r>>>=0))return"";e||(e="utf8");for(;;)switch(e){case"hex":return hexSlice(this,r,t);case"utf8":case"utf-8":return utf8Slice(this,r,t);case"ascii":return asciiSlice(this,r,t);case"latin1":case"binary":return latin1Slice(this,r,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,r,t);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();n=!0}}Buffer.prototype._isBuffer=!0;Buffer.prototype.toString=function toString(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)};function utf8Slice(e,r,t){t=Math.min(e.length,t);for(var n=[],o=r;o<t;){var i=e[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=t){var c,f,u,p;switch(a){case 1:i<128&&(s=i);break;case 2:128==(192&(c=e[o+1]))&&(p=(31&i)<<6|63&c)>127&&(s=p);break;case 3:c=e[o+1];f=e[o+2];128==(192&c)&&128==(192&f)&&(p=(15&i)<<12|(63&c)<<6|63&f)>2047&&(p<55296||p>57343)&&(s=p);break;case 4:c=e[o+1];f=e[o+2];u=e[o+3];128==(192&c)&&128==(192&f)&&128==(192&u)&&(p=(15&i)<<18|(63&c)<<12|(63&f)<<6|63&u)>65535&&p<1114112&&(s=p)}}if(null===s){s=65533;a=1}else if(s>65535){s-=65536;n.push(s>>>10&1023|55296);s=56320|1023&s}n.push(s);o+=a}return decodeCodePointsArray(n)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var r=e.length;if(r<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var t="",n=0;n<r;)t+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return t}function asciiSlice(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(127&e[o]);return n}function latin1Slice(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(e[o]);return n}function hexSlice(e,r,t){var n=e.length;(!r||r<0)&&(r=0);(!t||t<0||t>n)&&(t=n);for(var o="",i=r;i<t;++i)o+=hexSliceLookupTable[e[i]];return o}function utf16leSlice(e,r,t){for(var n=e.slice(r,t),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}Buffer.prototype.slice=function slice(e,r){var t=this.length;(e=~~e)<0?(e+=t)<0&&(e=0):e>t&&(e=t);(r=void 0===r?t:~~r)<0?(r+=t)<0&&(r=0):r>t&&(r=t);r<e&&(r=e);var n=this.subarray(e,r)(Object).setPrototypeOf(n,Buffer.prototype);return n};Buffer.prototype.copy=function copy(e,r,t,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");t||(t=0);n||0===n||(n=this.length);r>=e.length&&(r=e.length);r||(r=0);n>0&&n<t&&(n=t);if(n===t)return 0;if(0===e.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);e.length-r<n-t&&(n=e.length-r+t);var o=n-t;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,t,n);else if(this===e&&t<r&&r<n)for(var i=o-1;i>=0;--i)e[i+r]=this[i+t];else Uint8Array.prototype.set.call(e,this.subarray(t,n),r);return o};function isInstance(e,r){return e instanceof r||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===r.name}function numberIsNaN(e){return e!=e}var hexSliceLookupTable=function(){for(var e=new Array(256),r=0;r<16;++r)for(var t=16*r,n=0;n<16;++n)e[t+n]="0123456789abcdef"[r]+"0123456789abcdef"[n];return e}();function inRange(e,r){if(e<r[0])return!1;let t=0,n=r.length/2;for(;t<=n;){const o=Math.floor((t+n)/2),i=2*o;if(e>=r[i]&&e<=r[i+1])return!0;e>r[i+1]?t=o+1:n=o-1}return!1}exports.inRange=inRange;const unassigned_code_points=[545,545,564,591,686,687,751,767,848,863,880,883,886,889,891,893,895,899,907,907,909,909,930,930,975,975,1015,1023,1159,1159,1231,1231,1270,1271,1274,1279,1296,1328,1367,1368,1376,1376,1416,1416,1419,1424,1442,1442,1466,1466,1477,1487,1515,1519,1525,1547,1549,1562,1564,1566,1568,1568,1595,1599,1622,1631,1774,1775,1791,1791,1806,1806,1837,1839,1867,1919,1970,2304,2308,2308,2362,2363,2382,2383,2389,2391,2417,2432,2436,2436,2445,2446,2449,2450,2473,2473,2481,2481,2483,2485,2490,2491,2493,2493,2501,2502,2505,2506,2510,2518,2520,2523,2526,2526,2532,2533,2555,2561,2563,2564,2571,2574,2577,2578,2601,2601,2609,2609,2612,2612,2615,2615,2618,2619,2621,2621,2627,2630,2633,2634,2638,2648,2653,2653,2655,2661,2677,2688,2692,2692,2700,2700,2702,2702,2706,2706,2729,2729,2737,2737,2740,2740,2746,2747,2758,2758,2762,2762,2766,2767,2769,2783,2785,2789,2800,2816,2820,2820,2829,2830,2833,2834,2857,2857,2865,2865,2868,2869,2874,2875,2884,2886,2889,2890,2894,2901,2904,2907,2910,2910,2914,2917,2929,2945,2948,2948,2955,2957,2961,2961,2966,2968,2971,2971,2973,2973,2976,2978,2981,2983,2987,2989,2998,2998,3002,3005,3011,3013,3017,3017,3022,3030,3032,3046,3059,3072,3076,3076,3085,3085,3089,3089,3113,3113,3124,3124,3130,3133,3141,3141,3145,3145,3150,3156,3159,3167,3170,3173,3184,3201,3204,3204,3213,3213,3217,3217,3241,3241,3252,3252,3258,3261,3269,3269,3273,3273,3278,3284,3287,3293,3295,3295,3298,3301,3312,3329,3332,3332,3341,3341,3345,3345,3369,3369,3386,3389,3396,3397,3401,3401,3406,3414,3416,3423,3426,3429,3440,3457,3460,3460,3479,3481,3506,3506,3516,3516,3518,3519,3527,3529,3531,3534,3541,3541,3543,3543,3552,3569,3573,3584,3643,3646,3676,3712,3715,3715,3717,3718,3721,3721,3723,3724,3726,3731,3736,3736,3744,3744,3748,3748,3750,3750,3752,3753,3756,3756,3770,3770,3774,3775,3781,3781,3783,3783,3790,3791,3802,3803,3806,3839,3912,3912,3947,3952,3980,3983,3992,3992,4029,4029,4045,4046,4048,4095,4130,4130,4136,4136,4139,4139,4147,4149,4154,4159,4186,4255,4294,4303,4345,4346,4348,4351,4442,4446,4515,4519,4602,4607,4615,4615,4679,4679,4681,4681,4686,4687,4695,4695,4697,4697,4702,4703,4743,4743,4745,4745,4750,4751,4783,4783,4785,4785,4790,4791,4799,4799,4801,4801,4806,4807,4815,4815,4823,4823,4847,4847,4879,4879,4881,4881,4886,4887,4895,4895,4935,4935,4955,4960,4989,5023,5109,5120,5751,5759,5789,5791,5873,5887,5901,5901,5909,5919,5943,5951,5972,5983,5997,5997,6001,6001,6004,6015,6109,6111,6122,6143,6159,6159,6170,6175,6264,6271,6314,7679,7836,7839,7930,7935,7958,7959,7966,7967,8006,8007,8014,8015,8024,8024,8026,8026,8028,8028,8030,8030,8062,8063,8117,8117,8133,8133,8148,8149,8156,8156,8176,8177,8181,8181,8191,8191,8275,8278,8280,8286,8292,8297,8306,8307,8335,8351,8370,8399,8427,8447,8507,8508,8524,8530,8580,8591,9167,9215,9255,9279,9291,9311,9471,9471,9748,9749,9752,9752,9854,9855,9866,9984,9989,9989,9994,9995,10024,10024,10060,10060,10062,10062,10067,10069,10071,10071,10079,10080,10133,10135,10160,10160,10175,10191,10220,10223,11008,11903,11930,11930,12020,12031,12246,12271,12284,12287,12352,12352,12439,12440,12544,12548,12589,12592,12687,12687,12728,12783,12829,12831,12868,12880,12924,12926,13004,13007,13055,13055,13175,13178,13278,13279,13311,13311,19894,19967,40870,40959,42125,42127,42183,44031,55204,55295,64046,64047,64107,64255,64263,64274,64280,64284,64311,64311,64317,64317,64319,64319,64322,64322,64325,64325,64434,64466,64832,64847,64912,64913,64968,64975,65021,65023,65040,65055,65060,65071,65095,65096,65107,65107,65127,65127,65132,65135,65141,65141,65277,65278,65280,65280,65471,65473,65480,65481,65488,65489,65496,65497,65501,65503,65511,65511,65519,65528,65536,66303,66335,66335,66340,66351,66379,66559,66598,66599,66638,118783,119030,119039,119079,119081,119262,119807,119893,119893,119965,119965,119968,119969,119971,119972,119975,119976,119981,119981,119994,119994,119996,119996,120001,120001,120004,120004,120070,120070,120075,120076,120085,120085,120093,120093,120122,120122,120127,120127,120133,120133,120135,120137,120145,120145,120484,120487,120778,120781,120832,131069,173783,194559,195102,196605,196608,262141,262144,327677,327680,393213,393216,458749,458752,524285,524288,589821,589824,655357,655360,720893,720896,786429,786432,851965,851968,917501,917504,917504,917506,917535,917632,983037];exports.isUnassignedCodePoint=e=>inRange(e,unassigned_code_points);const commonly_mapped_to_nothing=[173,173,847,847,6150,6150,6155,6155,6156,6156,6157,6157,8203,8203,8204,8204,8205,8205,8288,8288,65024,65024,65025,65025,65026,65026,65027,65027,65028,65028,65029,65029,65030,65030,65031,65031,65032,65032,65033,65033,65034,65034,65035,65035,65036,65036,65037,65037,65038,65038,65039,65039,65279,65279];exports.isCommonlyMappedToNothing=e=>inRange(e,commonly_mapped_to_nothing);const non_ASCII_space_characters=[160,160,5760,5760,8192,8192,8193,8193,8194,8194,8195,8195,8196,8196,8197,8197,8198,8198,8199,8199,8200,8200,8201,8201,8202,8202,8203,8203,8239,8239,8287,8287,12288,12288];exports.isNonASCIISpaceCharacter=e=>inRange(e,non_ASCII_space_characters);const non_ASCII_controls_characters=[128,159,1757,1757,1807,1807,6158,6158,8204,8204,8205,8205,8232,8232,8233,8233,8288,8288,8289,8289,8290,8290,8291,8291,8298,8303,65279,65279,65529,65532,119155,119162],non_character_codepoints=[64976,65007,65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1114110,1114111],prohibited_characters=[0,31,127,127,832,832,833,833,8206,8206,8207,8207,8234,8234,8235,8235,8236,8236,8237,8237,8238,8238,8298,8298,8299,8299,8300,8300,8301,8301,8302,8302,8303,8303,12272,12283,55296,57343,57344,63743,65529,65529,65530,65530,65531,65531,65532,65532,65533,65533,917505,917505,917536,917631,983040,1048573,1048576,1114109];exports.isProhibitedCharacter=e=>inRange(e,non_ASCII_space_characters)||inRange(e,prohibited_characters)||inRange(e,non_ASCII_controls_characters)||inRange(e,non_character_codepoints);const bidirectional_r_al=[1470,1470,1472,1472,1475,1475,1488,1514,1520,1524,1563,1563,1567,1567,1569,1594,1600,1610,1645,1647,1649,1749,1757,1757,1765,1766,1786,1790,1792,1805,1808,1808,1810,1836,1920,1957,1969,1969,8207,8207,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65020,65136,65140,65142,65276];exports.isBidirectionalRAL=e=>inRange(e,bidirectional_r_al);const bidirectional_l=[65,90,97,122,170,170,181,181,186,186,192,214,216,246,248,544,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,1013,1024,1154,1162,1230,1232,1269,1272,1273,1280,1295,1329,1366,1369,1375,1377,1415,1417,1417,2307,2307,2309,2361,2365,2368,2377,2380,2384,2384,2392,2401,2404,2416,2434,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2494,2496,2503,2504,2507,2508,2519,2519,2524,2525,2527,2529,2534,2545,2548,2554,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2622,2624,2649,2652,2654,2654,2662,2671,2674,2676,2691,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2752,2761,2761,2763,2764,2768,2768,2784,2784,2790,2799,2818,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2878,2880,2880,2887,2888,2891,2892,2903,2903,2908,2909,2911,2913,2918,2928,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3007,3009,3010,3014,3016,3018,3020,3031,3031,3047,3058,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3137,3140,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3262,3264,3268,3271,3272,3274,3275,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3392,3398,3400,3402,3404,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3535,3537,3544,3551,3570,3572,3585,3632,3634,3635,3648,3654,3663,3675,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3792,3801,3804,3805,3840,3863,3866,3892,3894,3894,3896,3896,3902,3911,3913,3946,3967,3967,3973,3973,3976,3979,4030,4037,4039,4044,4047,4047,4096,4129,4131,4135,4137,4138,4140,4140,4145,4145,4152,4152,4160,4183,4256,4293,4304,4344,4347,4347,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4961,4988,5024,5108,5121,5750,5761,5786,5792,5872,5888,5900,5902,5905,5920,5937,5941,5942,5952,5969,5984,5996,5998,6e3,6016,6070,6078,6085,6087,6088,6100,6106,6108,6108,6112,6121,6160,6169,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8206,8206,8305,8305,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8509,8511,8517,8521,8544,8579,9014,9082,9109,9109,9372,9449,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12588,12593,12686,12688,12727,12784,12828,12832,12867,12896,12923,12927,12976,12992,13003,13008,13054,13056,13174,13179,13277,13280,13310,13312,19893,19968,40869,40960,42124,44032,55203,55296,64045,64048,64106,64256,64262,64275,64279,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500,66304,66334,66336,66339,66352,66378,66560,66597,66600,66637,118784,119029,119040,119078,119082,119142,119146,119154,119171,119172,119180,119209,119214,119261,119808,119892,119894,119964,119966,119967,119970,119970,119973,119974,119977,119980,119982,119993,119995,119995,119997,12e4,120002,120003,120005,120069,120071,120074,120077,120084,120086,120092,120094,120121,120123,120126,120128,120132,120134,120134,120138,120144,120146,120483,120488,120777,131072,173782,194560,195101,983040,1048573,1048576,1114109];exports.isBidirectionalL=e=>inRange(e,bidirectional_l);const mapping2space=exports.isNonASCIISpaceCharacter,mapping2nothing=exports.isCommonlyMappedToNothing,getCodePoint=e=>e.codePointAt(0),first=e=>e[0],last=e=>e[e.length-1];function toCodePoints(e){const r=[],t=e.length;for(let n=0;n<t;n+=1){const o=e.charCodeAt(n);if(o>=55296&&o<=56319&&t>n+1){const t=e.charCodeAt(n+1);if(t>=56320&&t<=57343){r.push(1024*(o-55296)+t-56320+65536);n+=1;continue}}r.push(o)}return r}function fromCodePoint(){if(String.fromCodePoint)return String.fromCodePoint.apply(null,arguments);for(var e=[],r=0,t="",n=0,o=arguments.length;n!==o;++n){var i=+arguments[n];if(!(i<1114111&&i>>>0===i))throw RangeError("Invalid code point: "+i);if(i<=65535)r=e.push(i);else{i-=65536;r=e.push(55296+(i>>10),i%1024+56320)}if(r>=16383){t+=String.fromCharCode.apply(null,e);e.length=0}}return t+String.fromCharCode.apply(null,e)}function saslprep(e,r={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const t=toCodePoints(e).map(e=>mapping2space(e)?32:e).filter(e=>!mapping2nothing(e)),n=fromCodePoint.apply(null,t).normalize("NFKC"),o=toCodePoints(n);if(o.some(exports.isProhibitedCharacter))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==r.allowUnassigned){if(o.some(exports.isUnassignedCodePoint))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const i=o.some(exports.isBidirectionalRAL),s=o.some(exports.isBidirectionalL);if(i&&s)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const a=exports.isBidirectionalRAL(getCodePoint(first(n))),c=exports.isBidirectionalRAL(getCodePoint(last(n)));if(i&&(!a||!c))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return n}exports.saslprep=saslprep;exports.CryptoJS=function(e,r){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto);!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto);var cryptoSecureRandomInt=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function F(){}return function(e){var r;F.prototype=e;r=new F;F.prototype=null;return r}}(),o={},i=o.lib={},s=i.Base={extend:function(e){var r=n(this);e&&r.mixIn(e);r.hasOwnProperty("init")&&this.init!==r.init||(r.init=function(){r.$super.init.apply(this,arguments)});r.init.prototype=r;r.$super=this;return r},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=s.extend({init:function(e,r){e=this.words=e||[];this.sigBytes=null!=r?r:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var r=this.words,t=e.words,n=this.sigBytes,o=e.sigBytes;this.clamp();if(n%4)for(var i=0;i<o;i++){var s=t[i>>>2]>>>24-i%4*8&255;r[n+i>>>2]|=s<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)r[n+i>>>2]=t[i>>>2];this.sigBytes+=o;return this},clamp:function(){var r=this.words,t=this.sigBytes;r[t>>>2]&=4294967295<<32-t%4*8;r.length=e.ceil(t/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(e){for(var r=[],t=0;t<e;t+=4)r.push(cryptoSecureRandomInt());return new a.init(r,e)}}),c=o.enc={},f=c.Hex={stringify:function(e){for(var r=e.words,t=e.sigBytes,n=[],o=0;o<t;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16));n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var r=e.length,t=[],n=0;n<r;n+=2)t[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(t,r/2)}},u=c.Latin1={stringify:function(e){for(var r=e.words,t=e.sigBytes,n=[],o=0;o<t;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var r=e.length,t=[],n=0;n<r;n++)t[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(t,r)}},p=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(r){var t,n=this._data,o=n.words,i=n.sigBytes,s=this.blockSize,c=i/(4*s),f=(c=r?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,u=e.min(4*f,i);if(f){for(var p=0;p<f;p+=s)this._doProcessBlock(o,p);t=o.splice(0,f);n.sigBytes-=u}return new a.init(t,u)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0}),d=(i.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){h.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(r,t){return new e.init(t).finalize(r)}},_createHmacHelper:function(e){return function(r,t){return new d.HMAC.init(e,t).finalize(r)}}}),o.algo={});return o}(Math);!function(e){var r=exports.CryptoJS,t=r.lib,n=t.WordArray,o=t.Hasher,i=r.algo,s=[];!function(){for(var r=0;r<64;r++)s[r]=4294967296*e.abs(e.sin(r+1))|0}();var a=i.MD5=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,r){for(var t=0;t<16;t++){var n=r+t,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[r+0],c=e[r+1],f=e[r+2],u=e[r+3],p=e[r+4],h=e[r+5],d=e[r+6],l=e[r+7],y=e[r+8],g=e[r+9],_=e[r+10],m=e[r+11],v=e[r+12],S=e[r+13],w=e[r+14],C=e[r+15],B=i[0],x=i[1],A=i[2],R=i[3];B=FF(B,x,A,R,a,7,s[0]);R=FF(R,B,x,A,c,12,s[1]);A=FF(A,R,B,x,f,17,s[2]);x=FF(x,A,R,B,u,22,s[3]);B=FF(B,x,A,R,p,7,s[4]);R=FF(R,B,x,A,h,12,s[5]);A=FF(A,R,B,x,d,17,s[6]);x=FF(x,A,R,B,l,22,s[7]);B=FF(B,x,A,R,y,7,s[8]);R=FF(R,B,x,A,g,12,s[9]);A=FF(A,R,B,x,_,17,s[10]);x=FF(x,A,R,B,m,22,s[11]);B=FF(B,x,A,R,v,7,s[12]);R=FF(R,B,x,A,S,12,s[13]);A=FF(A,R,B,x,w,17,s[14]);B=GG(B,x=FF(x,A,R,B,C,22,s[15]),A,R,c,5,s[16]);R=GG(R,B,x,A,d,9,s[17]);A=GG(A,R,B,x,m,14,s[18]);x=GG(x,A,R,B,a,20,s[19]);B=GG(B,x,A,R,h,5,s[20]);R=GG(R,B,x,A,_,9,s[21]);A=GG(A,R,B,x,C,14,s[22]);x=GG(x,A,R,B,p,20,s[23]);B=GG(B,x,A,R,g,5,s[24]);R=GG(R,B,x,A,w,9,s[25]);A=GG(A,R,B,x,u,14,s[26]);x=GG(x,A,R,B,y,20,s[27]);B=GG(B,x,A,R,S,5,s[28]);R=GG(R,B,x,A,f,9,s[29]);A=GG(A,R,B,x,l,14,s[30]);B=HH(B,x=GG(x,A,R,B,v,20,s[31]),A,R,h,4,s[32]);R=HH(R,B,x,A,y,11,s[33]);A=HH(A,R,B,x,m,16,s[34]);x=HH(x,A,R,B,w,23,s[35]);B=HH(B,x,A,R,c,4,s[36]);R=HH(R,B,x,A,p,11,s[37]);A=HH(A,R,B,x,l,16,s[38]);x=HH(x,A,R,B,_,23,s[39]);B=HH(B,x,A,R,S,4,s[40]);R=HH(R,B,x,A,a,11,s[41]);A=HH(A,R,B,x,u,16,s[42]);x=HH(x,A,R,B,d,23,s[43]);B=HH(B,x,A,R,g,4,s[44]);R=HH(R,B,x,A,v,11,s[45]);A=HH(A,R,B,x,C,16,s[46]);B=II(B,x=HH(x,A,R,B,f,23,s[47]),A,R,a,6,s[48]);R=II(R,B,x,A,l,10,s[49]);A=II(A,R,B,x,w,15,s[50]);x=II(x,A,R,B,h,21,s[51]);B=II(B,x,A,R,v,6,s[52]);R=II(R,B,x,A,u,10,s[53]);A=II(A,R,B,x,_,15,s[54]);x=II(x,A,R,B,c,21,s[55]);B=II(B,x,A,R,y,6,s[56]);R=II(R,B,x,A,C,10,s[57]);A=II(A,R,B,x,d,15,s[58]);x=II(x,A,R,B,S,21,s[59]);B=II(B,x,A,R,p,6,s[60]);R=II(R,B,x,A,m,10,s[61]);A=II(A,R,B,x,f,15,s[62]);x=II(x,A,R,B,g,21,s[63]);i[0]=i[0]+B|0;i[1]=i[1]+x|0;i[2]=i[2]+A|0;i[3]=i[3]+R|0},_doFinalize:function(){var r=this._data,t=r.words,n=8*this._nDataBytes,o=8*r.sigBytes;t[o>>>5]|=128<<24-o%32;var i=e.floor(n/4294967296),s=n;t[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);t[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);r.sigBytes=4*(t.length+1);this._process();for(var a=this._hash,c=a.words,f=0;f<4;f++){var u=c[f];c[f]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return a},clone:function(){var e=o.clone.call(this);e._hash=this._hash.clone();return e}});function FF(e,r,t,n,o,i,s){var a=e+(r&t|~r&n)+o+s;return(a<<i|a>>>32-i)+r}function GG(e,r,t,n,o,i,s){var a=e+(r&n|t&~n)+o+s;return(a<<i|a>>>32-i)+r}function HH(e,r,t,n,o,i,s){var a=e+(r^t^n)+o+s;return(a<<i|a>>>32-i)+r}function II(e,r,t,n,o,i,s){var a=e+(t^(r|~n))+o+s;return(a<<i|a>>>32-i)+r}r.MD5=o._createHelper(a);r.HmacMD5=o._createHmacHelper(a)}(Math);!function(e){var r=exports.CryptoJS,t=r.lib,n=t.WordArray,o=t.Hasher,i=r.algo,s=[],a=[];!function(){function isPrime(r){for(var t=e.sqrt(r),n=2;n<=t;n++)if(!(r%n))return!1;return!0}function getFractionalBits(e){return 4294967296*(e-(0|e))|0}for(var r=2,t=0;t<64;){if(isPrime(r)){t<8&&(s[t]=getFractionalBits(e.pow(r,.5)));a[t]=getFractionalBits(e.pow(r,1/3));t++}r++}}();var c=[],f=i.SHA256=o.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,r){for(var t=this._hash.words,n=t[0],o=t[1],i=t[2],s=t[3],f=t[4],u=t[5],p=t[6],h=t[7],d=0;d<64;d++){if(d<16)c[d]=0|e[r+d];else{var l=c[d-15],y=(l<<25|l>>>7)^(l<<14|l>>>18)^l>>>3,g=c[d-2],_=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[d]=y+c[d-7]+_+c[d-16]}var m=n&o^n&i^o&i,v=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=h+((f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25))+(f&u^~f&p)+a[d]+c[d];h=p;p=u;u=f;f=s+S|0;s=i;i=o;o=n;n=S+(v+m)|0}t[0]=t[0]+n|0;t[1]=t[1]+o|0;t[2]=t[2]+i|0;t[3]=t[3]+s|0;t[4]=t[4]+f|0;t[5]=t[5]+u|0;t[6]=t[6]+p|0;t[7]=t[7]+h|0},_doFinalize:function(){var r=this._data,t=r.words,n=8*this._nDataBytes,o=8*r.sigBytes;t[o>>>5]|=128<<24-o%32;t[14+(o+64>>>9<<4)]=e.floor(n/4294967296);t[15+(o+64>>>9<<4)]=n;r.sigBytes=4*t.length;this._process();return this._hash},clone:function(){var e=o.clone.call(this);e._hash=this._hash.clone();return e}});r.SHA256=o._createHelper(f);r.HmacSHA256=o._createHmacHelper(f)}(Math);!function(){var e=exports.CryptoJS,r=e.lib.Base,t=e.enc.Utf8;e.algo.HMAC=r.extend({init:function(e,r){e=this._hasher=new e.init;"string"==typeof r&&(r=t.parse(r));var n=e.blockSize,o=4*n;r.sigBytes>o&&(r=e.finalize(r));r.clamp();for(var i=this._oKey=r.clone(),s=this._iKey=r.clone(),a=i.words,c=s.words,f=0;f<n;f++){a[f]^=1549556828;c[f]^=909522486}i.sigBytes=s.sigBytes=o;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var r=this._hasher,t=r.finalize(e);r.reset();return r.finalize(this._oKey.clone().concat(t))}})}();exports.CryptoJS.lib.Cipher||function(e){var r=exports.CryptoJS,t=r.lib,n=t.Base,o=t.WordArray,i=t.BufferedBlockAlgorithm,s=r.enc,a=(s.Utf8,s.Base64),c=r.algo.EvpKDF,f=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,r){return this.create(this._ENC_XFORM_MODE,e,r)},createDecryptor:function(e,r){return this.create(this._DEC_XFORM_MODE,e,r)},init:function(e,r,t){this.cfg=this.cfg.extend(t);this._xformMode=e;this._key=r;this.reset()},reset:function(){i.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(e){return"string"==typeof e?m:g}return function(e){return{encrypt:function(r,t,n){return selectCipherStrategy(t).encrypt(e,r,t,n)},decrypt:function(r,t,n){return selectCipherStrategy(t).decrypt(e,r,t,n)}}}}()}),u=(t.StreamCipher=f.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),r.mode={}),p=t.BlockCipherMode=n.extend({createEncryptor:function(e,r){return this.Encryptor.create(e,r)},createDecryptor:function(e,r){return this.Decryptor.create(e,r)},init:function(e,r){this._cipher=e;this._iv=r}}),h=u.CBC=function(){var r=p.extend();r.Encryptor=r.extend({processBlock:function(e,r){var t=this._cipher,n=t.blockSize;xorBlock.call(this,e,r,n);t.encryptBlock(e,r);this._prevBlock=e.slice(r,r+n)}});r.Decryptor=r.extend({processBlock:function(e,r){var t=this._cipher,n=t.blockSize,o=e.slice(r,r+n);t.decryptBlock(e,r);xorBlock.call(this,e,r,n);this._prevBlock=o}});function xorBlock(r,t,n){var o,i=this._iv;if(i){o=i;this._iv=e}else o=this._prevBlock;for(var s=0;s<n;s++)r[t+s]^=o[s]}return r}(),d=(r.pad={}).Pkcs7={pad:function(e,r){for(var t=4*r,n=t-e.sigBytes%t,i=n<<24|n<<16|n<<8|n,s=[],a=0;a<n;a+=4)s.push(i);var c=o.create(s,n);e.concat(c)},unpad:function(e){var r=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=r}},l=(t.BlockCipher=f.extend({cfg:f.cfg.extend({mode:h,padding:d}),reset:function(){var e;f.reset.call(this);var r=this.cfg,t=r.iv,n=r.mode;if(this._xformMode==this._ENC_XFORM_MODE)e=n.createEncryptor;else{e=n.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==e)this._mode.init(this,t&&t.words);else{this._mode=e.call(n,this,t&&t.words);this._mode.__creator=e}},_doProcessBlock:function(e,r){this._mode.processBlock(e,r)},_doFinalize:function(){var e,r=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){r.pad(this._data,this.blockSize);e=this._process(!0)}else{e=this._process(!0);r.unpad(e)}return e},blockSize:4}),t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=(r.format={}).OpenSSL={stringify:function(e){var r=e.ciphertext,t=e.salt;return(t?o.create([1398893684,1701076831]).concat(t).concat(r):r).toString(a)},parse:function(e){var r,t=a.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){r=o.create(n.slice(2,4));n.splice(0,4);t.sigBytes-=16}return l.create({ciphertext:t,salt:r})}},g=t.SerializableCipher=n.extend({cfg:n.extend({format:y}),encrypt:function(e,r,t,n){n=this.cfg.extend(n);var o=e.createEncryptor(t,n),i=o.finalize(r),s=o.cfg;return l.create({ciphertext:i,key:t,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,r,t,n){n=this.cfg.extend(n);r=this._parse(r,n.format);return e.createDecryptor(t,n).finalize(r.ciphertext)},_parse:function(e,r){return"string"==typeof e?r.parse(e,this):e}}),_=(r.kdf={}).OpenSSL={execute:function(e,r,t,n){n||(n=o.random(8));var i=c.create({keySize:r+t}).compute(e,n),s=o.create(i.words.slice(r),4*t);i.sigBytes=4*r;return l.create({key:i,iv:s,salt:n})}},m=t.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:_}),encrypt:function(e,r,t,n){var o=(n=this.cfg.extend(n)).kdf.execute(t,e.keySize,e.ivSize);n.iv=o.iv;var i=g.encrypt.call(this,e,r,o.key,n);i.mixIn(o);return i},decrypt:function(e,r,t,n){n=this.cfg.extend(n);r=this._parse(r,n.format);var o=n.kdf.execute(t,e.keySize,e.ivSize,r.salt);n.iv=o.iv;return g.decrypt.call(this,e,r,o.key,n)}})}();!function(){if("function"==typeof ArrayBuffer){var e=exports.CryptoJS.lib.WordArray,r=e.init;(e.init=function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(e instanceof Uint8Array){for(var t=e.byteLength,n=[],o=0;o<t;o++)n[o>>>2]|=e[o]<<24-o%4*8;r.call(this,n,t)}else r.apply(this,arguments)}).prototype=e}}();exports.CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}};!function(){var e=exports.CryptoJS,r=e.lib.WordArray;e.enc.Base64={stringify:function(e){var r=e.words,t=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<t;i+=3)for(var s=(r[i>>>2]>>>24-i%4*8&255)<<16|(r[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|r[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<t;a++)o.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function parseLoop(e,t,n){for(var o=[],i=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2,f=a|c;o[i>>>2]|=f<<24-i%4*8;i++}return r.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();!function(){var e=exports.CryptoJS,r=e.lib,t=r.Base,n=r.WordArray,o=e.algo,i=o.MD5,s=o.EvpKDF=t.extend({cfg:t.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,r){for(var t,o=this.cfg,i=o.hasher.create(),s=n.create(),a=s.words,c=o.keySize,f=o.iterations;a.length<c;){t&&i.update(t);t=i.update(e).finalize(r);i.reset();for(var u=1;u<f;u++){t=i.finalize(t);i.reset()}s.concat(t)}s.sigBytes=4*c;return s}});e.EvpKDF=function(e,r,t){return s.create(t).compute(e,r)}}();!function(){var e=exports.CryptoJS,r=e.lib.BlockCipher,t=e.algo,n=[],o=[],i=[],s=[],a=[],c=[],f=[],u=[],p=[],h=[];!function(){for(var e=[],r=0;r<256;r++)e[r]=r<128?r<<1:r<<1^283;var t=0,d=0;for(r=0;r<256;r++){var l=d^d<<1^d<<2^d<<3^d<<4;l=l>>>8^255&l^99;n[t]=l;o[l]=t;var y=e[t],g=e[y],_=e[g],m=257*e[l]^16843008*l;i[t]=m<<24|m>>>8;s[t]=m<<16|m>>>16;a[t]=m<<8|m>>>24;c[t]=m;m=16843009*_^65537*g^257*y^16843008*t;f[l]=m<<24|m>>>8;u[l]=m<<16|m>>>16;p[l]=m<<8|m>>>24;h[l]=m;if(t){t=y^e[e[e[_^y]]];d^=e[e[d]]}else t=d=1}}();var d=[0,1,2,4,8,16,32,64,128,27,54],l=t.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,r=e.words,t=e.sigBytes/4,o=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],s=0;s<o;s++)if(s<t)i[s]=r[s];else{l=i[s-1];if(s%t)t>6&&s%t==4&&(l=n[l>>>24]<<24|n[l>>>16&255]<<16|n[l>>>8&255]<<8|n[255&l]);else{l=n[(l=l<<8|l>>>24)>>>24]<<24|n[l>>>16&255]<<16|n[l>>>8&255]<<8|n[255&l];l^=d[s/t|0]<<24}i[s]=i[s-t]^l}for(var a=this._invKeySchedule=[],c=0;c<o;c++){s=o-c;if(c%4)var l=i[s];else l=i[s-4];a[c]=c<4||s<=4?l:f[n[l>>>24]]^u[n[l>>>16&255]]^p[n[l>>>8&255]]^h[n[255&l]]}}},encryptBlock:function(e,r){this._doCryptBlock(e,r,this._keySchedule,i,s,a,c,n)},decryptBlock:function(e,r){var t=e[r+1];e[r+1]=e[r+3];e[r+3]=t;this._doCryptBlock(e,r,this._invKeySchedule,f,u,p,h,o);t=e[r+1];e[r+1]=e[r+3];e[r+3]=t},_doCryptBlock:function(e,r,t,n,o,i,s,a){for(var c=this._nRounds,f=e[r]^t[0],u=e[r+1]^t[1],p=e[r+2]^t[2],h=e[r+3]^t[3],d=4,l=1;l<c;l++){var y=n[f>>>24]^o[u>>>16&255]^i[p>>>8&255]^s[255&h]^t[d++],g=n[u>>>24]^o[p>>>16&255]^i[h>>>8&255]^s[255&f]^t[d++],_=n[p>>>24]^o[h>>>16&255]^i[f>>>8&255]^s[255&u]^t[d++],m=n[h>>>24]^o[f>>>16&255]^i[u>>>8&255]^s[255&p]^t[d++];f=y;u=g;p=_;h=m}y=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[p>>>8&255]<<8|a[255&h])^t[d++],g=(a[u>>>24]<<24|a[p>>>16&255]<<16|a[h>>>8&255]<<8|a[255&f])^t[d++],_=(a[p>>>24]<<24|a[h>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^t[d++],m=(a[h>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&p])^t[d++];e[r]=y;e[r+1]=g;e[r+2]=_;e[r+3]=m},keySize:8});e.AES=r._createHelper(l)}();!function(){var e=exports.CryptoJS,r=e.lib.StreamCipher,t=e.algo,n=t.RC4=r.extend({_doReset:function(){for(var e=this._key,r=e.words,t=e.sigBytes,n=this._S=[],o=0;o<256;o++)n[o]=o;o=0;for(var i=0;o<256;o++){var s=o%t,a=r[s>>>2]>>>24-s%4*8&255;i=(i+n[o]+a)%256;var c=n[o];n[o]=n[i];n[i]=c}this._i=this._j=0},_doProcessBlock:function(e,r){e[r]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var e=this._S,r=this._i,t=this._j,n=0,o=0;o<4;o++){t=(t+e[r=(r+1)%256])%256;var i=e[r];e[r]=e[t];e[t]=i;n|=e[(e[r]+e[t])%256]<<24-8*o}this._i=r;this._j=t;return n}e.RC4=r._createHelper(n);var o=t.RC4Drop=n.extend({cfg:n.cfg.extend({drop:192}),_doReset:function(){n._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)generateKeystreamWord.call(this)}});e.RC4Drop=r._createHelper(o)}();exports.CryptoJS.mode.ECB=function(){var e=exports.CryptoJS.lib.BlockCipherMode.extend();e.Encryptor=e.extend({processBlock:function(e,r){this._cipher.encryptBlock(e,r)}});e.Decryptor=e.extend({processBlock:function(e,r){this._cipher.decryptBlock(e,r)}});return e}();class _PDFSecurity{static generateFileID(e={}){let r=`${e.CreationDate.getTime()}\n`;for(let t in e)e.hasOwnProperty(t)&&(r+=`${t}: ${e[t]}\n`);return wordArrayToBuffer(exports.CryptoJS.MD5(r))}static generateRandomWordArray(e){return exports.CryptoJS.lib.WordArray.random(e)}static create(e,r={}){return r.ownerPassword||r.userPassword?new _PDFSecurity(e,r):null}constructor(e,r={}){if(!r.ownerPassword&&!r.userPassword)throw new Error("None of owner password and user password is defined.");this.document=e;this._setupEncryption(r)}_setupEncryption(e){switch(e.pdfVersion){case"1.4":case"1.5":this.version=2;break;case"1.6":case"1.7":this.version=4;break;case"1.7ext3":this.version=5;break;default:this.version=1}const r={Filter:"Standard"};switch(this.version){case 1:case 2:case 4:this._setupEncryptionV1V2V4(this.version,r,e);break;case 5:this._setupEncryptionV5(r,e)}this.dictionary=this.document.ref(r)}_setupEncryptionV1V2V4(e,r,t){let n,o;switch(e){case 1:n=2;this.keyBits=40;o=getPermissionsR2(t.permissions);break;case 2:n=3;this.keyBits=128;o=getPermissionsR3(t.permissions);break;case 4:n=4;this.keyBits=128;o=getPermissionsR3(t.permissions)}const i=processPasswordR2R3R4(t.userPassword),s=t.ownerPassword?processPasswordR2R3R4(t.ownerPassword):i,a=getOwnerPasswordR2R3R4(n,this.keyBits,i,s);this.encryptionKey=getEncryptionKeyR2R3R4(n,this.keyBits,this.document._id,i,a,o);let c;c=2===n?getUserPasswordR2(this.encryptionKey):getUserPasswordR3R4(this.document._id,this.encryptionKey);r.V=e;e>=2&&(r.Length=this.keyBits);if(4===e){r.CF={StdCF:{AuthEvent:"DocOpen",CFM:"AESV2",Length:this.keyBits/8}};r.StmF="StdCF";r.StrF="StdCF"}r.R=n;r.O=wordArrayToBuffer(a);r.U=wordArrayToBuffer(c);r.P=o}_setupEncryptionV5(e,r){this.keyBits=256;const t=getPermissionsR3(r.permissions),n=processPasswordR5(r.userPassword),o=r.ownerPassword?processPasswordR5(r.ownerPassword):n;this.encryptionKey=getEncryptionKeyR5(_PDFSecurity.generateRandomWordArray);const i=getUserPasswordR5(n,_PDFSecurity.generateRandomWordArray),s=getUserEncryptionKeyR5(n,exports.CryptoJS.lib.WordArray.create(i.words.slice(10,12),8),this.encryptionKey),a=getOwnerPasswordR5(o,i,_PDFSecurity.generateRandomWordArray),c=getOwnerEncryptionKeyR5(o,exports.CryptoJS.lib.WordArray.create(a.words.slice(10,12),8),i,this.encryptionKey),f=getEncryptedPermissionsR5(t,this.encryptionKey,_PDFSecurity.generateRandomWordArray);e.V=5;e.Length=this.keyBits;e.CF={StdCF:{AuthEvent:"DocOpen",CFM:"AESV3",Length:this.keyBits/8}};e.StmF="StdCF";e.StrF="StdCF";e.R=5;e.O=wordArrayToBuffer(a);e.OE=wordArrayToBuffer(c);e.U=wordArrayToBuffer(i);e.UE=wordArrayToBuffer(s);e.P=t;e.Perms=wordArrayToBuffer(f)}getEncryptFn(e,r){let t,n;this.version<5&&(t=this.encryptionKey.clone().concat(exports.CryptoJS.lib.WordArray.create([(255&e)<<24|(65280&e)<<8|e>>8&65280|255&r,(65280&r)<<16],5)));if(1===this.version||2===this.version){let e=exports.CryptoJS.MD5(t);e.sigBytes=Math.min(16,this.keyBits/8+5);return r=>wordArrayToBuffer(exports.CryptoJS.RC4.encrypt(exports.CryptoJS.lib.WordArray.create(r),e).ciphertext)}n=4===this.version?exports.CryptoJS.MD5(t.concat(exports.CryptoJS.lib.WordArray.create([1933667412],4))):this.encryptionKey;const o=_PDFSecurity.generateRandomWordArray(16),i={mode:exports.CryptoJS.mode.CBC,padding:exports.CryptoJS.pad.Pkcs7,iv:o};return e=>wordArrayToBuffer(o.clone().concat(exports.CryptoJS.AES.encrypt(exports.CryptoJS.lib.WordArray.create(e),n,i).ciphertext))}end(){this.dictionary.end()}}exports._PDFSecurity=_PDFSecurity;function getPermissionsR2(e={}){let r=-64;e.printing&&(r|=4);e.modifying&&(r|=8);e.copying&&(r|=16);e.annotating&&(r|=32);return r}function getPermissionsR3(e={}){let r=-3904;"lowResolution"===e.printing&&(r|=4);"highResolution"===e.printing&&(r|=2052);e.modifying&&(r|=8);e.copying&&(r|=16);e.annotating&&(r|=32);e.fillingForms&&(r|=256);e.contentAccessibility&&(r|=512);e.documentAssembly&&(r|=1024);return r}function getUserPasswordR2(e){return exports.CryptoJS.RC4.encrypt(processPasswordR2R3R4(),e).ciphertext}function getUserPasswordR3R4(e,r){const t=r.clone();let n=exports.CryptoJS.MD5(processPasswordR2R3R4().concat(exports.CryptoJS.lib.WordArray.create(e)));for(let e=0;e<20;e++){const o=Math.ceil(t.sigBytes/4);for(let n=0;n<o;n++)t.words[n]=r.words[n]^(e|e<<8|e<<16|e<<24);n=exports.CryptoJS.RC4.encrypt(n,t).ciphertext}return n.concat(exports.CryptoJS.lib.WordArray.create(null,16))}function getOwnerPasswordR2R3R4(e,r,t,n){let o=n,i=e>=3?51:1;for(let e=0;e<i;e++)o=exports.CryptoJS.MD5(o);const s=o.clone();s.sigBytes=r/8;let a=t;i=e>=3?20:1;for(let e=0;e<i;e++){const r=Math.ceil(s.sigBytes/4);for(let t=0;t<r;t++)s.words[t]=o.words[t]^(e|e<<8|e<<16|e<<24);a=exports.CryptoJS.RC4.encrypt(a,s).ciphertext}return a}function getEncryptionKeyR2R3R4(e,r,t,n,o,i){let s=n.clone().concat(o).concat(exports.CryptoJS.lib.WordArray.create([lsbFirstWord(i)],4)).concat(exports.CryptoJS.lib.WordArray.create(t));const a=e>=3?51:1;for(let e=0;e<a;e++)(s=exports.CryptoJS.MD5(s)).sigBytes=r/8;return s}function getUserPasswordR5(e,r){const t=r(8),n=r(8);return exports.CryptoJS.SHA256(e.clone().concat(t)).concat(t).concat(n)}function getUserEncryptionKeyR5(e,r,t){const n=exports.CryptoJS.SHA256(e.clone().concat(r)),o={mode:exports.CryptoJS.mode.CBC,padding:exports.CryptoJS.pad.NoPadding,iv:exports.CryptoJS.lib.WordArray.create(null,16)};return exports.CryptoJS.AES.encrypt(t,n,o).ciphertext}function getOwnerPasswordR5(e,r,t){const n=t(8),o=t(8);return exports.CryptoJS.SHA256(e.clone().concat(n).concat(r)).concat(n).concat(o)}function getOwnerEncryptionKeyR5(e,r,t,n){const o=exports.CryptoJS.SHA256(e.clone().concat(r).concat(t)),i={mode:exports.CryptoJS.mode.CBC,padding:exports.CryptoJS.pad.NoPadding,iv:exports.CryptoJS.lib.WordArray.create(null,16)};return exports.CryptoJS.AES.encrypt(n,o,i).ciphertext}function getEncryptionKeyR5(e){return e(32)}function getEncryptedPermissionsR5(e,r,t){const n=exports.CryptoJS.lib.WordArray.create([lsbFirstWord(e),4294967295,1415668834],12).concat(t(4)),o={mode:exports.CryptoJS.mode.ECB,padding:exports.CryptoJS.pad.NoPadding};return exports.CryptoJS.AES.encrypt(n,r,o).ciphertext}function processPasswordR2R3R4(e=""){const r=new Buffer(32),t=e.length;let n=0;for(;n<t&&n<32;){const t=e.charCodeAt(n);if(t>255)throw new Error("Password contains one or more invalid characters.");r[n]=t;n++}for(;n<32;){r[n]=PASSWORD_PADDING[n-t];n++}return exports.CryptoJS.lib.WordArray.create(r)}function processPasswordR5(e=""){e=unescape(encodeURIComponent(saslprep(e)));const r=Math.min(127,e.length),t=new Buffer(r);for(let n=0;n<r;n++)t[n]=e.charCodeAt(n);return exports.CryptoJS.lib.WordArray.create(t)}function lsbFirstWord(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}function wordArrayToBuffer(e){const r=[];for(let t=0;t<e.sigBytes;t++)r.push(e.words[Math.floor(t/4)]>>8*(3-t%4)&255);return Buffer.from(r)}const PASSWORD_PADDING=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];wijmo_1._registerModule("wijmo.pdf.security",selfModule);