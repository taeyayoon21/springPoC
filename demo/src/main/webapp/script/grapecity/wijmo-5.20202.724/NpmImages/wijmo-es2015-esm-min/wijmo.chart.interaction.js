/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{getElementRect,Point,setCss,removeClass,addClass,hasClass,createElement,Event,asNumber,asBoolean,copy,assert,isArray,toggleClass,isDate,asEnum,asType,_registerModule}from"wijmo/wijmo";import{FlexChartCore,FlexChart}from"wijmo/wijmo.chart";import*as selfModule from"wijmo/wijmo.chart.interaction";export var MouseAction;!function(t){t[t.Zoom=0]="Zoom";t[t.Pan=1]="Pan"}(MouseAction||(MouseAction={}));export var InteractiveAxes;!function(t){t[t.X=0]="X";t[t.Y=1]="Y";t[t.XY=2]="XY"}(InteractiveAxes||(InteractiveAxes={}));export class ChartGestures{constructor(t,i){this._chart=null;this._zoomEle=null;this._overlayEle=null;this._wrapperMousedown=null;this._wrapperMouseMove=null;this._wrapperMouseup=null;this._wrapperPointerdown=null;this._wrapperPointerMove=null;this._wrapperPointerup=null;this._wrapperTouchStart=null;this._wrapperTouchMove=null;this._wrapperTouchEnd=null;this._wrapperMouseWheel=null;this._startFirstPt=null;this._minX=null;this._maxX=null;this._minY=null;this._maxY=null;this._threadHold=20;this._clip={};this._selection={};this._startPointers=[];this._mvPointers=[];this._pinchStartEvents=[];this._minXRange=null;this._minYRange=null;this._innerUpdating=!1;this._lastMinX=null;this._lastMaxX=null;this._lastMinY=null;this._lastMaxY=null;this._mouseAction=MouseAction.Zoom;this._interactiveAxes=InteractiveAxes.X;this._enable=!0;this._scaleX=1;this._scaleY=1;this._posX=0;this._posY=0;t||assert(!1,"The FlexChart cannot be null.");this._chart=t;copy(this,i);this._initialize()}get mouseAction(){return this._mouseAction}set mouseAction(t){this._mouseAction=asEnum(t,MouseAction)}get interactiveAxes(){return this._interactiveAxes}set interactiveAxes(t){t!==this._interactiveAxes&&(this._interactiveAxes=asEnum(t,InteractiveAxes))}get enable(){return this._enable}set enable(t){t!==this._enable&&(this._enable=asBoolean(t,!0))}get scaleX(){return this._scaleX}set scaleX(t){if(t!==this._scaleX){this._scaleX=t<0?0:t>1?1:asNumber(t);this._seriesGroup&&this._initAxisRangeWithPosAndScale(!0)}}get scaleY(){return this._scaleY}set scaleY(t){if(t!==this._scaleY){this._scaleY=t<0?0:t>1?1:asNumber(t);this._seriesGroup&&this._initAxisRangeWithPosAndScale(!1)}}get posX(){return this._posX}set posX(t){if(t!==this._posX){this._posX=t<0?0:t>1?1:asNumber(t);this._seriesGroup&&this._initAxisRangeWithPosAndScale(!0)}}get posY(){return this._posY}set posY(t){if(t!==this._posY){this._posY=t<0?0:t>1?1:asNumber(t);this._seriesGroup&&this._initAxisRangeWithPosAndScale(!1)}}remove(){if(this._zoomEle){this._chart.hostElement.removeChild(this._zoomEle);this._zoomEle=null}removeClass(this._chart.hostElement,ChartGestures._CSS_TOUCH_DISABLED);this._switchEvent(!1);this._wrapperMousedown=null;this._wrapperMouseMove=null;this._wrapperMouseup=null;this._wrapperPointerdown=null;this._wrapperPointerMove=null;this._wrapperPointerup=null;this._wrapperTouchStart=null;this._wrapperTouchMove=null;this._wrapperTouchEnd=null;this._wrapperMouseWheel=null}reset(){var t=this._chart,i=t.axisX,e=t.axisY;this._maxX&&(i.max=this._maxX);this._minX&&(i.min=this._minX);this._maxY&&(e.max=this._maxY);this._minY&&(e.min=this._minY);this._initAxisRangeWithPosAndScale(!0);this._initAxisRangeWithPosAndScale(!1)}_refreshChart(){var t=this._chart,i=t.axisX,e=t.axisY;this._minX=this._getAxisMin(i);this._maxX=this._getAxisMax(i);this._minY=this._getAxisMin(e);this._maxY=this._getAxisMax(e);this._minXRange=.005*(this._maxX-this._minX);this._minYRange=.005*(this._maxY-this._minY);this._initAxisRangeWithPosAndScale(!0);this._initAxisRangeWithPosAndScale(!1)}_initialize(){var t=this._chart.hostElement;this._zoomEle=createElement('<div class="'+ChartGestures._CSS_ZOOM+'"><div class="'+ChartGestures._CSS_ZOOM_OVERLAY+'"></div>');this._zoomEle.style.visibility="visible";t.appendChild(this._zoomEle);addClass(t,ChartGestures._CSS_TOUCH_DISABLED);this._overlayEle=this._zoomEle.querySelector("."+ChartGestures._CSS_ZOOM_OVERLAY);this._wrapperMousedown=this._onMousedown.bind(this);this._wrapperMouseMove=this._onMouseMove.bind(this);this._wrapperMouseup=this._onMouseup.bind(this);this._wrapperPointerdown=this._onPointerdown.bind(this);this._wrapperPointerMove=this._onPointerMove.bind(this);this._wrapperPointerup=this._onPointerup.bind(this);this._wrapperMouseWheel=this._onMouseWheel.bind(this);this._wrapperTouchStart=this._onTouchStart.bind(this);this._wrapperTouchMove=this._onTouchMove.bind(this);this._wrapperTouchEnd=this._onTouchEnd.bind(this);this._switchEvent(!0)}_switchEvent(t){var i=this._chart.hostElement,e=t?"addEventListener":"removeEventListener",s=t?"addHandler":"removeHandler";if(i){i[e]("mousedown",this._wrapperMousedown);i[e]("mousemove",this._wrapperMouseMove);document[e]("mouseup",this._wrapperMouseup);if("onpointerdown"in window){i[e]("pointerdown",this._wrapperPointerdown);i[e]("pointermove",this._wrapperPointerMove);document[e]("pointerup",this._wrapperPointerup)}i[e]("wheel",this._wrapperMouseWheel);if("ontouchstart"in window){i[e]("touchstart",this._wrapperTouchStart);i[e]("touchmove",this._wrapperTouchMove);document[e]("touchend",this._wrapperTouchEnd)}this._chart.rendered[s](this._refresh,this)}}_refresh(){var t,i,e,s=this._chart,a=s.axisX,n=s.axisY,h=s.hostElement;this._seriesGroup=h.querySelector(".wj-series-group");t=h.querySelector("."+FlexChart._CSS_PLOT_AREA);this._plotOffset=getElementRect(t);this._plotBox=t.getBBox();this._zoomEleOffset=getElementRect(this._zoomEle);this._overlayEle&&this._overlayEle.removeAttribute("style");if(this._innerUpdating)this._innerUpdating=!1;else{i=!1;e=!1;if(null===this._minX||isNaN(this._minX)||0===this._minX||-1===this._minX||this._lastMinX!==this._getAxisMin(a)){this._minX=this._getAxisMin(a);null===this._minX||isNaN(this._minX)||0===this._minX||-1===this._minX||(i=!0)}if(null===this._maxX||isNaN(this._maxX)||0===this._maxX||-1===this._maxX||this._lastMaxX!==this._getAxisMax(a)){this._maxX=this._getAxisMax(a);null===this._maxX||isNaN(this._maxX)||0===this._maxX||-1===this._maxX||(i=!0)}if(null===this._minY||isNaN(this._minY)||this._lastMinY!==this._getAxisMin(n)){this._minY=this._getAxisMin(n);isNaN(this._minY)||(e=!0)}if(null===this._maxY||isNaN(this._maxY)||this._lastMaxY!==this._getAxisMax(n)){this._maxY=this._getAxisMax(n);isNaN(this._maxY)||(e=!0)}this._minXRange=.005*(this._maxX-this._minX);this._minYRange=.005*(this._maxY-this._minY);i&&null!==this._scaleX&&void 0!==this._scaleX&&1!==this._scaleX&&null!==this._posX&&void 0!==this._posX&&0!==this._posX&&this._initAxisRangeWithPosAndScale(!0);e&&null!==this._scaleY&&void 0!==this._scaleY&&1!==this._scaleY&&null!==this._posY&&void 0!==this._posY&&0!==this._posY&&this._initAxisRangeWithPosAndScale(!1)}}_onMousedown(t){if(this._enable){this._disabledOthersInteraction(!0);this._mouseDown(t);t.preventDefault()}}_onMouseMove(t){if(this._enable){this._mouseMove(t);t.preventDefault()}}_onMouseup(t){if(this._enable){this._mouseup(t);this._disabledOthersInteraction(!1)}}_onMouseWheel(t){var i=-t.deltaY>0?.05:-.05;if(this._enable){this._scaling=!0;this._interactiveAxes!==InteractiveAxes.X&&this._interactiveAxes!==InteractiveAxes.XY||this._updateAxisByChg(!0,i,-i);this._interactiveAxes!==InteractiveAxes.Y&&this._interactiveAxes!==InteractiveAxes.XY||this._updateAxisByChg(!1,i,-i);this._scaling=!1;t.preventDefault()}}_mouseDown(t){this._startFirstPt=this._getPoint(t);this._updatePoint(this._startFirstPt);if(this._mouseAction===MouseAction.Zoom)this._initOverlay();else{this._seriesGroup.setAttribute("clip-path","url(#"+this._chart._plotrectId+")");toggleClass(this._chart.hostElement,ChartGestures._CSS_PANABLE,this._mouseAction===MouseAction.Pan)}}_mouseMove(t){var i;if(this._startFirstPt){i=this._getPoint(t);this._updatePoint(i);this._endPoint=new Point(i.x,i.y);if(this._mouseAction===MouseAction.Zoom)this._updateOverLay(i);else{this._panning=!0;this._panningChart(i.x-this._startFirstPt.x,i.y-this._startFirstPt.y)}}}_mouseup(t){var i=this._endPoint;this._chart.axisX;if(this._startFirstPt&&i){if(this._mouseAction===MouseAction.Zoom){this._zoomedChart(i);this._reset()}else{this._pannedChart(i.x-this._startFirstPt.x,i.y-this._startFirstPt.y);this._reset()}removeClass(this._chart.hostElement,ChartGestures._CSS_PANABLE)}else{removeClass(this._chart.hostElement,ChartGestures._CSS_PANABLE);this._reset()}}_onPointerdown(t){if(this._enable){this._disabledOthersInteraction(!0);switch(t.pointerType){case"touch":this._pointerDown(t);break;case"mouse":this._mouseDown(t)}t.preventDefault()}}_onPointerMove(t){if(this._enable){switch(t.pointerType){case"touch":this._pointerMove(t);break;case"mouse":this._mouseMove(t)}t.preventDefault()}}_onPointerup(t){if(this._enable){switch(t.pointerType){case"touch":this._pointerUp(t);break;case"mouse":this._mouseup(t)}this._disabledOthersInteraction(!1);t.preventDefault()}}_pointerDown(t){t.preventManipulation&&t.preventManipulation();this._seriesGroup.setAttribute("clip-path","url(#"+this._chart._plotrectId+")");this._startPointers.push({id:t.pointerId,x:t.pageX,y:t.pageY});if(1===this._startPointers.length){this._scaling=!1;this._panning=!0}else if(2===this._startPointers.length){this._panning=!1;this._scaling=!0;this._startDistance={x:this._startPointers[0].x-this._startPointers[1].x,y:this._startPointers[0].y-this._startPointers[1].y}}}_pointerMove(t){var i,e,s,a,n=new Point(t.pageX,t.pageY),h={},r={};t.preventManipulation&&t.preventManipulation();if(this._panning){if(!this._pointInPlotArea(n))return;this._endPoint=new Point(t.pageX,t.pageY);this._panningChart(this._endPoint.x-this._startPointers[0].x,this._endPoint.y-this._startPointers[0].y)}else if(this._scaling){i=this._startPointers[0].id+"";e=this._startPointers[1].id+"";this._mvPointers[t.pointerId+""]={x:t.pageX,y:t.pageY};if(this._mvPointers[i]&&this._mvPointers[e]){if(Math.abs(this._startDistance.x)>this._threadHold&&this._interactiveAxes!==InteractiveAxes.Y){s=this._mvPointers[i].x-this._plotOffset.left;a=this._startPointers[0].x-this._plotOffset.left;r.x=Math.abs((this._mvPointers[i].x-this._mvPointers[e].x)/this._startDistance.x);h.x=s-r.x*a;this._clip.x=(this._plotBox.x-s)/r.x+a;this._selection.w=this._plotBox.width/r.x}if(Math.abs(this._startDistance.y)>this._threadHold&&this._interactiveAxes!==InteractiveAxes.X){s=this._mvPointers[i].y-this._plotOffset.top;a=this._startPointers[0].y-this._plotOffset.top;r.y=Math.abs((this._mvPointers[i].y-this._mvPointers[e].y)/this._startDistance.y);h.y=s-r.y*a;this._clip.y=(this._plotBox.y-s)/r.y+a;this._selection.h=this._plotBox.height/r.y}this._scalingChart(r,h)}}}_pointerUp(t){t.preventManipulation&&t.preventManipulation();if(this._panning){this._endPoint&&this._pannedChart(this._endPoint.x-this._startPointers[0].x,this._endPoint.y-this._startPointers[0].y);this._reset()}else if(this._scaling){this._scaledChart(t);this._reset()}}_onTouchStart(t){if(this._enable){this._disabledOthersInteraction(!0);if(1==t.touches.length){this._scaling=!1;this._panning=!0;this._startFirstPt=this._getPoint(t)}else if(2==t.touches.length){this._pinchStartEvents=this._getTouchPair(t);this._startDistance=this._touchDistance(t);this._panning=!1;this._scaling=!0}this._seriesGroup&&this._seriesGroup.setAttribute("clip-path","url(#"+this._chart._plotrectId+")");this._chart._hideToolTip();return!0}}_onTouchMove(t){if(this._enable){var i,e,s,a,n,h={},r={},_=t.touches[0],o=new Point(_.pageX,_.pageY);t.preventDefault();if(this._panning){if(this._startFirstPt){if(!this._pointInPlotArea(o))return;this._endPoint=new Point(_.pageX,_.pageY);this._panningChart(this._endPoint.x-this._startFirstPt.x,this._endPoint.y-this._startFirstPt.y)}}else if(this._scaling){s=this._touchDistance(t);a=this._getTouchPair(t)[0];n=this._pinchStartEvents[0];if(Math.abs(this._startDistance.x)>this._threadHold&&this._interactiveAxes!==InteractiveAxes.Y){i=a.pageX-this._plotOffset.left;e=n.pageX-this._plotOffset.left;h.x=Math.abs(s.x/this._startDistance.x);r.x=i-h.x*e;this._clip.x=(this._plotBox.x-i)/h.x+e;this._selection.w=this._plotBox.width/h.x}if(Math.abs(this._startDistance.y)>this._threadHold&&this._interactiveAxes!==InteractiveAxes.X){i=a.pageY-this._plotOffset.top;e=n.pageY-this._plotOffset.top;h.y=Math.abs(s.y/this._startDistance.y);r.y=i-h.y*e;this._clip.y=(this._plotBox.y-i)/h.y+e;this._selection.h=this._plotBox.height/h.y}this._scalingChart(h,r)}return!0}}_onTouchEnd(t){if(this._enable){var i=this._endPoint;if(this._panning){if(!this._startFirstPt||!i){this._reset();return}this._pannedChart(i.x-this._startFirstPt.x,i.y-this._startFirstPt.y)}else this._scaling&&this._scaledChart(t);this._reset();this._disabledOthersInteraction(!1);return!0}}_initOverlay(){this._zoomEle.style.visibility="visible";switch(this._interactiveAxes){case InteractiveAxes.X:this._overlayEle.style.left=this._startFirstPt.x-this._zoomEleOffset.left+"px";this._overlayEle.style.top=this._plotOffset.top-this._zoomEleOffset.top+"px";break;case InteractiveAxes.Y:this._overlayEle.style.left=this._plotBox.x+"px";this._overlayEle.style.top=this._startFirstPt.y-this._zoomEleOffset.top+"px";break;case InteractiveAxes.XY:this._overlayEle.style.left=this._startFirstPt.x-this._zoomEleOffset.left+"px";this._overlayEle.style.top=this._startFirstPt.y-this._zoomEleOffset.top+"px"}}_updateOverLay(t){var i=this._startFirstPt.x-t.x,e=this._startFirstPt.y-t.y,s={};switch(this._interactiveAxes){case InteractiveAxes.X:if(Math.abs(i)<this._threadHold)return;s=i<=0?{width:Math.abs(i)+"px",height:this._plotBox.height+"px"}:{left:t.x-this._zoomEleOffset.left+"px",width:i+"px",height:this._plotBox.height+"px"};break;case InteractiveAxes.Y:if(Math.abs(e)<this._threadHold)return;s=e<=0?{height:Math.abs(e)+"px",width:this._plotBox.width+"px"}:{top:t.y-this._zoomEleOffset.top+"px",height:e+"px",width:this._plotBox.width+"px"};break;case InteractiveAxes.XY:if(Math.abs(i)>=this._threadHold){s.width=Math.abs(i)+"px";i>0&&(s.left=t.x-this._zoomEleOffset.left+"px")}if(Math.abs(e)>=this._threadHold){s.height=Math.abs(e)+"px";e>0&&(s.top=t.y-this._zoomEleOffset.top+"px")}}setCss(this._overlayEle,s)}_updatePoint(t){var i=this._plotOffset;t.x<i.left&&(t.x=i.left);t.x>i.left+i.width&&(t.x=i.left+i.width);t.y<i.top&&(t.y=i.top);t.y>i.top+i.height&&(t.y=i.top+i.height)}_pointInPlotArea(t){var i=this._plotOffset;return t.x>=i.left&&t.x<=i.left+i.width&&t.y>=i.top&&t.y<=i.top+i.height}_zoomedChart(t){if(t){this._interactiveAxes!==InteractiveAxes.X&&this._interactiveAxes!==InteractiveAxes.XY||this._zoomedAxis(t,!0);this._interactiveAxes!==InteractiveAxes.Y&&this._interactiveAxes!==InteractiveAxes.XY||this._zoomedAxis(t,!1);this._startFirstPt=null}}_zoomedAxis(t,i){var e,s,a=i?this._chart.axisX:this._chart.axisY,n=i?"x":"y",h=i?"left":"top";if(t&&Math.abs(this._startFirstPt[n]-t[n])>this._threadHold){e=a.convertBack(this._startFirstPt[n]-this._plotOffset[h]+this._plotBox[n]);(s=a.convertBack(t[n]-this._plotOffset[h]+this._plotBox[n]))-e!=0&&this._updateAxisRange(a,Math.min(e,s),Math.max(e,s))}}_panningChart(t,i){var e=this._chart.axisX,s=this._chart.axisY,a=this._getTransFormGroups();t=Math.abs(t)<this._threadHold?0:t;i=Math.abs(i)<this._threadHold?0:i;this._interactiveAxes===InteractiveAxes.X&&(i=0);this._interactiveAxes===InteractiveAxes.Y&&(t=0);t>0&&e.actualMin.valueOf()===this._minX&&(t=0);t<0&&e.actualMax.valueOf()===this._maxX&&(t=0);i>0&&s.actualMax.valueOf()===this._maxY&&(i=0);i<0&&s.actualMin.valueOf()===this._minY&&(i=0);for(var n=0;n<a.length;n++)a[n].setAttribute("transform","translate("+t+","+i+")")}_pannedChart(t,i){this._interactiveAxes!==InteractiveAxes.X&&this._interactiveAxes!==InteractiveAxes.XY||this._updateAxisByDistance(!0,t);this._interactiveAxes!==InteractiveAxes.Y&&this._interactiveAxes!==InteractiveAxes.XY||this._updateAxisByDistance(!1,-i)}_scalingChart(t,i){var e,s,a,n=this._chart.axisX,h=this._chart.axisY,r=void 0!==i.x?i.x:0,_=void 0!==i.y?i.y:0;if(t){e=this._getTransFormGroups();if(void 0!==t.x&&t.x<1&&n.actualMin.valueOf()===this._minX&&n.actualMax.valueOf()===this._maxX){t.x=1;r=0}if(void 0!==t.y&&t.y<1&&h.actualMin.valueOf()===this._minY&&h.actualMax.valueOf()===this._maxY){t.y=1;_=0}s=void 0!==t.x?t.x:1;a=void 0!==t.y?t.y:1;for(var o=0;o<e.length;o++)e[o].setAttribute("transform","translate("+r+", "+_+") scale("+s+", "+a+")")}}_scaledChart(t){var i,e,s=this._chart,a=s.axisX,n=s.axisY;if(this._clip){if(this._interactiveAxes!==InteractiveAxes.Y&&void 0!==this._clip.x){if((i=Math.max(this._minX,a.convertBack(this._clip.x)))>(e=Math.min(this._maxX,a.convertBack(this._clip.x+this._selection.w)))){let t=i;i=e;e=t}i-e!=0&&this._updateAxisRange(a,i,e)}if(this._interactiveAxes!==InteractiveAxes.X&&void 0!==this._clip.y){e=Math.min(this._maxY,n.convertBack(this._clip.y));if((i=Math.max(this._minY,n.convertBack(this._clip.y+this._selection.h)))>e){let t=i;i=e;e=t}i-e!=0&&this._updateAxisRange(n,i,e)}}}_updateAxisByDistance(t,i){var e,s=t?this._chart.axisX:this._chart.axisY,a=t?this._minX:this._minY,n=t?this._maxX:this._maxY,h=s.actualMin.valueOf(),r=s.actualMax.valueOf();if(0!==i)if(i>0&&a===h||i<0&&n===r){this._innerUpdating=!0;this._chart.invalidate()}else{e=i/(t?this._plotBox.width:this._plotBox.height);this._updateAxisByChg(t,-e,-e)}}_updateAxisByChg(t,i,e){var s,a,n=t?this._chart.axisX:this._chart.axisY,h=t?this._minX:this._minY,r=t?this._maxX:this._maxY,_=n.actualMin.valueOf(),o=(n.actualMax.valueOf(),this._chart._plotRect),l=t?o.left:o.top,c=t?o.width:o.height,d=t?this._minXRange:this._minYRange;if(!isNaN(i)&&!isNaN(e)){if(this._panning){if(i<0)if((s=t?n.convertBack(l+i*c):n.convertBack(l+c-i*c))<h){s=h;a=t?n.convertBack(n.convert(s)+c):n.convertBack(n.convert(s)-c)}else a=t?n.convertBack(l+c+e*c):n.convertBack(l-e*c);else if((a=t?n.convertBack(l+c+e*c):n.convertBack(l-e*c))>r){a=r;s=t?n.convertBack(n.convert(a)-c):n.convertBack(n.convert(a)+c)}else s=t?n.convertBack(l+i*c):n.convertBack(l+c-i*c);if(s>a){let t=s;s=a;a=t}}else if(this._scaling){if((s=t?n.convertBack(l+i*c):n.convertBack(l+c-i*c))>(a=t?n.convertBack(l+c+e*c):n.convertBack(l-e*c))){let t=s;s=a;a=t}s<h&&(s=h);a>r&&(a=r);a-s<d&&(s=a-d)}this._updateAxisRange(n,s,a)}}_initAxisRangeWithPosAndScale(t){var i,e,s,a;if(t){i=this._maxX-this._minX;if(!isNaN(i)){e=i*this._scaleX;a=(s=this._minX+this._posX*(i-e))+e;this._innerUpdating=!0;this._chart.axisX.min=s;this._chart.axisX.max=a;this._lastMinX=s;this._lastMaxX=a}}else{i=this._maxY-this._minY;if(!isNaN(i)){e=i*this._scaleY;a=(s=this._minY+this._posY*(i-e))+e;this._innerUpdating=!0;this._chart.axisY.min=s;this._chart.axisY.max=a;this._lastMinY=s;this._lastMaxY=a}}}_updateAxisRange(t,i,e){this._chart.beginUpdate();t.min=i;t.max=e;if(t===this._chart.axisX){this._lastMinX=i;this._lastMaxX=e}else{this._lastMinY=i;this._lastMaxY=e}this._innerUpdating=!0;this._chart.endUpdate()}_reset(){this._scaling=!1;this._panning=!1;this._startDistance=0;this._startFirstPt=null;this._pinchStartEvents=[];this._startPointers=[];this._mvPointers=[];this._endPoint=null;this._clip={};this._selection={}}_getAxisMin(t){return isDate(t.actualMin)?t.actualMin.valueOf():t.actualMin}_getAxisMax(t){return isDate(t.actualMax)?t.actualMax.valueOf():t.actualMax}_getTransFormGroups(){var t=this._seriesGroup.querySelectorAll("g[clip-path]");0===t.length&&(t=this._seriesGroup.querySelectorAll("g"));return t}_disabledOthersInteraction(t){var i=this._chart.hostElement;if(null!=i)for(var e=i.querySelectorAll(".wj-chart-linemarker-container"),s=0;s<e.length;s++)t?addClass(e[s],ChartGestures._CSS_BLOCK_INTERACTION):removeClass(e[s],ChartGestures._CSS_BLOCK_INTERACTION)}_getPoint(t){return t instanceof MouseEvent?new Point(t.pageX,t.pageY):new Point(t.changedTouches[0].pageX,t.changedTouches[0].pageY)}_getTouchPair(t){var i=[];if(isArray(t)){i[0]=t[0];i[1]=t[1]}else if("touchend"===t.type){if(1===t.touches.length){i[0]=t.touches[0];i[1]=t.changedTouches[0]}else if(0===t.touches.length){i[0]=t.changedTouches[0];i[1]=t.changedTouches[1]}}else{i[0]=t.touches[0];i[1]=t.touches[1]}return i}_touchDistance(t){var i=this._getTouchPair(t),e=0,s=0;i[0]&&void 0!==i[0].pageX&&i[1]&&void 0!==i[1].pageX&&(e=i[0].pageX-i[1].pageX);i[0]&&void 0!==i[0].pageY&&i[1]&&void 0!==i[1].pageY&&(s=i[0].pageY-i[1].pageY);return{x:e,y:s}}}ChartGestures._CSS_ZOOM="wj-zoom";ChartGestures._CSS_ZOOM_OVERLAY="wj-zoom-overlay";ChartGestures._CSS_PANABLE="wj-panable";ChartGestures._CSS_TOUCH_DISABLED="wj-flexchart-touch-disabled";ChartGestures._CSS_BLOCK_INTERACTION="wj-block-other-interaction";export class _RangeSlider{constructor(t,i,e,s){this._isVisible=!0;this._buttonsVisible=!0;this._minScale=0;this._maxScale=1;this._seamless=!1;this._rsContainer=null;this._rsEle=null;this._decBtn=null;this._incBtn=null;this._rsContent=null;this._minHandler=null;this._rangeHandler=null;this._maxHandler=null;this._wrapperSliderMousedown=null;this._wrapperDocMouseMove=null;this._wrapperDocMouseup=null;this._wrapperBtnMousedown=null;this._wrapperRangeSpaceMousedown=null;this._wrapperRangeMouseleave=null;this._isTouch=!1;this._slidingInterval=null;this._rangeSliderRect=null;this._isHorizontal=!0;this._isBtnMousedown=!1;this._needSpaceClick=!1;this._hasButtons=!0;this._movingEle=null;this._movingOffset=null;this._range=null;this._startPt=null;this._minPos=0;this._maxPos=1;this.rangeChanged=new Event;this.rangeChanging=new Event;t||assert(!1,"The container cannot be null.");this._isTouch="ontouchstart"in window;this._needSpaceClick=i;this._hasButtons=e;copy(this,s);this._createSlider(t)}get buttonsVisible(){return this._buttonsVisible}set buttonsVisible(t){if(t!=this._buttonsVisible){this._buttonsVisible=asBoolean(t);if(!this._rsContainer||!this._hasButtons)return;this._refresh()}}get isHorizontal(){return this._isHorizontal}set isHorizontal(t){if(t!=this._isHorizontal){this._isHorizontal=asBoolean(t);if(!this._rsContainer)return;this._invalidate()}}get isVisible(){return this._isVisible}set isVisible(t){if(t!=this._isVisible){this._isVisible=asBoolean(t);if(!this._rsContainer)return;this._rsContainer.style.visibility=this._isVisible?"visible":"hidden"}}get minScale(){return this._minScale}set minScale(t){t>=0&&t!=this._minScale&&(this._minScale=asNumber(t))}get maxScale(){return this._maxScale}set maxScale(t){t>=0&&t!=this._maxScale&&(this._maxScale=asNumber(t))}get seamless(){return this._seamless}set seamless(t){t!=this._seamless&&(this._seamless=asBoolean(t))}onRangeChanged(t){this.rangeChanged.raise(this,t)}onRangeChanging(t){this.rangeChanging.raise(this,t)}get _isSliding(){return null!==this._startPt}get _handleWidth(){return this._minHandler.offsetWidth}_createSlider(t){var i=this._isHorizontal?_RangeSlider._HRANGESLIDER:_RangeSlider._VRANGESLIDER,e=this._isHorizontal?"wj-glyph-left":"wj-glyph-down",s=this._isHorizontal?"wj-glyph-right":"wj-glyph-up";this._rsContainer=t;this._rsContainer.style.visibility=this._isVisible?"visible":"hidden";this._rsEle=createElement('<div class="wj-chart-rangeslider '+i+'"></div>');this._rsContainer.appendChild(this._rsEle);if(this._hasButtons){this._decBtn=createElement('<button class="wj-rangeslider-decbtn wj-btn wj-btn-default" type="button" tabindex="-1"><span class="'+e+" "+_RangeSlider._RANGESLIDER_DECBTN+'"></span></button>');this._rsEle.appendChild(this._decBtn);this._incBtn=createElement('<button class="wj-rangeslider-incbtn wj-btn wj-btn-default" type="button" tabindex="-1"><span class="'+s+" "+_RangeSlider._RANGESLIDER_INCBTN+'"></span></button>');this._rsEle.appendChild(this._incBtn)}this._rsContent=createElement('<div class="wj-rangeslider-content"><div class="wj-rangeslider-rangehandle"></div><div class="wj-rangeslider-minhandle"></div><div class="wj-rangeslider-maxhandle"></div>');this._rsEle.appendChild(this._rsContent);this._minHandler=this._rsContent.querySelector("."+_RangeSlider._RANGESLIDER_MINHANDLE);this._rangeHandler=this._rsContent.querySelector("."+_RangeSlider._RANGESLIDER_RANGEHANDLE);this._maxHandler=this._rsContent.querySelector("."+_RangeSlider._RANGESLIDER_MAXHANDLE);this._wrapperSliderMousedown=this._onSliderMousedown.bind(this);this._wrapperDocMouseMove=this._onDocMouseMove.bind(this);this._wrapperDocMouseup=this._onDocMouseup.bind(this);this._wrapperRangeSpaceMousedown=this._onRangeSpaceMousedown.bind(this);this._wrapperRangeMouseleave=this._onRangeMouseleave.bind(this);this._wrapperBtnMousedown=this._onBtnMousedown.bind(this);this._switchEvent(!0)}_switchEvent(t){var i=t?"addEventListener":"removeEventListener";if(this._rsContainer){this._needSpaceClick&&this._rsEle[i]("mousedown",this._wrapperRangeSpaceMousedown);this._rsEle[i]("mouseleave",this._wrapperRangeMouseleave);this._rsContent[i]("mousedown",this._wrapperSliderMousedown);if(this._hasButtons){this._decBtn[i]("mousedown",this._wrapperBtnMousedown);this._incBtn[i]("mousedown",this._wrapperBtnMousedown)}document[i]("mousemove",this._wrapperDocMouseMove);document[i]("mouseup",this._wrapperDocMouseup);if("ontouchstart"in window){this._needSpaceClick&&this._rsEle[i]("touchstart",this._wrapperRangeSpaceMousedown);this._rsContent[i]("touchstart",this._wrapperSliderMousedown);if(this._hasButtons){this._decBtn[i]("touchstart",this._wrapperBtnMousedown);this._incBtn[i]("touchstart",this._wrapperBtnMousedown)}document[i]("touchmove",this._wrapperDocMouseMove);document[i]("touchend",this._wrapperDocMouseup)}}}_onSliderMousedown(t){if(this._isVisible){this._movingEle=t.srcElement||t.target;this._startPt=t instanceof MouseEvent?new Point(t.pageX,t.pageY):new Point(t.changedTouches[0].pageX,t.changedTouches[0].pageY);removeClass(this._minHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE);removeClass(this._maxHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE);this._movingOffset=getElementRect(this._movingEle);if(this._movingEle!=this._rangeHandler){this._isHorizontal?this._movingOffset.left+=.5*this._movingEle.offsetWidth:this._movingOffset.top+=.5*this._movingEle.offsetHeight;addClass(this._movingEle,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE)}else this._range=this._maxPos-this._minPos;t.preventDefault()}}_onDocMouseMove(t){if(this._isVisible&&this._startPt){var i=t instanceof MouseEvent?new Point(t.pageX,t.pageY):new Point(t.changedTouches[0].pageX,t.changedTouches[0].pageY);this._onMove(i)}}_onMove(t){var i,e=this._startPt,s=this._movingOffset,a=this._plotBox,n=this._range,h=this._movingEle,r=this._minHandler,_=this._rangeHandler,o=this._maxHandler;if(e&&s){(i=this._isHorizontal?(s.left+t.x-e.x-a.x)/a.width:1-(s.top+t.y-e.y-a.y)/a.height)<0?i=0:i>1&&(i=1);if(h===r)if(this._seamless&&0===this._minScale&&i>=this._maxPos){this._minPos=this._maxPos;this._movingEle=o;removeClass(this._minHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE);addClass(this._maxHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE)}else{i>this._maxPos-this._minScale&&(i=this._maxPos-this._minScale);i<this._maxPos-this._maxScale&&(i=this._maxPos-this._maxScale);this._minPos=i}else if(h===o)if(this._seamless&&0===this._minScale&&i<=this._minPos){this._maxPos=this._minPos;this._movingEle=r;removeClass(this._maxHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE);addClass(this._minHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE)}else{i<this._minPos+this._minScale&&(i=this._minPos+this._minScale);i>this._minPos+this._maxScale&&(i=this._minPos+this._maxScale);this._maxPos=i}else if(h===_)if(this._isHorizontal){this._minPos=i;this._maxPos=this._minPos+n;if(this._maxPos>=1){this._maxPos=1;this._minPos=this._maxPos-n}}else{this._maxPos=i;this._minPos=this._maxPos-n;if(this._minPos<=0){this._minPos=0;this._maxPos=this._minPos+n}}this._updateElesPosition();this.onRangeChanging()}}_onDocMouseup(t){if(this._isVisible){this._clearInterval();this._isBtnMousedown=!1;if(this._startPt){this.onRangeChanged();this._startPt=null;this._movingOffset=null}removeClass(this._minHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE);removeClass(this._maxHandler,_RangeSlider._RANGESLIDER_HANDLE_ACTIVE)}}_onRangeSpaceMousedown(t){var i=t instanceof MouseEvent?new Point(t.pageX,t.pageY):new Point(t.changedTouches[0].pageX,t.changedTouches[0].pageY),e=getElementRect(this._rsContent),s=getElementRect(this._rangeHandler),a=t.srcElement||t.target,n=0;t.stopPropagation();t.preventDefault();if(a===this._rsContent||a===this._rsEle){if(this._isHorizontal){n=s.width/e.width;i.x<s.left?n*=-1:i.x>s.left+s.width&&(n*=1)}else{n=s.height/e.height;i.y<s.top?n*=1:i.y>s.top+s.height&&(n*=-1)}0!==n&&this._doSliding(n,i)}}_onRangeMouseleave(t){t.stopPropagation();t.preventDefault();if(this._isBtnMousedown){this._clearInterval();this.onRangeChanged()}}_onBtnMousedown(t){var i=t.srcElement||t.target,e=0;t.stopPropagation();t.preventDefault();if(hasClass(i,_RangeSlider._RANGESLIDER_DECBTN)){if(0===this._minPos)return;e=-.05}else if(hasClass(i,_RangeSlider._RANGESLIDER_INCBTN)){if(1===this._maxPos)return;e=.05}this._isBtnMousedown=!0;0!==e&&this._doSliding(e)}_refresh(t){var i,e,s=0,a=getElementRect(this._rsContainer);t&&(this._rangeSliderRect=t);if(this._rangeSliderRect){if(this._hasButtons&&this._buttonsVisible){this._decBtn.style.display="block";this._incBtn.style.display="block";s=this._isHorizontal?this._decBtn.offsetWidth+this._minHandler.offsetWidth/2:this._decBtn.offsetHeight+this._minHandler.offsetHeight/2}else{if(this._hasButtons){this._decBtn.style.display="none";this._incBtn.style.display="none"}s=this._isHorizontal?this._minHandler.offsetWidth/2:this._minHandler.offsetHeight/2}i=this._getRsRect();if(this._isHorizontal){i.left-=this._minHandler.offsetWidth/2;i.width+=this._minHandler.offsetWidth;e={left:s,width:i.width-2*s}}else{i.top-=this._minHandler.offsetHeight/2;i.height+=this._minHandler.offsetHeight;e={top:s,height:i.height-2*s}}setCss(this._rsEle,i);setCss(this._rsContent,e);a=getElementRect(this._rsContent);this._plotBox={x:a.left,y:a.top,width:a.width,height:a.height};this._updateElesPosition()}}_updateElesPosition(){var t,i,e,s=this._minHandler,a=(this._rangeHandler,this._maxHandler),n=this._plotBox,h=this._isHorizontal;if(n){t=h?{left:this._minPos*n.width-.5*s.offsetWidth}:{top:(1-this._minPos)*n.height-.5*a.offsetHeight};i=h?{left:this._minPos*n.width,width:(this._maxPos-this._minPos)*n.width}:{top:(1-this._maxPos)*n.height,height:(this._maxPos-this._minPos)*n.height};e=h?{left:this._maxPos*n.width-.5*a.offsetWidth}:{top:(1-this._maxPos)*n.height-.5*s.offsetHeight};this._refreshSlider(t,i,e)}}_refreshSlider(t,i,e){setCss(this._minHandler,t);setCss(this._rangeHandler,i);setCss(this._maxHandler,e)}_invalidate(){var t,i;if(this._rsContainer){t=this._isHorizontal?_RangeSlider._HRANGESLIDER:_RangeSlider._VRANGESLIDER;i=this._isHorizontal?_RangeSlider._VRANGESLIDER:_RangeSlider._HRANGESLIDER;removeClass(this._rsEle,i);addClass(this._rsEle,t);[this._rsEle,this._rsContent,this._minHandler,this._maxHandler,this._rangeHandler].forEach(t=>{t.removeAttribute("style")});this._refresh()}}_changeRange(t){var i=this._maxPos-this._minPos;if(!(t<0&&0===this._minPos||t>0&&1===this._maxPos)){if(t<0){this._minPos+=t;this._minPos=this._minPos<0?0:this._minPos;this._maxPos=this._minPos+i}else{this._maxPos+=t;this._maxPos=this._maxPos>1?1:this._maxPos;this._minPos=this._maxPos-i}this._updateElesPosition()}}_doSliding(t,i){getElementRect(this._rsContent),getElementRect(this._rangeHandler);this._clearInterval();this._startPt=new Point;this._changeRange(t);this.onRangeChanged();this._setSlidingInterval(t,i)}_setSlidingInterval(t,i){var e,s=this;this._slidingInterval=window.setInterval((function(){if(i){getElementRect(s._rsContent);e=getElementRect(s._rangeHandler);if(s._isHorizontal){if(i.x>=e.left&&i.x<=e.left+e.width){s._clearInterval();return}}else if(i.y>=e.top&&i.y<=e.top+e.height){s._clearInterval();return}}s._changeRange(t);s.onRangeChanged()}),200)}_clearInterval(){this._slidingInterval&&window.clearInterval(this._slidingInterval)}_getRsRect(){var t=this._rangeSliderRect,i={};if(t){["left","top","width","height"].forEach((function(e){t[e]&&(i[e]=t[e])}));return i}}}_RangeSlider._HRANGESLIDER="wj-chart-hrangeslider";_RangeSlider._VRANGESLIDER="wj-chart-vrangeslider";_RangeSlider._RANGESLIDER_DECBTN="wj-rangeslider-decbtn";_RangeSlider._RANGESLIDER_INCBTN="wj-rangeslider-incbtn";_RangeSlider._RANGESLIDER_RANGEHANDLE="wj-rangeslider-rangehandle";_RangeSlider._RANGESLIDER_MINHANDLE="wj-rangeslider-minhandle";_RangeSlider._RANGESLIDER_MAXHANDLE="wj-rangeslider-maxhandle";_RangeSlider._RANGESLIDER_HANDLE_ACTIVE="wj-rangeslider-handle-active";export var Orientation;!function(t){t[t.X=0]="X";t[t.Y=1]="Y"}(Orientation||(Orientation={}));export class RangeSelector{constructor(t,i){this._isVisible=!0;this._orientation=Orientation.X;this._seamless=!1;this._minScale=0;this._maxScale=1;this.rangeChanged=new Event;this._chart=asType(t,FlexChartCore,!1);this._createRangeSelector();copy(this,i)}get isVisible(){return this._isVisible}set isVisible(t){if(t!=this._isVisible){this._isVisible=asBoolean(t);this._rangeSlider&&(this._rangeSlider.isVisible=t)}}get min(){return this._min}set min(t){if((t=asNumber(t,!0,!1))!=this._min){var i=!1;if(null==t||void 0===t||isNaN(t)||null==this._max){this._min=t;i=!0}else if(t<=this._max||void 0===this._max){this._min=t;i=!0}this._rangeSlider&&i&&this._changeRange()}}get max(){return this._max}set max(t){if((t=asNumber(t,!0,!1))!=this._max){var i=!1;if(null==t||isNaN(t)){this._max=t;i=!0}else if(t>=this._min||void 0===this._min){this._max=t;i=!0}this._rangeSlider&&i&&this._changeRange()}}get orientation(){return this._orientation}set orientation(t){if((t=asEnum(t,Orientation))!==this._orientation){this._orientation=t;this._rangeSlider&&(this._rangeSlider.isHorizontal=t==Orientation.X)}}get seamless(){return this._seamless}set seamless(t){if((t=asBoolean(t,!0))!=this._seamless){this._seamless=t;this._rangeSlider&&(this._rangeSlider.seamless=t)}}get minScale(){return this._minScale}set minScale(t){if((t=asNumber(t))<=1&&t>=0&&t!=this._minScale&&t<this._maxScale){this._minScale=t;if(this._rangeSlider){this._rangeSlider.minScale=asNumber(t);this._updateMinAndMaxWithScale(!0)}}}get maxScale(){return this._maxScale}set maxScale(t){if((t=asNumber(t))<=1&&t>=0&&t!=this._maxScale&&t>this._minScale){this._maxScale=t;if(this._rangeSlider){this._rangeSlider.maxScale=asNumber(t);this._updateMinAndMaxWithScale(!0)}}}remove(){if(this._rangeSelectorEle){this._chart.hostElement.removeChild(this._rangeSelectorEle);this._switchEvent(!1);this._rangeSelectorEle=null;this._rangeSlider=null}}onRangeChanged(t){this.rangeChanged.raise(this,t)}_createRangeSelector(){var t=this._chart.hostElement,i=this._orientation===Orientation.X;this._rangeSelectorEle=createElement('<div class="wj-chart-rangeselector-container"></div>');this._rangeSlider=new _RangeSlider(this._rangeSelectorEle,!1,!1,{isHorizontal:i,isVisible:this._isVisible,seamless:this._seamless});t.appendChild(this._rangeSelectorEle);this._switchEvent(!0)}_switchEvent(t){var i=t?"addHandler":"removeHandler";if(this._chart.hostElement){this._rangeSlider.rangeChanged[i](this._updateRange,this);this._chart.rendered[i](this._refresh,this)}}_refresh(){var t,i,e,s=this._chart.hostElement,a=getElementRect(this._rangeSelectorEle);t=s.querySelector("."+FlexChart._CSS_PLOT_AREA);i=getElementRect(t);if((e=t.getBBox())&&e.width&&e.height){this._adjustMinAndMax();this._rangeSlider._refresh({left:e.x,top:i.top-a.top,width:e.width,height:e.height})}}_adjustMinAndMax(){var t=this._chart,i=this._rangeSlider,e=this._min,s=this._max,a=this._orientation===Orientation.X?t.axisX:t.axisY,n=isDate(a.actualMin)?a.actualMin.valueOf():a.actualMin,h=isDate(a.actualMax)?a.actualMax.valueOf():a.actualMax;this._min=null===e||isNaN(e)||void 0===e||e<n||e>h?n:e;this._max=null===s||isNaN(s)||void 0===s||s<n||s>h?h:s;var r=this._chart._plotRect;if(r){let t,e;if(this._orientation===Orientation.X){t=(a.convert(this._min)-r.left)/r.width;e=(a.convert(this._max)-r.left)/r.width}else{t=(r.top-a.convert(this._min))/r.height+1;e=(r.top-a.convert(this._max))/r.height+1}i._minPos=isNaN(t)?0:t;i._maxPos=isNaN(e)?1:e;this._updateMinAndMaxWithScale(!1)}}_updateMinAndMaxWithScale(t){var i,e=this._rangeSlider,s=!1;if(0!==this._minScale&&e._minPos+this._minScale>e._maxPos){if((i=e._minPos+this._minScale)>1){e._maxPos=1;e._minPos=1-this._minScale}else e._maxPos=i;s=!0}if(1!==this._maxScale&&e._minPos+this._maxScale<e._maxPos){if((i=e._minPos+this._maxScale)>1){e._maxPos=1;e._minPos=1-this._maxScale}else e._maxPos=i;s=!0}if(s){var a=this._getMinAndMax();this._min=a.min;this._max=a.max;if(t&&this._rangeSelectorEle){this._rangeSlider._refresh();this.onRangeChanged()}}}_changeRange(){this._adjustMinAndMax();if(this._rangeSelectorEle){this._rangeSlider._refresh();this.onRangeChanged()}}_updateRange(){var t;this._rangeSlider;t=this._chart;this._orientation===Orientation.X?t.axisX:t.axisY;var i=this._getMinAndMax();this._min=i.min;this._max=i.max;this.onRangeChanged()}_getMinAndMax(){var t=this._rangeSlider,i=this._chart,e=i._plotRect,s=null,a=null;if(e)if(this._orientation===Orientation.X){s=i.axisX.convertBack(e.left+t._minPos*e.width);a=i.axisX.convertBack(e.left+t._maxPos*e.width)}else{s=i.axisY.convertBack(e.top+(1-t._minPos)*e.height);a=i.axisY.convertBack(e.top+(1-t._maxPos)*e.height)}return{min:s,max:a}}}_registerModule("wijmo.chart.interaction",selfModule);