/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{_addCultureInfo,culture,setAriaLabel,disableAutoComplete,isIE,isIE9,asBoolean,asString,asEnum,setSelectionRange,contains,getActiveElement,setAttribute,showPopup,hidePopup,hasClass,addClass,removeClass,toggleClass,removeChild,Control,Key,Event,EventArgs,CancelEventArgs,tryCast,createElement,hasItems,isObject,isString,asArray,asFunction,asNumber,asType,asCollectionView,closest,escapeHtml,toPlainText,Binding,DateTime,getUniqueId,isNumber,enable,isFunction,escapeRegExp,assert,setCss,setText,isDate,asDate,asInt,Globalize,_ClickRepeater,CollectionView,format,Color,clamp,_MaskProvider,setChecked,isArray,Point,getElementRect,Rect,PopupPosition,moveFocus,getElement,isUndefined,_registerModule}from"wijmo/wijmo";import*as selfModule from"wijmo/wijmo.input";_addCultureInfo("InputNumber",{ariaLabels:{incVal:"Increase Value",decVal:"Decrease Value"}});export class InputNumber extends Control{constructor(t,e){super(t);this._value=null;this._min=null;this._max=null;this._format="";this._step=null;this._showBtn=!0;this._readOnly=!1;this._oldText="";this.textChanged=new Event;this.valueChanged=new Event;let s=this.hostElement;setAttribute(s,"role","spinbutton",!0);let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-inputnumber",i,{_tbx:"input",_btnUp:"btn-inc",_btnDn:"btn-dec"},"input");let n=culture.InputNumber.ariaLabels;setAriaLabel(this._btnUp.querySelector("button"),n.incVal);setAriaLabel(this._btnDn.querySelector("button"),n.decVal);this._tbx.type.match(/number/i)&&(this.inputType="");let h=this._tbx;h.autocomplete="off";h.spellcheck=!1;this._updateSymbols();let l=this.addEventListener.bind(this);l(h,"keypress",this._keypress.bind(this));l(h,"keydown",this._keydown.bind(this));l(h,"input",this._input.bind(this));l(h,"blur",()=>{this.text!=this._oldText&&this._setText(this.text)});l(h,"compositionstart",()=>{this._composing=!0});l(h,"compositionend",()=>{this._composing=!1;setTimeout(()=>{let t=this.text,e=this._oldText;e&&e.indexOf(this._chrPct)>-1&&t.indexOf(this._chrPct)<0&&(t+=this._chrPct);this._setText(t)})});let a=this._clickSpinner.bind(this);l(this._btnUp,"click",a);l(this._btnDn,"click",a);this._rptUp=new _ClickRepeater(this._btnUp.querySelector("button"));this._rptDn=new _ClickRepeater(this._btnDn.querySelector("button"));l(h,"wheel",t=>{if(!t.defaultPrevented&&!t.ctrlKey&&!this.isReadOnly&&this.containsFocus()){let e=clamp(-t.deltaY,-1,1);this._increment((this.step||1)*e);setTimeout(()=>this.selectAll());t.preventDefault()}});this.value=0;this.isRequired=!0;this.initialize(e)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._value}set value(t){if(t!=this._value)if(null==(t=asNumber(t,!this.isRequired||null==t&&null==this._value)))this._setText("");else if(!isNaN(t)){let e=Globalize.format(t,this.format);this._setText(e)}}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t);this.inputElement.readOnly=this._readOnly;toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get min(){return this._min}set min(t){if(t!=this._min){this._min=asNumber(t,!0);this._updateAria()}}get max(){return this._max}set max(t){if(t!=this._max){this._max=asNumber(t,!0);this._updateAria()}}get step(){return this._step}set step(t){this._step=asNumber(t,!0);this._updateBtn()}get format(){return this._format}set format(t){if(t!=this.format){this._format=asString(t);this.refresh()}}get text(){return this._tbx.value}set text(t){if(t!=this.text){this._oldText=null;this._setText(t)}}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get showSpinner(){return this._showBtn}set showSpinner(t){this._showBtn=asBoolean(t);this._updateBtn()}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(t){this._rptUp.disabled=this._rptDn.disabled=!asBoolean(t)}selectAll(){let t=this._tbx;setSelectionRange(t,0,t.value.length)}clamp(t){return clamp(t,this.min,this.max)}onTextChanged(t){this.textChanged.raise(this,t);this._updateState()}onValueChanged(t){this._updateAria();this.valueChanged.raise(this,t)}dispose(){this._rptUp.element=null;this._rptDn.element=null;super.dispose()}onGotFocus(t){this._oldValue=this.value;if(!this.isTouching){this._tbx.focus();this.selectAll()}super.onGotFocus(t)}onLostFocus(t){if(this._composing){this._composing=!1;this._setText(this.text)}if(!this.isReadOnly){let t=this.clamp(this.value);if(t==this.value||this.onInvalidInput(new CancelEventArgs)){let e=Globalize.format(t,this.format);this._setText(e)}}super.onLostFocus(t)}refresh(t=!0){super.refresh(t);if(this.hostElement){this._updateSymbols();let t=Globalize.format(this.value,this.format);this._setText(t)}}_updateSymbols(){let t=culture.Globalize.numberFormat,e=Globalize._parseNumericFormat(this.format);this._chrDec=t["."]||".";this._chrTho=t[","]||",";this._chrNeg=t["-"]||"-";this._chrPls=t["+"]||"+";this._chrPct=t["%"]||"%";this._chrCur=e.curr||t.currency.symbol||"$";this._fmtSpc=e.spec;this._fmtPrc=e.prec;this._rxSym=new RegExp("^[%+\\-() \\"+this._chrDec+"\\"+this._chrCur+"\\"+this._chrNeg+"\\"+this._chrPls+"\\"+this._chrPct+"]*$");this._rxNeg=new RegExp("(\\-|\\(|\\"+this._chrNeg+")")}_isNumeric(t,e){let s=t==this._chrDec||t>="0"&&t<="9",i="x"==this._fmtSpc;!s&&i&&(s=t>="a"&&t<="f"||t>="A"&&t<="F");s||e||i||(s=t==this._chrPls||t==this._chrNeg||"("==t||")"==t);return s}_getInputRange(t){let e=[0,0],s=this.text,i=!1;for(let n=0;n<s.length;n++)if(this._isNumeric(s[n],t)){if(!i){e[0]=n;i=!0}e[1]=n+1}return e}_flipSign(){let t=this._getSelStartDigits();this.value*=-1;this._setSelStartDigits(t)}_getSelStartDigits(){let t=0,e=this._tbx.selectionStart,s=this._tbx.value;for(let i=0;i<s.length&&i<e;i++)this._isNumeric(s[i],!0)&&t++;return t}_setSelStartDigits(t){let e=this._tbx.value;for(let s=0;s<e.length&&t>=0;s++)if(this._isNumeric(e[s],!0)){if(!t){setSelectionRange(this._tbx,s);break}t--}else if(!t){setSelectionRange(this._tbx,s);break}}_increment(t){if(t){let e=this.clamp(isNumber(this.value)?this.value+t:0),s=Globalize.format(e,this.format,!1,!1);this._setText(s)}}_updateBtn(){let t=this.showSpinner&&!!this.step,e=t;setCss([this._btnUp,this._btnDn],{display:t?"":"none"});toggleClass(this.hostElement,"wj-input-show-spinner",t);enable(this._btnUp,e);enable(this._btnDn,e);this._updateAria()}_setText(t){if(this._composing)return;let e=this._tbx,s=this._rxNeg.test(t),i=this._delKey,n=this.containsFocus();t&&this._rxSym.test(t)&&n&&(t=this.isRequired||!i?"0":"");this._delKey=!1;i&&0==this.value&&!this.isRequired&&(t="");if(!t){if(!this.isRequired){e.value="";if(null!=this._value){this._value=null;this.onValueChanged()}if(this._oldText){this._oldText=t;this.onTextChanged()}this._updateBtn();return}t="0"}let h=this._format||(t.indexOf(this._chrDec)>-1?"n2":"n0"),l=Globalize.parseFloat(t,h);if(isNaN(l)){this.onInvalidInput(new CancelEventArgs)?e.value=this._oldText:this.focus();return}let a=Globalize.format(l,h,!1);s&&l>=0&&!i&&(a=this._chrNeg+a);n&&(null!=this._fmtPrc&&"g"!=this._fmtSpc||!i&&e.value.match(/\.0?$/)&&(a=t+("0"==t?this._chrDec:"")));if(e.value!=a){"g"==this._fmtSpc&&e.value.match(a+"0*")&&this.containsFocus()&&e.selectionStart==e.value.length&&(a=e.value);e.value=a;l=Globalize.parseFloat(a,this.format)}if(l!=this._value){this._value=l;this.onValueChanged()}if(this.text!=this._oldText){this._oldText=this.text;this.onTextChanged()}this._updateBtn()}_keypress(t){if(!(t.defaultPrevented||this._composing||this.isReadOnly)&&t.charCode&&!t.ctrlKey&&!t.metaKey){let e=this._tbx,s=String.fromCharCode(t.charCode);if(this._isNumeric(s,!1)){let s=e.maxLength;if(s>-1&&e.value.length>=s&&e.selectionEnd==e.selectionStart){t.preventDefault();return}let i=this._getInputRange(!0),n=e.selectionStart,h=e.selectionEnd;if(n<i[0]&&h<e.value.length){h=Math.max(h,i[0]);setSelectionRange(e,i[0],h)}if(n>=i[1]){let s=null!=this._fmtPrc?this._fmtPrc:2,i=e.value.indexOf(this._chrDec);i>-1&&n-i>s&&t.preventDefault()}}else t.preventDefault();switch(s){case"-":case this._chrNeg:if(this.clamp(-1)>=0)this.value<0&&this._flipSign();else if(this.value&&e.selectionStart==e.selectionEnd)this._flipSign();else if(this.clamp(-1)<0){e.value=this._chrNeg;setSelectionRange(e,1)}t.preventDefault();break;case"+":case this._chrPls:this.value<0&&this._flipSign();t.preventDefault();break;case".":case this._chrDec:if(0==this._fmtPrc)t.preventDefault();else{let s=e.value.indexOf(this._chrDec);if(s>-1){e.selectionStart<=s&&s++;setSelectionRange(e,s);t.preventDefault()}}}if(!t.defaultPrevented&&isIE()){let i=e.value,n=e.selectionStart,h=e.selectionEnd;if(n==h){e.value=i.substr(0,n)+s+i.substr(h);setSelectionRange(e,n+1);t.preventDefault();this._input()}}}}_keydown(t){this._delKey=!1;if(t.defaultPrevented||this._composing)return;let e=this._tbx,s=e.value,i=e.selectionStart,n=e.selectionEnd;switch(t.keyCode){case 65:if(t.ctrlKey){setTimeout(()=>{this.selectAll()});t.preventDefault()}break;case Key.Up:case Key.Down:if(this.step&&!this.isReadOnly){this._increment(this.step*(t.keyCode==Key.Up?1:-1));setTimeout(()=>{this.selectAll()});t.preventDefault()}break;case Key.Back:this._delKey=!0;if(n-i<2&&!this.isReadOnly){let i=s[n-1];if(i==this._chrDec||i==this._chrPct||i==this._chrTho||")"==i){setTimeout(()=>{n=i==this._chrPct?this._getInputRange(!0)[1]:n-1;setSelectionRange(e,n)});t.preventDefault()}}break;case Key.Delete:this._delKey=!0;if(n-i<2&&!this.isReadOnly)if("0"==s&&1==i)setSelectionRange(e,0);else{let n=s[i];if(n==this._chrDec||n==this._chrPct){setTimeout(()=>{setSelectionRange(e,i+1)});t.preventDefault()}}break;case Key.Escape:this.value=this._oldValue;this.selectAll()}}_input(){this._composing||setTimeout(()=>{let t=this._tbx,e=t.value,s=e.indexOf(this._chrDec),i=t.selectionStart,n=this._getSelStartDigits();"p"==this._fmtSpc&&e.length&&e.indexOf(this._chrPct)<0&&(e+=this._chrPct);this._setText(e);if(this.containsFocus()){let h=t.value,l=h.indexOf(this._chrDec),a=this._getInputRange(!0);if(e==this._chrNeg+this._chrDec&&l>-1){setSelectionRange(t,l+1);return}if(e[0]==this._chrNeg&&h[0]!=this._chrNeg){1==h.length?setSelectionRange(t,1):this._setSelStartDigits(n);return}e?e==this._chrDec&&l>-1?i=l+1:i<=s&&l>-1||s<0&&l<0?i+=h.length-e.length:s<0&&l>-1&&(i=l):i=l>-1?l:a[1];i=clamp(i,a[0],a[1]);setSelectionRange(t,i)}})}_clickSpinner(t){if(!t.defaultPrevented&&!this.isReadOnly&&this.step){this._increment(this.step*(contains(this._btnUp,t.target)?1:-1));this.isTouching||setTimeout(()=>this.selectAll())}}_updateAria(){let t=this.hostElement;if(t){setAttribute(t,"aria-valuemin",this.min);setAttribute(t,"aria-valuemax",this.max);setAttribute(t,"aria-valuenow",this.value)}}}InputNumber.controlTemplate='<div class="wj-input"><div class="wj-input-group"><span wj-part="btn-dec" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">-</button></span><input type="tel" wj-part="input" class="wj-form-control wj-numeric"/><span wj-part="btn-inc" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">+</button></span></div></div>';export class InputMask extends Control{constructor(t,e){super(t);this.valueChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-inputmask",s,{_tbx:"input"},"input");if("INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(this.value=t)}this._msk=new _MaskProvider(this._tbx);this.isRequired=!0;this.initialize(e);this.addEventListener(this._tbx,"input",()=>{this.onValueChanged()});this.addEventListener(this._tbx,"blur",this._commitText.bind(this));this.addEventListener(this._tbx,"keydown",t=>{t.keyCode==Key.Enter&&this._commitText()})}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._tbx.value}set value(t){if(t!=this.value){this._tbx.value=asString(t);t=this._msk._applyMask();this._tbx.value=t;this.onValueChanged()}}get rawValue(){return this._msk.getRawValue()}set rawValue(t){t!=this.rawValue&&(this.value=asString(t))}get mask(){return this._msk.mask}set mask(t){let e=this.value;this._msk.mask=asString(t);this.value!=e&&this.onValueChanged()}get promptChar(){return this._msk.promptChar}set promptChar(t){let e=this.value;this._msk.promptChar=t;this.value!=e&&this.onValueChanged()}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get maskFull(){return this._msk.maskFull}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(t){this._tbx.readOnly=asBoolean(t);toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}selectAll(){let t=this._msk.getMaskRange();setSelectionRange(this._tbx,t[0],t[1]+1)}onValueChanged(t){if(this.value!=this._oldValue){this._oldValue=this.value;this.valueChanged.raise(this,t)}this._updateState()}_commitText(){if((this.value||this.isRequired)&&!this.maskFull&&!this.onInvalidInput(new CancelEventArgs)){let t=this._tbx,e=t.value,s=e.indexOf(this.promptChar);s>-1&&setSelectionRange(t,s,e.length)}}dispose(){this._msk.input=null;super.dispose()}refresh(t=!0){super.refresh(t);this.hostElement&&this._msk.refresh()}onGotFocus(t){super.onGotFocus(t);this.selectAll()}}InputMask.controlTemplate='<div class="wj-input"><div class="wj-input-group"><input wj-part="input" class="wj-form-control"/></div></div>';export class ColorPicker extends Control{constructor(t,e){super(t);this._hsb=[.5,1,1];this._alpha=1;this.valueChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-colorpicker",s,{_eSB:"div-sb",_eHue:"div-hue",_eAlpha:"div-alpha",_ePreview:"div-pv",_ePal:"div-pal",_eText:"div-text"});this._palette="#FFF,#000, #F00,#FFC000,#FFFF00,#92D050,#00B050,#00B0F0,#0070C0,#7030A0".split(",");this._updatePalette();this._eHue.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAD4CAIAAACi6hsPAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAGvSURBVDhPXdBPaM9xHMfxz4pWaxcmtoOhpdXSVpiyHWxqmVpDjaU5rK34XfypjTJ/p+ZPay6jhsOsRrKwaJElf9IQq03WIkv4FeMwMq221tfje1ByeFzfvd7PEKWGEKWTQRZLySWfVRRTQjmVbKWGOhLsZT+HaeY0bbTTQSfdXOcWffTzmAFeMcwoYyT5ygS/mA5hNgphip98J8kHRnnNSwZ4yH1uc4OrdHGR87RximYO0cgedlLLdqqoYAPrWMtKVrCcJSxiPmnMJUQp/Bsyk2xyyKOAQooopYwKtlDNDur5G7SBJo7RQiv/B+2hl3s84CkvGGKEOOYnxolj/mYmhBmDJ5ngCx95xxsGecYj4pB3iENeoZMO2mmlhaMcpIE4ZII6aqhmM3HMMkooopB88sghm0wySCeVlCjMCVFIYx4LWUwOeRSwhmLWU84mqqihll3sppEmjnOSs5zjEl1c4yZ99POE5wwxwns+840fTDFLFKaZZIJxkozxlmEGGSC+GF++Sy89dHOZC8Rr4lVnOMERDrCPBPXEX22jko2UEn+/mnxyWUYWC0gnNUQh/AEc0HJs6cex0gAAAABJRU5ErkJggg==)";this._eHue.style.backgroundSize="contain";if(navigator.appVersion.indexOf("MSIE 9")>-1){this._eSB.children[0].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#ffffffff,endColorstr=#00ffffff,GradientType=1)";this._eSB.children[1].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr=#ff000000,GradientType=0)"}s=ColorPicker._tplCursor;this._cSB=createElement(s);this._cHue=createElement(s);this._cHue.style.width="100%";this._cAlpha=createElement(s);this._cAlpha.style.height="100%";this._eSB.appendChild(this._cSB);this._eHue.appendChild(this._cHue);this._eAlpha.appendChild(this._cAlpha);let i=this.addEventListener.bind(this),n=this.removeEventListener.bind(this),h=document;i(this.hostElement,"mousedown",t=>{i(h,"mousemove",mouseMove);i(h,"mouseup",mouseUp);this._mouseDown(t)});i(this.hostElement,"touchstart",t=>{i(h,"touchmove",mouseMove);i(h,"touchend",mouseUp);this._mouseDown(t)});let mouseMove=t=>{this._mouseMove(t)},mouseUp=t=>{n(h,"mousemove",mouseMove);n(h,"mouseup",mouseUp);n(h,"touchmove",mouseMove);n(h,"touchend",mouseUp);this._mouseUp(t)};i(this.hostElement,"click",t=>{let e=t.target;if(e&&"DIV"==e.tagName&&contains(this._ePal,e)){let t=e.style.backgroundColor;t&&(this.value=new Color(t).toString())}});this.value="#ffffff";this.initialize(e);this._updatePanels()}get showAlphaChannel(){return"none"!=this._eAlpha.parentElement.style.display}set showAlphaChannel(t){this._eAlpha.parentElement.style.display=asBoolean(t)?"":"none"}get showColorString(){return"none"!=this._eText.style.display}set showColorString(t){this._eText.style.display=asBoolean(t)?"":"none"}get value(){return this._value}set value(t){if(t!=this.value){this._value=asString(t);this._eText.innerText=this._value;let e=new Color(this._value),s=e.getHsb();if(this._hsb[0]!=s[0]||this._hsb[1]!=s[1]||this._hsb[2]!=s[2]||this._alpha!=e.a){if(0==s[2]){s[0]=this._hsb[0];s[1]=this._hsb[1]}else 0==s[1]&&(s[0]=this._hsb[0]);this._hsb=s;this._alpha=e.a;this.onValueChanged()}}}get palette(){return this._palette}set palette(t){t=asArray(t);for(let e=0;e<t.length&&e<this._palette.length;e++){let s=asString(t[e]);this._palette[e]=s}this._updatePalette()}onValueChanged(t){this._updatePanels();this.valueChanged.raise(this,t)}_mouseDown(t){this._htDown=this._getTargetPanel(t);if(this._htDown){t.preventDefault();this.focus();this._mouseMove(t)}}_mouseMove(t){var e=t.touches?t.touches[0]:t;if(this._htDown){let t=this._htDown.getBoundingClientRect();if(this._htDown==this._eHue){this._hsb[0]=clamp((e.clientY-t.top)/t.height,0,.99);this._updateColor()}else if(this._htDown==this._eSB){this._hsb[1]=clamp((e.clientX-t.left)/t.width,0,1);this._hsb[2]=clamp(1-(e.clientY-t.top)/t.height,0,1);this._updateColor()}else if(this._htDown==this._eAlpha){this._alpha=clamp((e.clientX-t.left)/t.width,0,1);this._updateColor()}}}_mouseUp(t){this._htDown=null}_updateColor(){let t=Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],this._alpha);this.value=t.toString();this._updatePanels()}_updatePalette(){let t=new Color("#fff"),e=new Color("#000");this._ePal.innerHTML="";for(let s=0;s<this._palette.length;s++){let i=createElement('<div style="float:left;width:10%;box-sizing:border-box;padding:1px">'),n=new Color(this._palette[s]),h=n.getHsb();i.appendChild(this._makePalEntry(n,4));for(let s=0;s<5;s++){if(0==h[1]){let i=.1*s+(h[2]>.5?.05:.55);n=Color.interpolate(t,e,i)}else n=Color.fromHsb(h[0],.1+.2*s,1-.1*s);i.appendChild(this._makePalEntry(n,0))}this._ePal.appendChild(i)}}_makePalEntry(t,e){let s=document.createElement("div");setCss(s,{cursor:"pointer",backgroundColor:t.toString(),marginBottom:e||""});s.innerHTML="&nbsp";return s}_updatePanels(){let t=Color.fromHsb(this._hsb[0],1,1,1),e=Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],1);this._eSB.style.backgroundColor=t.toString();this._eAlpha.style.background="linear-gradient(to right, transparent 0%, "+e.toString()+" 100%)";navigator.appVersion.indexOf("MSIE 9")>-1&&(this._eAlpha.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr="+e.toString()+", GradientType = 1)");this._ePreview.style.backgroundColor=this.value;this._cHue.style.top=(100*this._hsb[0]).toFixed(0)+"%";this._cSB.style.left=(100*this._hsb[1]).toFixed(0)+"%";this._cSB.style.top=(100-100*this._hsb[2]).toFixed(0)+"%";this._cAlpha.style.left=(100*this._alpha).toFixed(0)+"%"}_getTargetPanel(t){let e=t.target;return contains(this._eSB,e)?this._eSB:contains(this._eHue,e)?this._eHue:contains(this._eAlpha,e)?this._eAlpha:null}}ColorPicker.controlTemplate='<div style="position:relative;width:100%;height:100%"><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-pal"><div style="float:left;width:10%;box-sizing:border-box;padding:2px"><div style="background-color:black;width:100%">&nbsp;</div><div style="height:6px"></div></div></div><div wj-part="div-text" style="position:absolute;bottom:0px;display:none"></div></div><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-sb" class="wj-colorbox" style="float:left;width:89%;height:89%"><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to right, white 0%,transparent 100%)"></div><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to top, black 0%,transparent 100%)"></div></div><div style="float:left;width:1%;height:89%"></div><div style="float:left;width:10%;height:89%"><div wj-part="div-hue" class="wj-colorbox"></div></div><div style="float:left;width:89%;height:1%"></div><div style="float:left;width:89%;height:10%"><div style="width:100%;height:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAAcSURBVBhXY/iPBBYgAWpKQGkwgMqDAdUk/v8HAM7Mm6GatDUYAAAAAElFTkSuQmCC)"><div wj-part="div-alpha" class="wj-colorbox"></div></div></div><div style="float:left;width:1%;height:10%"></div><div style="float:left;width:10%;height:10%"><div wj-part="div-pv" class="wj-colorbox" style="position:static"></div></div></div></div>';ColorPicker._tplCursor='<div style="position:absolute;left:50%;top:50%;width:7px;height:7px;transform:translate(-50%,-50%);border:2px solid #f0f0f0;border-radius:50px;box-shadow:0px 0px 4px 2px #0f0f0f"></div>';export class CollectionViewNavigator extends Control{constructor(t,e){super(t);this._byPage=!1;this._fmt="{current:n0} / {count:n0}";let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-pager wj-collectionview-navigator",s,{_btnFirst:"btn-first",_btnPrev:"btn-prev",_txtCurr:"txt-curr",_btnNext:"btn-next",_btnLast:"btn-last"},"input");this._rptNext=new _ClickRepeater(this._btnNext.querySelector("button"));this._rptPrev=new _ClickRepeater(this._btnPrev.querySelector("button"));this.addEventListener(this.hostElement,"click",this._click.bind(this));this.initialize(e);this._update()}get cv(){return this._view}set cv(t){if(t!=this._view){let e=this._view;if(e){e.collectionChanged.removeHandler(this._collectionChanged);e.currentChanged.removeHandler(this._currentChanged)}e=this._view=asType(t,"ICollectionView",!0);this._update();if(e){e.collectionChanged.addHandler(this._collectionChanged,this);e.currentChanged.addHandler(this._currentChanged,this)}}}get byPage(){return this._byPage}set byPage(t){if(t!=this._byPage){this._byPage=asBoolean(t);this._update()}}get headerFormat(){return this._fmt}set headerFormat(t){if(t!=this._fmt){this._fmt=asString(t);this._update()}}get repeatButtons(){return!this._rptNext.disabled}set repeatButtons(t){this._rptNext.disabled=this._rptPrev.disabled=!asBoolean(t)}_update(){let t=this._view,e=this._byPage,s=t?e?t.pageIndex:t.currentPosition:0,i=t?e?t.pageCount:t.itemCount:0;enable(this._btnFirst,t&&s>0);enable(this._btnPrev,t&&s>0);enable(this._txtCurr,null!=t);enable(this._btnNext,t&&s<i-1);enable(this._btnLast,t&&s<i-1);this._txtCurr.value=format(this._fmt,{current:t?s+1:0,count:t?i:0,currentItem:t?t.currentPosition+1:0,itemCount:t?t.itemCount:0,currentPage:t?t.pageIndex+1:0,pageCount:t?t.pageCount:0})}_currentChanged(){this._update()}_collectionChanged(){this._update()}_click(t){let e=t.target,s=this._view,i=this._byPage;if(s){contains(this._btnFirst,e)?i?s.moveToFirstPage():s.moveCurrentToFirst():contains(this._btnPrev,e)?i?s.moveToPreviousPage():s.moveCurrentToPrevious():contains(this._btnNext,e)?i?s.moveToNextPage():s.moveCurrentToNext():contains(this._btnLast,e)&&(i?s.moveToLastPage():s.moveCurrentToLast());t.preventDefault()}}}CollectionViewNavigator.controlTemplate='<div class="wj-input-group"><span wj-part="btn-first" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-step-backward"></span></button></span><span wj-part="btn-prev" class="wj-input-group-btn"> <button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-left"></span> </button></span><input wj-part="txt-curr" class="wj-form-control" readonly><span wj-part="btn-next" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-right"></span></button></span><span wj-part="btn-last" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-step-forward"></span></button></span></div>';export class ListBox extends Control{constructor(t,e){super(t);this._pathDisplay=new Binding(null);this._pathValue=new Binding(null);this._pathChecked=new Binding(null);this._html=!1;this._shGroups=!1;this._itemRole="option";this._search="";this._caseSensitive=!1;this._fmtItemHandlers=0;this._itemCount=0;this.selectedIndexChanged=new Event;this.itemsChanged=new Event;this.loadingItems=new Event;this.loadedItems=new Event;this.itemChecked=new Event;this.checkedItemsChanged=new Event;this.formatItem=new Event(()=>{this.invalidate()});this.applyTemplate("wj-control wj-content wj-listbox",null,null);let s=this.hostElement;setAttribute(s,"role","listbox",!0);"SELECT"==this._orgTag&&this._initFromSelect(this.hostElement);this.addEventListener(s,"click",this._click.bind(this));this.addEventListener(s,"keydown",this._keydown.bind(this));this.addEventListener(s,"keypress",this._keypress.bind(this));this.addEventListener(s,"wheel",t=>{if(s.scrollHeight>s.offsetHeight&&(t.deltaY<0&&0==s.scrollTop||t.deltaY>0&&s.scrollTop+s.offsetHeight>=s.scrollHeight)){t.preventDefault();t.stopPropagation();t.stopImmediatePropagation()}});this.initialize(e)}get itemsSource(){return this._items}set itemsSource(t){if(this._items!=t){if(this._cv){this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this);this._cv=null}this._items=t;this._checkedItems=null;this._cv=asCollectionView(t);if(null!=this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this)}this._populateList();this.onItemsChanged();this.onSelectedIndexChanged()}}get collectionView(){return this._cv}get showGroups(){return this._shGroups}set showGroups(t){if(t!=this._shGroups){this._shGroups=asBoolean(t);this._populateList()}}get isContentHtml(){return this._html}set isContentHtml(t){if(t!=this._html){this._html=asBoolean(t);this._populateList()}}get itemFormatter(){return this._itemFormatter}set itemFormatter(t){if(t!=this._itemFormatter){this._itemFormatter=asFunction(t);this._populateList()}}get displayMemberPath(){return this._pathDisplay.path}set displayMemberPath(t){if(t!=this.displayMemberPath){this._pathDisplay.path=asString(t);this._populateList()}}get selectedValuePath(){return this._pathValue.path}set selectedValuePath(t){this._pathValue.path=asString(t)}get checkedMemberPath(){return this._pathChecked.path}set checkedMemberPath(t){if(t!=this.checkedMemberPath){this._pathChecked.path=asString(t);this._populateList()}}get caseSensitiveSearch(){return this._caseSensitive}set caseSensitiveSearch(t){this._caseSensitive=asBoolean(t)}get itemRole(){return this._itemRole}set itemRole(t){if(t!=this.itemRole){this._itemRole=asString(t);this._populateList()}}getDisplayValue(t){let e=null;if(t>-1&&hasItems(this._cv)){e=this._cv.items[t];this.displayMemberPath&&(e=this._pathDisplay.getValue(e))}let s=null!=e?e.toString():"";this._itemFormatter&&(s=this._itemFormatter(t,s));return s}getDisplayText(t){let e=this._getChild(t);return null!=e?e.textContent:""}isItemEnabled(t){var e=this._getChild(t);return null!=e&&!e.hasAttribute("disabled")&&!hasClass(e,"wj-state-disabled")&&!hasClass(e,"wj-separator")}get selectedIndex(){return this._cv?this._cv.currentPosition:-1}set selectedIndex(t){this._cv&&this._cv.moveCurrentToPosition(asNumber(t))}get selectedItem(){return this._cv?this._cv.currentItem:null}set selectedItem(t){this._cv&&this._cv.moveCurrentTo(t)}get selectedValue(){let t=this.selectedItem;t&&this.selectedValuePath&&(t=this._pathValue.getValue(t));return t}set selectedValue(t){let e=this._cv,s=e?e.items:null,i=this.selectedValuePath,n=-1;if(s){for(let e=0;e<s.length;e++){let h=s[e],l=i?this._pathValue.getValue(h):h;if(l===t||DateTime.equals(l,t)){n=e;break}if(this.isContentHtml&&isString(l)&&l.indexOf("<")>-1&&toPlainText(l)===t){n=e;break}}this.selectedIndex=n}}get maxHeight(){let t=this.hostElement;return t?parseFloat(t.style.maxHeight):null}set maxHeight(t){let e=this.hostElement;e&&(e.style.maxHeight=asNumber(t)+"px")}showSelection(t){let e=this.selectedIndex,s=this.hostElement,i=s.children;e=this._getElementIndex(e);for(let t=0;t<i.length;t++){let s=i[t],n=t==e,h=this.checkedMemberPath?this._getCheckbox(t):null,l=h?h.checked:null;toggleClass(s,"wj-state-selected",n);setAttribute(s,"aria-selected",this._getAriaSelected(n,l));s.tabIndex=n?this._orgTabIndex:-1}if(e>-1&&e<i.length){let t=i[e].getBoundingClientRect(),n=s.getBoundingClientRect(),h=0;if(this._shGroups){let t=i[0];hasClass(t,"wj-header")&&(h=t.offsetHeight)}t.bottom>n.bottom?s.scrollTop+=t.bottom-n.bottom:t.top<n.top+h&&(s.scrollTop-=n.top+h-t.top)}if(e>-1){null==t&&(t=this.containsFocus());if(t){let t=i[e];t instanceof HTMLElement&&!contains(t,getActiveElement())&&t.focus()}}s.tabIndex=e<0?this._orgTabIndex:-1}loadList(){this._populateList()}getItemChecked(t){let e=this._cv.items[t],s=this._pathChecked;if(isObject(e)&&s.path)return s.getValue(e);let i=this._getCheckbox(t);return!!i&&i.checked}setItemChecked(t,e){this._setItemChecked(t,e,!0)}toggleItemChecked(t){this.setItemChecked(t,!this.getItemChecked(t))}get checkedItems(){if(null==this._checkedItems){let t=this.collectionView;this._checkedItems=t&&this.checkedMemberPath?t.items.filter((t,e)=>this.getItemChecked(e)):[]}return this._checkedItems}set checkedItems(t){let e=asArray(t,!1),s=this._cv;if(!this._arrayEquals(e,this.checkedItems)){if(s){let t=this.hostElement,i=s.currentPosition,n=t.scrollTop;s.items.forEach((t,s)=>{let i=e.indexOf(t)>-1;this._setItemChecked(s,i,!1)});s.moveCurrentToPosition(i);t.scrollTop=n}this.onCheckedItemsChanged()}}indexOf(t){if(this._shGroups&&hasClass(t,"wj-header"))return-1;let e=this.hostElement.children;for(let s=0,i=0;s<e.length;s++){let n=e[s];if(contains(e[s],t))return i;this._shGroups&&hasClass(n,"wj-header")||i++}return-1}onSelectedIndexChanged(t){this.selectedIndexChanged.raise(this,t)}onItemsChanged(t){this.itemsChanged.raise(this,t)}onLoadingItems(t){this.loadingItems.raise(this,t)}onLoadedItems(t){this.loadedItems.raise(this,t)}onItemChecked(t){this.itemChecked.raise(this,t)}onCheckedItemsChanged(t){this._checkedItems=null;this.checkedItemsChanged.raise(this,t)}onFormatItem(t){this.formatItem.raise(this,t)}refresh(t=!0){super.refresh(t);if(this.hostElement){let t=this._cv?this._cv.items.length:0,e=this.formatItem.handlerCount;if(t!=this._itemCount||e!=this._fmtItemHandlers){this._fmtItemHandlers=e;this._populateList()}}}_arrayEquals(t,e){if(t==e)return!0;if(!t||!e||t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!=e[s])return!1;return!0}_getChild(t){t=this._getElementIndex(t);return this.hostElement.children[t]}_getElementIndex(t){if(this._shGroups){let e=this.hostElement.children;for(let s=0;s<=t&&s<e.length;s++){let i=e[s];hasClass(i,"wj-header")&&t++}}return t}_setItemChecked(t,e,s=!0){let i=this._cv.items[t],n=this._pathChecked,h=!1;if(isObject(i)&&n.path){let t=tryCast(this._cv,"IEditableCollectionView");if(n.getValue(i)!=e){h=!0;this._checking=!0;if(t){t.editItem(i);n.setValue(i,e);t.commitEdit()}else{n.setValue(i,e);this._cv.refresh()}this._checking=!1}}else h=!0;let l=this._getCheckbox(t);if(l){l.checked=e;let t=closest(l,".wj-listbox-item");if(t){toggleClass(t,"wj-state-checked",e);setAttribute(t,"aria-selected",!!e||null)}}if(h&&s){this.onItemChecked();this.onCheckedItemsChanged()}return h}_cvCollectionChanged(){if(!this._checking){this._populateList();this.onItemsChanged()}}_cvCurrentChanged(){if(!this._checking){this.showSelection();this.onSelectedIndexChanged()}}_populateList(){let t=this.hostElement;this._itemCount=this._cv?this._cv.items.length:0;if(t){let e,s=this.containsFocus(),i=-1;this.onLoadingItems();t.textContent="";t.scrollTop=0;let n=this._cv;if(n){let s,h=[],l=0;i=n.currentPosition;if(this._shGroups&&n.groups&&n.groups.length){e={};for(let t=0;t<n.groups.length;t++){let i=n.groups[t];e[l]=i;s=this._createHeaderItem(i);h.push(s);for(let t=0;t<i.items.length;t++,l++){s=this._createItem(l);h.push(s)}}}else for(let t=0;t<n.items.length;t++,l++){s=this._createItem(l);h.push(s)}t.innerHTML=h.join("")}if(this.formatItem.hasHandlers&&n){let s=t.children,i=n.items,h=0,l=new FormatItemEventArgs(0,null,null);for(let t=0;t<s.length;t++){l._item=s[t];if(this._shGroups&&hasClass(l._item,"wj-header")){l._index=-1;l._data=e[h]}else{l._index=h;l._data=i[h];h++}this.onFormatItem(l)}}0==t.children.length&&t.appendChild(document.createElement("div"));t.tabIndex=i<0?this._orgTabIndex:-1;if(s){(i>=0?t.children[this._getElementIndex(i)]:t).focus()}else i>0&&this.showSelection();this.onLoadedItems()}}_createItem(t){let e=this._cv.items[t],s=t==this._cv.currentPosition,i=this.getDisplayValue(t);1!=this._html&&(i=escapeHtml(i));let n=null;this.checkedMemberPath&&(i='<label><input type="checkbox" tabindex="-1"'+((n=!!this._pathChecked.getValue(e))?" checked":"")+"><span></span> "+i+"</label>");let h="wj-listbox-item";s&&(h+=" wj-state-selected");n&&(h+=" wj-state-checked");if(this._html){let t=["wj-separator","wj-state-disabled"];if(i.indexOf(t[0])>-1||i.indexOf(t[1])>-1){let e=createElement(i);t.forEach(t=>{hasClass(e,t)&&(h+=" "+t)})}}return'<div class="'+h+'" role="'+this.itemRole+'" '+(this._getAriaSelected(s,n)?'aria-selected="true" ':"")+'tabindex="'+(s?this._orgTabIndex:-1)+'">'+i+"</div>"}_getAriaSelected(t,e){return!(!e&&!t)||null}_createHeaderItem(t){return'<div class="wj-listbox-item wj-header wj-state-disabled" role="presentation" tabindex="-1">'+escapeHtml(t.name)+"</div>"}_click(t){if(0==t.button&&!t.defaultPrevented){let e=this.indexOf(t.target);if(e>-1){this.selectedIndex=e;if(this.checkedMemberPath){let s=this._getCheckbox(e),i=this.hostElement.children[e];if(s==t.target||t.target==i){i.focus({preventScroll:!0});this.setItemChecked(e,s.checked)}}}}}_keydown(t){let e=this.selectedIndex;this.hostElement;if(!t.defaultPrevented){if(65==t.keyCode&&(t.ctrlKey||t.metaKey)){let e=this.collectionView;if(this.checkedMemberPath&&hasItems(e)){this.checkedItems=this.checkedItems.length!=e.items.length?e.items:[];t.preventDefault();return}}if(!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey))switch(t.keyCode){case Key.Down:t.preventDefault();this._selectNext();break;case Key.Up:t.preventDefault();this._selectPrev();break;case Key.Home:t.preventDefault();this._selectFirst();break;case Key.End:t.preventDefault();this._selectLast();break;case Key.PageDown:t.preventDefault();this._selectNextPage();break;case Key.PageUp:t.preventDefault();this._selectPrevPage();break;case Key.Space:if(this.checkedMemberPath&&e>-1){let s=this._getCheckbox(e);if(s&&this.isItemEnabled(e)){this.setItemChecked(e,!s.checked);t.preventDefault()}}}}}_keypress(t){if(!t.defaultPrevented&&!(t.target instanceof HTMLInputElement)&&(t.charCode>32||32==t.charCode&&this._search)){t.preventDefault();this._search+=String.fromCharCode(t.charCode);this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout(()=>{this._toSearch=null;this._search=""},Control._SEARCH_DELAY);let e=this._findNext();if(e<0&&this._search.length>1){this._search=this._search[this._search.length-1];e=this._findNext()}e>-1&&(this.selectedIndex=e)}}_selectNext(){let t=this.hostElement.children.length;for(let e=this.selectedIndex+1;e<t;e++)if(this.isItemEnabled(e)){this.selectedIndex=e;return!0}return!1}_selectPrev(){for(let t=this.selectedIndex-1;t>=0;t--)if(this.isItemEnabled(t)){this.selectedIndex=t;return!0}return!1}_selectFirst(){let t=this.hostElement.children.length;for(let e=0;e<t;e++)if(this.isItemEnabled(e)){this.selectedIndex=e;return!0}return!1}_selectLast(){for(let t=this.hostElement.children.length-1;t>=0;t--)if(this.isItemEnabled(t)){this.selectedIndex=t;return!0}return!1}_selectNextPage(){let t=this.hostElement,e=t.offsetHeight,s=t.children,i=0;for(let t=this.selectedIndex+1;t<this._cv.items.length;t++){let n=s[t].scrollHeight;if(i+n>e&&this.isItemEnabled(t)){this.selectedIndex=t;return!0}i+=n}return this._selectLast()}_selectPrevPage(){let t=this.hostElement,e=t.offsetHeight,s=t.children,i=0;for(let t=this.selectedIndex-1;t>0;t--){let n=s[t].scrollHeight;if(i+n>e&&this.isItemEnabled(t)){this.selectedIndex=t;return!0}i+=n}return this._selectFirst()}_findNext(){if(this.hostElement){let t=this.hostElement.childElementCount,e=this.selectedIndex;(e<0||1==this._search.length)&&e++;let s=this._search,i=this.caseSensitiveSearch;i||(s=s.toLowerCase());for(let n=0;n<t;n++){let h=(e+n)%t;if(this.isItemEnabled(h)){let t=this.getDisplayText(h).trim();i||(t=t.toLowerCase());if(0==t.indexOf(s))return h}}}return-1}_getCheckbox(t){let e=this.hostElement,s=e?e.children:null;t=this._getElementIndex(t);return e&&t>-1&&t<s.length?s[t].querySelector("input[type=checkbox]"):null}_initFromSelect(t){let e=t.children,s=[],i=-1;for(let n=0;n<e.length;n++){let h=e[n];if("OPTION"==h.tagName){h.hasAttribute("selected")&&(i=s.length);h.innerHTML?s.push({hdr:h.innerHTML,val:h.getAttribute("value"),cmdParam:h.getAttribute("cmd-param")}):s.push({hdr:'<div class="wj-separator"></div>'});t.removeChild(h);n--}}if(s){this.displayMemberPath="hdr";this.selectedValuePath="val";this.itemsSource=s;this.selectedIndex=i}}}export class FormatItemEventArgs extends EventArgs{constructor(t,e,s){super();this._index=asNumber(t);this._data=e;this._item=asType(s,HTMLElement,!0)}get index(){return this._index}get data(){return this._data}get item(){return this._item}}_addCultureInfo("MultiSelectListBox",{filterPlaceholder:"Filter",selectAll:"Select All"});export class MultiSelectListBox extends Control{constructor(t,e){super(t);this._filterText="";this._checkOnFilter=!0;this.checkedItemsChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-multiselectlistbox",s,{_selectAll:"select-all",_filter:"filter",_lbHost:"list-box"});this._selectAll.style.display="none";this._filter.style.display="none";this._lbx=new ListBox(this._lbHost,{checkedMemberPath:MultiSelectListBox._DEF_CHECKED_PATH,checkedItemsChanged:()=>{this.onCheckedItemsChanged()}});this._cbSelectAll=this._selectAll.querySelector("input[type=checkbox]");this._spSelectAll=this._selectAll.querySelector("label>span");let i=culture.MultiSelectListBox;setText(this._spSelectAll,i.selectAll);this._filter.placeholder=i.filterPlaceholder;this.initialize(e);this.addEventListener(this._filter,"input",()=>{if(this._filter.value!=this._filterText){this._filterText=this._filter.value;this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout(()=>{this._toSearch=null;this._applyFilter()},Control._SEARCH_DELAY)}});this.addEventListener(this._cbSelectAll,"click",t=>{let e=this._lbx.collectionView;hasItems(e)&&(this.checkedItems=t.target.checked?e.items:[])});this.addEventListener(this.hostElement,"keydown",t=>{let e=this._filter;if(t.keyCode==Key.F3){setSelectionRange(e,0,e.value.length);t.preventDefault()}if(getActiveElement()==e)t.stopPropagation();else switch(t.keyCode){case Key.Down:case Key.Up:case Key.Home:case Key.End:case Key.PageDown:case Key.PageUp:this._lbx.focus()}})}get itemsSource(){return this._lbx.itemsSource}set itemsSource(t){this._lbx.itemsSource=t}get displayMemberPath(){return this._lbx.displayMemberPath}set displayMemberPath(t){this._lbx.displayMemberPath=t}get isContentHtml(){return this._lbx.isContentHtml}set isContentHtml(t){this._lbx.isContentHtml=t}get showGroups(){return this._lbx.showGroups}set showGroups(t){this._lbx.showGroups=t}get checkOnFilter(){return this._checkOnFilter}set checkOnFilter(t){if(t!=this.checkOnFilter){this._checkOnFilter=asBoolean(t);this.checkedItems=[]}}get listBox(){return this._lbx}get showFilterInput(){return""==this._filter.style.display}set showFilterInput(t){if(t!=this.showFilterInput){this._filter.style.display=asBoolean(t)?"":"none";if(!this.showFilterInput){this._filter.value="";this._applyFilter()}}}get filterInputPlaceholder(){return this._filterPlaceholder}set filterInputPlaceholder(t){if(t!=this._filterPlaceholder){this._filterPlaceholder=asString(t);this.invalidate()}}get showSelectAllCheckbox(){return""==this._selectAll.style.display}set showSelectAllCheckbox(t){this._selectAll.style.display=asBoolean(t)?"":"none"}get selectAllLabel(){return this._selectAllLabel}set selectAllLabel(t){if(t!=this._selectAllLabel){this._selectAllLabel=asString(t);this.refresh()}}get checkedMemberPath(){let t=this.listBox.checkedMemberPath;return t!=MultiSelectListBox._DEF_CHECKED_PATH?t:null}set checkedMemberPath(t){t=asString(t);this.listBox.checkedMemberPath=t||MultiSelectListBox._DEF_CHECKED_PATH}get checkedItems(){return this.listBox.checkedItems}set checkedItems(t){this.listBox.checkedItems=asArray(t)}onCheckedItemsChanged(t){this._updateCheckAllCheckbox();this.checkedItemsChanged.raise(this,t)}refresh(t=!0){super.refresh(t);if(this.hostElement){let t=culture.MultiSelectListBox;this._filter.placeholder=null!=this._filterPlaceholder?this._filterPlaceholder:t.filterPlaceholder;this._spSelectAll&&setText(this._spSelectAll,null!=this._selectAllLabel?this._selectAllLabel:t.selectAll);this._updateCheckAllCheckbox()}}dispose(){this.listBox.dispose();super.dispose()}_applyFilter(){let t=this._lbx,e=t.collectionView,s=this._filter.value,i=s?new RegExp(escapeRegExp(s),"i"):null,n=this.displayMemberPath,h=n?new Binding(n):null,l=this._checkOnFilter?this.checkedItems:[];e.filter=t=>{if(null!=i){h&&(t=h.getValue(t));this.isContentHtml&&(t=toPlainText(t));return null!=t&&i.test(t.toString())}return!0};t.selectedIndex=Math.max(0,t.selectedIndex);this.checkedItems=this._checkOnFilter?i?e.items:[]:l}_updateCheckAllCheckbox(){let t=this._lbx.collectionView,e=this._cbSelectAll;if(hasItems(t)){let s=t.items.length,i=this.checkedItems.length;setChecked(e,i==s||0!=i&&null);e.disabled=!1}else{setChecked(e,!1);e.checked=!1;e.disabled=!0}}}MultiSelectListBox._DEF_CHECKED_PATH="$checked";MultiSelectListBox.controlTemplate='<div class="wj-template wj-listbox"><input wj-part="filter" class="wj-form-control"><div wj-part="select-all" class="wj-header wj-select-all wj-listbox-item"><label><input type="checkbox" tabindex="-1"> <span></span></label></div><div wj-part="list-box"/></div>';_addCultureInfo("Calendar",{ariaLabels:{calendar:"Calendar",monthView:"Month View",yearView:"Year View",prvMo:"Previous Month",today:"Today",nxtMo:"Next Month",prvYr:"Previous Year",currMo:"Current Month",nxtYr:"Next Year"}});export var DateSelectionMode;!function(t){t[t.None=0]="None";t[t.Day=1]="Day";t[t.Month=2]="Month"}(DateSelectionMode||(DateSelectionMode={}));export class Calendar extends Control{constructor(t,e){super(t);this._yrPicker=!0;this._mtPicker=!0;this._wksBefore=0;this._wksAfter=0;this._rngMin=0;this._rngMax=0;this._min=null;this._max=null;this._readOnly=!1;this._selMode=DateSelectionMode.Day;this._tmYrHidden=0;this._tdFirst=null;this._tdLast=null;this._fmtYrMo="y";this._fmtYr="yyyy";this._fmtDayHdr="ddd";this._fmtDay="d ";this._fmtMonths="MMM";this.valueChanged=new Event;this.rangeEndChanged=new Event;this.displayMonthChanged=new Event;this.formatItem=new Event(()=>{this.invalidate()});this._value=this._rngEnd=DateTime.newDate();this._month=this._getMonth(this._value);this._createChildren();this._createYearPicker();let s=this.hostElement,i=this.addEventListener.bind(this);i(s,"keydown",this._keydown.bind(this));i(s,"click",this._click.bind(this));this._rptUp=new _ClickRepeater(this._btnPrv);this._rptDn=new _ClickRepeater(this._btnNxt);this.addEventListener(s,"wheel",t=>{if(!t.defaultPrevented&&!this.isReadOnly&&this.containsFocus()){t.deltaY<0?this._btnPrv.click():this._btnNxt.click();t.preventDefault()}});this.initialize(e);this.refresh(!0)}get value(){return this._value}set value(t){t=asDate(t,!0);t=this._clamp(t);if(this._valid(t)||null==t){this._ensureVisible(t);if(this._value!=t&&!DateTime.equals(this._value,t)){this._value=t;this._rngEnd=null;this.invalidate(!1);this.onValueChanged()}}}get rangeEnd(){return this._rngEnd}set rangeEnd(t){t=asDate(t,!0);if((t=this._clamp(t))&&this._value&&this._rngMode()){let e=this._rngMin,s=this._rngMax;if(e&&e>0||s&&s>0){let i=this._value,n=Math.ceil((t.getTime()-i.getTime())/864e5)+1;e&&e>0&&n<e&&(t=DateTime.addDays(i,e-1));s&&s>0&&n>s&&(t=DateTime.addDays(i,s-1))}}if((this._valid(t)||null==t)&&!DateTime.equals(this._rngEnd,t)){this._rngEnd=t;this.invalidate(!1);this.onRangeEndChanged()}}get rangeMin(){return this._rngMin}set rangeMin(t){this._rngMin=asNumber(t);this._syncProp(this,"rangeMin")}get rangeMax(){return this._rngMax}set rangeMax(t){this._rngMax=asNumber(t);this._syncProp(this,"rangeMax")}get min(){return this._min}set min(t){if(t!=this.min){this._min=asDate(t,!0);this.refresh();this._syncProp(this,"min")}}get max(){return this._max}set max(t){if(t!=this.max){this._max=asDate(t,!0);this.refresh();this._syncProp(this,"max")}}get selectionMode(){return this._selMode}set selectionMode(t){if((t=asEnum(t,DateSelectionMode))!=this._selMode){this._selMode=t;this._mthMode()&&(this.monthView=!1);this.refresh();this._syncProp(this,"selectionMode")}}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t);toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly);this._syncProp(this,"isReadOnly")}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(t){this._rptUp.disabled=this._rptDn.disabled=!asBoolean(t);this._syncProp(this,"repeatButtons")}get showYearPicker(){return this._yrPicker}set showYearPicker(t){if(t!=this._yrPicker){this._yrPicker=asBoolean(t);this._syncProp(this,"showYearPicker")}}get showMonthPicker(){return this._mtPicker}set showMonthPicker(t){if(t!=this._mtPicker){this._mtPicker=asBoolean(t);this.invalidate();this._syncProp(this,"showMonthPicker")}}get firstDayOfWeek(){return this._fdw}set firstDayOfWeek(t){if(t!=this._fdw){if((t=asNumber(t,!0))&&(t>6||t<0))throw"firstDayOfWeek must be between 0 and 6 (Sunday to Saturday).";this._fdw=t;this.refresh();this._syncProp(this,"firstDayOfWeek")}}get displayMonth(){return this._month}set displayMonth(t){if(!DateTime.equals(this.displayMonth,t)){t=asDate(t);if(this.monthView?this._monthInValidRange(t):this._yearInValidRange(t)){this._month=this._getMonth(this._clamp(t));this.invalidate(!0);this.onDisplayMonthChanged()}}}get displayMonths(){return this.hostElement.querySelectorAll(".wj-calendar").length+1}set displayMonths(t){if(t!=this.displayMonths){let e=this.hostElement,s=e.querySelectorAll(".wj-calendar");t=asInt(t,!1);assert(t>0,"Calendars must have at least one display month.");assert(1==t||!closest(e.parentElement,".wj-calendar"),"Only top-level calendars can have displayMonths.");for(let t=0;t<s.length;t++){let e=s[t];removeChild(e);this._getCalendar(e).dispose()}this._cals=[this];for(let s=1;s<t;s++){let t=new Calendar(document.createElement("div"),{itemFormatter:this.itemFormatter,itemValidator:this.itemValidator,formatItem:(t,e)=>this.onFormatItem(e)});for(let e in this)if(!/^(_.*|constructor|displayMonth(s)?|hostElement|rightToLeft|isUpdating|isTouching)$/.test(e)){let s=this[e];isFunction(s)||s instanceof Event||(t[e]=s)}this._cals.push(t);e.appendChild(t.hostElement)}toggleClass(e,"wj-calendar-multimonth",t>1);this._syncProp(this,"displayMonth")}}get formatYearMonth(){return this._fmtYrMo}set formatYearMonth(t){if(t!=this._fmtYrMo){this._fmtYrMo=asString(t);this.invalidate()}}get formatDayHeaders(){return this._fmtDayHdr}set formatDayHeaders(t){if(t!=this._fmtDayHdr){this._fmtDayHdr=asString(t);this.invalidate()}}get formatDays(){return this._fmtDay}set formatDays(t){if(t!=this._fmtDay){this._fmtDay=asString(t);this.invalidate()}}get formatYear(){return this._fmtYr}set formatYear(t){if(t!=this._fmtYr){this._fmtYr=asString(t);this.invalidate()}}get formatMonths(){return this._fmtMonths}set formatMonths(t){if(t!=this._fmtMonths){this._fmtMonths=asString(t);this.invalidate()}}get showHeader(){return"none"!=this._tbHdr.style.display}set showHeader(t){this._tbHdr.style.display=asBoolean(t)?"":"none"}get monthView(){return"none"!=this._tbMth.style.display}set monthView(t){if(t!=this.monthView){this._tbMth.style.display=t?"":"none";this._tbYr.style.display=t?"none":"";this.refresh();let e=culture.Calendar.ariaLabels;setAriaLabel(this._btnPrv,t?e.prvMo:e.prvYr);setAriaLabel(this._btnTdy,t?e.today:e.currMo);setAriaLabel(this._btnNxt,t?e.nxtMo:e.nxtYr);setAriaLabel(this._btnMth,t?e.monthView:e.yearView);this._syncProp(this,"monthView")}}get weeksBefore(){return this._wksBefore}set weeksBefore(t){if(t!=this._wksBefore){this._wksBefore=Math.floor(asNumber(t,!1,!0));this._syncProp(this,"weeksBefore");this.invalidate()}}get weeksAfter(){return this._wksAfter}set weeksAfter(t){if(t!=this._wksAfter){this._wksAfter=Math.floor(asNumber(t,!1,!0));this._syncProp(this,"weeksAfter");this.invalidate()}}get itemFormatter(){return this._itemFormatter}set itemFormatter(t){if(t!=this._itemFormatter){this._itemFormatter=asFunction(t);this._syncProp(this,"itemFormatter");this.invalidate()}}get itemValidator(){return this._itemValidator}set itemValidator(t){if(t!=this._itemValidator){this._itemValidator=asFunction(t);this._syncProp(this,"itemValidator");this.invalidate()}}hitTest(t){return(t=closest(t,"td"))?t[Calendar._DATE_KEY]:null}onValueChanged(t){this.valueChanged.raise(this,t);this._syncProp(this,"value")}onRangeEndChanged(t){}onDisplayMonthChanged(t){this.displayMonthChanged.raise(this,t);this._syncProp(this,"displayMonth")}onFormatItem(t){this.formatItem.raise(this,t)}containsFocus(){return super.containsFocus()||this._lbYears.containsFocus()}dispose(){this._rptUp.element=null;this._rptDn.element=null;this._lbYears.dispose();super.dispose()}refresh(t=!0){let e=this.hostElement,s=this.containsFocus();if(e){super.refresh(t);t&&this._updateContent();this._updateSelection();if(s){let t=(this.monthView?this._tbMth:this._tbYr).querySelector("td.wj-state-selected")||e;t&&t.focus()}}}_getCalendar(t){return Control.getControl(t)}_getCalendars(){let t=closest(this.hostElement,".wj-calendar-multimonth");return(t?this._getCalendar(t):this)._cals}_syncProp(t,e){if(!this._syncing){let s=this._getCalendars();if(s&&s.length>1){let i=t[e],n=DateTime,h=this._mthMode()?n.addYears:n.addMonths;"displayMonth"==e&&(i=h(i,-s.indexOf(t)));s[0].deferUpdate(()=>{this._syncing=!0;s.forEach((s,n)=>{if(s!=t){let t=s.displayMonth;s[e]="displayMonth"==e?h(i,n):i;if("value"==e){s.displayMonth=t;this._rngMode()&&(s.rangeEnd=null)}}});this._syncing=!1})}}}_updateContent(){let t=this.displayMonth,e=Globalize.format,s=DateTime;setText(this._spMth,e(t,this._fmtYrMo));let i=this._btnMth.querySelector(".wj-glyph-down");i&&(i.style.display=this._mthMode()||!this._mtPicker?"none":"");let n=null!=this._fdw?this._fdw:Globalize.getFirstDayOfWeek(),h=s.addDays(t,-(t.getDay()-n+7)%7),l=s.monthLast(t),a=this._tbMth.querySelectorAll("td");for(let t=0;t<7&&t<a.length;t++){let i=s.addDays(h,t);setText(a[t],e(i,this._fmtDayHdr))}let r=this._tbMth.querySelectorAll("tr");for(let t=1;t<r.length;t++)removeChild(r[t]);let o=s.addDays(h,-7*this._wksBefore);for(let t=0;t<this._wksBefore;t++)o=this._addWeek(o,"wj-week-before");for(;o<=l;)o=this._addWeek(o);for(let t=0;t<this._wksAfter;t++)o=this._addWeek(o,"wj-week-after");this._tdFirst=s.addDays(h,-7*this._wksBefore);this._tdLast=s.addDays(o,-1);(a=this._tbYr.querySelectorAll("td")).length&&setText(a[0],e(t,this._fmtYr));for(let i=1;i<a.length;i++){o=s.newDate(t.getFullYear(),i-1,1);let n=a[i],h=!this._monthInValidRange(o);n[Calendar._DATE_KEY]=o;setText(n,e(o,this._fmtMonths));toggleClass(n,"wj-state-disabled",h)}}_updateSelection(){let t=Calendar._DATE_KEY,e=DateTime,s=this._tbMth.querySelectorAll("td");for(let i=7;i<s.length;i++){let n=s[i],h=n[t],l=this.value,a=this.rangeEnd,r=this._selMode&&e.sameDate(h,l),o=this._selMode&&e.sameDate(h,a),d=this._selMode&&h>l&&null!=a&&h<=a;toggleClass(n,"wj-state-selected",r);toggleClass(n,"wj-state-multi-selected",d);toggleClass(n,"wj-state-last-selected",o);setAttribute(n,"aria-selected",!!r||null);this._customizeCell(i,h,n)}s=this._tbYr.querySelectorAll("td");for(let e=0;e<s.length;e++){let i=s[e],n=i[t],h=this._sameMonth(n,this.value);toggleClass(i,"wj-state-selected",h);setAttribute(i,"aria-selected",!!h||null)}}_addWeek(t,e){let s=this._createElement("tr",this._tbMth,e),i=DateTime;for(let e=0;e<7;e++){let n=this._createElement("td",s),h=i.addDays(t,e);n[Calendar._DATE_KEY]=h;setText(n,Globalize.format(h,this._fmtDay));let l=!this._valid(h),a=h.getDay(),r=h.getMonth()!=this.displayMonth.getMonth();toggleClass(n,"wj-day-today",i.sameDate(h,i.newDate()));toggleClass(n,"wj-day-weekend",0==a||6==a);toggleClass(n,"wj-day-othermonth",r||!this._inValidRange(h)||l);toggleClass(n,"wj-state-invalid",l)}return i.addDays(t,7)}_customizeCell(t,e,s){isFunction(this.itemFormatter)&&this.itemFormatter(e,s);if(this.formatItem.hasHandlers){let i=new FormatItemEventArgs(t,e,s);this.onFormatItem(i)}}_canChangeValue(){return!this._readOnly&&this._selMode!=DateSelectionMode.None}_valid(t){return!(!isDate(t)||!DateTime.sameDate(t,this._clamp(t)))&&(!isFunction(this.itemValidator)||this.itemValidator(t))}_inValidRange(t){let e=DateTime.fromDateTime;return!(this.min&&t<e(this.min,t))&&!(this.max&&t>e(this.max,t))}_monthInValidRange(t){if(this.min||this.max){let e=t.getFullYear(),s=t.getMonth(),i=DateTime,n=i.newDate(e,s,1),h=i.newDate(e,s+1,0);if(this.min&&this.min>h)return!1;if(this.max&&this.max<n)return!1}return!0}_yearInValidRange(t){if(this.min||this.max){let e=t.getFullYear(),s=DateTime,i=s.newDate(e,0,1),n=s.newDate(e,11,31);if(this.min&&this.min>n)return!1;if(this.max&&this.max<i)return!1}return!0}_sameMonth(t,e){return isDate(t)&&isDate(e)&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}_getValidDate(t,e){if(isDate(t)){let s=t.getFullYear(),i=t.getMonth()+(e?0:1),n=e?1:0,h=DateTime,l=h.newDate(s,i,n),a=e?1:-1;for(let t=0;t<31;t++){if(this._valid(l))return l;l=h.addDays(l,a)}}return null}_clamp(t){if(t){let e=DateTime.fromDateTime;if(this.min){let s=e(this.min,t);t<s&&(t=s)}if(this.max){let s=e(this.max,t);t>s&&(t=s)}}return t}_createChildren(){let t=this.getTemplate();this.applyTemplate("wj-control wj-calendar",t,{_tbHdr:"tbl-header",_btnMth:"btn-month",_spMth:"span-month",_btnPrv:"btn-prev",_btnTdy:"btn-today",_btnNxt:"btn-next",_tbMth:"tbl-month",_tbYr:"tbl-year"});this._tbYr.style.display="none";let e=culture.Calendar.ariaLabels;setAriaLabel(this._tbMth,e.calendar);setAriaLabel(this._tbYr,e.calendar);setAriaLabel(this._btnPrv,e.calendar);setAriaLabel(this._btnMth,e.monthView);setAriaLabel(this._btnPrv,e.prvMo);setAriaLabel(this._btnTdy,e.today);setAriaLabel(this._btnNxt,e.nxtMo);let s=this._createElement("tr",this._tbMth,"wj-header");for(let t=0;t<7;t++)this._createElement("td",s);s=this._createElement("tr",this._tbYr,"wj-header");this._createElement("td",s).setAttribute("colspan","4");for(let t=0;t<3;t++){s=this._createElement("tr",this._tbYr);for(let t=0;t<4;t++)this._createElement("td",s)}}_createYearPicker(){let t=this.hostElement,e=this._createElement("div",null,"wj-dropdown-panel wj-yearpicker");e.tabIndex=this._orgTabIndex;this._lbYears=new ListBox(e,{lostFocus:t=>{hidePopup(e);this._tmYrHidden=Date.now();this.removeEventListener(window,"touchstart");if(t.selectedIndex>-1){let e=DateTime.clone(this.displayMonth);e.setFullYear(t.selectedIndex+t.itemsSource[0]);this.displayMonth=e}}});this.addEventListener(e,"keydown",e=>{switch(e.keyCode){case Key.Enter:t.focus();break;case Key.Escape:this._lbYears.selectedIndex=-1;t.focus()}e.defaultPrevented&&e.stopPropagation()});this.addEventListener(e,"click",e=>{t.focus()})}_createElement(t,e,s){let i=document.createElement(t);s&&addClass(i,s);e&&e.appendChild(i);return i}_click(t){if(!t.defaultPrevented&&0==t.button){let l=!1,a=t.target;if(contains(this._btnMth,a)&&!this._mthMode()&&this._mtPicker){this.monthView=!this.monthView;l=!0}else if(contains(this._btnPrv,a)){this._navigate(-1);l=!0}else if(contains(this._btnNxt,a)){this._navigate(1);l=!0}else if(contains(this._btnTdy,a)){this._navigate(0);l=!0}if(a&&!l&&this._yrPicker&&contains(this._tbYr,a)&&closest(a,".wj-header")){if(Date.now()-this._tmYrHidden<600){t.preventDefault();return}for(var e=this.displayMonth.getFullYear(),s=this.min?this.min.getFullYear():e-100,i=this.max?this.max.getFullYear():e+100,n=[],h=s;h<=i;h++)n.push(h);let l=this._lbYears,r=l.hostElement,o=closest(a,".wj-header"),d=this.hostElement,c=closest(d,".wj-inputdate-dropdown")||d;l.itemsSource=n;l.selectedIndex=e-n[0];setAttribute(r,"dir",this.rightToLeft?"rtl":null);setCss(r,{minWidth:"",width:o.offsetWidth});showPopup(r,o,!1,!1,c);requestAnimationFrame(()=>{l.showSelection(!0)});this.addEventListener(window,"touchstart",t=>{if(!contains(r,t.target)){hidePopup(r);this._tmYrHidden=Date.now();this.removeEventListener(window,"touchstart")}});t.preventDefault();return}if(a&&!l){let t=closest(a,"td");if(t){let e=this.hitTest(t),s=DateTime.fromDateTime;if(this.monthView){if(e&&this._canChangeValue()){let t=s(e,this._value);this._inValidRange(t)&&this._valid(t)&&(this._rngMode()&&this.value&&!this.rangeEnd&&t>=this.value?this.rangeEnd=t:this.value=t);l=!0}}else if(e){this.displayMonth=e;if(this._mthMode()){if(this._canChangeValue()){let t=s(this.displayMonth,this.value);this._inValidRange(t)&&(this.value=t)}}else this.monthView=!0;l=!0}}}if(l){t.preventDefault();this.focus()}}}_keydown(t){if(t.defaultPrevented)return;if(t.altKey)switch(t.keyCode){case Key.Up:case Key.Down:return;case Key.End:this._navigate(0);t.preventDefault();return}if(t.ctrlKey||t.metaKey||t.shiftKey&&!this._rngMode())return;let e=this._getKeyCode(t),s=0,i=0,n=!0;if(this.monthView)switch(e){case Key.Left:s=-1;break;case Key.Right:s=1;break;case Key.Up:s=-7;break;case Key.Down:s=7;break;case Key.PageDown:i=t.altKey?12:1;break;case Key.PageUp:i=t.altKey?-12:-1;break;case Key.Home:case Key.End:if(this._canChangeValue()&&!t.shiftKey){let t=this.value||this.displayMonth,s=this._getValidDate(t,e==Key.Home);if(s){this.value=DateTime.fromDateTime(s,this.value);this._rngEnd=null}}break;default:n=!1}else switch(e){case Key.Left:i=-1;break;case Key.Right:i=1;break;case Key.Up:i=-4;break;case Key.Down:i=4;break;case Key.PageDown:i=t.altKey?120:12;break;case Key.PageUp:i=t.altKey?-120:-12;break;case Key.Home:i=this.value?-this.value.getMonth():0;break;case Key.End:i=this.value?11-this.value.getMonth():0;break;case Key.Enter:this._mthMode()?n=!1:this.monthView=!0;break;default:n=!1}if(this._canChangeValue()&&(s||i)){let e=t.shiftKey&&null!=this.rangeEnd?this.rangeEnd:this.value,n=DateTime;if(e){e=n.addDays(e,s);e=n.addMonths(e,i)}else e=this._getValidDate(new Date,!0);if(i&&!this._valid(e)){let t=e.getMonth();for(let s=1;s<31&&!this._valid(e);s++){let i=n.addDays(e,+s),h=n.addDays(e,-s);this._valid(i)&&i.getMonth()==t?e=i:this._valid(h)&&h.getMonth()==t&&(e=h)}}for(let t=0;t<31&&!this._valid(e);t++)e=n.addDays(e,s>0||i>0?1:-1);t.shiftKey&&e>this.value?this.rangeEnd=e:this.value=e}n&&t.preventDefault()}_getMonth(t){let e=DateTime;t=t||e.newDate();return e.newDate(t.getFullYear(),t.getMonth(),1)}_ensureVisible(t){let e=this._tdFirst,s=this._tdLast;t=t||DateTime.newDate();(!e||t<e||!s||t>s)&&(this.displayMonth=this._getMonth(t))}_mthMode(){return this.selectionMode==DateSelectionMode.Month}_rngMode(){return!1}_navigate(t){let e=this.monthView,s=this.displayMonth,i=DateTime;switch(t){case 0:let t=i.newDate();this._canChangeValue()&&(this.value=e?i.fromDateTime(t,this.value):this._getMonth(t));s=this._getMonth(t);break;case 1:s=i.addMonths(s,e?1:12);break;case-1:s=i.addMonths(s,e?-1:-12)}this.displayMonth=s}}Calendar._DATE_KEY="$WJ-DATE";Calendar.controlTemplate='<div class="wj-content wj-calendar-outer"><div wj-part="tbl-header" class="wj-calendar-header"><div wj-part="btn-month" class="wj-month-select" role="button"><span wj-part="span-month"></span> <span class="wj-glyph-down"></span></div><div class="wj-btn-group"><button wj-part="btn-prev" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-left"></span></button><button wj-part="btn-today" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-circle"></span></button><button wj-part="btn-next" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-right"></span></button></div></div><table wj-part="tbl-month" class="wj-calendar-month" role="grid"></table><table wj-part="tbl-year" class="wj-calendar-year" role="grid"></table></div>';_addCultureInfo("DropDown",{ariaLabels:{tgl:"Toggle Dropdown"}});export var ClickAction;!function(t){t[t.Select=0]="Select";t[t.Open=1]="Open";t[t.Toggle=2]="Toggle"}(ClickAction||(ClickAction={}));export class DropDown extends Control{constructor(t,e){super(t);this._clickAction=ClickAction.Select;this._showBtn=!0;this._autoExpand=!0;this._animate=!1;this._oldText="";this.textChanged=new Event;this.isDroppedDownChanging=new Event;this.isDroppedDownChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-dropdown",s,{_tbx:"input",_btn:"btn",_dropDown:"dropdown"},"input");this._dropDown.style.display="none";let i=culture.DropDown.ariaLabels;setAriaLabel(this._btn.querySelector("button"),i.tgl);let n=this._elRef=this._tbx;disableAutoComplete(n);this._createDropDown();this._updateBtn();let h=this.hostElement;addClass(h,"wj-state-collapsed");this.addEventListener(window,"resize",()=>{this.isDroppedDown&&this.invalidate()});let l=this.dropDown,a=this.addEventListener.bind(this),r=this._updateFocusState.bind(this);a(l,"blur",r,!0);a(l,"focus",r);let o=this._keydown.bind(this);a(h,"keydown",o);a(l,"keydown",o);a(n,"keypress",t=>{9787==t.keyCode&&t.preventDefault()});a(n,"input",()=>{this._setText(this.text,!1)});a(n,"click",()=>{this._autoExpand&&this._expandSelection()});a(n,"blur",()=>{this._commitText()},!0);a(n,"mousedown",t=>{switch(this._clickAction){case ClickAction.Open:if(!this.isDroppedDown){this.isDroppedDown=!0;this.focus();t.preventDefault()}break;case ClickAction.Toggle:this.isDroppedDown=!this.isDroppedDown;this.focus();t.preventDefault()}});a(this._btn,"mousedown",t=>{this._btnclick(t)});removeChild(l);isIE()&&this._elRef==this._tbx&&a(h,"mouseup",t=>{if(!t.defaultPrevented&&0==t.button&&hasClass(t.target,"wj-btn")){let e=getActiveElement();e&&e!=t.target&&setTimeout(()=>{e.focus()})}});isIE9()&&a(n,"keyup",()=>{this._setText(this.text,!1)});a(l,"click",this._dropDownClick.bind(this))}get text(){return this._tbx.value}set text(t){if(t!=this.text){this._setText(t,!0);this._commitText()}}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(t){this._tbx.readOnly=asBoolean(t);toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get clickAction(){return this._clickAction}set clickAction(t){this._clickAction=asEnum(t,ClickAction)}get isDroppedDown(){let t=this._dropDown;return t&&"none"!=t.style.display}set isDroppedDown(t){let e=this.hostElement,s=this._dropDown,i=this.containsFocus()||this._setFocus;if(e&&s&&(t=asBoolean(t)&&!this.isDisabled&&!this.isReadOnly)!=this.isDroppedDown&&this.onIsDroppedDownChanging(new CancelEventArgs)){if(t){this._minWidthDropdown=s.style.minWidth;s.style.display="block";this._updateDropDown();this.addEventListener(window,"touchstart",t=>{for(let s=t.target;s;){if(s==e)return;s=s[Control._OWNR_KEY]||s.parentNode}Control._touching=!0;this.isDroppedDown=!1;Control._touching=!1})}else{this.removeEventListener(window,"touchstart");hidePopup(s);s.style.minWidth=this._minWidthDropdown}this._setFocus=!1;i&&(this.isTouching&&this.showDropDownButton?e.focus():this.selectAll());this._updateFocusState();toggleClass(e,"wj-state-collapsed",!this.isDroppedDown);this.onIsDroppedDownChanged()}}get dropDown(){return this._dropDown}get dropDownCssClass(){return this._cssClass}set dropDownCssClass(t){if(t!=this._cssClass){removeClass(this._dropDown,this._cssClass);this._cssClass=asString(t);addClass(this._dropDown,this._cssClass)}}get showDropDownButton(){return this._showBtn}set showDropDownButton(t){this._showBtn=asBoolean(t);this._updateBtn()}get autoExpandSelection(){return this._autoExpand}set autoExpandSelection(t){this._autoExpand=asBoolean(t)}get isAnimated(){return this._animate}set isAnimated(t){this._animate=asBoolean(t)}selectAll(){let t=this._tbx;this._elRef==t&&setSelectionRange(t,0,this.text.length);this.containsFocus()||this.focus()}onTextChanged(t){this.textChanged.raise(this,t);this._updateState()}onIsDroppedDownChanging(t){this.isDroppedDownChanging.raise(this,t);return!t.cancel}onIsDroppedDownChanged(t){this.isDroppedDownChanged.raise(this,t)}onGotFocus(t){this.isTouching||contains(this._dropDown,getActiveElement())||this.selectAll();super.onGotFocus(t)}onLostFocus(t){this._commitText();this.isDroppedDown=!1;super.onLostFocus(t)}containsFocus(){return super.containsFocus()||this.isDroppedDown&&contains(this._dropDown,getActiveElement())}dispose(){this.isDroppedDown=!1;let t=this._dropDown;if(t){let e=Control.getControl(t);e&&e.dispose();removeChild(t);this._dropDown=null}super.dispose()}refresh(t=!0){super.refresh(t);let e=this.hostElement;if(e&&e.offsetHeight&&this.isDroppedDown){let t=getActiveElement();this.isAnimated&&""!=this._dropDown.style.opacity||showPopup(this._dropDown,e,!1,!1,null==this.dropDownCssClass);t instanceof HTMLElement&&t!=getActiveElement()&&t.focus()}}_handleResize(){this.isDroppedDown&&this.refresh()}_dropDownClick(t){t.stopPropagation()}_expandSelection(){let t=this._tbx,e=t.value,s=t.selectionStart,i=t.selectionEnd;if(e&&s==i){let n=this._getCharType(e,s);if(n>-1){for(;i<e.length&&this._getCharType(e,i)==n;i++);for(;s>0&&this._getCharType(e,s-1)==n;s--);s!=i&&setSelectionRange(t,s,i)}}}_getCharType(t,e){let s=t[e];return s>="0"&&s<="9"?0:s>="a"&&s<="z"||s>="A"&&s<="Z"?1:-1}_keydown(t){if(!t.defaultPrevented)switch(t.keyCode){case Key.Tab:case Key.Escape:case Key.Enter:if(this.isDroppedDown){this.isDroppedDown=!1;t.keyCode==Key.Tab||this.containsFocus()||this.focus();t.preventDefault()}break;case Key.F4:case Key.Up:case Key.Down:if(t.keyCode==Key.F4||t.altKey){let e=this.hostElement;if(e&&e.offsetHeight){this.isDroppedDown=!this.isDroppedDown;t.preventDefault()}}}}_btnclick(t){if(!t.defaultPrevented&&0==t.button){this._setFocus=!0;this.isDroppedDown=!this.isDroppedDown;t.preventDefault()}}_setText(t,e){null==t&&(t="");(t=t.toString())!=this._tbx.value&&(this._tbx.value=t);if(t!=this._oldText){this._oldText=t;this.onTextChanged()}}_updateBtn(){this._btn.style.display=this._showBtn?"":"none"}_createDropDown(){}_commitText(){}_updateDropDown(){if(this.isDroppedDown){this._commitText();let t=this.dropDown;setAttribute(t,"dir",this.rightToLeft?"rtl":null);showPopup(t,this.hostElement,!1,this._animate,null==this.dropDownCssClass)}}}DropDown.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"><span wj-part="btn" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-down"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel"></div></div>';export var PopupTrigger;!function(t){t[t.None=0]="None";t[t.ClickOwner=1]="ClickOwner";t[t.ClickPopup=2]="ClickPopup";t[t.Click=3]="Click";t[t.BlurOwner=4]="BlurOwner";t[t.BlurPopup=8]="BlurPopup";t[t.Blur=12]="Blur";t[t.ClickOrBlur=15]="ClickOrBlur";t[t.DownOwner=16]="DownOwner";t[t.DownPopup=32]="DownPopup";t[t.Down=48]="Down";t[t.EnterOwner=64]="EnterOwner";t[t.EnterPopup=128]="EnterPopup";t[t.Enter=192]="Enter";t[t.LeaveOwner=256]="LeaveOwner";t[t.LeavePopup=512]="LeavePopup";t[t.Leave=768]="Leave"}(PopupTrigger||(PopupTrigger={}));var _Edges;!function(t){t[t.None=0]="None";t[t.Left=1]="Left";t[t.Top=2]="Top";t[t.Right=4]="Right";t[t.Bottom=8]="Bottom";t[t.LeftTop=3]="LeftTop";t[t.RightTop=6]="RightTop";t[t.RightBottom=12]="RightBottom";t[t.LeftBottom=9]="LeftBottom"}(_Edges||(_Edges={}));export class Popup extends Control{constructor(t,e){super(t);this._modal=!1;this._position=PopupPosition.BelowLeft;this._showTrigger=PopupTrigger.ClickOwner;this._hideTrigger=PopupTrigger.Blur;this._hideAnim=[];this._fadeIn=!0;this._fadeOut=!0;this._removeOnHide=!0;this._draggable=!1;this._resizable=!1;this._visible=!1;this._ownerClickBnd=this._ownerClick.bind(this);this._ownerDownBnd=this._ownerDown.bind(this);this._ownerBlurBnd=this._ownerBlur.bind(this);this._ownerEnterBnd=this._ownerEnter.bind(this);this._ownerLeaveBnd=this._ownerLeave.bind(this);this._mousedownBnd=this._mousedown.bind(this);this._mousemoveBnd=this._mousemove.bind(this);this._mousedragBnd=this._mousedrag.bind(this);this._mouseupBnd=this._mouseup.bind(this);this._hideBnd=this.hide.bind(this);this._lastShow=0;this.showing=new Event;this.shown=new Event;this.hiding=new Event;this.hidden=new Event;this.resizing=new Event;this.resized=new Event;this.dragging=new Event;this.dragged=new Event;this.sizeChanging=new Event;this.sizeChanged=new Event;this.positionChanging=new Event;this.positionChanged=new Event;let s=this.hostElement;addClass(s,"wj-control wj-content wj-popup");s.getAttribute("tabindex")||(s.tabIndex=0);hidePopup(s,!1);let i=this.addEventListener.bind(this);i(s,"compositionstart",()=>{this._composing=!0});i(s,"compositionend",()=>{this._composing=!1});i(window,"resize",()=>{!this.isVisible||this._dragged||this.isTouching||this.invalidate()});i(s,"keydown",t=>{if(!t.defaultPrevented){if(t.keyCode==Key.Escape&&!this._composing){let e=this._oldFocus;t.preventDefault();this.hide();e&&e.offsetHeight&&e.focus()}if(t.keyCode==Key.Enter&&!this._composing){let e=this.dialogResultEnter;if(e){t.preventDefault();this._validateAndHide(e)}}if(t.keyCode==Key.Tab&&this.modal){t.preventDefault();moveFocus(s,t.shiftKey?-1:1)}}});i(s,"click",t=>{let e=t.target;if(e instanceof HTMLElement){if(e instanceof HTMLButtonElement&&"submit"==e.type){let e=this.hostElement,s=this.dialogResultSubmit;if(e instanceof HTMLFormElement&&s&&e.reportValidity()){t.preventDefault();this.hide(s)}}let s=e.className.match(/\bwj-hide[\S]*\b/);if(s&&s.length>0){t.preventDefault();t.stopPropagation();this.hide(s[0])}}});let n=this._toggle.bind(this),h=PopupTrigger;this.addEventListener(s,"click",t=>{this._ignoreClick||n(t,h.ClickPopup)},!0);this.addEventListener(s,"mousedown",t=>{this._ignoreClick=!1;n(t,h.DownPopup)},!0);this.addEventListener(s,"mouseenter",t=>{t.target==s&&n(t,h.EnterPopup)},!0);this.addEventListener(s,"mouseleave",t=>{t.target==s&&n(t,h.LeavePopup)},!0);this.addEventListener(s,"blur",t=>{this.containsFocus()||n(t,h.BlurPopup)},!0);i(document,"wheel",t=>{if(this.isVisible&&this._modal){for(let e=t.target;e&&e!=document.body;e=e.parentElement)if(e.scrollHeight>e.clientHeight)return;t.preventDefault()}});this.initialize(e)}get owner(){return this._owner}set owner(t){let e=this._owner;if(e){this.removeEventListener(e,"click");this.removeEventListener(e,"mousedown");this.removeEventListener(e,"mouseenter");this.removeEventListener(e,"mouseleave");this.removeEventListener(e,"blur")}if(e=this._owner=null!=t?getElement(t):null){this.addEventListener(e,"click",this._ownerClickBnd,!0);this.addEventListener(e,"mousedown",this._ownerDownBnd,!0);this.addEventListener(e,"mouseenter",this._ownerEnterBnd,!0);this.addEventListener(e,"mouseleave",this._ownerLeaveBnd,!0);this.addEventListener(e,"blur",this._ownerBlurBnd,!0)}}get position(){return this._position}set position(t){this._position=asEnum(t,PopupPosition)}get content(){return this.hostElement.firstElementChild}set content(t){if(t!=this.content){this.hostElement.innerHTML="";t instanceof HTMLElement&&this.hostElement.appendChild(t)}}get showTrigger(){return this._showTrigger}set showTrigger(t){this._showTrigger=asEnum(t,PopupTrigger)}get hideTrigger(){return this._hideTrigger}set hideTrigger(t){this._hideTrigger=asEnum(t,PopupTrigger)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=asBoolean(t)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=asBoolean(t)}get removeOnHide(){return this._removeOnHide}set removeOnHide(t){this._removeOnHide=asBoolean(t)}get modal(){return this._modal}set modal(t){this._modal=asBoolean(t)}get isDraggable(){return this._draggable}set isDraggable(t){this._draggable=asBoolean(t)}get isResizable(){return this._resizable}set isResizable(t){this._resizable=asBoolean(t)}get dialogResult(){return this._result}set dialogResult(t){this._result=t}get dialogResultEnter(){return this._resultEnter}set dialogResultEnter(t){this._resultEnter=t}get dialogResultSubmit(){return this._resultSubmit}set dialogResultSubmit(t){this._resultSubmit=asString(t)}get isVisible(){let t=this.hostElement;return this._visible&&null!=t&&t.offsetHeight>0}show(t,e){this._lastShow=Date.now();if(!this.isVisible){let s=this.hostElement;this.dialogResult=null;this._callback=null;this._oldFocus=null;this._hideAnim.forEach(t=>{clearInterval(t)});this._hideAnim.length=0;let i=new CancelEventArgs;if(this.onShowing(i)){null!=t&&(this.modal=asBoolean(t));null!=e&&(this._callback=asFunction(e));this._oldFocus=getActiveElement();showPopup(s,this._owner,this._position,this._fadeIn,!1,this._hideBnd);this._modal&&this._showBackdrop();this._composing=!1;this._visible=!0;this.onShown(i);this.modal&&this.addEventListener(window,"focus",()=>{this.containsFocus()||moveFocus(s,0)});this._resized=this._dragged=this._ignoreClick=!1;this._handleDragResize(!0);this.addEventListener(window,"touchstart",t=>{this._hideTrigger&PopupTrigger.Blur&&!contains(s,t.target,!0)&&this.hide()});setTimeout(()=>{if(!this.isTouching){let t=s.querySelector("[autofocus]");if(t&&t.clientHeight>0&&!t.disabled&&t.tabIndex>-1&&!closest(t,"[disabled],.wj-state-disabled")){t.focus();isFunction(t.select)&&t.select()}else moveFocus(s,0)}if(!this.containsFocus()){s.tabIndex=0;s.focus()}},200)}}}hide(t){this._handleDragResize(!1);this.removeEventListener(window,"touchstart");if(this.isVisible){isUndefined(t)||(this.dialogResult=t);let e=new CancelEventArgs,s=this.hostElement;if(this.onHiding(e)){let t=s.querySelectorAll(".wj-control.wj-dropdown");for(let e=0;e<t.length;e++){let s=Control.getControl(t[e]);s instanceof DropDown&&(s.isDroppedDown=!1)}let i=this.removeOnHide,n=this.fadeOut;this._bkDrop&&this._hideAnim.push(hidePopup(this._bkDrop,i,n));this._hideAnim.push(hidePopup(s,i,n));this._visible=!1;this._oldFocus=null;this.removeEventListener(window,"focus");this.containsFocus()&&getActiveElement().blur();setTimeout(()=>{this._updateState();this.onHidden(e);this._callback&&this._callback(this);if(this.hideTrigger&PopupTrigger.LeavePopup){let t=Control.getControl(closest(this.owner,".wj-popup"));if(t instanceof Popup&&0!=(t.hideTrigger&PopupTrigger.Leave)){let e=Popup._evtHover,s=e?document.elementFromPoint(e.clientX,e.clientY):null,i=Control.getControl(closest(s,".wj-popup"));i instanceof Popup&&!i.isVisible&&(s=null);s&&contains(t.hostElement,s,!0)||t.hide()}}})}}}onShowing(t){this.showing.raise(this,t);return!t.cancel}onShown(t){this.shown.raise(this,t)}onHiding(t){this.hiding.raise(this,t);return!t.cancel}onHidden(t){this._wasVisible=!1;this.hidden.raise(this,t)}onResizing(t){this.resizing.raise(this,t);return!t.cancel}onResized(t){this.resized.raise(this,t)}onDragging(t){this.dragging.raise(this,t);return!t.cancel}onDragged(t){this.dragged.raise(this,t)}onSizeChanging(t){this.sizeChanging.raise(this,t);return!t.cancel}onSizeChanged(t){this.sizeChanged.raise(this,t)}onPositionChanging(t){this.positionChanging.raise(this,t);return!t.cancel}onPositionChanged(t){this.positionChanged.raise(this,t)}onLostFocus(t){super.onLostFocus(t);if(this._hideTrigger&PopupTrigger.BlurPopup&&!this.containsFocus()){let t=document.createEvent("Event");t.initEvent("blur",!0,!0);this._toggle(t,PopupTrigger.BlurPopup)}}dispose(){this.owner=null;super.dispose()}refresh(t=!0){let e=this.hostElement;super.refresh(t);if(this.isVisible&&!this._refreshing&&e){this._refreshing=!0;let t=getActiveElement(),s=this._owner?this._owner.getBoundingClientRect():null;showPopup(e,s,this._position);this._modal&&t instanceof HTMLElement&&t!=getActiveElement()&&t.focus();this._refreshing=!1}}_handleDragResize(t){let e=this.hostElement,s=this._draggable?this._getHeaderElement():null,i=this.addEventListener.bind(this),n=this.removeEventListener.bind(this),h=this._mousemoveBnd,l=this._mousedownBnd;if(t){i(e,"mousemove",h);i(e,"mousedown",l);i(e,"touchstart",l);s&&(s.style.touchAction="none")}else{this._mousedownEvt=null;this._rcBounds=null;n(e,"mousemove",h);n(e,"mousedown",l);n(e,"touchstart",l);n(document,"mousemove",this._mousedragBnd);n(document,"mouseup",this._mouseupBnd);s&&(s.style.touchAction="")}}_mousemove(t){if(!this._mousedownEvt){let e=this.hostElement,s=this._getEdges(e,t),i="",n=_Edges;this._edges=s;this._resizable&&(s==n.LeftTop||s==n.RightBottom?i="nwse-resize":s==n.LeftBottom||s==n.RightTop?i="nesw-resize":s==n.Left||s==n.Right?i="ew-resize":s!=n.Top&&s!=n.Bottom||(i="ns-resize"));this._draggable&&!i&&this._getClosestHeader(t.target)&&(i="move");e.style.cursor=i}}_mousedown(t){if(!t.defaultPrevented){let e=t.touches&&t.touches.length>0?t.touches[0]:t;this._edges=this._getEdges(this.hostElement,e);if(this._edges||this._draggable&&this._getClosestHeader(t.target)){let t=new CancelEventArgs;if(this._edges?this.onResizing(t):this.onDragging(t)){this._mousedownEvt=e;this._rcBounds=this.hostElement.getBoundingClientRect();let t=this.addEventListener.bind(this),s=document,i=this._mousedragBnd,n=this._mouseupBnd;t(s,"mousemove",i);t(s,"touchmove",i);t(s,"mouseup",n);t(s,"touchend",n)}}this._ignoreClick=!1}}_mouseup(){this._mousedownEvt=null;this._rcBounds=null;let t=this.removeEventListener.bind(this),e=document,s=this._mousedragBnd,i=this._mouseupBnd;t(e,"mousemove",s);t(e,"touchmove",s);t(e,"mouseup",i);t(e,"touchend",i);this._resized?this.onResized():this._dragged&&this.onDragged()}_mousedrag(t){if(!t.defaultPrevented){let e=this.hostElement,s=this._mousedownEvt,i=t.touches&&t.touches.length>0?t.touches[0]:t,n=i.clientX-s.clientX,h=i.clientY-s.clientY,l=this._rcBounds,a=this._edges,r=Popup._SZ_MIN,o=Rect.fromBoundingRect(l);if(a){if(a&_Edges.Left){o.left=l.left+n+(i.pageX-i.clientX);o.width=Math.max(l.width-n,r)}else if(a&_Edges.Right){o.left=l.left;o.width=Math.max(l.width+n,r)}if(a&_Edges.Top){o.top=l.top+h+(i.pageY-i.clientY);o.height=Math.max(l.height-h,r)}else if(a&_Edges.Bottom){o.top=l.top;o.height=Math.max(l.height+h,r)}if(this.onSizeChanging(new PopupBoundsChangingEventArgs(o))){setCss(e,{left:o.left,top:o.top,width:o.width,height:o.height});this._resized=this._dragged=this._ignoreClick=!0;this.onSizeChanged()}if(!window.ResizeObserver){let t=this.hostElement.children;for(let e=0;e<t.length;e++)Control.invalidateAll(t[e])}}else if(this._draggable&&(this._dragged||Math.abs(n)+Math.abs(h)>Popup._DRAG_THRESHOLD)){o.left=Math.max(l.left+n+(i.pageX-i.clientX),50-l.width);o.top=Math.max(l.top+h+(i.pageY-i.clientY),0);if(this.onPositionChanging(new PopupBoundsChangingEventArgs(o))){setCss(e,{left:o.left,top:o.top});this._dragged=this._ignoreClick=!0;this.onPositionChanged()}}}}_getEdges(t,e){let s=0;if(this._resizable){let i=t.getBoundingClientRect(),n=Popup._SZ_EDGE;e.clientX-i.left<n&&(s|=_Edges.Left);e.clientY-i.top<n&&(s|=_Edges.Top);i.right-e.clientX<n&&(s|=_Edges.Right);i.bottom-e.clientY<n&&(s|=_Edges.Bottom)}return s}_ownerClick(t){this._toggle(t,PopupTrigger.ClickOwner)}_ownerDown(t){this._wasVisible=this.isVisible;this._toggle(t,PopupTrigger.DownOwner)}_ownerBlur(t){contains(this._owner,getActiveElement())||this._toggle(t,PopupTrigger.BlurOwner)}_ownerEnter(t){t.target==this._owner&&this._toggle(t,PopupTrigger.EnterOwner)}_ownerLeave(t){t.target==this._owner&&this._toggle(t,PopupTrigger.LeaveOwner)}_toggle(t,e){t instanceof MouseEvent&&(Popup._evtHover=t);if(!("mouseenter"==t.type&&Date.now()-this._lastShow<300||t.defaultPrevented)){let t=0!=(this._hideTrigger&e),s=0!=(this._showTrigger&e),i=PopupTrigger;if(t||s){if(this._toHide){clearTimeout(this._toHide);this._toHide=null}if(this._toShow){clearTimeout(this._toShow);this._toShow=null}}t&&this.isVisible&&(e&i.Leave?this._toHide=setTimeout(()=>{let t=Popup._evtHover,e=t?document.elementFromPoint(t.clientX,t.clientY):null;e&&contains(this.hostElement,e,!0)||this.hide()},Control._LEAVE_DELAY):e&i.Blur?setTimeout(()=>{this.containsFocus()||contains(this._owner,getActiveElement())||this.hide()},Control._FOCUS_INTERVAL+50):this.hide());s&&e!=i.ClickPopup&&(this._wasVisible||(e&i.Enter?this._toShow=setTimeout(()=>{this.show()},Control._HOVER_DELAY):this.show()))}}_getHeaderElement(){let t=this.hostElement;return t.querySelector(".wj-dialog-header")||t.querySelector(".modal-header")}_getClosestHeader(t){return closest(t,".wj-dialog-header")||closest(t,".modal-header")}_showBackdrop(){if(!this._bkDrop){this._bkDrop=document.createElement("div");this._bkDrop.tabIndex=-1;addClass(this._bkDrop,"wj-popup-backdrop");this.addEventListener(this._bkDrop,"mousedown",t=>{t.preventDefault();t.stopPropagation();this.hostElement.focus();this.hideTrigger&PopupTrigger.Blur&&this.hide()})}setCss(this._bkDrop,{zIndex:Control._POPUP_ZINDEX,display:""});let t=this.hostElement;t.parentElement.insertBefore(this._bkDrop,t)}_validateAndHide(t){let e=this.hostElement;if(e instanceof HTMLFormElement)e.reportValidity()&&this.hide(t);else{let e=this.hostElement.querySelector(":invalid");e?e.focus():this.hide(t)}}}Popup._DRAG_THRESHOLD=6;Popup._SZ_EDGE=10;Popup._SZ_MIN=40;export class PopupBoundsChangingEventArgs extends CancelEventArgs{constructor(t){super();this._rc=t}get bounds(){return this._rc}}export class InputDate extends DropDown{constructor(t,e){super(t);this._fmt="d";this._sep=" - ";this._rngs=null;this._showCal=!1;this._clsOnSel=!0;this._clicked=!1;this.valueChanged=new Event;this.rangeEndChanged=new Event;addClass(this.hostElement,"wj-inputdate");this._msk=new _MaskProvider(this._tbx);isIE9()||(this.inputType="tel");this._tbx.type.match(/^(tel|text|)$/i)&&(this.inputType="");this.addEventListener(this.hostElement,"wheel",t=>{if(!t.defaultPrevented&&!this.isDroppedDown&&this.containsFocus()&&null!=this.value&&this._canChangeValue()){let e=clamp(-t.deltaY,-1,1),s=this.value;this.value=this.selectionMode==DateSelectionMode.Month?DateTime.addMonths(s,e):DateTime.addDays(s,e);this.selectAll();t.preventDefault()}});let s=this._lbx=new ListBox(document.createElement("div"),{displayMemberPath:"name",selectedIndexChanged:t=>{let e=t.selectedItem,s=DateTime.fromDateTime;if(e&&e.start&&e.end){this.value=s(e.start,this.value);this.rangeEnd=s(e.end,this.value);this._selectAll()}else this._cal.hostElement.style.display=""}}),i=this._cal=new Calendar(document.createElement("div")),n=this._dropDown;addClass(n,"wj-inputdate-dropdown");n.appendChild(s.hostElement);n.appendChild(i.hostElement);this.addEventListener(n,"click",()=>{this._clicked=!0;setTimeout(()=>{this._clicked=!1},50)},!0);if("INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(i.value=i.rangeEnd=Globalize.parseDate(t,"yyyy-MM-dd"))}this.isRequired=!0;this.initialize(e);this._tbx.value=this._oldText=this._getText();i.valueChanged.addHandler((t,e)=>{this.onValueChanged(e);this._refreshText();this._closeOnChange()});i.rangeEndChanged.addHandler((t,e)=>{if(i._rngMode()){this.onRangeEndChanged(e);this._refreshText();this._closeOnChange()}});i.hostElement.addEventListener("click",t=>{if(i.selectionMode&&!i._rngMode()){let e=t.target,s=i.hitTest(e);(DateTime.sameDate(this.value,s)||closest(e,"[wj-part=btn-today]"))&&this._closeOnChange()}})}get value(){return this._cal.value}set value(t){let e=this._cal;e.rangeEnd=e.value=t}get rangeEnd(){return this._cal.rangeEnd}set rangeEnd(t){this._cal.rangeEnd=t}get rangeMin(){return this._cal.rangeMin}set rangeMin(t){this._cal.rangeMin=t}get rangeMax(){return this._cal.rangeMax}set rangeMax(t){this._cal.rangeMax=t}get text(){return this._tbx.value}set text(t){if(t!=this.text){this._setText(t,!0);this._commitText()}}get format(){return this._fmt}set format(t){if(t!=this.format){this._fmt=asString(t);this._refreshText()}}get separator(){return this._sep}set separator(t){if(t!=this._sep){this._sep=asString(t,!1);this.invalidate()}}get mask(){return this._msk.mask}set mask(t){this._msk.mask=asString(t)}get closeOnSelection(){return this._clsOnSel}set closeOnSelection(t){this._clsOnSel=asBoolean(t)}get predefinedRanges(){return this._rngs}set predefinedRanges(t){if(this._rngs!=t){assert(null==t||isObject(t),"Object expected");this._rngs=t;this._lbx.itemsSource=this._getRanges(t);this.invalidate()}}get alwaysShowCalendar(){return this._showCal}set alwaysShowCalendar(t){this._showCal=asBoolean(t)}get min(){return this._cal.min}set min(t){this._cal.min=asDate(t,!0)}get max(){return this._cal.max}set max(t){this._cal.max=asDate(t,!0)}get repeatButtons(){return this._cal.repeatButtons}set repeatButtons(t){this._cal.repeatButtons=asBoolean(t)}get showYearPicker(){return this._cal.showYearPicker}set showYearPicker(t){this._cal.showYearPicker=asBoolean(t)}get showMonthPicker(){return this._cal.showYearPicker}set showMonthPicker(t){this._cal.showYearPicker=asBoolean(t)}get weeksBefore(){return this._cal.weeksBefore}set weeksBefore(t){this._cal.weeksBefore=t}get weeksAfter(){return this._cal.weeksAfter}set weeksAfter(t){this._cal.weeksAfter=t}get selectionMode(){return this._cal.selectionMode}set selectionMode(t){if(t!=this.selectionMode){this._cal.selectionMode=t;this.invalidate()}}get displayMonths(){return this._cal.displayMonths}set displayMonths(t){this._cal.displayMonths=t}get calendar(){return this._cal}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get itemValidator(){return this._cal.itemValidator}set itemValidator(t){if(t!=this.itemValidator){this._cal.itemValidator=asFunction(t);this.invalidate()}}get itemFormatter(){return this._cal.itemFormatter}set itemFormatter(t){this._cal.itemFormatter=asFunction(t)}onValueChanged(t){this.valueChanged.raise(this,t)}onRangeEndChanged(t){this.rangeEndChanged.raise(this,t)}refresh(t=!0){super.refresh(t);if(this.hostElement){this._msk&&this._msk.refresh();this._cal&&this._cal.refresh();this._refreshText()}}onIsDroppedDownChanging(t){if(!this.isDroppedDown){let t=this._lbx,e=this._cal,s=t.collectionView,i=t.hostElement.style,n=e.hostElement.style;if(e._rngMode()&&hasItems(s)){let t=this._updateRangeSelection();i.display="";n.display=!this._showCal&&t&&t.start&&s.items.some(t=>!t.end)?"none":""}else{i.display="none";n.display=""}e._mthMode()||(e.monthView=!0);e.value&&(e.displayMonth=e.value)}return super.onIsDroppedDownChanging(t)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);let e=this.containsFocus();if(this.isDroppedDown){e&&(this._tryFocus(this._cal)||this._tryFocus(this._lbx)||this.dropDown.focus());this._lbx.showSelection();this._cal.refresh()}else this._commitText()}_updateDropDown(){this._commitText();let t=getComputedStyle(this.hostElement);this._dropDown.style.minWidth=18*parseFloat(t.fontSize)+"px";this._cal.refresh();super._updateDropDown()}_keydown(t){if(!(t.defaultPrevented||t.altKey||t.ctrlKey||t.metaKey))switch(t.keyCode){case Key.Enter:this._commitText();break;case Key.Escape:this.text=this._getText();this.selectAll();break;case Key.Tab:if(this._cal._rngMode()){let e=this._tbx,s=this._sep,i=e.value,n=i.indexOf(s);if(n>-1){let h=i.length,l=e.selectionStart,a=e.selectionEnd,r=null;e.selectionEnd<=n&&!t.shiftKey?r=0==l&&0==a:t.shiftKey&&e.selectionStart>=n+s.length&&(r=l<h||a<h);if(null!=r){r?setSelectionRange(e,0,n):setSelectionRange(e,n+s.length,h);t.preventDefault()}}}break;case Key.Up:case Key.Down:if(!this.isDroppedDown&&this.value&&this._canChangeValue()){let e=t.keyCode==Key.Up?1:-1,s=this.selectionMode==DateSelectionMode.Month?DateTime.addMonths(this.value,e):DateTime.addDays(this.value,e);this.value=this._fromDateTime(s);this.selectAll();t.preventDefault()}}super._keydown(t)}_expandSelection(){if(this._cal._rngMode()){let t=this._tbx,e=t.value,s=t.selectionStart,i=t.selectionEnd,n=this._sep,h=e.indexOf(n);h>-1&&s==i&&(i<=h?setSelectionRange(t,0,h):s>=h+n.length&&setSelectionRange(t,h+n.length,t.value.length))}else super._expandSelection()}_refreshText(){let t=this._getText();if(t!=this.text){this._tbx.value=this._oldText=t;this.onTextChanged()}}_selectAll(){this.isDroppedDown||!this.containsFocus()||this.isTouching||this.selectAll()}_closeOnChange(){if(this._clsOnSel&&this._clicked){let t=this._cal;(!t._rngMode()||t.value&&t.rangeEnd)&&setTimeout(()=>{this.isDroppedDown=!1})}}_tryFocus(t){let e=t.hostElement;if(e&&e.offsetHeight){e.focus();return!0}return!1}_clamp(t){return this._cal._clamp(t)}_getText(){let t=Globalize.format,e=this._fmt,s=t(this.value,e);this._cal._rngMode()&&s&&(s+=this._sep+t(this.rangeEnd,e));return s}_commitText(){let t=this._tbx.value,e=!1,s=Globalize.parseDate,i=this._fmt;if(t||this.isRequired)if(this._cal._rngMode()){let n=t.split(this._sep);if(2==n.length&&n[0]){let t=s(n[0],i,this.value);if(t&&this._isValidDate(t)){let h=s(n[1],i,this.value);this.value=this._fromDateTime(t);this.rangeEnd=h&&this._isValidDate(h)&&h>=t?this._fromDateTime(h):t;e=!0}}}else{let n=s(t,i,this.value);if(n&&this._isValidDate(n)){this.value=this._fromDateTime(n);e=!0}}else this.value=this.rangeEnd=null;(e||this.onInvalidInput(new CancelEventArgs))&&(this.text=this._getText());this._selectAll()}_fromDateTime(t){return DateTime.fromDateTime(t,this.value)}_canChangeValue(){return!this.isReadOnly&&!this.isDisabled&&this.selectionMode!=DateSelectionMode.None}_isValidDate(t){if(t){if(this._clamp(t)!=t)return!1;if(this.itemValidator&&!this.itemValidator(t))return!1}return!0}_getRanges(t){let e=[];if(isObject(t))for(let s in t){let i=t[s];e.push({name:s,start:i?i[0]:null,end:i?i[1]:null})}return new CollectionView(e,{currentItem:null})}_updateRangeSelection(){let t=this._lbx,e=-1;if(hasItems(t.collectionView)){let t=this._lbx.collectionView.items,s=DateTime.sameDate;for(let i=0;i<t.length;i++){let n=t[i];if(n.start){if(s(n.start,this.value)&&s(n.end,this.rangeEnd)){e=i;break}}else e=i}}t.selectedIndex=e;return t.selectedItem}}export class InputColor extends DropDown{constructor(t,e){super(t);this.valueChanged=new Event;addClass(this.hostElement,"wj-inputcolor");this._ePreview=createElement('<div class="wj-inputcolorbox"></div>',this.hostElement.firstElementChild);if("INPUT"==this._orgTag){this._tbx.type="";this._commitText()}this.value="#ffffff";this.isRequired=!0;this.initialize(e);this.addEventListener(this._colorPicker.hostElement,"click",t=>{let e=t.target;if(e&&"DIV"==e.tagName&&(closest(e,'[wj-part="div-pal"]')||closest(e,'[wj-part="div-pv"]'))){e.style.backgroundColor&&(this.isDroppedDown=!1)}})}get value(){return this._value}set value(t){t!=this.value&&(!t&&this.isRequired||(this.text=asString(t)))}get text(){return this._tbx.value}set text(t){if(t!=this.text){this._setText(asString(t),!0);this._commitText()}}get showAlphaChannel(){return this._colorPicker.showAlphaChannel}set showAlphaChannel(t){this._colorPicker.showAlphaChannel=t}get showColorString(){return this._colorPicker.showColorString}set showColorString(t){this._colorPicker.showColorString=t}get palette(){return this._colorPicker.palette}set palette(t){this._colorPicker.palette=t}get colorPicker(){return this._colorPicker}onValueChanged(t){this.valueChanged.raise(this,t)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);this.isDroppedDown&&!this.isTouching&&this.selectAll()}_createDropDown(){this._colorPicker=new ColorPicker(this._dropDown);setCss(this._dropDown,{minWidth:420,minHeight:200});this._colorPicker.valueChanged.addHandler(()=>{this.value=this._colorPicker.value})}_keydown(t){if(!t.defaultPrevented)switch(t.keyCode){case Key.Enter:this._commitText();this.selectAll();break;case Key.Escape:this.text=this.value;this.selectAll()}super._keydown(t)}_commitText(){if(this._value!=this.text){if(!this.isRequired&&!this.text){this._value=this.text;this._ePreview.style.backgroundColor="";this.onValueChanged();return}if(Color.fromString(this.text)){let t=this._colorPicker;t.value=this.text;this._value=t.value;this._ePreview.style.backgroundColor=this.value;this.onValueChanged()}else this.onInvalidInput(new CancelEventArgs)&&(this.text=this._value?this._value:"")}}}export class ComboBox extends DropDown{constructor(t,e){super(t);this._editable=!1;this._trimText=!0;this._delKey=0;this._pathHdr=new Binding(null);this._bsCollapse=!0;this._fmtItemHandlers=0;this.itemsSourceChanged=new Event;this.selectedIndexChanged=new Event;let s=this.hostElement;addClass(s,"wj-combobox");this.dropDown.id=getUniqueId(s.id+"_dropdown");this.autoExpandSelection=!1;let i=this._tbx;this.addEventListener(i,"compositionstart",()=>{this._composing=!0});this.addEventListener(i,"compositionend",()=>{this._composing=!1;this._setText(this.text,!0)});this.addEventListener(s,"wheel",this._wheel.bind(this));"SELECT"==this._orgTag&&this._lbx._initFromSelect(s);let n=this._lbx;n.loadedItems.addHandler(t=>{this.selectedIndex>-1&&(this.selectedIndex=n.selectedIndex)});this.isRequired=!0;this.initialize(e)}get itemsSource(){return this._lbx.itemsSource}set itemsSource(t){if(this._lbx.itemsSource!=t){this._lbx.itemsSource=t;this.onItemsSourceChanged()}this._updateBtn()}get collectionView(){return this._lbx.collectionView}get showGroups(){return this._lbx.showGroups}set showGroups(t){this._lbx.showGroups=t}get displayMemberPath(){return this._lbx.displayMemberPath}set displayMemberPath(t){this._lbx.displayMemberPath=t;let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}get headerPath(){return this._pathHdr.path}set headerPath(t){this._pathHdr.path=asString(t);let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}get selectedValuePath(){return this._lbx.selectedValuePath}set selectedValuePath(t){this._lbx.selectedValuePath=t}get isContentHtml(){return this._lbx.isContentHtml}set isContentHtml(t){if(t!=this.isContentHtml){this._lbx.isContentHtml=asBoolean(t);let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}}get caseSensitiveSearch(){return this._lbx.caseSensitiveSearch}set caseSensitiveSearch(t){this._lbx.caseSensitiveSearch=asBoolean(t)}get trimText(){return this._trimText}set trimText(t){if(t!=this._trimText){this._trimText=asBoolean(t);this.invalidate()}}get itemFormatter(){return this._lbx.itemFormatter}set itemFormatter(t){this._lbx.itemFormatter=asFunction(t);this.selectedIndex=this._lbx.selectedIndex}get formatItem(){return this.listBox.formatItem}get selectedIndex(){return this._lbx.selectedIndex}set selectedIndex(t){t!=this.selectedIndex&&isNumber(t)&&(this._lbx.selectedIndex=t);t=this.selectedIndex;let e=this.getDisplayText(t);this.text!=e&&this._setText(e,!0)}get selectedItem(){return this._lbx.selectedItem}set selectedItem(t){this._lbx.selectedItem=t}get selectedValue(){return this.collectionView?this._lbx.selectedValue:this.text}set selectedValue(t){this.collectionView?this._lbx.selectedValue=t:null!=t&&(this.text=t.toString())}get isEditable(){return this._editable}set isEditable(t){this._editable=asBoolean(t)}get maxDropDownHeight(){return this._lbx.maxHeight}set maxDropDownHeight(t){this._lbx.maxHeight=asNumber(t)}get maxDropDownWidth(){let t=this._dropDown;return t?parseInt(t.style.maxWidth):0}set maxDropDownWidth(t){let e=this._dropDown;e.style.maxWidth=asNumber(t)+"px";e.style.minWidth=""}getDisplayText(t=this.selectedIndex,e=this._trimText){let s,i=this.collectionView;if(this.headerPath&&t>-1&&hasItems(i)){let e=i.items[t];s=null!=(s=e?this._pathHdr.getValue(e):null)?s.toString():"";this.isContentHtml&&(s=toPlainText(s))}else s=this._lbx.getDisplayText(t);return e?s.trim():s}indexOf(t,e){let s=this.collectionView,i=this.caseSensitiveSearch;if(hasItems(s)&&null!=t){t=t.toString();i||(t=t.toLowerCase());let n=this.selectedIndex,h=this.getDisplayText(n);if(e){i||(h=h.toLowerCase());if(t==h)return n}for(let n=0;n<s.items.length;n++)if(this.listBox.isItemEnabled(n)){h=this.getDisplayText(n);i||(h=h.toLowerCase());if(e){if(h==t)return n}else if(t&&0==h.indexOf(t))return n}}return-1}get listBox(){return this._lbx}onItemsSourceChanged(t){this.itemsSourceChanged.raise(this,t)}onSelectedIndexChanged(t){this._updateBtn();this.selectedIndexChanged.raise(this,t)}refresh(t=!0){super.refresh(t);if(this.hostElement&&hasItems(this.collectionView)){this._lbx.refresh();this.selectedIndex>-1&&(this.selectedIndex=this._lbx.selectedIndex)}}onLostFocus(t){if(this._composing){this._composing=!1;this._setText(this.text,!0)}this.isEditable&&this.isRequired&&!this.text&&hasItems(this.collectionView)&&(this.selectedIndex=0);super.onLostFocus(t)}onIsDroppedDownChanging(t){if(!this.isDroppedDown&&!this._hasItems()){t.cancel=!0;return!1}return super.onIsDroppedDownChanging(t)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);if(this.isDroppedDown){this._fmtItemHandlers=this.formatItem.handlerCount;this._lbx.showSelection()}this._updateAria()}_updateBtn(){let t=this.collectionView,e=this._tbx,s=this._hasItems();super._updateBtn();this._btn.style.display=this._showBtn&&null!=t?"":"none";enable(this._btn,s);setAttribute(e,"role",s?"combobox":null);setAttribute(e,"aria-autocomplete",s?"both":null);this._updateAria()}_hasItems(){return hasItems(this.collectionView)}_updateAria(){let t=this._tbx,e=this.isDroppedDown,s=this.dropDown?this.dropDown.id:null,i=s&&hasItems(this.collectionView);setAttribute(t,"aria-owns",i&&e?s:null);setAttribute(t,"aria-expanded",i?e:null)}_createDropDown(){this._lbx||(this._lbx=new ListBox(this._dropDown));this._lbx.maxHeight=200;this._lbx.selectedIndexChanged.addHandler(()=>{this._updateBtn();let t=this._lbx.selectedIndex,e=this._lbx.hostElement.children,s=t>-1&&t<e.length?e[t].id:null;setAttribute(this._tbx,"aria-activedescendant",s&&s.length?s:null);this.selectedIndex=t;this.onSelectedIndexChanged()});this._lbx.itemsChanged.addHandler(()=>{this._updateBtn()})}_wheel(t){if(!t.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex>-1){let e=this._findNext("",t.deltaY>0?1:-1);e>-1&&(this.selectedIndex=e);t.preventDefault()}}_dropDownClick(t){t.defaultPrevented||t.target!=this._dropDown&&(this.isDroppedDown=!1);super._dropDownClick(t)}_setText(t,e){if(this._composing)return;if(this._settingText)return;this._settingText=!0;if(this.containsFocus()){let t=this.formatItem.handlerCount;if(this._fmtItemHandlers!=t){this._fmtItemHandlers=t;this._lbx.loadList()}}null==t&&(t="");t=t.toString();let s=this.selectedIndex,i=this.collectionView,n=this._getSelStart(),h=-1,l=!0;if(this.isEditable&&(this._delKey||this._getSelEnd()<t.length||!this.containsFocus())){e=!0;l=!1}s=this.indexOf(t,e);if(l){s<0&&e&&(s=this.indexOf(t,!1));s<0&&n>0&&(s=this.indexOf(t.substr(0,n),!1))}if(s<0&&!this.isEditable&&hasItems(i)&&(this.isRequired||t)){let e=this._oldText||"";s=Math.max(0,this.indexOf(e,!1));for(let s=0;s<t.length&&s<e.length;s++)if(t[s]!=e[s]){n=s;break}}if(s>-1){h=n;t=this.getDisplayText(s)}let a=this._tbx;t!=a.value&&(a.value=t);h>-1&&this.containsFocus()&&!this.isTouching&&this._updateInputSelection(h);i&&i.moveCurrentToPosition(s);this._delKey=0;this._settingText=!1;super._setText(t,e)}_findNext(t,e){let s=this.selectedIndex,i=this.collectionView,n=i?i.items.length:0,h=this.listBox,l=this.caseSensitiveSearch;if(i&&n&&e){l||(t=t.toLowerCase());for(let i=s+e;i>-1&&i<n;i+=e){let e=this.getDisplayText(i);l||(e=e.toLowerCase());if(0==e.indexOf(t)){if(!this.dropDown.children[i]||h.isItemEnabled(i))return i}}}return s}_keydown(t){super._keydown(t);if(t.defaultPrevented||this.isReadOnly)return;if(t.altKey)return;if(!hasItems(this.collectionView))return;if(this._elRef!=this._tbx)return;this._delKey=0;let e=this._getSelStart();switch(t.keyCode){case Key.Back:if(this._bsCollapse&&!this.isEditable){let t=this._getSelEnd();e>0&&t==this._tbx.value.length&&hasItems(this.collectionView)&&this._setSelRange(e-1,t)}this._delKey=t.keyCode;break;case Key.Delete:this._delKey=t.keyCode;break;case Key.Up:case Key.Down:e==this.text.length&&(e=0);this.selectedIndex=this._findNext(this.text.substr(0,e),t.keyCode==Key.Up?-1:1);this._setSelRange(e,this.text.length);t.preventDefault();break;case Key.PageUp:this._lbx._selectPrevPage();this.selectAll();t.preventDefault();break;case Key.PageDown:this._lbx._selectNextPage();this.selectAll();t.preventDefault()}}_updateInputSelection(t){let e=this._tbx;this._elRef==e&&this._setSelRange(t,e.value.length)}_getSelStart(){let t=this._tbx;return t&&t.value?t.selectionStart:0}_getSelEnd(){let t=this._tbx;return t&&t.value?t.selectionEnd:0}_setSelRange(t,e){let s=this._tbx;this._elRef!=s||s.readOnly||setSelectionRange(s,t,e)}}_addCultureInfo("MultiSelect",{itemsSelected:"{count:n0} items selected",selectAll:"Select All"});export class MultiSelect extends ComboBox{constructor(t,e){super(t);this._maxHdrItems=2;this._readOnly=!1;this._hdrFmt=null;this.checkedItemsChanged=new Event;addClass(this.hostElement,"wj-multiselect");this._tbx.readOnly=!0;this.checkedMemberPath=null;this.removeEventListener(this.dropDown,"click");this.listBox.itemsChanged.addHandler(()=>{this._updateHeader()});this.listBox.checkedItemsChanged.addHandler(()=>{this._updateHeader();this.onCheckedItemsChanged()});this.clickAction=ClickAction.Toggle;this.initialize(e)}get showSelectAllCheckbox(){return this._msLbx.showSelectAllCheckbox}set showSelectAllCheckbox(t){this._msLbx.showSelectAllCheckbox=asBoolean(t)}get showFilterInput(){return this._msLbx.showFilterInput}set showFilterInput(t){this._msLbx.showFilterInput=asBoolean(t)}get filterInputPlaceholder(){return this._msLbx.filterInputPlaceholder}set filterInputPlaceholder(t){this._msLbx.filterInputPlaceholder=asString(t)}get checkOnFilter(){return this._msLbx.checkOnFilter}set checkOnFilter(t){if(t!=this.checkOnFilter){this._msLbx.checkOnFilter=asBoolean(t);this.checkedItems=[]}}get selectAllLabel(){return this._msLbx.selectAllLabel}set selectAllLabel(t){this._msLbx.selectAllLabel=asString(t)}get checkedMemberPath(){return this._msLbx.checkedMemberPath}set checkedMemberPath(t){this._msLbx.checkedMemberPath=asString(t)}get maxHeaderItems(){return this._maxHdrItems}set maxHeaderItems(t){if(this._maxHdrItems!=t){this._maxHdrItems=asNumber(t);this._updateHeader()}}get headerFormat(){return this._hdrFmt}set headerFormat(t){if(t!=this._hdrFmt){this._hdrFmt=asString(t);this._updateHeader()}}get headerFormatter(){return this._hdrFormatter}set headerFormatter(t){if(t!=this._hdrFormatter){this._hdrFormatter=asFunction(t);this._updateHeader()}}get checkedItems(){return this._msLbx.checkedItems}set checkedItems(t){this._msLbx.checkedItems=asArray(t)}onCheckedItemsChanged(t){this.checkedItemsChanged.raise(this,t)}dispose(){this.listBox.dispose();super.dispose()}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);setTimeout(()=>{if(this.isDroppedDown&&this.containsFocus())if(this.showFilterInput&&!this.isTouching)this._msLbx._filter.focus();else{this.listBox.showSelection(!0);this.listBox.focus()}})}_createDropDown(){let t=createElement("<div></div>",this._dropDown);this._msLbx=new MultiSelectListBox(t);this._lbx=this._msLbx.listBox;super._createDropDown()}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t);toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}refresh(t=!0){super.refresh(t);this.hostElement&&this._updateHeader()}_setText(t,e){}_keydown(t){super._keydown(t);!t.defaultPrevented&&hasItems(this.collectionView)&&t.keyCode>32&&(this.isDroppedDown=!0)}_hasItems(){let t=this.collectionView,e=t?t.sourceCollection:null;return hasItems(t)||e&&e.length&&this.showFilterInput}_updateHeader(){let t=this.checkedItems;if(isFunction(this._hdrFormatter))this.inputElement.value=this._hdrFormatter(this);else{let e="";if(t.length>0)if(t.length<=this._maxHdrItems){if(this.displayMemberPath){let e=new Binding(this.displayMemberPath);t=t.map(t=>e.getValue(t))}this.isContentHtml&&(t=t.map(t=>toPlainText(t)));e=t.join(", ")}else e=format(this.headerFormat||culture.MultiSelect.itemsSelected,{count:t.length});this.inputElement.value=e}this._updateState()}}MultiSelect._DEF_CHECKED_PATH="$checked";export class Menu extends ComboBox{constructor(t,e){super(t);this._isButton=!1;this._openOnHover=!1;this._closeOnLeave=!0;this._hoverEnterBnd=this._hoverEnter.bind(this);this._hoverLeaveBnd=this._hoverLeave.bind(this);this._hoverOverBnd=this._hoverOver.bind(this);this.itemClicked=new Event;let s=this.hostElement,i=this._tbx,n=this._lbx,h=this.dropDown;addClass(s,"wj-menu");i.style.display="none";this._hdr=this._elRef=createElement('<div wj-part="header" class="wj-form-control"/>');i.parentElement.insertBefore(this._hdr,this._tbx);var l=this._orgOuter.match(/tabindex="?(-?\d+)"?/i);s.tabIndex=l?parseInt(l[1]):0;this.isRequired=!1;setAttribute(s,"role","menubar",!0);setAttribute(i,"role",null);setAttribute(i,"aria-autocomplete",null);setAttribute(i,"aria-owns",null);setAttribute(h,"role","menu");n.itemRole="menuitem";if("SELECT"==this._orgTag){this.header=s.getAttribute("header");this._lbx.itemsSource&&(this.commandParameterPath="cmdParam")}this.isContentHtml=!0;this.maxDropDownHeight=500;this.addEventListener(this._hdr,"click",t=>{if(!t.defaultPrevented){this._clearHover(t);if(this._isButton){this.isDroppedDown=!1;this._raiseCommand()}else this.isDroppedDown=!this.isDroppedDown}});n.lostFocus.addHandler(()=>{this.containsFocus()||(this.isDroppedDown=!1)});addClass(h,"wj-menu-items");n.formatItem.addHandler(this._formatMenuItem.bind(this));this.initialize(e)}get header(){return this._hdr.innerHTML}set header(t){this._hdr.innerHTML=asString(t)}get command(){return this._cmd}set command(t){this._cmd=t}get commandPath(){return this._cmdPath}set commandPath(t){this._cmdPath=asString(t)}get commandParameterPath(){return this._cmdParamPath}set commandParameterPath(t){this._cmdParamPath=asString(t)}get subItemsPath(){return this._subPath}set subItemsPath(t){if(t!=this._subPath){this._subPath=t;this.refresh(!0)}}get openOnHover(){return this._openOnHover}set openOnHover(t){this._openOnHover=asBoolean(t);this._updateHoverEvents()}get closeOnLeave(){return this._closeOnLeave}set closeOnLeave(t){this._closeOnLeave=asBoolean(t);this._updateHoverEvents()}get isButton(){return this._isButton}set isButton(t){this._isButton=asBoolean(t)}get owner(){return this._owner}set owner(t){this._owner=asType(t,HTMLElement,!0);this._enableDisableItems()}show(t){if(!this.isDroppedDown){this.selectedIndex=-1;if(this.onIsDroppedDownChanging(new CancelEventArgs)){let e=this.dropDown,s=this.owner;!s&&t instanceof MouseEvent&&(s=t.target);s instanceof HTMLElement&&(e[Control._OWNR_KEY]=s);if(t instanceof MouseEvent&&this.openOnHover&&this.closeOnLeave){let e=2;t=new Point(t.pageX-pageXOffset-e,t.pageY-pageYOffset-e)}showPopup(e,t,!1,this.isAnimated);this.onIsDroppedDownChanged();e.focus()}}}hide(){if(this.isDroppedDown&&this.onIsDroppedDownChanging(new CancelEventArgs)){hidePopup(this.dropDown);this.onIsDroppedDownChanged()}}onItemClicked(t){this.itemClicked.raise(this,t)}refresh(t=!0){super.refresh(t);this.hostElement&&this._enableDisableItems()}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);if(this.isDroppedDown){this._closing=!0;this._defaultItem=this.selectedItem;this.isRequired=!1;this.selectedIndex=-1;this._enableDisableItems();this._closing=!1;this.dropDown.focus()}else{this.selectedItem||(this.selectedItem=this._defaultItem);let t=this._subMenu;t&&(t.isDroppedDown=!1)}}_updateHoverEvents(){let t=this.hostElement,e=this.dropDown,s=this.addEventListener.bind(this),i=this.removeEventListener.bind(this),n="mouseleave";i(t,"mouseenter",this._hoverEnterBnd);i(t,n,this._hoverLeaveBnd);i(e,"mouseover",this._hoverOverBnd);i(e,n,this._hoverLeaveBnd);if(this._openOnHover){s(t,"mouseenter",this._hoverEnterBnd);s(e,"mouseover",this._hoverOverBnd);if(this._closeOnLeave){s(t,n,this._hoverLeaveBnd);s(e,n,this._hoverLeaveBnd)}}}_getSubItems(t){let e=this.subItemsPath,s=t&&e?t[e]:null;return isArray(s)&&s.length?s:null}_formatMenuItem(t,e){let s=e.item;if(this._getSubItems(e.data))addClass(s,"wj-subitems");else if("-"==s.innerHTML){s.innerHTML="";addClass(s,"wj-separator")}}_keydown(t){if(!t.defaultPrevented){let s=this._getKeyCode(t);if(this.isDroppedDown)switch(s){case Key.Enter:case Key.Right:if(this._showSubMenu()){t.preventDefault();return}break;case Key.Left:var e=Control.getControl(this.owner);if(e instanceof Menu){let s=e.dropDown,i=e.selectedIndex;(i>-1?s.children[i]:s).focus();t.preventDefault();return}}if(s==Key.Enter)if(this.isDroppedDown)this.selectedIndex>-1&&this._raiseCommand();else{this.isDroppedDown=!0;t.preventDefault()}}super._keydown(t)}_dropDownClick(t){if(!t.defaultPrevented&&t.target!=this.dropDown){this._clearHover(t);if(this._showSubMenu()){t.preventDefault();return}this.selectedIndex>-1&&this._raiseCommand()}super._dropDownClick(t)}_showSubMenu(){let t=this._getSubItems(this.selectedItem);if(!t)return null;let e=this.dropDown.children[this.selectedIndex].getBoundingClientRect(),s=new Point(e.right,e.top);if(0==e.height)return null;let i=this.rightToLeft||"rtl"==this.dropDown.getAttribute("dir");i&&(s.x=e.left);let n=this._subMenu;n&&(n.isDroppedDown=!1);n=new Menu(document.createElement("div"),{owner:this.hostElement,itemsSource:t,itemClicked:(t,e)=>{this.itemClicked.raise(t,e)}});"displayMemberPath,selectedValuePath,isContentHtml,command,commandPath,commandParameterPath,maxDropDownWidth,maxDropDownHeight,dropDownCssClass,isAnimated,subItemsPath,openOnHover,closeOnLeave".split(",").forEach(t=>{n[t]=this[t]});let h=n.dropDown;setAttribute(h,"dir",i?"rtl":null);n.show(s);h[Control._OWNR_KEY]=this.dropDown;h.focus();return n}_raiseCommand(t){let e=this.selectedItem,s=this._getSubItems(e),i=this._getCommand(e);if(i&&!s){let t=this._getCommandParm(e);if(!this._canExecuteCommand(i,t))return;this._executeCommand(i,t)}this.onItemClicked(t);if(this.containsFocus()){let t=this;for(;t&&t.owner;){let e=Control.getControl(t.owner);if(!(e instanceof Menu))break;t=e}let e=t.owner;!e&&t.dropDown&&(e=t.dropDown[Control._OWNR_KEY]);t.isDroppedDown=!1;t.focus();t.containsFocus()||e instanceof HTMLElement&&e.focus()}}_getCommand(t){let e=t&&this._cmdPath?t[this._cmdPath]:null;return e||this._cmd}_getCommandParm(t){let e=this._cmdParamPath;return t&&e?t[e]:t}_executeCommand(t,e){t&&!isFunction(t)&&(t=t.executeCommand);isFunction(t)&&t(e)}_canExecuteCommand(t,e){if(t){let s=t.canExecuteCommand;if(isFunction(s))return s(e)}return!0}_enableDisableItems(){if(this.collectionView&&(this._cmd||this._cmdPath)){let t=this.collectionView.items;for(let e=0;e<t.length;e++){let s=t[e],i=this._getCommand(s);if(i){let t=this._lbx.hostElement.children[e],n=this._getCommandParm(s);toggleClass(t,"wj-state-disabled",!this._canExecuteCommand(i,n))}}}}_clearHover(t){this._toHover&&clearTimeout(this._toHover);this._toHover=null;Menu._evtHover=t}_hoverEnter(t){this._clearHover(t);this._toHover=setTimeout(()=>{this._toHover=null;this.isDroppedDown=!0},Control._HOVER_DELAY)}_hoverLeave(t){this._clearHover(t);this.isDroppedDown&&(this._toHover=setTimeout(()=>{let e=(t=Menu._evtHover)?document.elementFromPoint(t.clientX,t.clientY):null,s=closest(e,".wj-listbox.wj-menu-items"),i=this._subMenu;if(!s&&!contains(this.hostElement,e,!0)){this.isDroppedDown=!1;i&&(i.isDroppedDown=!1)}},Control._LEAVE_DELAY))}_hoverOver(t){this._clearHover(t);this._toHover=setTimeout(()=>{this._toHover=null;let e=this.listBox.indexOf(t.target);if(e>-1){this.selectedIndex=e;this._subMenu=this._showSubMenu()}},Control._HOVER_DELAY)}}export class InputTime extends ComboBox{constructor(t,e){super(t);this._format="t";this.valueChanged=new Event;addClass(this.hostElement,"wj-inputtime");this.isEditable=!0;this._value=DateTime.newDate();this._min=this._max=null;this._msk=new _MaskProvider(this._tbx);isIE9()||(this._tbx.type="tel");if("INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(this.value=Globalize.parseDate(t,"HH:mm:ss"))}this.step=15;this.autoExpandSelection=!0;this.initialize(e)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._value}set value(t){(t=asDate(t,!this.isRequired))&&(t=this._clamp(t));this._setText(t?Globalize.format(t,this.format):"",!0);this.selectedItem&&this.selectedItem.value&&(t=DateTime.fromDateTime(t,this.selectedItem.value));if(t!=this._value&&!DateTime.equals(t,this._value)){this._value=t;this.onValueChanged()}}get text(){return this._tbx.value}set text(t){if(t!=this.text){this._setText(t,!0);this._commitText()}}get min(){return this._min}set min(t){this._min=asDate(t,!0);this.isDroppedDown=!1;this._updateItems()}get max(){return this._max}set max(t){this._max=asDate(t,!0);this.isDroppedDown=!1;this._updateItems()}get step(){return this._step}set step(t){if(t!=this.step){this._step=t;this.isDroppedDown=!1;this._updateItems()}}get format(){return this._format}set format(t){if(t!=this.format){this._format=asString(t);this._tbx.value=Globalize.format(this.value,this.format);hasItems(this.collectionView)&&this._updateItems()}}get mask(){return this._msk.mask}set mask(t){this._msk.mask=asString(t)}onValueChanged(t){this.valueChanged.raise(this,t)}onItemsSourceChanged(t){super.onItemsSourceChanged(t);this._hasCustomItems=null!=this.itemsSource}refresh(t=!0){super.refresh(t);if(this.hostElement){this._msk.refresh();this._tbx.value=Globalize.format(this.value,this.format);this._updateItems()}}onSelectedIndexChanged(t){if(this.selectedIndex>-1&&!this._settingText){let t=this.value?this.value:DateTime.newDate(),e=null!=this.selectedItem.value?this.selectedItem.value:Globalize.parseDate(this.text,this.format,this.value);this.value=DateTime.fromDateTime(t,e)}super.onSelectedIndexChanged(t)}_clamp(t){null!=this._min&&this._getTime(t)<this._getTime(this._min)&&(t=DateTime.fromDateTime(t,this._min));null!=this._max&&this._getTime(t)>this._getTime(this._max)&&(t=DateTime.fromDateTime(t,this._max));return t}_wheel(t){if(!t.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex<0&&this.value&&isNumber(this.step)&&this.step>0){let e=DateTime.addMinutes(this.value,this.step*clamp(t.deltaY,-1,1));this.value=this._clamp(e);this.selectAll();t.preventDefault()}super._wheel(t)}_updateInputSelection(t){if(this._delKey)super._updateInputSelection(t);else{let e=this._tbx.value;for(;t<e.length&&!e[t].match(/[a-z0-9]/i);)t++;setSelectionRange(this._tbx,t,this._tbx.value.length)}}_updateItems(){if(this._hasCustomItems)return;let t=[],e=DateTime.newDate(0,0,0,0,0),s=DateTime.newDate(0,0,0,23,59,59),i=this.step;this.min&&e.setHours(this.min.getHours(),this.min.getMinutes(),this.min.getSeconds());this.max&&s.setHours(this.max.getHours(),this.max.getMinutes(),this.max.getSeconds());if(isNumber(i)&&i>0)for(let n=e;n<=s;n=DateTime.addMinutes(n,i))t.push({value:n,text:Globalize.format(n,this.format)});let n=this.value;this._settingText=!0;this.displayMemberPath="text";this.selectedValuePath="text";this.itemsSource=t;this._hasCustomItems=!1;this._settingText=!1;this.value=n}_getTime(t){return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()}_keydown(t){super._keydown(t);if(!t.defaultPrevented)switch(t.keyCode){case Key.Enter:if(!this.isDroppedDown){this._commitText();this.selectAll()}break;case Key.Escape:this.text=Globalize.format(this.value,this.format);this.selectAll()}}_commitText(){if(this.text||this.isRequired){let t=this.value?Globalize.format(this.value,this.format):"";if(this.text!=t){let e=this.selectedItem&&this.selectedItem.value?this.selectedItem.value:Globalize.parseDate(this.text,this.format,this.value);e?(DateTime.sameTime(e,this._clamp(e))||this.onInvalidInput(new CancelEventArgs))&&(this.value=DateTime.fromDateTime(this.value,e)):this.onInvalidInput(new CancelEventArgs)&&(this.text=t)}}else this.value=null}}_addCultureInfo("InputDateTime",{ariaLabels:{tglDate:"Toggle Calendar",tglTime:"Toggle Time List"}});export class InputDateTime extends InputDate{constructor(t,e){super(t);addClass(this.hostElement,"wj-inputdatetime");let s=culture.InputDateTime.ariaLabels;setAriaLabel(this._btn,s.tglDate);setAriaLabel(this._btnTm,s.tglTime);this.value=new Date;this.format="g";this._inputTime=new InputTime(document.createElement("div"),{valueChanged:t=>{let e=this.rangeEnd;this.value=DateTime.fromDateTime(this.value,t.value);this.calendar._rngMode()&&e&&(this.rangeEnd=DateTime.fromDateTime(e,t.value))}});let i=this.addEventListener.bind(this);this._btnTm=this.hostElement.querySelector('[wj-part="btn-tm"]');i(this._btnTm,"mousedown",t=>{this._btnclick(t)});this._ddDate=this._dropDown;let n=this._ddTime=this._inputTime.dropDown;i(n,"keydown",this._keydown.bind(this),!0);i(n,"blur",()=>{this._updateFocusState()},!0);i(n,"click",t=>{t.defaultPrevented||t.target!=n&&this.hostElement.focus()},!0);this.initialize(e);this.text=this._getText()}get timeMin(){return this._inputTime.min}set timeMin(t){this._inputTime.min=t}get timeMax(){return this._inputTime.max}set timeMax(t){this._inputTime.max=t}get timeFormat(){return this._inputTime.format}set timeFormat(t){this._inputTime.format=t}get timeStep(){return this._inputTime.step}set timeStep(t){this._inputTime.step=t}get inputTime(){return this._inputTime}_fromDateTime(t){return t}_btnclick(t){let e=closest(t.target,"button")==this._btn?this._ddDate:this._ddTime;this._setDropdown(e);super._btnclick(t)}dispose(){this._setDropdown(this._ddDate);super.dispose();this._inputTime.dispose()}refresh(t=!0){this._inputTime.refresh();super.refresh(t)}_updateBtn(){super._updateBtn();if(this._btnTm){this._btnTm.tabIndex=this._btn.tabIndex;this._btnTm.parentElement.style.display=this._btn.style.display}}_setDropdown(t){if(this._dropDown==t)return!1;this.isDroppedDown&&(this.isDroppedDown=!1);var e=this.dropDownCssClass;this.dropDownCssClass="";this._dropDown=t;this.dropDownCssClass=e;return!0}_updateDropDown(){let t=this._inputTime;if(this._dropDown==t.dropDown){this._commitText();super._updateDropDown();t.isRequired=this.isRequired&&null!=this.value;t.value=this.value;this.isDroppedDown&&t.listBox.showSelection()}else super._updateDropDown()}}InputDateTime.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span class="wj-input-group-btn"><button wj-part="btn" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-calendar"></span></button><button wj-part="btn-tm" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-clock"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel"></div></div>';export class AutoComplete extends ComboBox{constructor(t,e){super(t);this._cssMatch="wj-state-match";this._minLength=2;this._maxItems=6;this._itemCount=0;this._beginsWith=!1;this._delay=Control._SEARCH_DELAY;this._query="";this._inCallback=!1;this._srchProps=[];addClass(this.hostElement,"wj-autocomplete");this._bsCollapse=!1;this.isEditable=!0;this.isRequired=!1;this.listBox.formatItem.addHandler(this._formatListItem,this);this._itemsSourceFnCallbackBnd=this._itemSourceFunctionCallback.bind(this);this.initialize(e)}get minLength(){return this._minLength}set minLength(t){this._minLength=asNumber(t,!1,!0)}get beginsWithSearch(){return this._beginsWith}set beginsWithSearch(t){this._beginsWith=asBoolean(t)}get maxItems(){return this._maxItems}set maxItems(t){this._maxItems=asNumber(t,!1,!0)}get delay(){return this._delay}set delay(t){this._delay=asNumber(t,!1,!0)}get searchMemberPath(){return this._srchProp}set searchMemberPath(t){this._srchProp=asString(t);this._srchProps=t?t.trim().split(/\s*,\s*/):[]}get itemsSourceFunction(){return this._itemsSourceFn}set itemsSourceFunction(t){this._itemsSourceFn=asFunction(t);isFunction(this._itemsSourceFn)&&this.itemsSourceFunction(this.text,this.maxItems,this._itemsSourceFnCallbackBnd)}get cssMatch(){return this._cssMatch}set cssMatch(t){this._cssMatch=asString(t)}_keydown(t){if(!t.defaultPrevented&&this.isDroppedDown)switch(t.keyCode){case Key.Up:case Key.Down:this.selectAll()}super._keydown(t)}_setText(t){if(!(this._inCallback||this._composing||this._settingText)){if(this.selectedIndex>-1&&this.getDisplayText()!=t){this._settingText=!0;this.selectedIndex=-1;this._settingText=!1}if(t!=this._oldText){let e=this._tbx;e.value!=t&&(e.value=t);this._oldText=t;this.onTextChanged();let s=this.collectionView;if(!t&&s){(this._query||this.selectedIndex<0)&&(this.isDroppedDown=!1);this._query=this._rxHighlight=null;s.filter=null;let t=this.itemsSourceFunction;if(isFunction(t)){this.isDroppedDown=!1;t(this._query,this.maxItems,this._itemsSourceFnCallbackBnd)}return}}this._toSearch&&clearTimeout(this._toSearch);t!=this.getDisplayText()&&(this._toSearch=setTimeout(()=>{this._toSearch=null;let t=this.text.trim();if(t.length>=this._minLength&&t!=this._query){this._query=t;t=escapeRegExp(t);let e=escapeHtml(t),s=this.caseSensitiveSearch?"":"i";this._beginsWith||(s+="g");this._rxSrch=this._beginsWith?new RegExp("^"+t+".*",s):new RegExp("(?=.*"+t.replace(/ /g,")(?=.*")+")",s);this._rxHighlight=new RegExp("("+e.replace(/\s+/g,"|")+")",s);let i=this.itemsSourceFunction;isFunction(i)?i(this._query,this.maxItems,this._itemsSourceFnCallbackBnd):this._updateItems()}},this._delay))}}_itemSourceFunctionCallback(t){this._inCallback=!0;let e=asCollectionView(t);e&&e.moveCurrentToPosition(-1);this.itemsSource=e;this._inCallback=!1;if(this.containsFocus()){let t=this._tbx,e=t.selectionStart,s=t.selectionEnd,i=this.collectionView;this.isDroppedDown=null!=i&&i.items.length>0;setSelectionRange(t,e,s);this.refresh()}}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t);if(this.containsFocus()&&!this.isTouching&&this.selectedIndex<0){let t=this.collectionView.items,e=this.text;1==t.length&&t[0]==e?this.selectedIndex=0:setSelectionRange(this._tbx,e.length)}this._query=""}_updateItems(){let t=this.collectionView;if(t){this._inCallback=!0;t.beginUpdate();this._itemCount=0;t.filter=this._filter.bind(this);t.moveCurrentToPosition(-1);t.endUpdate();this._inCallback=!1;let e=t.items.length,s=this._tbx,i=s.selectionStart,n=s.selectionEnd;this.isDroppedDown=e>0&&this.containsFocus();e||this.isEditable||(this.selectedIndex=-1);this.isDroppedDown&&setSelectionRange(s,i,n);this.refresh()}}_filter(t){if(this._itemCount>=this._maxItems)return!1;let e=this._getItemText(t,!1);this._srchProps&&this._srchProps.forEach(s=>{let i=t[s];null!=i&&(e+="\0"+i)});this.isContentHtml&&(e=e.replace(/(<[^>]*>|&[^;]*;)/g,""));if(this._rxSrch.test(e)){this._itemCount++;return!0}return!1}_getItemText(t,e){let s=t?t.toString():"",i=e&&this.headerPath?this._pathHdr:this._lbx._pathDisplay;i&&(s=null!=(s=i.getValue(t))?s.toString():"");return s}_formatListItem(t,e){this._cssMatch&&this._rxHighlight&&(e.item.innerHTML=e.item.innerHTML.replace(this._rxHighlight,(t,e,s,i)=>this._enclosed(i,s,"<",">")||this._enclosed(i,s,"&",";")?t:'<span class="'+this._cssMatch+'">'+t+"</span>"))}_enclosed(t,e,s,i){for(let n=e;n>=0&&t[n]!=i;n--)if(t[n]==s)for(let n=e;n<t.length&&t[n]!=s;n++)if(t[n]==i)return!0;return!1}}export class MultiAutoComplete extends AutoComplete{constructor(t,e){super(t);this._selItems=[];this._lastInputValue="";this._selPath=new Binding(null);this._notAddItm=!1;this.selectedItemsChanged=new Event;addClass(this.hostElement,"wj-multi-autocomplete");this._wjTpl=this.hostElement.querySelector(".wj-template");this._wjInput=this.hostElement.querySelector(".wj-input");this.showDropDownButton=!1;this.initialize(e);this.addEventListener(this.hostElement,"keyup",this._keyup.bind(this),!0);this.addEventListener(window,"resize",this._adjustInputWidth.bind(this));this.addEventListener(this._tbx,"focus",()=>{this._itemOff()});this._addHelperInput();this._initSeltems();this.listBox.itemsChanged.addHandler(()=>this.selectedIndex=-1);this._refreshHeader()}set showDropDownButton(t){this._showBtn=!1}get maxSelectedItems(){return this._maxSelItems}set maxSelectedItems(t){if(this._maxSelItems!=t){this._maxSelItems=asNumber(t,!0);this._updateMaxItems();this._refreshHeader();this._clearSelIndex()}}get selectedMemberPath(){return this._selPath.path}set selectedMemberPath(t){if((t=asString(t))!==this.selectedMemberPath){this._selPath.path=t;this._initSeltems();this._refreshHeader();this.onSelectedItemsChanged()}}get selectedItems(){return this._selItems}set selectedItems(t){this._selItems=asArray(t);if(this.selectedMemberPath&&""!==this.selectedMemberPath&&this._selItems)for(let t=0;t<this._selItems.length;t++){let e=this._selItems[t];this._setSelItem(e,!1)}this._updateMaxItems();this.onSelectedItemsChanged();this._refreshHeader();this._clearSelIndex()}onSelectedItemsChanged(t){this.selectedItemsChanged.raise(this,t)}onIsDroppedDownChanged(t){!this.isDroppedDown&&this.selectedIndex>-1&&!this._notAddItm&&this._addItem(!0);this._notAddItm=!1;super.onIsDroppedDownChanged(t)}refresh(t=!0){super.refresh(t);if(this.hostElement){this._initSeltems();this.isDroppedDown||this._refreshHeader()}}_keydown(t){if(!this.isReadOnly){if(!t.defaultPrevented)switch(t.keyCode){case Key.Back:this._lastInputValue=this._tbx.value;break;case Key.Enter:this._itemOff();this._addItem(!0);isIE&&setSelectionRange(this._tbx,0,0);break;case Key.Tab:if(this.isDroppedDown){this._addItem(!1);this._tbx.value="";this._lbx.selectedIndex=-1;t.preventDefault()}else this._updateFocus();break;case Key.Space:if(""!==this._tbx.value)return;if(!this.isDroppedDown&&!this._tbx.disabled){this.isDroppedDown=!0;this._clearSelIndex()}break;case Key.Escape:this.isDroppedDown&&(this._notAddItm=!0);break;case Key.Left:this._itemOn(!this.rightToLeft);break;case Key.Right:this._itemOn(!!this.rightToLeft);break;case Key.Up:case Key.Down:let e=getActiveElement();if(t.altKey){if(this._tbx==e){this.isDroppedDown=!this.isDroppedDown;this.isDroppedDown||this._tbx.focus();t.preventDefault();return}}else if(this._tbx!==e)return;default:if(t.keyCode===Key.Back||t.keyCode===Key.Delete)return;this._itemOff();null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems&&t.preventDefault()}this._tbx.disabled||super._keydown(t)}}_updateState(){super._updateState();this._wjTpl&&(hasClass(this.hostElement,"wj-state-focused")||this._itemOff())}_keyup(t){if(!this.isReadOnly&&!t.defaultPrevented)switch(t.keyCode){case Key.Back:0===this._tbx.value.length&&0===this._lastInputValue.length&&this._delItem(!1);break;case Key.Delete:this._delItem(!0)}}_addHelperInput(){let t=document.createElement("input");t.type="text";t.tabIndex=-1;t.className="wj-token-helper";t.readOnly=!0;this._wjTpl.insertBefore(t,this._wjInput);this._helperInput=t}_refreshHeader(){let t=this.hostElement.querySelectorAll(".wj-token");for(let e=0;e<t.length;e++)this._wjTpl.removeChild(t[e]);let e=this.selectedItems;if(e&&0!==e.length){for(let t=0;t<e.length;t++)this._insertToken(e[t]);this._wjInput.style.cssFloat=this.rightToLeft?"right":"left";this._adjustInputWidth()}else{this._wjInput.style.cssFloat=this.rightToLeft?"right":"left";this._adjustInputWidth()}}_insertToken(t){let e=this._getItemText(t,!0);this.isContentHtml||(e=escapeHtml(e));this._wjTpl.insertBefore(this._createItem(e),this._wjInput)}_updateMaxItems(){null!=this._maxSelItems&&this._selItems&&this._selItems.length>this._maxSelItems&&(this._selItems=this._selItems.slice(0,this._maxSelItems))}_updateFocus(){let t=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);if(t){removeClass(t,MultiAutoComplete._clsActive);setTimeout(()=>{this._tbx.focus()})}else this._clearSelIndex()}_addItem(t){if(this.selectedItems.indexOf(this.selectedItem)>-1)this._clearSelIndex();else if(this.selectedIndex>-1){this._updateSelItems(this.selectedItem,!0);this._refreshHeader();t&&this._clearSelIndex();this._disableInput(!0)}}_delItem(t){let e,s,i=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive),n=!1;if(!t||i){if(i){if((s=this._getItemIndex(i))>-1){e=this._selItems[s];n=!0}}else if(this._selItems.length>0){e=this._selItems[this._selItems.length-1];n=!0}if(n){this._updateSelItems(e,!1);this._refreshHeader();this._clearSelIndex();this._disableInput(!1)}this._tbx.focus()}}_updateSelItems(t,e){if(e){this._selItems&&0!==this._selItems.length||(this._selItems=[]);if(null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems)return;this._selItems.push(t)}else{let e=this._selItems.indexOf(t);this._selItems.splice(e,1)}this._hasSelectedMemeberPath()&&this._setSelItem(t,e);this.onSelectedItemsChanged()}_createItem(t){let e=document.createElement("div"),s=document.createElement("span"),i=document.createElement("a");e.appendChild(s);e.appendChild(i);e.className="wj-token";s.className="wj-token-label";s.innerHTML=t;i.className="wj-token-close";i.href="#";i.tabIndex=-1;i.text="×";e.style.cssFloat=this.rightToLeft?"right":"left";this.addEventListener(e,"click",t=>{this._helperInput.focus();let s=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);s&&removeClass(s,MultiAutoComplete._clsActive);addClass(e,MultiAutoComplete._clsActive);t.stopPropagation();t.preventDefault()});this.addEventListener(i,"click",t=>{if(this.isReadOnly)return;let s=this._getItemIndex(e);if(s>-1){let t=this._selItems[s];this._updateSelItems(t,!1)}this._wjTpl.removeChild(e);this._adjustInputWidth();this._disableInput(!1);this._tbx.focus();t.stopPropagation();t.preventDefault()});return e}_itemOn(t){let e,s,i,n=getActiveElement();if((this._tbx!=n||0===this._tbx.value.length)&&0!==(e=this._wjTpl.querySelectorAll(".wj-token")).length){s=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);i=this._getItemIndex(s);if(t){if(0===i)return;if(-1===i){addClass(e[e.length-1],MultiAutoComplete._clsActive);this._helperInput.focus()}else{removeClass(s,MultiAutoComplete._clsActive);addClass(e[i-1],MultiAutoComplete._clsActive);this._helperInput.focus()}}else if(!t){if(-1===i)return;if(i!==e.length-1){removeClass(s,MultiAutoComplete._clsActive);addClass(e[i+1],MultiAutoComplete._clsActive);this._helperInput.focus()}else{removeClass(s,MultiAutoComplete._clsActive);this._tbx.focus()}}}}_itemOff(){let t=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);t&&removeClass(t,MultiAutoComplete._clsActive)}_initSeltems(){if(this.selectedMemberPath){this._selItems.splice(0,this._selItems.length);let t=this.collectionView;if(t)for(let e=0;e<t.sourceCollection.length;e++)this._getSelItem(e)&&this._selItems.push(t.sourceCollection[e])}}_getSelItem(t){let e=this.collectionView,s=e?e.sourceCollection[t]:null;return!(!isObject(s)||!this.selectedMemberPath)&&this._selPath.getValue(s)}_setSelItem(t,e){this.itemsSource;isObject(t)&&this._selPath.getValue(t)!=e&&this._selPath.setValue(t,e)}_clearSelIndex(){this.selectedIndex=-1}_hasSelectedMemeberPath(){return this.selectedMemberPath&&""!==this.selectedMemberPath}_disableInput(t){if(null!=this._maxSelItems)if(this._selItems.length<this._maxSelItems){this._tbx.disabled=!1;this._tbx.focus()}else{this._tbx.disabled=!0;this.hostElement.focus()}}_adjustInputWidth(){this._tbx.style.width="60px";let t,e=getElementRect(this.hostElement),s=getElementRect(this._tbx),i=getComputedStyle(this._tbx),n=parseInt(i.paddingLeft,10),h=parseInt(i.paddingRight,10);t=this.rightToLeft?s.left+s.width-e.left-n-h-8:e.left+e.width-s.left-n-h-8;this._tbx.style.width=t+"px"}_getItemIndex(t){let e=this.hostElement.querySelectorAll(".wj-token");for(let s=0;s<e.length;s++)if(t===e[s])return s;return-1}}MultiAutoComplete._clsActive="wj-token-active";_registerModule("wijmo.input",selfModule);