/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{_registerModule}from"wijmo/wijmo";import*as selfModule from"wijmo/wijmo.pdf.security";var K_MAX_LENGTH=2147483647;function createBuffer(e){if(e>K_MAX_LENGTH)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);Object.setPrototypeOf(t,Buffer.prototype);return t}export function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return fromArrayBuffer(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(e,SharedArrayBuffer)||e&&isInstance(e.buffer,SharedArrayBuffer)))return fromArrayBuffer(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var i=fromObject(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}Buffer.from=function(e,t,r){return from(e,t,r)};Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype);Object.setPrototypeOf(Buffer,Uint8Array);function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function allocUnsafe(e){assertSize(e);return createBuffer(e<0?0:0|checked(e))}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);Object.setPrototypeOf(n,Buffer.prototype);return n}function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);if(0===r.length)return r;e.copy(r,0,0,t);return r}return void 0!==e.length?"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e):"Buffer"===e.type&&Array.isArray(e.data)?fromArrayLike(e.data):void 0}function checked(e){if(e>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|e}Buffer.isBuffer=function isBuffer(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype};function slowToString(e,t,r){var n=!1;(void 0===t||t<0)&&(t=0);if(t>this.length)return"";(void 0===r||r>this.length)&&(r=this.length);if(r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";e||(e="utf8");for(;;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();n=!0}}Buffer.prototype._isBuffer=!0;Buffer.prototype.toString=function toString(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)};function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=r){var c,f,u,h;switch(a){case 1:o<128&&(s=o);break;case 2:128==(192&(c=e[i+1]))&&(h=(31&o)<<6|63&c)>127&&(s=h);break;case 3:c=e[i+1];f=e[i+2];128==(192&c)&&128==(192&f)&&(h=(15&o)<<12|(63&c)<<6|63&f)>2047&&(h<55296||h>57343)&&(s=h);break;case 4:c=e[i+1];f=e[i+2];u=e[i+3];128==(192&c)&&128==(192&f)&&128==(192&u)&&(h=(15&o)<<18|(63&c)<<12|(63&f)<<6|63&u)>65535&&h<1114112&&(s=h)}}if(null===s){s=65533;a=1}else if(s>65535){s-=65536;n.push(s>>>10&1023|55296);s=56320|1023&s}n.push(s);i+=a}return decodeCodePointsArray(n)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0);(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=hexSliceLookupTable[e[o]];return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}Buffer.prototype.slice=function slice(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r);(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r);t<e&&(t=e);var n=this.subarray(e,t)(Object).setPrototypeOf(n,Buffer.prototype);return n};Buffer.prototype.copy=function copy(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");r||(r=0);n||0===n||(n=this.length);t>=e.length&&(t=e.length);t||(t=0);n>0&&n<r&&(n=r);if(n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;o>=0;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i};function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}var hexSliceLookupTable=function(){for(var e=new Array(256),t=0;t<16;++t)for(var r=16*t,n=0;n<16;++n)e[r+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}();export function inRange(e,t){if(e<t[0])return!1;let r=0,n=t.length/2;for(;r<=n;){const i=Math.floor((r+n)/2),o=2*i;if(e>=t[o]&&e<=t[o+1])return!0;e>t[o+1]?r=i+1:n=i-1}return!1}const unassigned_code_points=[545,545,564,591,686,687,751,767,848,863,880,883,886,889,891,893,895,899,907,907,909,909,930,930,975,975,1015,1023,1159,1159,1231,1231,1270,1271,1274,1279,1296,1328,1367,1368,1376,1376,1416,1416,1419,1424,1442,1442,1466,1466,1477,1487,1515,1519,1525,1547,1549,1562,1564,1566,1568,1568,1595,1599,1622,1631,1774,1775,1791,1791,1806,1806,1837,1839,1867,1919,1970,2304,2308,2308,2362,2363,2382,2383,2389,2391,2417,2432,2436,2436,2445,2446,2449,2450,2473,2473,2481,2481,2483,2485,2490,2491,2493,2493,2501,2502,2505,2506,2510,2518,2520,2523,2526,2526,2532,2533,2555,2561,2563,2564,2571,2574,2577,2578,2601,2601,2609,2609,2612,2612,2615,2615,2618,2619,2621,2621,2627,2630,2633,2634,2638,2648,2653,2653,2655,2661,2677,2688,2692,2692,2700,2700,2702,2702,2706,2706,2729,2729,2737,2737,2740,2740,2746,2747,2758,2758,2762,2762,2766,2767,2769,2783,2785,2789,2800,2816,2820,2820,2829,2830,2833,2834,2857,2857,2865,2865,2868,2869,2874,2875,2884,2886,2889,2890,2894,2901,2904,2907,2910,2910,2914,2917,2929,2945,2948,2948,2955,2957,2961,2961,2966,2968,2971,2971,2973,2973,2976,2978,2981,2983,2987,2989,2998,2998,3002,3005,3011,3013,3017,3017,3022,3030,3032,3046,3059,3072,3076,3076,3085,3085,3089,3089,3113,3113,3124,3124,3130,3133,3141,3141,3145,3145,3150,3156,3159,3167,3170,3173,3184,3201,3204,3204,3213,3213,3217,3217,3241,3241,3252,3252,3258,3261,3269,3269,3273,3273,3278,3284,3287,3293,3295,3295,3298,3301,3312,3329,3332,3332,3341,3341,3345,3345,3369,3369,3386,3389,3396,3397,3401,3401,3406,3414,3416,3423,3426,3429,3440,3457,3460,3460,3479,3481,3506,3506,3516,3516,3518,3519,3527,3529,3531,3534,3541,3541,3543,3543,3552,3569,3573,3584,3643,3646,3676,3712,3715,3715,3717,3718,3721,3721,3723,3724,3726,3731,3736,3736,3744,3744,3748,3748,3750,3750,3752,3753,3756,3756,3770,3770,3774,3775,3781,3781,3783,3783,3790,3791,3802,3803,3806,3839,3912,3912,3947,3952,3980,3983,3992,3992,4029,4029,4045,4046,4048,4095,4130,4130,4136,4136,4139,4139,4147,4149,4154,4159,4186,4255,4294,4303,4345,4346,4348,4351,4442,4446,4515,4519,4602,4607,4615,4615,4679,4679,4681,4681,4686,4687,4695,4695,4697,4697,4702,4703,4743,4743,4745,4745,4750,4751,4783,4783,4785,4785,4790,4791,4799,4799,4801,4801,4806,4807,4815,4815,4823,4823,4847,4847,4879,4879,4881,4881,4886,4887,4895,4895,4935,4935,4955,4960,4989,5023,5109,5120,5751,5759,5789,5791,5873,5887,5901,5901,5909,5919,5943,5951,5972,5983,5997,5997,6001,6001,6004,6015,6109,6111,6122,6143,6159,6159,6170,6175,6264,6271,6314,7679,7836,7839,7930,7935,7958,7959,7966,7967,8006,8007,8014,8015,8024,8024,8026,8026,8028,8028,8030,8030,8062,8063,8117,8117,8133,8133,8148,8149,8156,8156,8176,8177,8181,8181,8191,8191,8275,8278,8280,8286,8292,8297,8306,8307,8335,8351,8370,8399,8427,8447,8507,8508,8524,8530,8580,8591,9167,9215,9255,9279,9291,9311,9471,9471,9748,9749,9752,9752,9854,9855,9866,9984,9989,9989,9994,9995,10024,10024,10060,10060,10062,10062,10067,10069,10071,10071,10079,10080,10133,10135,10160,10160,10175,10191,10220,10223,11008,11903,11930,11930,12020,12031,12246,12271,12284,12287,12352,12352,12439,12440,12544,12548,12589,12592,12687,12687,12728,12783,12829,12831,12868,12880,12924,12926,13004,13007,13055,13055,13175,13178,13278,13279,13311,13311,19894,19967,40870,40959,42125,42127,42183,44031,55204,55295,64046,64047,64107,64255,64263,64274,64280,64284,64311,64311,64317,64317,64319,64319,64322,64322,64325,64325,64434,64466,64832,64847,64912,64913,64968,64975,65021,65023,65040,65055,65060,65071,65095,65096,65107,65107,65127,65127,65132,65135,65141,65141,65277,65278,65280,65280,65471,65473,65480,65481,65488,65489,65496,65497,65501,65503,65511,65511,65519,65528,65536,66303,66335,66335,66340,66351,66379,66559,66598,66599,66638,118783,119030,119039,119079,119081,119262,119807,119893,119893,119965,119965,119968,119969,119971,119972,119975,119976,119981,119981,119994,119994,119996,119996,120001,120001,120004,120004,120070,120070,120075,120076,120085,120085,120093,120093,120122,120122,120127,120127,120133,120133,120135,120137,120145,120145,120484,120487,120778,120781,120832,131069,173783,194559,195102,196605,196608,262141,262144,327677,327680,393213,393216,458749,458752,524285,524288,589821,589824,655357,655360,720893,720896,786429,786432,851965,851968,917501,917504,917504,917506,917535,917632,983037];export const isUnassignedCodePoint=e=>inRange(e,unassigned_code_points);const commonly_mapped_to_nothing=[173,173,847,847,6150,6150,6155,6155,6156,6156,6157,6157,8203,8203,8204,8204,8205,8205,8288,8288,65024,65024,65025,65025,65026,65026,65027,65027,65028,65028,65029,65029,65030,65030,65031,65031,65032,65032,65033,65033,65034,65034,65035,65035,65036,65036,65037,65037,65038,65038,65039,65039,65279,65279];export const isCommonlyMappedToNothing=e=>inRange(e,commonly_mapped_to_nothing);const non_ASCII_space_characters=[160,160,5760,5760,8192,8192,8193,8193,8194,8194,8195,8195,8196,8196,8197,8197,8198,8198,8199,8199,8200,8200,8201,8201,8202,8202,8203,8203,8239,8239,8287,8287,12288,12288];export const isNonASCIISpaceCharacter=e=>inRange(e,non_ASCII_space_characters);const non_ASCII_controls_characters=[128,159,1757,1757,1807,1807,6158,6158,8204,8204,8205,8205,8232,8232,8233,8233,8288,8288,8289,8289,8290,8290,8291,8291,8298,8303,65279,65279,65529,65532,119155,119162],non_character_codepoints=[64976,65007,65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1114110,1114111],prohibited_characters=[0,31,127,127,832,832,833,833,8206,8206,8207,8207,8234,8234,8235,8235,8236,8236,8237,8237,8238,8238,8298,8298,8299,8299,8300,8300,8301,8301,8302,8302,8303,8303,12272,12283,55296,57343,57344,63743,65529,65529,65530,65530,65531,65531,65532,65532,65533,65533,917505,917505,917536,917631,983040,1048573,1048576,1114109];export const isProhibitedCharacter=e=>inRange(e,non_ASCII_space_characters)||inRange(e,prohibited_characters)||inRange(e,non_ASCII_controls_characters)||inRange(e,non_character_codepoints);const bidirectional_r_al=[1470,1470,1472,1472,1475,1475,1488,1514,1520,1524,1563,1563,1567,1567,1569,1594,1600,1610,1645,1647,1649,1749,1757,1757,1765,1766,1786,1790,1792,1805,1808,1808,1810,1836,1920,1957,1969,1969,8207,8207,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65020,65136,65140,65142,65276];export const isBidirectionalRAL=e=>inRange(e,bidirectional_r_al);const bidirectional_l=[65,90,97,122,170,170,181,181,186,186,192,214,216,246,248,544,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,1013,1024,1154,1162,1230,1232,1269,1272,1273,1280,1295,1329,1366,1369,1375,1377,1415,1417,1417,2307,2307,2309,2361,2365,2368,2377,2380,2384,2384,2392,2401,2404,2416,2434,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2494,2496,2503,2504,2507,2508,2519,2519,2524,2525,2527,2529,2534,2545,2548,2554,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2622,2624,2649,2652,2654,2654,2662,2671,2674,2676,2691,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2752,2761,2761,2763,2764,2768,2768,2784,2784,2790,2799,2818,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2878,2880,2880,2887,2888,2891,2892,2903,2903,2908,2909,2911,2913,2918,2928,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3007,3009,3010,3014,3016,3018,3020,3031,3031,3047,3058,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3137,3140,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3262,3264,3268,3271,3272,3274,3275,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3392,3398,3400,3402,3404,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3535,3537,3544,3551,3570,3572,3585,3632,3634,3635,3648,3654,3663,3675,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3792,3801,3804,3805,3840,3863,3866,3892,3894,3894,3896,3896,3902,3911,3913,3946,3967,3967,3973,3973,3976,3979,4030,4037,4039,4044,4047,4047,4096,4129,4131,4135,4137,4138,4140,4140,4145,4145,4152,4152,4160,4183,4256,4293,4304,4344,4347,4347,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4961,4988,5024,5108,5121,5750,5761,5786,5792,5872,5888,5900,5902,5905,5920,5937,5941,5942,5952,5969,5984,5996,5998,6e3,6016,6070,6078,6085,6087,6088,6100,6106,6108,6108,6112,6121,6160,6169,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8206,8206,8305,8305,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8509,8511,8517,8521,8544,8579,9014,9082,9109,9109,9372,9449,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12588,12593,12686,12688,12727,12784,12828,12832,12867,12896,12923,12927,12976,12992,13003,13008,13054,13056,13174,13179,13277,13280,13310,13312,19893,19968,40869,40960,42124,44032,55203,55296,64045,64048,64106,64256,64262,64275,64279,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500,66304,66334,66336,66339,66352,66378,66560,66597,66600,66637,118784,119029,119040,119078,119082,119142,119146,119154,119171,119172,119180,119209,119214,119261,119808,119892,119894,119964,119966,119967,119970,119970,119973,119974,119977,119980,119982,119993,119995,119995,119997,12e4,120002,120003,120005,120069,120071,120074,120077,120084,120086,120092,120094,120121,120123,120126,120128,120132,120134,120134,120138,120144,120146,120483,120488,120777,131072,173782,194560,195101,983040,1048573,1048576,1114109];export const isBidirectionalL=e=>inRange(e,bidirectional_l);const mapping2space=isNonASCIISpaceCharacter,mapping2nothing=isCommonlyMappedToNothing,getCodePoint=e=>e.codePointAt(0),first=e=>e[0],last=e=>e[e.length-1];function toCodePoints(e){const t=[],r=e.length;for(let n=0;n<r;n+=1){const i=e.charCodeAt(n);if(i>=55296&&i<=56319&&r>n+1){const r=e.charCodeAt(n+1);if(r>=56320&&r<=57343){t.push(1024*(i-55296)+r-56320+65536);n+=1;continue}}t.push(i)}return t}function fromCodePoint(){if(String.fromCodePoint)return String.fromCodePoint.apply(null,arguments);for(var e=[],t=0,r="",n=0,i=arguments.length;n!==i;++n){var o=+arguments[n];if(!(o<1114111&&o>>>0===o))throw RangeError("Invalid code point: "+o);if(o<=65535)t=e.push(o);else{o-=65536;t=e.push(55296+(o>>10),o%1024+56320)}if(t>=16383){r+=String.fromCharCode.apply(null,e);e.length=0}}return r+String.fromCharCode.apply(null,e)}export function saslprep(e,t={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const r=toCodePoints(e).map(e=>mapping2space(e)?32:e).filter(e=>!mapping2nothing(e)),n=fromCodePoint.apply(null,r).normalize("NFKC"),i=toCodePoints(n);if(i.some(isProhibitedCharacter))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==t.allowUnassigned){if(i.some(isUnassignedCodePoint))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const o=i.some(isBidirectionalRAL),s=i.some(isBidirectionalL);if(o&&s)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const a=isBidirectionalRAL(getCodePoint(first(n))),c=isBidirectionalRAL(getCodePoint(last(n)));if(o&&(!a||!c))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return n}export var CryptoJS=function(e,t){var r;"undefined"!=typeof window&&window.crypto&&(r=window.crypto);!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto);var cryptoSecureRandomInt=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function F(){}return function(e){var t;F.prototype=e;t=new F;F.prototype=null;return t}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=n(this);e&&t.mixIn(e);t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[];this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;this.clamp();if(n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];this.sigBytes+=i;return this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8;t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);e.words=this.words.slice(0);return e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(cryptoSecureRandomInt());return new a.init(t,e)}}),c=i.enc={},f=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16));n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},h=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,c=o/(4*s),f=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,u=e.min(4*f,o);if(f){for(var h=0;h<f;h+=s)this._doProcessBlock(i,h);r=i.splice(0,f);n.sigBytes-=u}return new a.init(r,u)},clone:function(){var e=s.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0}),d=(o.Hasher=p.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){p.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math);!function(e){var t=CryptoJS,r=t.lib,n=r.WordArray,i=r.Hasher,o=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var a=o.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],f=e[t+2],u=e[t+3],h=e[t+4],p=e[t+5],d=e[t+6],l=e[t+7],y=e[t+8],g=e[t+9],m=e[t+10],_=e[t+11],v=e[t+12],S=e[t+13],w=e[t+14],C=e[t+15],B=o[0],A=o[1],R=o[2],b=o[3];B=FF(B,A,R,b,a,7,s[0]);b=FF(b,B,A,R,c,12,s[1]);R=FF(R,b,B,A,f,17,s[2]);A=FF(A,R,b,B,u,22,s[3]);B=FF(B,A,R,b,h,7,s[4]);b=FF(b,B,A,R,p,12,s[5]);R=FF(R,b,B,A,d,17,s[6]);A=FF(A,R,b,B,l,22,s[7]);B=FF(B,A,R,b,y,7,s[8]);b=FF(b,B,A,R,g,12,s[9]);R=FF(R,b,B,A,m,17,s[10]);A=FF(A,R,b,B,_,22,s[11]);B=FF(B,A,R,b,v,7,s[12]);b=FF(b,B,A,R,S,12,s[13]);R=FF(R,b,B,A,w,17,s[14]);B=GG(B,A=FF(A,R,b,B,C,22,s[15]),R,b,c,5,s[16]);b=GG(b,B,A,R,d,9,s[17]);R=GG(R,b,B,A,_,14,s[18]);A=GG(A,R,b,B,a,20,s[19]);B=GG(B,A,R,b,p,5,s[20]);b=GG(b,B,A,R,m,9,s[21]);R=GG(R,b,B,A,C,14,s[22]);A=GG(A,R,b,B,h,20,s[23]);B=GG(B,A,R,b,g,5,s[24]);b=GG(b,B,A,R,w,9,s[25]);R=GG(R,b,B,A,u,14,s[26]);A=GG(A,R,b,B,y,20,s[27]);B=GG(B,A,R,b,S,5,s[28]);b=GG(b,B,A,R,f,9,s[29]);R=GG(R,b,B,A,l,14,s[30]);B=HH(B,A=GG(A,R,b,B,v,20,s[31]),R,b,p,4,s[32]);b=HH(b,B,A,R,y,11,s[33]);R=HH(R,b,B,A,_,16,s[34]);A=HH(A,R,b,B,w,23,s[35]);B=HH(B,A,R,b,c,4,s[36]);b=HH(b,B,A,R,h,11,s[37]);R=HH(R,b,B,A,l,16,s[38]);A=HH(A,R,b,B,m,23,s[39]);B=HH(B,A,R,b,S,4,s[40]);b=HH(b,B,A,R,a,11,s[41]);R=HH(R,b,B,A,u,16,s[42]);A=HH(A,R,b,B,d,23,s[43]);B=HH(B,A,R,b,g,4,s[44]);b=HH(b,B,A,R,v,11,s[45]);R=HH(R,b,B,A,C,16,s[46]);B=II(B,A=HH(A,R,b,B,f,23,s[47]),R,b,a,6,s[48]);b=II(b,B,A,R,l,10,s[49]);R=II(R,b,B,A,w,15,s[50]);A=II(A,R,b,B,p,21,s[51]);B=II(B,A,R,b,v,6,s[52]);b=II(b,B,A,R,u,10,s[53]);R=II(R,b,B,A,m,15,s[54]);A=II(A,R,b,B,c,21,s[55]);B=II(B,A,R,b,y,6,s[56]);b=II(b,B,A,R,C,10,s[57]);R=II(R,b,B,A,d,15,s[58]);A=II(A,R,b,B,S,21,s[59]);B=II(B,A,R,b,h,6,s[60]);b=II(b,B,A,R,_,10,s[61]);R=II(R,b,B,A,f,15,s[62]);A=II(A,R,b,B,g,21,s[63]);o[0]=o[0]+B|0;o[1]=o[1]+A|0;o[2]=o[2]+R|0;o[3]=o[3]+b|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);t.sigBytes=4*(r.length+1);this._process();for(var a=this._hash,c=a.words,f=0;f<4;f++){var u=c[f];c[f]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return a},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});function FF(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+i+s;return(a<<o|a>>>32-o)+t}function GG(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+i+s;return(a<<o|a>>>32-o)+t}function HH(e,t,r,n,i,o,s){var a=e+(t^r^n)+i+s;return(a<<o|a>>>32-o)+t}function II(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+i+s;return(a<<o|a>>>32-o)+t}t.MD5=i._createHelper(a);t.HmacMD5=i._createHmacHelper(a)}(Math);!function(e){var t=CryptoJS,r=t.lib,n=r.WordArray,i=r.Hasher,o=t.algo,s=[],a=[];!function(){function isPrime(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function getFractionalBits(e){return 4294967296*(e-(0|e))|0}for(var t=2,r=0;r<64;){if(isPrime(t)){r<8&&(s[r]=getFractionalBits(e.pow(t,.5)));a[r]=getFractionalBits(e.pow(t,1/3));r++}t++}}();var c=[],f=o.SHA256=i.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],f=r[4],u=r[5],h=r[6],p=r[7],d=0;d<64;d++){if(d<16)c[d]=0|e[t+d];else{var l=c[d-15],y=(l<<25|l>>>7)^(l<<14|l>>>18)^l>>>3,g=c[d-2],m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[d]=y+c[d-7]+m+c[d-16]}var _=n&i^n&o^i&o,v=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=p+((f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25))+(f&u^~f&h)+a[d]+c[d];p=h;h=u;u=f;f=s+S|0;s=o;o=i;i=n;n=S+(v+_)|0}r[0]=r[0]+n|0;r[1]=r[1]+i|0;r[2]=r[2]+o|0;r[3]=r[3]+s|0;r[4]=r[4]+f|0;r[5]=r[5]+u|0;r[6]=r[6]+h|0;r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;r[14+(i+64>>>9<<4)]=e.floor(n/4294967296);r[15+(i+64>>>9<<4)]=n;t.sigBytes=4*r.length;this._process();return this._hash},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});t.SHA256=i._createHelper(f);t.HmacSHA256=i._createHmacHelper(f)}(Math);!function(){var e=CryptoJS,t=e.lib.Base,r=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init;"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t));t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,f=0;f<n;f++){a[f]^=1549556828;c[f]^=909522486}o.sigBytes=s.sigBytes=i;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(r))}})}();CryptoJS.lib.Cipher||function(e){var t=CryptoJS,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,s=t.enc,a=(s.Utf8,s.Base64),c=t.algo.EvpKDF,f=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r);this._xformMode=e;this._key=t;this.reset()},reset:function(){o.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(e){return"string"==typeof e?_:g}return function(e){return{encrypt:function(t,r,n){return selectCipherStrategy(r).encrypt(e,t,r,n)},decrypt:function(t,r,n){return selectCipherStrategy(r).decrypt(e,t,r,n)}}}}()}),u=(r.StreamCipher=f.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),h=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e;this._iv=t}}),p=u.CBC=function(){var t=h.extend();t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;xorBlock.call(this,e,t,n);r.encryptBlock(e,t);this._prevBlock=e.slice(t,t+n)}});t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=e.slice(t,t+n);r.decryptBlock(e,t);xorBlock.call(this,e,t,n);this._prevBlock=i}});function xorBlock(t,r,n){var i,o=this._iv;if(o){i=o;this._iv=e}else i=this._prevBlock;for(var s=0;s<n;s++)t[r+s]^=i[s]}return t}(),d=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,s=[],a=0;a<n;a+=4)s.push(o);var c=i.create(s,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},l=(r.BlockCipher=f.extend({cfg:f.cfg.extend({mode:p,padding:d}),reset:function(){var e;f.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)e=n.createEncryptor;else{e=n.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==e)this._mode.init(this,r&&r.words);else{this._mode=e.call(n,this,r&&r.words);this._mode.__creator=e}},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);e=this._process(!0)}else{e=this._process(!0);t.unpad(e)}return e},blockSize:4}),r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(a)},parse:function(e){var t,r=a.parse(e),n=r.words;if(1398893684==n[0]&&1701076831==n[1]){t=i.create(n.slice(2,4));n.splice(0,4);r.sigBytes-=16}return l.create({ciphertext:r,salt:t})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:y}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),s=i.cfg;return l.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){n=this.cfg.extend(n);t=this._parse(t,n.format);return e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),m=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){n||(n=i.random(8));var o=c.create({keySize:t+r}).compute(e,n),s=i.create(o.words.slice(t),4*r);o.sigBytes=4*t;return l.create({key:o,iv:s,salt:n})}},_=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:m}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,e,t,i.key,n);o.mixIn(i);return o},decrypt:function(e,t,r,n){n=this.cfg.extend(n);t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);n.iv=i.iv;return g.decrypt.call(this,e,t,i.key,n)}})}();!function(){if("function"==typeof ArrayBuffer){var e=CryptoJS.lib.WordArray,t=e.init;(e.init=function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(e instanceof Uint8Array){for(var r=e.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=e[i]<<24-i%4*8;t.call(this,n,r)}else t.apply(this,arguments)}).prototype=e}}();CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}};!function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<r;a++)i.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var r=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<n.length;o++)i[n.charCodeAt(o)]=o}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(r=a)}return function parseLoop(e,r,n){for(var i=[],o=0,s=0;s<r;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2,f=a|c;i[o>>>2]|=f<<24-o%4*8;o++}return t.create(i,o)}(e,r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();!function(){var e=CryptoJS,t=e.lib,r=t.Base,n=t.WordArray,i=e.algo,o=i.MD5,s=i.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,i=this.cfg,o=i.hasher.create(),s=n.create(),a=s.words,c=i.keySize,f=i.iterations;a.length<c;){r&&o.update(r);r=o.update(e).finalize(t);o.reset();for(var u=1;u<f;u++){r=o.finalize(r);o.reset()}s.concat(r)}s.sigBytes=4*c;return s}});e.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)}}();!function(){var e=CryptoJS,t=e.lib.BlockCipher,r=e.algo,n=[],i=[],o=[],s=[],a=[],c=[],f=[],u=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,d=0;for(t=0;t<256;t++){var l=d^d<<1^d<<2^d<<3^d<<4;l=l>>>8^255&l^99;n[r]=l;i[l]=r;var y=e[r],g=e[y],m=e[g],_=257*e[l]^16843008*l;o[r]=_<<24|_>>>8;s[r]=_<<16|_>>>16;a[r]=_<<8|_>>>24;c[r]=_;_=16843009*m^65537*g^257*y^16843008*r;f[l]=_<<24|_>>>8;u[l]=_<<16|_>>>16;h[l]=_<<8|_>>>24;p[l]=_;if(r){r=y^e[e[e[m^y]]];d^=e[e[d]]}else r=d=1}}();var d=[0,1,2,4,8,16,32,64,128,27,54],l=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,i=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],s=0;s<i;s++)if(s<r)o[s]=t[s];else{l=o[s-1];if(s%r)r>6&&s%r==4&&(l=n[l>>>24]<<24|n[l>>>16&255]<<16|n[l>>>8&255]<<8|n[255&l]);else{l=n[(l=l<<8|l>>>24)>>>24]<<24|n[l>>>16&255]<<16|n[l>>>8&255]<<8|n[255&l];l^=d[s/r|0]<<24}o[s]=o[s-r]^l}for(var a=this._invKeySchedule=[],c=0;c<i;c++){s=i-c;if(c%4)var l=o[s];else l=o[s-4];a[c]=c<4||s<=4?l:f[n[l>>>24]]^u[n[l>>>16&255]]^h[n[l>>>8&255]]^p[n[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,a,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3];e[t+3]=r;this._doCryptBlock(e,t,this._invKeySchedule,f,u,h,p,i);r=e[t+1];e[t+1]=e[t+3];e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,s,a){for(var c=this._nRounds,f=e[t]^r[0],u=e[t+1]^r[1],h=e[t+2]^r[2],p=e[t+3]^r[3],d=4,l=1;l<c;l++){var y=n[f>>>24]^i[u>>>16&255]^o[h>>>8&255]^s[255&p]^r[d++],g=n[u>>>24]^i[h>>>16&255]^o[p>>>8&255]^s[255&f]^r[d++],m=n[h>>>24]^i[p>>>16&255]^o[f>>>8&255]^s[255&u]^r[d++],_=n[p>>>24]^i[f>>>16&255]^o[u>>>8&255]^s[255&h]^r[d++];f=y;u=g;h=m;p=_}y=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&p])^r[d++],g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[p>>>8&255]<<8|a[255&f])^r[d++],m=(a[h>>>24]<<24|a[p>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^r[d++],_=(a[p>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^r[d++];e[t]=y;e[t+1]=g;e[t+2]=m;e[t+3]=_},keySize:8});e.AES=t._createHelper(l)}();!function(){var e=CryptoJS,t=e.lib.StreamCipher,r=e.algo,n=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var s=i%r,a=t[s>>>2]>>>24-s%4*8&255;o=(o+n[i]+a)%256;var c=n[i];n[i]=n[o];n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r];e[r]=o;n|=e[(e[t]+e[r])%256]<<24-8*i}this._i=t;this._j=r;return n}e.RC4=t._createHelper(n);var i=r.RC4Drop=n.extend({cfg:n.cfg.extend({drop:192}),_doReset:function(){n._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)generateKeystreamWord.call(this)}});e.RC4Drop=t._createHelper(i)}();CryptoJS.mode.ECB=function(){var e=CryptoJS.lib.BlockCipherMode.extend();e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}});e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}});return e}();export class _PDFSecurity{static generateFileID(e={}){let t=`${e.CreationDate.getTime()}\n`;for(let r in e)e.hasOwnProperty(r)&&(t+=`${r}: ${e[r]}\n`);return wordArrayToBuffer(CryptoJS.MD5(t))}static generateRandomWordArray(e){return CryptoJS.lib.WordArray.random(e)}static create(e,t={}){return t.ownerPassword||t.userPassword?new _PDFSecurity(e,t):null}constructor(e,t={}){if(!t.ownerPassword&&!t.userPassword)throw new Error("None of owner password and user password is defined.");this.document=e;this._setupEncryption(t)}_setupEncryption(e){switch(e.pdfVersion){case"1.4":case"1.5":this.version=2;break;case"1.6":case"1.7":this.version=4;break;case"1.7ext3":this.version=5;break;default:this.version=1}const t={Filter:"Standard"};switch(this.version){case 1:case 2:case 4:this._setupEncryptionV1V2V4(this.version,t,e);break;case 5:this._setupEncryptionV5(t,e)}this.dictionary=this.document.ref(t)}_setupEncryptionV1V2V4(e,t,r){let n,i;switch(e){case 1:n=2;this.keyBits=40;i=getPermissionsR2(r.permissions);break;case 2:n=3;this.keyBits=128;i=getPermissionsR3(r.permissions);break;case 4:n=4;this.keyBits=128;i=getPermissionsR3(r.permissions)}const o=processPasswordR2R3R4(r.userPassword),s=r.ownerPassword?processPasswordR2R3R4(r.ownerPassword):o,a=getOwnerPasswordR2R3R4(n,this.keyBits,o,s);this.encryptionKey=getEncryptionKeyR2R3R4(n,this.keyBits,this.document._id,o,a,i);let c;c=2===n?getUserPasswordR2(this.encryptionKey):getUserPasswordR3R4(this.document._id,this.encryptionKey);t.V=e;e>=2&&(t.Length=this.keyBits);if(4===e){t.CF={StdCF:{AuthEvent:"DocOpen",CFM:"AESV2",Length:this.keyBits/8}};t.StmF="StdCF";t.StrF="StdCF"}t.R=n;t.O=wordArrayToBuffer(a);t.U=wordArrayToBuffer(c);t.P=i}_setupEncryptionV5(e,t){this.keyBits=256;const r=getPermissionsR3(t.permissions),n=processPasswordR5(t.userPassword),i=t.ownerPassword?processPasswordR5(t.ownerPassword):n;this.encryptionKey=getEncryptionKeyR5(_PDFSecurity.generateRandomWordArray);const o=getUserPasswordR5(n,_PDFSecurity.generateRandomWordArray),s=getUserEncryptionKeyR5(n,CryptoJS.lib.WordArray.create(o.words.slice(10,12),8),this.encryptionKey),a=getOwnerPasswordR5(i,o,_PDFSecurity.generateRandomWordArray),c=getOwnerEncryptionKeyR5(i,CryptoJS.lib.WordArray.create(a.words.slice(10,12),8),o,this.encryptionKey),f=getEncryptedPermissionsR5(r,this.encryptionKey,_PDFSecurity.generateRandomWordArray);e.V=5;e.Length=this.keyBits;e.CF={StdCF:{AuthEvent:"DocOpen",CFM:"AESV3",Length:this.keyBits/8}};e.StmF="StdCF";e.StrF="StdCF";e.R=5;e.O=wordArrayToBuffer(a);e.OE=wordArrayToBuffer(c);e.U=wordArrayToBuffer(o);e.UE=wordArrayToBuffer(s);e.P=r;e.Perms=wordArrayToBuffer(f)}getEncryptFn(e,t){let r,n;this.version<5&&(r=this.encryptionKey.clone().concat(CryptoJS.lib.WordArray.create([(255&e)<<24|(65280&e)<<8|e>>8&65280|255&t,(65280&t)<<16],5)));if(1===this.version||2===this.version){let e=CryptoJS.MD5(r);e.sigBytes=Math.min(16,this.keyBits/8+5);return t=>wordArrayToBuffer(CryptoJS.RC4.encrypt(CryptoJS.lib.WordArray.create(t),e).ciphertext)}n=4===this.version?CryptoJS.MD5(r.concat(CryptoJS.lib.WordArray.create([1933667412],4))):this.encryptionKey;const i=_PDFSecurity.generateRandomWordArray(16),o={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7,iv:i};return e=>wordArrayToBuffer(i.clone().concat(CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(e),n,o).ciphertext))}end(){this.dictionary.end()}}function getPermissionsR2(e={}){let t=-64;e.printing&&(t|=4);e.modifying&&(t|=8);e.copying&&(t|=16);e.annotating&&(t|=32);return t}function getPermissionsR3(e={}){let t=-3904;"lowResolution"===e.printing&&(t|=4);"highResolution"===e.printing&&(t|=2052);e.modifying&&(t|=8);e.copying&&(t|=16);e.annotating&&(t|=32);e.fillingForms&&(t|=256);e.contentAccessibility&&(t|=512);e.documentAssembly&&(t|=1024);return t}function getUserPasswordR2(e){return CryptoJS.RC4.encrypt(processPasswordR2R3R4(),e).ciphertext}function getUserPasswordR3R4(e,t){const r=t.clone();let n=CryptoJS.MD5(processPasswordR2R3R4().concat(CryptoJS.lib.WordArray.create(e)));for(let e=0;e<20;e++){const i=Math.ceil(r.sigBytes/4);for(let n=0;n<i;n++)r.words[n]=t.words[n]^(e|e<<8|e<<16|e<<24);n=CryptoJS.RC4.encrypt(n,r).ciphertext}return n.concat(CryptoJS.lib.WordArray.create(null,16))}function getOwnerPasswordR2R3R4(e,t,r,n){let i=n,o=e>=3?51:1;for(let e=0;e<o;e++)i=CryptoJS.MD5(i);const s=i.clone();s.sigBytes=t/8;let a=r;o=e>=3?20:1;for(let e=0;e<o;e++){const t=Math.ceil(s.sigBytes/4);for(let r=0;r<t;r++)s.words[r]=i.words[r]^(e|e<<8|e<<16|e<<24);a=CryptoJS.RC4.encrypt(a,s).ciphertext}return a}function getEncryptionKeyR2R3R4(e,t,r,n,i,o){let s=n.clone().concat(i).concat(CryptoJS.lib.WordArray.create([lsbFirstWord(o)],4)).concat(CryptoJS.lib.WordArray.create(r));const a=e>=3?51:1;for(let e=0;e<a;e++)(s=CryptoJS.MD5(s)).sigBytes=t/8;return s}function getUserPasswordR5(e,t){const r=t(8),n=t(8);return CryptoJS.SHA256(e.clone().concat(r)).concat(r).concat(n)}function getUserEncryptionKeyR5(e,t,r){const n=CryptoJS.SHA256(e.clone().concat(t)),i={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding,iv:CryptoJS.lib.WordArray.create(null,16)};return CryptoJS.AES.encrypt(r,n,i).ciphertext}function getOwnerPasswordR5(e,t,r){const n=r(8),i=r(8);return CryptoJS.SHA256(e.clone().concat(n).concat(t)).concat(n).concat(i)}function getOwnerEncryptionKeyR5(e,t,r,n){const i=CryptoJS.SHA256(e.clone().concat(t).concat(r)),o={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding,iv:CryptoJS.lib.WordArray.create(null,16)};return CryptoJS.AES.encrypt(n,i,o).ciphertext}function getEncryptionKeyR5(e){return e(32)}function getEncryptedPermissionsR5(e,t,r){const n=CryptoJS.lib.WordArray.create([lsbFirstWord(e),4294967295,1415668834],12).concat(r(4)),i={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.NoPadding};return CryptoJS.AES.encrypt(n,t,i).ciphertext}function processPasswordR2R3R4(e=""){const t=new Buffer(32),r=e.length;let n=0;for(;n<r&&n<32;){const r=e.charCodeAt(n);if(r>255)throw new Error("Password contains one or more invalid characters.");t[n]=r;n++}for(;n<32;){t[n]=PASSWORD_PADDING[n-r];n++}return CryptoJS.lib.WordArray.create(t)}function processPasswordR5(e=""){e=unescape(encodeURIComponent(saslprep(e)));const t=Math.min(127,e.length),r=new Buffer(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return CryptoJS.lib.WordArray.create(r)}function lsbFirstWord(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}function wordArrayToBuffer(e){const t=[];for(let r=0;r<e.sigBytes;r++)t.push(e.words[Math.floor(r/4)]>>8*(3-r%4)&255);return Buffer.from(t)}const PASSWORD_PADDING=[40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122];_registerModule("wijmo.pdf.security",selfModule);