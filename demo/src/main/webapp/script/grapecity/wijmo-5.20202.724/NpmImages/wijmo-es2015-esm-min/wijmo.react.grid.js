/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{ComponentBase}from"wijmo/wijmo.react.base";import*as React from"react";import*as ReactDOM from"react-dom";import*as wjcCore from"wijmo/wijmo";import*as wjcGrid from"wijmo/wijmo.grid";import*as wjcInteropGrid from"wijmo/wijmo.interop.grid";export var CellTemplateType=wjcInteropGrid.GridCellTemplateType;export class FlexGrid extends ComponentBase{constructor(e){super(e,wjcGrid.FlexGrid,{objectProps:["childItemsPath","mergeManager","itemsSource","virtualizationThreshold","columnGroups"]})}_createControl(){let e=super._createControl();new DirectiveCellFactory(this,e);return e}}export class FlexGridColumn extends ComponentBase{constructor(e){super(e,wjcGrid.Column,{objectProps:["dataMap","cellTemplate","editor"]});this._parentProp="columns"}_initParent(){var e=this.parent.control;if(e.autoGenerateColumns){e.autoGenerateColumns=!1;e.columns.clear()}super._initParent()}}class DirectiveCellFactory extends wjcInteropGrid.DirectiveCellFactoryBase{constructor(e,t){super(t);this._renderedCells=[];this._isViewUpdated=!1;t.updatedView.addHandler(this._gridViewUpdated,this);e._beforeDidUpdate.addHandler(this._gridCmpBeforeDidUpdate,this);e._afterDidUpdate.addHandler(this._gridCmpAfterDidUpdate,this)}shouldInstantiate(e){let t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement}renderTemplate(e,t){let l=e.row,r=e.templateContext,o=e.cell;e.cellBindingsData=this.setBindingsData({},l,e.column,l.dataItem,e.cellValue,r.valuePaths);this._renderCell(o,e);if(t){this._addRenderedCell(o);let t=e.templateCache={column:e.column,rootElement:o.firstElementChild,templateContextProperty:e.templateContextProperty};o[e.templateContextProperty]=t}}disposeTemplate(e,t,l){if(t){ReactDOM.unmountComponentAtNode(e);this._removeRenderedCell(e);super.disposeTemplate(e,t,l)}}clearCell(e){ReactDOM.unmountComponentAtNode(e)}applyImmediately(e){}flushPendingEvents(e){}getEditorFocusFlag(){return!0}setEditorFocusFlag(e){}_renderCell(e,t){var l=t||e.__wjCellLastRenderedProp;if(l){let t=l&&l.templateContext.template,r=l.cellBindingsData.localVars;ReactDOM.render(React.createElement("div",{},t&&t(r)),e);e.__wjCellLastRenderedProp=l}}_addRenderedCell(e){let t=this._renderedCells;t.indexOf(e)<0&&t.push(e)}_removeRenderedCell(e){let t=this._renderedCells,l=t.indexOf(e);l>-1&&t.splice(l,1)}_reRenderCells(){this._renderedCells.forEach(e=>this._renderCell(e))}_gridCmpBeforeDidUpdate(){this._isViewUpdated=!1}_gridCmpAfterDidUpdate(){this._gridCmpRendered()}_gridCmpRendered(){setTimeout(()=>{this._isViewUpdated?this._isViewUpdated=!1:this._reRenderCells()},wjcCore.Control._REFRESH_INTERVAL)}_gridViewUpdated(){this._isViewUpdated=!0}}export class FlexGridCellTemplate extends React.Component{get cellOverflow(){return this.props.cellOverflow}get autoSizeRows(){let e=this.props.autoSizeRows;return null==e||e}get forceFullEdit(){let e=this.props.forceFullEdit;return null==e||e}get valuePaths(){return this.props.valuePaths}get template(){return this.props[FlexGridCellTemplate._CellRenderFuncProp]}componentDidMount(){let e=this.props[ComponentBase._propsParent];e&&e._mountedCB(()=>{let t=this.ownerControl=e.control;if(t instanceof wjcGrid.FlexGrid)this.grid=t;else if(t instanceof wjcGrid.Column){this.column=t;this.grid=e.props[ComponentBase._propsParent].control}this.template&&this._attachToControl()})}componentWillUnmount(){this._detachFromControl()}componentDidUpdate(e){let t=e[FlexGridCellTemplate._CellRenderFuncProp],l=this.template;t!=l&&(null==t?this._attachToControl():null==l&&this._detachFromControl())}render(){return null}_attachToControl(){let e=this.cellType=wjcCore.asEnum(this.props.cellType,CellTemplateType),t=this.ownerControl;t[DirectiveCellFactory.getTemplContextProp(e)]=this;t instanceof wjcGrid.Column&&(e===CellTemplateType.Cell||e===CellTemplateType.ColumnHeader||e===CellTemplateType.ColumnFooter)&&t._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.grid.invalidate()}_detachFromControl(){if(null!=this.cellType){this.ownerControl[DirectiveCellFactory.getTemplContextProp(this.cellType)]=null;this.grid.invalidate()}}}FlexGridCellTemplate._CellRenderFuncProp="template";