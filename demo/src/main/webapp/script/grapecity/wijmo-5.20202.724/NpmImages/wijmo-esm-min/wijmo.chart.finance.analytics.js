/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();import{Rect,asInt,Size,asNumber,Point,asArray,assert,asString,asEnum,isNumber,isDate,asDate,Globalize,asType,addClass,asBoolean,isObject,_registerModule}from"wijmo/wijmo";import{SeriesBase,ChartType,_DataPoint,_DataInfo,_LinesArea,_CircleArea,_BasePlotter,LabelPosition,DataPoint,FlexChartCore}from"wijmo/wijmo.chart";import{_minimum,_maximum,_avgTrueRng,_range,_stdDeviation,_sma,_average,_ema,_sum}from"wijmo/wijmo.chart.finance";import*as selfModule from"wijmo/wijmo.chart.finance.analytics";function isValid(t){return isFinite(t)&&!isNaN(t)&&isNumber(t)}var Fibonacci=function(t){__extends(Fibonacci,t);function Fibonacci(e){var i=t.call(this)||this;i._levels=[0,23.6,38.2,50,61.8,100];i._uptrend=!0;i._labelPosition=LabelPosition.Left;i.rendering.addHandler(i._render);i.initialize(e);return i}Object.defineProperty(Fibonacci.prototype,"low",{get:function(){return this._low},set:function(t){if(t!=this._low){this._low=asNumber(t,!0);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"high",{get:function(){return this._high},set:function(t){if(t!=this._high){this._high=asNumber(t,!0);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"labelPosition",{get:function(){return this._labelPosition},set:function(t){if((t=asEnum(t,LabelPosition,!0))!=this._labelPosition){this._labelPosition=t;this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"uptrend",{get:function(){return this._uptrend},set:function(t){if(t!=this._uptrend){this._uptrend=asBoolean(t,!0);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"levels",{get:function(){return this._levels},set:function(t){if(t!=this._levels){this._levels=asArray(t,!0);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"minX",{get:function(){return this._minX},set:function(t){if(t!=this._minX){this._minX=t;this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Fibonacci.prototype,"maxX",{get:function(){return this._maxX},set:function(t){if(t!=this._maxX){this._maxX=t;this._invalidate()}},enumerable:!0,configurable:!0});Fibonacci.prototype._getMinX=function(){return isNumber(this._minX)?this._minX:isDate(this._minX)?asDate(this._minX).valueOf():this._getAxisX().actualMin};Fibonacci.prototype._getMaxX=function(){return isNumber(this._maxX)?this._maxX:isDate(this._maxX)?asDate(this._maxX).valueOf():this._getAxisX().actualMax};Fibonacci.prototype._updateLevels=function(){var e=void 0,i=void 0;if(void 0===this._low||void 0===this._high){var s=t.prototype.getValues.call(this,0),a=t.prototype.getValues.call(this,1);if(s)for(var n=s.length,l=this._getMinX(),r=this._getMaxX(),o=0;o<n;o++){var h=s[o],c=a?a[o]:o;if(!(c<l||c>r)&&!isNaN(h)){(void 0===e||e>h)&&(e=h);(void 0===i||i<h)&&(i=h)}}}void 0===this._low&&void 0!==e?this._actualLow=e:this._actualLow=this._low;void 0===this._high&&void 0!==i?this._actualHigh=i:this._actualHigh=this._high};Fibonacci.prototype._render=function(t,e){e.cancel=!0;var i=t;i._updateLevels();var s=i._getAxisX(),a=i._getAxisY(),n=e.engine,l=i._getSymbolStroke(i._chart.series.indexOf(i)),r=_BasePlotter.cloneStyle(i.style,["fill"]),o=_BasePlotter.cloneStyle(i.style,["stroke"]),h=i.chart._plotrectId;n.stroke=l;n.strokeWidth=2;n.textFill=l;var c=i._getMinX(),_=i._getMaxX();c<s.actualMin&&(c=s.actualMin);_>s.actualMax&&(_=s.actualMax);n.startGroup(null,h);for(var u=i._levels?i._levels.length:0,d=0;d<u;d++){var p=i._levels[d],g=s.convert(c),f=s.convert(_),y=i.uptrend?a.convert(i._actualLow+.01*p*(i._actualHigh-i._actualLow)):a.convert(i._actualHigh-.01*p*(i._actualHigh-i._actualLow));if(_DataInfo.isValid(g)&&_DataInfo.isValid(f)&&_DataInfo.isValid(y)){n.drawLine(g,y,f,y,null,r);if(i.labelPosition!=LabelPosition.None){var m=p.toFixed(1)+"%",v=0;(i.uptrend&&0==d||!i.uptrend&&d==u-1)&&(v=2);switch(i.labelPosition){case LabelPosition.Left:FlexChartCore._renderText(n,m,new Point(g,y),0,v,null,null,o);break;case LabelPosition.Center:FlexChartCore._renderText(n,m,new Point(.5*(g+f),y),1,v,null,null,o);break;case LabelPosition.Right:FlexChartCore._renderText(n,m,new Point(f,y),2,v,null,null,o)}}}}n.stroke=null;n.strokeWidth=null;n.textFill=null;n.endGroup()};Fibonacci.prototype._getChartType=function(){return ChartType.Line};return Fibonacci}(SeriesBase);export{Fibonacci};var FibonacciArcs=function(t){__extends(FibonacciArcs,t);function FibonacciArcs(e){var i=t.call(this)||this;i._levels=[38.2,50,61.8];i._labelPosition=LabelPosition.Top;i.rendering.addHandler(i._render,i);i.initialize(e);return i}Object.defineProperty(FibonacciArcs.prototype,"start",{get:function(){return this._start},set:function(t){if(t!==this.start){this._start=asType(t,DataPoint);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciArcs.prototype,"end",{get:function(){return this._end},set:function(t){if(t!==this.end){this._end=asType(t,DataPoint);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciArcs.prototype,"levels",{get:function(){return this._levels},set:function(t){if(t!==this._levels){this._levels=asArray(t,!1);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciArcs.prototype,"labelPosition",{get:function(){return this._labelPosition},set:function(t){if((t=asEnum(t,LabelPosition))!==this.labelPosition){this._labelPosition=t;this._invalidate()}},enumerable:!0,configurable:!0});FibonacciArcs.prototype._render=function(e,i){i.cancel=!0;var s=this._getX(0),a=this._getY(0),n=this._getX(1),l=this._getY(1);if(!(t.prototype._getLength.call(this)<=1)&&isValid(s)&&isValid(a)&&isValid(n)&&isValid(l)){var r,o=this._getAxisX(),h=this._getAxisY(),c=i.engine,_=this.chart.series.indexOf(this),u=this._getSymbolStroke(_),d=_BasePlotter.cloneStyle(this.style,["fill"]),p=_BasePlotter.cloneStyle(this.style,["stroke"]);c.stroke=u;c.strokeWidth=2;c.textFill=u;var g,f,y,m,v,V,b,x,P,w=this.chart._plotrectId,B=l-a;r=c.startGroup(null,w);addClass(r,"fibonacci-arcs");isValid(s)&&isValid(a)&&isValid(n)&&isValid(l)&&c.drawLines([o.convert(s),o.convert(n)],[h.convert(a),h.convert(l)],null,d);m=Math.sqrt(Math.pow(o.convert(n)-o.convert(s),2)+Math.pow(h.convert(l)-h.convert(a),2));V=new Point(n,l);for(var k=0;k<this.levels.length;k++){b=.01*this.levels[k];v=Math.abs(m*b);if(isValid(V.x)&&isValid(V.y)&&isValid(v)){g=o.convert(V.x);f=h.convert(V.y);c.drawDonutSegment(g,f,v,v,B>0?0:Math.PI,Math.PI,null,d);if(this.labelPosition!==LabelPosition.None&&0!==b){P=Globalize.format(b,"p1");x=c.measureString(P,null,null,p);y=B<=0?f-v:f+v;switch(this.labelPosition){case LabelPosition.Center:y+=.5*x.height;break;case LabelPosition.Bottom:y+=B<=0?x.height:0;break;default:y+=B<=0?0:x.height}c.drawString(P,new Point(g-.5*x.width,y),null,p)}}}c.stroke=null;c.strokeWidth=null;c.textFill=null;c.endGroup()}};FibonacciArcs.prototype._getX=function(t){var e=null;0===t&&this.start?e=this.start.x:1===t&&this.end&&(e=this.end.x);isDate(e)&&(e=asDate(e).valueOf());return e};FibonacciArcs.prototype._getY=function(t){var e=null;0===t&&this.start?e=this.start.y:1===t&&this.end&&(e=this.end.y);return e};FibonacciArcs.prototype._getChartType=function(){return ChartType.Line};return FibonacciArcs}(SeriesBase);export{FibonacciArcs};var FibonacciFans=function(t){__extends(FibonacciFans,t);function FibonacciFans(e){var i=t.call(this)||this;i._levels=[0,23.6,38.2,50,61.8,100];i._labelPosition=LabelPosition.Top;i.rendering.addHandler(i._render,i);i.initialize(e);return i}Object.defineProperty(FibonacciFans.prototype,"start",{get:function(){return this._start},set:function(t){if(t!==this.start){this._start=asType(t,DataPoint);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciFans.prototype,"end",{get:function(){return this._end},set:function(t){if(t!==this.end){this._end=asType(t,DataPoint);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciFans.prototype,"levels",{get:function(){return this._levels},set:function(t){if(t!==this._levels){this._levels=asArray(t,!1);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciFans.prototype,"labelPosition",{get:function(){return this._labelPosition},set:function(t){if((t=asEnum(t,LabelPosition))!==this.labelPosition){this._labelPosition=t;this._invalidate()}},enumerable:!0,configurable:!0});FibonacciFans.prototype._updateLevels=function(){if(!this.start||!this.end){var e,i,s,a,n=this.chart._getPlotter(this),l=this._getAxisX(),r=t.prototype.getValues.call(this,0),o=t.prototype.getValues.call(this,1)||n.dataInfo.getXVals();if(r&&r.length>0){s=_minimum(r);a=_maximum(r)}if(o&&o.length>0){e=_minimum(o);i=_maximum(o)}else{e=l.actualMin;i=l.actualMax}if(isValid(e)&&isValid(s)&&isValid(i)&&isValid(a)){this.start=new DataPoint(e,s);this.end=new DataPoint(i,a)}}};FibonacciFans.prototype._render=function(e,i){i.cancel=!0;this._updateLevels();var s=this._getX(0),a=this._getY(0),n=this._getX(1),l=this._getY(1);if(!(t.prototype._getLength.call(this)<=1)&&isValid(s)&&isValid(a)&&isValid(n)&&isValid(l)){var r=this._getAxisX(),o=this._getAxisY(),h=this.chart.series.indexOf(this),c=i.engine,_=this._getSymbolStroke(h),u=_BasePlotter.cloneStyle(this.style,["fill"]),d=_BasePlotter.cloneStyle(this.style,["stroke"]);c.stroke=_;c.strokeWidth=2;c.textFill=_;var p,g,f,y,m,v,V,b,x,P,w,B,k,L=l-a,M=n-s,I=this.chart._plotrectId;p=s;f=a;y=l;var X=g=n;c.startGroup(null,I);for(var O=0;O<this.levels.length;O++){g=M<0?r.actualMin:r.actualMax;y=(b=((y=f+(P=.01*this.levels[O])*L)-f)/(X-p))*g+(x=y-b*X);L>0&&y>o.actualMax?g=((y=o.actualMax)-x)/b:L<0&&y<o.actualMin&&(g=((y=o.actualMin)-x)/b);if(isValid(p)&&isValid(f)&&isValid(g)&&isValid(y)){m=new Point(r.convert(p),o.convert(f));v=new Point(r.convert(g),o.convert(y));c.drawLines([m.x,v.x],[m.y,v.y],null,u);if(this.labelPosition!=LabelPosition.None){w=Globalize.format(P,"p1");B=c.measureString(w,null,null,d);k=180*Math.atan((v.y-m.y)/(v.x-m.x))/Math.PI;V=v.clone();v.x=M>0?v.x-B.width:v.x;var S,C=k*Math.PI/180,F=new Point,A=new Point,T=new Point,D=new Point,Y=o.convert(o.actualMin),j=o.convert(o.actualMax),R=r.convert(r.actualMin),W=r.convert(r.actualMax),N=V.clone();switch(this.labelPosition){case LabelPosition.Center:v.y+=.5*B.height;N.y+=.5*B.height;break;case LabelPosition.Bottom:v.y+=B.height}if(M>0){if(this.labelPosition===LabelPosition.Top||this.labelPosition===LabelPosition.Center){D=N.clone();T.x=D.x+B.height*Math.sin(C);T.y=D.y-B.height*Math.cos(C);F.x=D.x-B.width*Math.cos(C)+B.height*Math.sin(C);F.y=D.y-B.width*Math.sin(C)-B.height*Math.cos(C);A.x=D.x-B.width*Math.cos(C);A.y=D.y-B.width*Math.sin(C)}else if(this.labelPosition===LabelPosition.Bottom){T=N.clone();F.x=T.x-B.width*Math.cos(C);F.y=T.y-B.width*Math.sin(C);A.x=F.x-B.height*Math.sin(C);A.y=F.y+B.height*Math.cos(C);D.x=F.x+B.width*Math.cos(C)-B.height*Math.sin(C);D.y=F.y+B.width*Math.sin(C)+B.height*Math.cos(C)}if(L>0){if(T.y<j){b=(o.convertBack(T.y)-o.convertBack(F.y))/(r.convertBack(T.x)-r.convertBack(F.x));x=o.convertBack(T.y)-b*r.convertBack(T.x);S=r.convert((o.actualMax-x)/b);v.x-=Math.abs(T.x-S)}D.x>W&&(v.x-=Math.abs(W-D.x))}else if(L<0){if(D.y>Y){b=(o.convertBack(A.y)-o.convertBack(D.y))/(r.convertBack(A.x)-r.convertBack(D.x));x=o.convertBack(D.y)-b*r.convertBack(D.x);S=r.convert((o.actualMin-x)/b);v.x-=Math.max(Math.abs(S-D.x),Math.abs(Y-D.y))}T.x>W&&(v.x-=Math.abs(W-T.x))}}else if(M<0){if(this.labelPosition===LabelPosition.Top||this.labelPosition===LabelPosition.Center){A=N.clone();F.x=A.x+B.height*Math.sin(C);F.y=A.y-B.height*Math.cos(C);D.x=A.x+B.width*Math.cos(C);D.y=A.y+B.width*Math.sin(C);T.x=F.x+B.width*Math.cos(C);T.y=F.y+B.width*Math.sin(C)}else if(this.labelPosition===LabelPosition.Bottom){F=N.clone();T.x=F.x+B.width*Math.cos(C);T.y=F.y+B.width*Math.sin(C);A.x=F.x-B.height*Math.sin(C);A.y=F.y+B.height*Math.cos(C);D.x=F.x+B.width*Math.cos(C)-B.height*Math.sin(C);D.y=F.y+B.width*Math.sin(C)+B.height*Math.cos(C)}if(L>0){if(F.y<j){b=(o.convertBack(F.y)-o.convertBack(T.y))/(r.convertBack(F.x)-r.convertBack(T.x));x=o.convertBack(F.y)-b*r.convertBack(F.x);S=r.convert((o.actualMax-x)/b);v.x+=Math.abs(F.x-S)}A.x<R&&(v.x+=Math.abs(R-A.x))}else if(L<0){if(A.y>Y){b=(o.convertBack(D.y)-o.convertBack(A.y))/(r.convertBack(D.x)-r.convertBack(A.x));x=o.convertBack(A.y)-b*r.convertBack(A.x);S=r.convert((o.actualMin-x)/b);v.x+=Math.max(Math.abs(S-A.x),Math.abs(Y-A.y))}F.x<R&&(v.x+=Math.abs(R-F.x))}}0===k?c.drawString(w,v,null,d):c.drawStringRotated(w,v,V,k,null,d)}}}c.stroke=null;c.strokeWidth=null;c.textFill=null;c.endGroup()}};FibonacciFans.prototype._getX=function(t){var e=null;0===t&&this.start?e=this.start.x:1===t&&this.end&&(e=this.end.x);isDate(e)&&(e=asDate(e).valueOf());return e};FibonacciFans.prototype._getY=function(t){var e=null;0===t&&this.start?e=this.start.y:1===t&&this.end&&(e=this.end.y);return e};FibonacciFans.prototype._getChartType=function(){return ChartType.Line};return FibonacciFans}(SeriesBase);export{FibonacciFans};var FibonacciTimeZones=function(t){__extends(FibonacciTimeZones,t);function FibonacciTimeZones(e){var i=t.call(this)||this;i._levels=[0,1,2,3,5,8,13,21,34];i._labelPosition=LabelPosition.Right;i.rendering.addHandler(i._render,i);i.initialize(e);return i}Object.defineProperty(FibonacciTimeZones.prototype,"startX",{get:function(){return this._startX},set:function(t){if(t!==this.startX){isDate(t)?this._startX=asDate(t):this._startX=asNumber(t);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciTimeZones.prototype,"endX",{get:function(){return this._endX},set:function(t){if(t!==this.endX){isDate(t)?this._endX=asDate(t):this._endX=asNumber(t);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciTimeZones.prototype,"levels",{get:function(){return this._levels},set:function(t){if(t!==this._levels){this._levels=asArray(t,!1);this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FibonacciTimeZones.prototype,"labelPosition",{get:function(){return this._labelPosition},set:function(t){if((t=asEnum(t,LabelPosition))!==this.labelPosition){this._labelPosition=t;this._invalidate()}},enumerable:!0,configurable:!0});FibonacciTimeZones.prototype._render=function(e,i){i.cancel=!0;this._updateLevels();var s=this._getX(0),a=this._getX(1);if(!(t.prototype._getLength.call(this)<=1)&&isValid(s)&&isValid(a)){var n,l,r,o,h=a-s,c=this._getAxisX(),_=this._getAxisY(),u=this._chart.series.indexOf(this),d=i.engine,p=this._getSymbolStroke(u),g=_BasePlotter.cloneStyle(this.style,["fill"]),f=_BasePlotter.cloneStyle(this.style,["stroke"]),y=_.convert(_.actualMin),m=_.convert(_.actualMax),v=this.chart._plotrectId;d.stroke=p;d.strokeWidth=2;d.textFill=p;if(0!==h){d.startGroup(null,v);for(var V=0;V<this.levels.length;V++)if(!((l=h*(n=this.levels[V])+s)<c.actualMin||c.actualMax<l)&&isValid(l)){l=c.convert(l);d.drawLine(l,y,l,m,null,g);if(this.labelPosition!==LabelPosition.None){o=Globalize.format(n,"n0");r=d.measureString(o,null,null,f);switch(this.labelPosition){case LabelPosition.Left:l-=r.width+2;break;case LabelPosition.Center:l-=r.width/2;break;case LabelPosition.Right:l+=2;break;default:l=h<0?l-r.width-2:l+2}d.drawString(o,new Point(l,y),null,f)}}d.stroke=null;d.strokeWidth=null;d.textFill=null;d.endGroup()}}};FibonacciTimeZones.prototype._updateLevels=function(){var e=this.chart._getPlotter(this),i=t.prototype.getValues.call(this,1)||e.dataInfo.getXVals();if(!(t.prototype._getLength.call(this)<=1)){var s=this._getX(0),a=this._getX(1),n=isNumber(s)&&isNumber(a);if(n||i){if(!n&&i){this._startX=i[0];this._endX=i[1]}}else{this._startX=0;this._endX=1}}};FibonacciTimeZones.prototype._getX=function(t){var e=null;0===t?e=this.startX:1===t&&(e=this.endX);isDate(e)&&(e=asDate(e).valueOf());return e};FibonacciTimeZones.prototype._getChartType=function(){return ChartType.Line};return FibonacciTimeZones}(SeriesBase);export{FibonacciTimeZones};var OverlayIndicatorBase=function(t){__extends(OverlayIndicatorBase,t);function OverlayIndicatorBase(e){var i=t.call(this,e)||this;i._seriesCount=1;return i}Object.defineProperty(OverlayIndicatorBase.prototype,"_hitTester",{get:function(){this._plotter&&!this.__hitTester&&(this.__hitTester=this._plotter.hitTester);return this.__hitTester},enumerable:!0,configurable:!0});OverlayIndicatorBase.prototype._getChartType=function(){return ChartType.Line};OverlayIndicatorBase.prototype._getXValues=function(){return t.prototype.getValues.call(this,1)||this._plotter.dataInfo.getXVals()};OverlayIndicatorBase.prototype._getDataPoint=function(t,e,i,s,a,n){var l=new _DataPoint(i,s,t,e);l.y=e;l.yfmt=n._formatValue(e);l.x=t;l.xfmt=a._formatValue(t);return l};OverlayIndicatorBase.prototype._shouldCalculate=function(){return!0};OverlayIndicatorBase.prototype._init=function(){};OverlayIndicatorBase.prototype._calculate=function(){};OverlayIndicatorBase.prototype._clearValues=function(){t.prototype._clearValues.call(this);this.__hitTester=null};OverlayIndicatorBase.prototype._getName=function(t){var e=void 0;if(this.name)if(this.name.indexOf(",")){var i=this.name.split(",");i&&i.length-1>=t&&(e=i[t].trim())}else e=this.name;return e};OverlayIndicatorBase.prototype._getStyles=function(t){var e=null;if(t<0||null===this._styles)return e;var i=0;for(var s in this._styles){if(i===t&&this._styles.hasOwnProperty(s)){e=this._styles[s];break}i++}return e};OverlayIndicatorBase.prototype.legendItemLength=function(){return this._seriesCount};OverlayIndicatorBase.prototype.measureLegendItem=function(t,e){var i=this._getName(e),s=new Size(0,0);i&&(s=this._measureLegendItem(t,this._getName(e)));return s};OverlayIndicatorBase.prototype.drawLegendItem=function(t,e,i){var s=this._getStyles(i)||this.style;this._getName(i)&&this._drawLegendItem(t,e,this._getChartType(),this._getName(i),s,this.symbolStyle)};return OverlayIndicatorBase}(SeriesBase);export{OverlayIndicatorBase};var SingleOverlayIndicatorBase=function(t){__extends(SingleOverlayIndicatorBase,t);function SingleOverlayIndicatorBase(e){var i=t.call(this,e)||this;i._period=14;return i}Object.defineProperty(SingleOverlayIndicatorBase.prototype,"period",{get:function(){return this._period},set:function(t){if(t!==this._period){this._period=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});SingleOverlayIndicatorBase.prototype.getValues=function(e){var i=null;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}0===e?i=this._yvals:1===e&&(i=this._xvals);return i};SingleOverlayIndicatorBase.prototype.getDataRect=function(e,i){if(i)return i;var s=null;if(t.prototype._getLength.call(this)<=0)return s;if(this._shouldCalculate()){this._init();this._calculate()}var a=_minimum(this._xvals),n=_maximum(this._xvals),l=_minimum(this._yvals),r=_maximum(this._yvals);_DataInfo.isValid(a)&&_DataInfo.isValid(n)&&_DataInfo.isValid(l)&&_DataInfo.isValid(r)&&(s=new Rect(a,l,n-a,r-l));return s};SingleOverlayIndicatorBase.prototype._clearValues=function(){t.prototype._clearValues.call(this);this._xvals=null;this._yvals=null};SingleOverlayIndicatorBase.prototype._shouldCalculate=function(){return!this._yvals||!this._xvals};SingleOverlayIndicatorBase.prototype._init=function(){t.prototype._init.call(this);this._yvals=[];this._xvals=[]};SingleOverlayIndicatorBase.prototype._getItem=function(e){if(t.prototype._getLength.call(this)<=0)return t.prototype._getItem.call(this,e);if(this._shouldCalculate()){this._init();this._calculate()}e=t.prototype._getLength.call(this)-_minimum(this._yvals.length,this._xvals.length)+e;return t.prototype._getItem.call(this,e)};return SingleOverlayIndicatorBase}(OverlayIndicatorBase);export{SingleOverlayIndicatorBase};var WilliamsR=function(t){__extends(WilliamsR,t);function WilliamsR(e){var i=t.call(this)||this;i.period=14;i.initialize(e);return i}WilliamsR.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(e<=0)){var i=t.prototype._getBindingValues.call(this,0),s=t.prototype._getBindingValues.call(this,1),a=t.prototype._getBindingValues.call(this,3),n=this._getXValues();this._yvals=_williamsR(i,s,a,this.period);this._xvals=n?n.slice(this.period-1):_range(this.period-1,e-1)}};return WilliamsR}(SingleOverlayIndicatorBase);export{WilliamsR};export function _williamsR(t,e,i,s){asArray(t,!1);asArray(e,!1);asArray(i,!1);asInt(s,!1,!0);var a,n=_minimum(t.length,e.length,i.length),l=[],r=[],o=[];assert(n>s&&s>1,"Williams %R period must be an integer less than the length of the data and greater than one.");for(a=s;a<=t.length;a++){l.push(_maximum(t.slice(a-s,a)));r.push(_minimum(e.slice(a-s,a)))}i.splice(0,s-1);for(a=0;a<l.length;a++)o.push((l[a]-i[a])/(l[a]-r[a])*-100);return o}var Stochastic=function(t){__extends(Stochastic,t);function Stochastic(e){var i=t.call(this)||this;i._kPeriod=14;i._dPeriod=3;i._smoothingPeriod=1;i._seriesCount=2;i.rendering.addHandler(i._rendering,i);i.initialize(e);return i}Object.defineProperty(Stochastic.prototype,"kPeriod",{get:function(){return this._kPeriod},set:function(t){if(t!==this._kPeriod){this._kPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Stochastic.prototype,"dPeriod",{get:function(){return this._dPeriod},set:function(t){if(t!==this._dPeriod){this._dPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Stochastic.prototype,"smoothingPeriod",{get:function(){return this._smoothingPeriod},set:function(t){if(t!==this._smoothingPeriod){this._smoothingPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Stochastic.prototype,"styles",{get:function(){return this._styles},set:function(t){if(t!==this._styles){this._styles=t;this._invalidate()}},enumerable:!0,configurable:!0});Stochastic.prototype.getDataRect=function(e,i){if(i)return i;var s=null;if(t.prototype._getLength.call(this)<=0)return s;if(this._shouldCalculate()){this._init();this._calculate()}var a=this._kVals.concat(this._dVals),n=this._kXVals.concat(this._dXVals),l=_minimum(n),r=_maximum(n),o=_minimum(a),h=_maximum(a);_DataInfo.isValid(l)&&_DataInfo.isValid(r)&&_DataInfo.isValid(o)&&_DataInfo.isValid(h)&&(s=new Rect(l,o,r-l,h-o));return s};Stochastic.prototype._clearValues=function(){t.prototype._clearValues.call(this);this._kVals=null;this._kXVals=null;this._dVals=null;this._dXVals=null};Stochastic.prototype._shouldCalculate=function(){return!(this._kVals&&this._kXVals&&this._dVals&&this._dXVals)};Stochastic.prototype._init=function(){t.prototype._init.call(this);this._kVals=[];this._kXVals=[];this._dVals=[];this._dXVals=[]};Stochastic.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(t.prototype._getLength.call(this)<=0)){var i=t.prototype._getBindingValues.call(this,0),s=t.prototype._getBindingValues.call(this,1),a=t.prototype._getBindingValues.call(this,3),n=this._getXValues(),l=_stochastic(i,s,a,this.kPeriod,this.dPeriod,this.smoothingPeriod);this._kVals=l.ks;this._dVals=l.ds;this._kXVals=n?n.slice(this.kPeriod-1):_range(this.kPeriod-1,e-1);this.smoothingPeriod&&this.smoothingPeriod>1&&(this._kXVals=this._kXVals.slice(this._kXVals.length-this._kVals.length,this._kXVals.length));this._dXVals=this._kXVals.slice(this._kXVals.length-this._dVals.length,this._kXVals.length)}};Stochastic.prototype._rendering=function(e,i){i.cancel=!0;if(!(t.prototype._getLength.call(this)<=0)){if(this._shouldCalculate()){this._init();this._calculate()}var s=this.chart.series.indexOf(this),a=i.engine,n=this._getAxisX(),l=this._getAxisY(),r=_BasePlotter.cloneStyle(this.style,["fill"]),o=this._getSymbolStroke(s),h=this.chart._plotrectId,c=null,_=o,u=2,d=null,p=o,g=2;if(this.styles&&isObject(this.styles)){if(this.styles.kLine&&isObject(this.styles.kLine)){_=(c=_BasePlotter.cloneStyle(this.styles.kLine,["fill"])).stroke?c.stroke:o;u=c.strokeWidth?c.strokeWidth:2}if(this.styles.dLine&&isObject(this.styles.dLine)){p=(d=_BasePlotter.cloneStyle(this.styles.dLine,["fill"])).stroke?d.stroke:o;g=d.strokeWidth?d.strokeWidth:2}}var f,y,m,v,V=[],b=[],x=[],P=[],w=this._getLength();for(m=0;m<this._kVals.length;m++){v=w-this._kVals.length+m;b.push(n.convert(this._kXVals[m]));V.push(l.convert(this._kVals[m]));(f=this._getDataPoint(this._kXVals[m],this._kVals[m],s,v,n,l)).name=this._getName(0);(y=new _CircleArea(new Point(b[m],V[m]),.5*a.strokeWidth)).tag=f;this._hitTester.add(y,s)}this._hitTester.add(new _LinesArea(b,V),s);a.stroke=_;a.strokeWidth=u;a.drawLines(b,V,null,r,h);for(m=0;m<this._dVals.length;m++){v=w-this._dVals.length+m;P.push(n.convert(this._dXVals[m]));x.push(l.convert(this._dVals[m]));(f=this._getDataPoint(this._dXVals[m],this._dVals[m],s,v,n,l)).name=this._getName(1);(y=new _CircleArea(new Point(P[m],x[m]),.5*a.strokeWidth)).tag=f;this._hitTester.add(y,s)}this._hitTester.add(new _LinesArea(P,x),s);a.stroke=p;a.strokeWidth=g;a.drawLines(P,x,null,r,h)}};Stochastic.prototype.getCalculatedValues=function(e){e=asString(e,!1);var i=[],s=0;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}switch(e){case"kLine":for(;s<this._kVals.length;s++)i.push({x:this._kXVals[s],y:this._kVals[s]});break;case"dLine":for(;s<this._dVals.length;s++)i.push({x:this._dXVals[s],y:this._dVals[s]})}return i};return Stochastic}(OverlayIndicatorBase);export{Stochastic};export function _stochastic(t,e,i,s,a,n){asArray(t,!1);asArray(e,!1);asArray(i,!1);asInt(s,!1,!0);asInt(a,!1,!0);asInt(n,!0,!0);var l,r=[],o=[],h=[];for(l=s;l<=t.length;l++){r.push(_maximum(t.slice(l-s,l)));o.push(_minimum(e.slice(l-s,l)))}i=i.slice(s-1);for(l=0;l<i.length;l++)h.push((i[l]-o[l])/(r[l]-o[l])*100);n&&n>1&&(h=_sma(h,n));return{ks:h,ds:_sma(h,a)}}var RSI=function(t){__extends(RSI,t);function RSI(e){var i=t.call(this)||this;i.period=14;i.initialize(e);return i}RSI.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(e<=0)){var i=t.prototype._getBindingValues.call(this,0),s=this._getXValues();this._yvals=_rsi(i,this.period);this._xvals=s?s.slice(this.period):_range(this.period,e)}};return RSI}(SingleOverlayIndicatorBase);export{RSI};export function _rsi(t,e){asArray(t,!1);asInt(e,!0,!1);assert(t.length>e&&e>1,"RSI period must be an integer less than the length of the data and greater than one.");var i,s,a,n,l=[],r=[],o=[],h=[];for(n=1;n<t.length;n++)l.push(t[n]-t[n-1]);i=l.map((function(t){return t>0?t:0}));s=l.map((function(t){return t<0?Math.abs(t):0}));for(n=e;n<=l.length;n++){if(n===e){r.push(_sum(i.slice(n-e,n))/e);o.push(_sum(s.slice(n-e,n))/e)}else{r.push((i[n-1]+r[n-e-1]*(e-1))/e);o.push((s[n-1]+o[n-e-1]*(e-1))/e)}a=r[n-e]/o[n-e];a=isFinite(a)?a:0;h.push(100-100/(1+a))}return h}var MacdBase=function(t){__extends(MacdBase,t);function MacdBase(e){var i=t.call(this,e)||this;i._fastPeriod=12;i._slowPeriod=26;i._smoothingPeriod=9;return i}Object.defineProperty(MacdBase.prototype,"fastPeriod",{get:function(){return this._fastPeriod},set:function(t){if(t!==this._fastPeriod){this._fastPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MacdBase.prototype,"slowPeriod",{get:function(){return this._slowPeriod},set:function(t){if(t!==this._slowPeriod){this._slowPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MacdBase.prototype,"smoothingPeriod",{get:function(){return this._smoothingPeriod},set:function(t){if(t!==this._smoothingPeriod){this._smoothingPeriod=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});MacdBase.prototype._clearValues=function(){t.prototype._clearValues.call(this);this._macdVals=null;this._macdXVals=null;this._signalVals=null;this._signalXVals=null;this._histogramVals=null;this._histogramXVals=null};MacdBase.prototype._shouldCalculate=function(){return!(this._macdVals&&this._macdXVals&&this._signalVals&&this._signalXVals&&this._histogramVals&&this._histogramXVals)};MacdBase.prototype._init=function(){t.prototype._init.call(this);this._macdVals=[];this._macdXVals=[];this._signalVals=[];this._signalXVals=[];this._histogramVals=[];this._histogramXVals=[]};MacdBase.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(e<=0)){var i=t.prototype.getValues.call(this,0),s=this._getXValues(),a=_macd(i,this.fastPeriod,this.slowPeriod,this.smoothingPeriod);this._macdVals=a.macds;this._signalVals=a.signals;this._histogramVals=a.histograms;this._macdXVals=s?s.slice(e-this._macdVals.length,e):_range(e-this._macdVals.length,e-1);this._signalXVals=s?s.slice(e-this._signalVals.length,e):_range(e-this._signalVals.length,e-1);this._histogramXVals=s?s.slice(e-this._histogramVals.length,e):_range(e-this._histogramVals.length,e-1)}};return MacdBase}(OverlayIndicatorBase);export{MacdBase};var Macd=function(t){__extends(Macd,t);function Macd(e){var i=t.call(this)||this;i._seriesCount=2;i.rendering.addHandler(i._rendering,i);i.initialize(e);return i}Object.defineProperty(Macd.prototype,"styles",{get:function(){return this._styles},set:function(t){if(t!==this._styles){this._styles=t;this._invalidate()}},enumerable:!0,configurable:!0});Macd.prototype.legendItemLength=function(){return this.name.indexOf(",")>-1?2:1};Macd.prototype.getDataRect=function(e,i){if(i)return i;var s=null;if(t.prototype._getLength.call(this)<=0)return s;if(this._shouldCalculate()){this._init();this._calculate()}var a=[],n=[];n.push.apply(n,this._macdXVals);n.push.apply(n,this._signalXVals);a.push.apply(a,this._macdVals);a.push.apply(a,this._signalVals);var l=_minimum(n),r=_maximum(n),o=_minimum(a),h=_maximum(a);_DataInfo.isValid(l)&&_DataInfo.isValid(r)&&_DataInfo.isValid(o)&&_DataInfo.isValid(h)&&(s=new Rect(l,o,r-l,h-o));return s};Macd.prototype._rendering=function(e,i){i.cancel=!0;if(!(t.prototype._getLength.call(this)<=0)){if(this._shouldCalculate()){this._init();this._calculate()}var s=this.chart.series.indexOf(this),a=i.engine,n=this._getAxisX(),l=this._getAxisY(),r=_BasePlotter.cloneStyle(this.style,["fill"]),o=this._getSymbolStroke(s),h=this.chart._plotrectId,c=null,_=o,u=2,d=null,p=o,g=2;if(this.styles&&isObject(this.styles)){if(this.styles.macdLine&&isObject(this.styles.macdLine)){_=(c=_BasePlotter.cloneStyle(this.styles.macdLine,["fill"])).stroke?c.stroke:o;u=c.strokeWidth?c.strokeWidth:2}if(this.styles.signalLine&&isObject(this.styles.signalLine)){p=(d=_BasePlotter.cloneStyle(this.styles.signalLine,["fill"])).stroke?d.stroke:o;g=d.strokeWidth?d.strokeWidth:2}}var f,y,m,v,V=[],b=[],x=[],P=[],w=this._getLength();for(m=0;m<this._macdVals.length;m++){v=w-this._macdVals.length+m;b.push(n.convert(this._macdXVals[m]));V.push(l.convert(this._macdVals[m]));(f=this._getDataPoint(this._macdXVals[m],this._macdVals[m],s,v,n,l)).name=this._getName(0);(y=new _CircleArea(new Point(b[m],V[m]),.5*a.strokeWidth)).tag=f;this._hitTester.add(y,s)}this._hitTester.add(new _LinesArea(b,V),s);a.stroke=_;a.strokeWidth=u;a.drawLines(b,V,null,r,h);for(m=0;m<this._signalVals.length;m++){v=w-this._signalVals.length+m;P.push(n.convert(this._signalXVals[m]));x.push(l.convert(this._signalVals[m]));(f=this._getDataPoint(this._signalXVals[m],this._signalVals[m],s,v,n,l)).name=this._getName(1);(y=new _CircleArea(new Point(P[m],x[m]),.5*a.strokeWidth)).tag=f;this._hitTester.add(y,s)}this._hitTester.add(new _LinesArea(P,x),s);a.stroke=p;a.strokeWidth=g;a.drawLines(P,x,null,r,h)}};Macd.prototype.getCalculatedValues=function(e){e=asString(e,!1);var i=[],s=0;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}switch(e){case"macdLine":for(;s<this._macdVals.length;s++)i.push({x:this._macdXVals[s],y:this._macdVals[s]});break;case"signalLine":for(;s<this._signalVals.length;s++)i.push({x:this._signalXVals[s],y:this._signalVals[s]})}return i};return Macd}(MacdBase);export{Macd};var MacdHistogram=function(t){__extends(MacdHistogram,t);function MacdHistogram(e){return t.call(this,e)||this}MacdHistogram.prototype.getValues=function(e){var i=null;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}0===e?i=this._histogramVals:1===e&&(i=this._histogramXVals);return i};MacdHistogram.prototype.getDataRect=function(e,i){if(i)return i;var s=null;if(t.prototype._getLength.call(this)<=0)return s;if(this._shouldCalculate()){this._init();this._calculate()}var a=_minimum(this._histogramXVals),n=_maximum(this._histogramXVals),l=_minimum(this._histogramVals),r=_maximum(this._histogramVals);_DataInfo.isValid(a)&&_DataInfo.isValid(n)&&_DataInfo.isValid(l)&&_DataInfo.isValid(r)&&(s=new Rect(a,l,n-a,r-l));return s};MacdHistogram.prototype._getChartType=function(){return ChartType.Column};MacdHistogram.prototype._getItem=function(e){e=t.prototype._getLength.call(this)-_minimum(this._histogramVals.length,this._histogramXVals.length)+e;return t.prototype._getItem.call(this,e)};return MacdHistogram}(MacdBase);export{MacdHistogram};export function _macd(t,e,i,s){asArray(t,!1);asInt(e,!1,!0);asInt(i,!1,!0);asInt(s,!1,!0);var a,n=e>i;if(n){a=i;i=e;e=a}var l,r,o=_ema(t,e),h=_ema(t,i),c=[],_=[];o.splice(0,i-e);for(r=0;r<o.length;r++){a=o[r]-h[r];n&&(a*=-1);c.push(a)}l=_ema(c,s);var u=c.slice(c.length-l.length,c.length);for(r=0;r<u.length;r++)_.push(u[r]-l[r]);return{macds:c,signals:l,histograms:_}}export var MovingAverageType;!function(t){t[t.Simple=0]="Simple";t[t.Exponential=1]="Exponential"}(MovingAverageType||(MovingAverageType={}));var Envelopes=function(t){__extends(Envelopes,t);function Envelopes(e){var i=t.call(this)||this;i._period=20;i._type=MovingAverageType.Simple;i._size=.025;i.rendering.addHandler(i._rendering,i);i.initialize(e);return i}Object.defineProperty(Envelopes.prototype,"period",{get:function(){return this._period},set:function(t){if(t!==this._period){this._period=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Envelopes.prototype,"type",{get:function(){return this._type},set:function(t){if((t=asEnum(t,MovingAverageType,!1))!==this._type){this._type=t;this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Envelopes.prototype,"size",{get:function(){return this._size},set:function(t){if(t!==this._size){this._size=asNumber(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Envelopes.prototype.getDataRect=function(e,i){if(i)return i;var s=null;if(t.prototype._getLength.call(this)<=0)return s;if(this._shouldCalculate()){this._init();this._calculate()}var a=this._upperYVals.concat(this._lowerYVals),n=_minimum(this._xVals),l=_maximum(this._xVals),r=_minimum(a),o=_maximum(a);_DataInfo.isValid(n)&&_DataInfo.isValid(l)&&_DataInfo.isValid(r)&&_DataInfo.isValid(o)&&(s=new Rect(n,r,l-n,o-r));return s};Envelopes.prototype._clearValues=function(){t.prototype._clearValues.call(this);this._upperYVals=null;this._lowerYVals=null;this._xVals=null};Envelopes.prototype._init=function(){t.prototype._init.call(this);this._upperYVals=[];this._lowerYVals=[];this._xVals=[]};Envelopes.prototype._shouldCalculate=function(){return!this._upperYVals||!this._lowerYVals||!this._xVals};Envelopes.prototype._calculate=function(){var e=this;if(!(t.prototype._getLength.call(this)<=0)){var i,s=t.prototype.getValues.call(this,0),a=this._getXValues();switch(this.type){case MovingAverageType.Exponential:i=_ema(s,this.period);break;case MovingAverageType.Simple:default:i=_sma(s,this.period)}this._xVals=a?a.slice(this.period-1):_range(this.period-1,t.prototype._getLength.call(this)-1);this._upperYVals=i.map((function(t){return t+t*e.size}));this._lowerYVals=i.map((function(t){return t-t*e.size}))}};Envelopes.prototype._rendering=function(e,i){i.cancel=!0;if(!(t.prototype._getLength.call(this)<=0)){if(this._shouldCalculate()){this._init();this._calculate()}var s=this.chart.series.indexOf(this),a=i.engine,n=this._getAxisX(),l=this._getAxisY(),r=_minimum(this._upperYVals.length,this._lowerYVals.length,this._xVals.length),o=_BasePlotter.cloneStyle(this.style,["fill"]),h=this._getSymbolStroke(s),c=this.chart._plotrectId;if(r&&!(r<=0)){a.stroke=h;a.strokeWidth=2;for(var _,u,d,p=[],g=[],f=[],y=this._getLength(),m=0;m<r;m++){d=y-r+m;p.push(n.convert(this._xVals[m]));g.push(l.convert(this._upperYVals[m]));_=this._getDataPoint(this._xVals[m],this._upperYVals[m],s,d,n,l);(u=new _CircleArea(new Point(p[m],g[m]),.5*a.strokeWidth)).tag=_;this._hitTester.add(u,s);f.push(l.convert(this._lowerYVals[m]));_=this._getDataPoint(this._xVals[m],this._lowerYVals[m],s,d,n,l);(u=new _CircleArea(new Point(p[m],f[m]),.5*a.strokeWidth)).tag=_;this._hitTester.add(u,s)}this._hitTester.add(new _LinesArea(p,g),s);this._hitTester.add(new _LinesArea(p,f),s);a.drawLines(p,g,null,o,c);a.drawLines(p,f,null,o,c)}}};Envelopes.prototype.getCalculatedValues=function(e){e=asString(e,!1);var i=[],s=0;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}switch(e){case"upperEnvelope":for(;s<this._upperYVals.length;s++)i.push({x:this._xVals[s],y:this._upperYVals[s]});break;case"lowerEnvelope":for(;s<this._lowerYVals.length;s++)i.push({x:this._xVals[s],y:this._lowerYVals[s]})}return i};return Envelopes}(OverlayIndicatorBase);export{Envelopes};var CCI=function(t){__extends(CCI,t);function CCI(e){var i=t.call(this)||this;i._constant=.015;i.period=20;i.initialize(e);return i}Object.defineProperty(CCI.prototype,"constant",{get:function(){return this._constant},set:function(t){if(t!==this._constant){this._constant=asNumber(t,!1);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});CCI.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(e<=0)){var i=t.prototype._getBindingValues.call(this,0),s=t.prototype._getBindingValues.call(this,1),a=t.prototype._getBindingValues.call(this,3),n=this._getXValues();this._yvals=_cci(i,s,a,this.period,this.constant);this._xvals=n?n.slice(this.period-1):_range(this.period-1,e-1)}};return CCI}(SingleOverlayIndicatorBase);export{CCI};export function _cci(t,e,i,s,a){asArray(t,!1);asArray(e,!1);asArray(i,!1);asInt(s,!1,!0);asNumber(a,!1,!0);var n,l,r,o=_minimum(t.length,e.length,i.length),h=[],c=[],_=[];assert(o>s&&s>1,"CCI period must be an integer less than the length of the data and greater than one.");for(l=0;l<o;l++)h.push(_average(t[l],e[l],i[l]));n=_sma(h,s);for(l=0;l<n.length;l++){r=h.slice(l,s+l).reduce((function(t,e){return t+Math.abs(n[l]-e)}),0);c.push(r/s)}h.splice(0,s-1);for(l=0;l<n.length;l++)_.push((h[l]-n[l])/(a*c[l]));return _}var BollingerBands=function(t){__extends(BollingerBands,t);function BollingerBands(e){var i=t.call(this)||this;i._period=20;i._multiplier=2;i.rendering.addHandler(i._rendering,i);i.initialize(e);return i}Object.defineProperty(BollingerBands.prototype,"period",{get:function(){return this._period},set:function(t){if(t!==this._period){this._period=asInt(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(BollingerBands.prototype,"multiplier",{get:function(){return this._multiplier},set:function(t){if(t!==this._multiplier){this._multiplier=asNumber(t,!1,!0);this._clearValues();this._invalidate()}},enumerable:!0,configurable:!0});BollingerBands.prototype.getDataRect=function(e,i){if(i)return i;if(t.prototype._getLength.call(this)<=0)return null;if(this._shouldCalculate()){this._init();this._calculate()}var s=this._upperYVals.concat(this._lowerYVals),a=_minimum(this._xVals),n=_maximum(this._xVals),l=_minimum(s),r=_maximum(s);return _DataInfo.isValid(a)&&_DataInfo.isValid(n)&&_DataInfo.isValid(l)&&_DataInfo.isValid(r)?new Rect(a,l,n-a,r-l):null};BollingerBands.prototype._clearValues=function(){t.prototype._clearValues.call(this);this._upperYVals=null;this._middleYVals=null;this._lowerYVals=null;this._xVals=null};BollingerBands.prototype._shouldCalculate=function(){return!(this._upperYVals&&this._middleYVals&&this._lowerYVals&&this._xVals)};BollingerBands.prototype._init=function(){t.prototype._init.call(this);this._upperYVals=[];this._middleYVals=[];this._lowerYVals=[];this._xVals=[]};BollingerBands.prototype._calculate=function(){var e=t.prototype._getLength.call(this);if(!(e<=0)){var i=t.prototype.getValues.call(this,0),s=this._getXValues(),a=_bollingerBands(i,this.period,this.multiplier);this._upperYVals=a.uppers;this._middleYVals=a.middles;this._lowerYVals=a.lowers;this._xVals=s?s.slice(this.period-1):_range(this.period-1,e-1)}};BollingerBands.prototype._rendering=function(e,i){i.cancel=!0;if(!(t.prototype._getLength.call(this)<=0)){if(this._shouldCalculate()){this._init();this._calculate()}var s=this.chart.series.indexOf(this),a=i.engine,n=this._getAxisX(),l=this._getAxisY(),r=_minimum(this._upperYVals.length,this._middleYVals.length,this._lowerYVals.length,this._xVals.length),o=_BasePlotter.cloneStyle(this.style,["fill"]),h=this._getSymbolStroke(s),c=this.chart._plotrectId;if(r&&!(r<=0)){a.stroke=h;a.strokeWidth=2;for(var _,u,d,p=[],g=[],f=[],y=[],m=this._getLength(),v=0;v<r;v++){d=m-r+v;p.push(n.convert(this._xVals[v]));g.push(l.convert(this._upperYVals[v]));_=this._getDataPoint(this._xVals[v],this._upperYVals[v],s,d,n,l);(u=new _CircleArea(new Point(p[v],g[v]),.5*a.strokeWidth)).tag=_;this._hitTester.add(u,s);f.push(l.convert(this._middleYVals[v]));_=this._getDataPoint(this._xVals[v],this._middleYVals[v],s,d,n,l);(u=new _CircleArea(new Point(p[v],f[v]),.5*a.strokeWidth)).tag=_;this._hitTester.add(u,s);y.push(l.convert(this._lowerYVals[v]));_=this._getDataPoint(this._xVals[v],this._lowerYVals[v],s,d,n,l);(u=new _CircleArea(new Point(p[v],y[v]),.5*a.strokeWidth)).tag=_;this._hitTester.add(u,s)}this._hitTester.add(new _LinesArea(p,g),s);this._hitTester.add(new _LinesArea(p,f),s);this._hitTester.add(new _LinesArea(p,y),s);a.drawLines(p,g,null,o,c);a.drawLines(p,f,null,o,c);a.drawLines(p,y,null,o,c)}}};BollingerBands.prototype.getCalculatedValues=function(e){e=asString(e,!1);var i=[],s=0;if(t.prototype._getLength.call(this)<=0)return i;if(this._shouldCalculate()){this._init();this._calculate()}switch(e){case"upperBand":for(;s<this._upperYVals.length;s++)i.push({x:this._xVals[s],y:this._upperYVals[s]});break;case"middleBand":for(;s<this._middleYVals.length;s++)i.push({x:this._xVals[s],y:this._middleYVals[s]});break;case"lowerBand":for(;s<this._lowerYVals.length;s++)i.push({x:this._xVals[s],y:this._lowerYVals[s]})}return i};return BollingerBands}(OverlayIndicatorBase);export{BollingerBands};export function _bollingerBands(t,e,i){asArray(t,!1);asInt(e,!1,!0);asNumber(i,!1,!0);assert(t.length>e&&e>1,"Bollinger Bands period must be an integer less than the length of the data and greater than one.");var s,a=_sma(t,e),n=[];for(s=e;s<=t.length;s++)n.push(_stdDeviation(t.slice(s-e,s)));var l=a,r=a.map((function(t,e){return t+n[e]*i}));return{lowers:a.map((function(t,e){return t-n[e]*i})),middles:l,uppers:r}}var ATR=function(t){__extends(ATR,t);function ATR(e){var i=t.call(this)||this;i.period=14;i.initialize(e);return i}ATR.prototype._calculate=function(){if(!(t.prototype._getLength.call(this)<=0)){var e=t.prototype._getBindingValues.call(this,0),i=t.prototype._getBindingValues.call(this,1),s=t.prototype._getBindingValues.call(this,3),a=this._getXValues();this._yvals=_avgTrueRng(e,i,s,this.period);this._xvals=a?a.slice(this.period-1):_range(this.period-1,e.length)}};return ATR}(SingleOverlayIndicatorBase);export{ATR};_registerModule("wijmo.chart.finance.analytics",selfModule);