/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();import{_registerModule}from"wijmo/wijmo";import*as core from"wijmo/wijmo";import*as chart from"wijmo/wijmo.chart";import*as selfModule from"wijmo/wijmo.chart.webgl";var WebGLRenderEngine=function(t){__extends(WebGLRenderEngine,t);function WebGLRenderEngine(e){var i=t.call(this,e)||this;i.primitives=[];i.clipRects={};i.init();return i}WebGLRenderEngine.prototype.beginRender=function(){t.prototype.beginRender.call(this);this.isIE?this.element.appendChild(this.canvas):this.element.appendChild(this.foCanvas);var e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.enable(e.BLEND);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);this.primitives.forEach((function(t){return t.beginRender()}));this.clipRects={}};WebGLRenderEngine.prototype.setViewportSize=function(e,i){t.prototype.setViewportSize.call(this,e,i);if(this.foCanvas){this.foCanvas.setAttribute("width",e.toString());this.foCanvas.setAttribute("height",i.toString())}var r=this.gl;r.canvas.width=e;r.canvas.height=i};WebGLRenderEngine.prototype.endRender=function(){this.primitives.forEach((function(t){return t.endRender()}));t.prototype.endRender.call(this);if(this.isIE){var e=document.createElementNS(WebGLRenderEngine.svgns,"image");e.setAttribute("width",this.gl.canvas.width);e.setAttribute("height",this.gl.canvas.height);e.setAttribute("href",this.canvas.toDataURL());this.element.appendChild(e);this.element.removeChild(this.canvas)}};WebGLRenderEngine.prototype.drawEllipse=function(t,e,i,r,n,o){this.edraw.drawEllipse(new core.Rect(t-i,e-r,2*i,2*r),this.fill);return null};WebGLRenderEngine.prototype.drawRect=function(e,i,r,n,o,s,a){if("wj-plot-area"==this._groupCls)return t.prototype.drawRect.call(this,e,i,r,n,o,s,a);this.rdraw.drawRect(new core.Rect(e,i,r,n),this.fill);return null};WebGLRenderEngine.prototype.drawLines=function(t,e,i,r,n,o){this.ldraw.drawLines(t,e,o,this.stroke,n?this.clipRects[n]:null);return null};WebGLRenderEngine.prototype.drawPolygon=function(t,e,i,r,n){this.adraw.drawPolygon(t,e,this.fill,n?this.clipRects[n]:null);return null};WebGLRenderEngine.prototype.addClipRect=function(e,i){t.prototype.addClipRect.call(this,e,i);e&&i&&(this.clipRects[i]=e)};WebGLRenderEngine.prototype.init=function(){this.canvas=document.createElement("canvas");this.gl=this.canvas.getContext("webgl");if(this.gl){this.canvas.setAttribute("style","margin:0px;padding:0px;border:none");var t=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.setAttribute("style","margin:0px;padding:0px;border:none");this.foCanvas=document.createElementNS(WebGLRenderEngine.svgns,"foreignObject");t.appendChild(this.canvas);this.foCanvas.appendChild(t)}else{this.gl=this.canvas.getContext("experimental-webgl");this.isIE=!0;this.canvas.setAttribute("style","visibility:hidden;position:absolute;top:-1000px;margin:0px;padding:0px;border:none")}this.rdraw=new _GLDrawRect(this.gl);this.edraw=new _GLDrawEllipse(this.gl);this.ldraw=new _GLDrawLines(this.gl);this.adraw=new _GLDrawAreas(this.gl);this.primitives.push(this.rdraw,this.edraw,this.ldraw,this.adraw)};WebGLRenderEngine.svgns="http://www.w3.org/2000/svg";return WebGLRenderEngine}(chart._SvgRenderEngine);export{WebGLRenderEngine};var _GLDrawBase=function(){function _GLDrawBase(t){this._vsSource="\n    attribute vec2 a_position;\n    \n    uniform vec2 u_resolution;\n    \n    void main() {\n      vec2 zeroToOne = a_position / u_resolution;\n      vec2 zeroToTwo = zeroToOne * 2.0;\n      vec2 clipSpace = zeroToTwo - 1.0;\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n    }\n    ";this._fsSource="\n    precision mediump float;\n    uniform vec4 u_color;\n    void main() {\n      gl_FragColor = u_color;\n    }\n    ";this.gl=t}_GLDrawBase.prototype.init=function(){var t=this.gl;this.shaderProgram=this.initShaderProgram(this.vsSource,this.fsSource);this.positionAttributeLocation=t.getAttribLocation(this.shaderProgram,"a_position");this.resolutionUniformLocation=t.getUniformLocation(this.shaderProgram,"u_resolution");this.colorLocation=t.getUniformLocation(this.shaderProgram,"u_color");t.useProgram(this.shaderProgram);this.positionBuffer=t.createBuffer()};_GLDrawBase.prototype.beginRender=function(){var t=this.gl;t.useProgram(this.shaderProgram);t.uniform2f(this.resolutionUniformLocation,t.canvas.width,t.canvas.height)};_GLDrawBase.prototype.endRender=function(){this.flush()};_GLDrawBase.prototype.flush=function(){};_GLDrawBase.prototype.initShaderProgram=function(t,e){var i=this.gl,r=this.loadShader(i.VERTEX_SHADER,t),n=this.loadShader(i.FRAGMENT_SHADER,e),o=i.createProgram();i.attachShader(o,r);i.attachShader(o,n);i.linkProgram(o);if(!i.getProgramParameter(o,i.LINK_STATUS)){alert("Unable to initialize the shader program: "+i.getProgramInfoLog(o));return null}return o};_GLDrawBase.prototype.loadShader=function(t,e){var i=this.gl,r=i.createShader(t);i.shaderSource(r,e);i.compileShader(r);if(!i.getShaderParameter(r,i.COMPILE_STATUS)){alert("An error occurred compiling the shaders: "+i.getShaderInfoLog(r));i.deleteShader(r);return null}return r};Object.defineProperty(_GLDrawBase.prototype,"vsSource",{get:function(){return this._vsSource},enumerable:!0,configurable:!0});Object.defineProperty(_GLDrawBase.prototype,"fsSource",{get:function(){return this._fsSource},enumerable:!0,configurable:!0});return _GLDrawBase}(),_GLDrawRect=function(t){__extends(_GLDrawRect,t);function _GLDrawRect(e){var i=t.call(this,e)||this;i.BUFFER_SIZE=1e4;i.bufRects=[];i.bufLen=0;i.init();return i}_GLDrawRect.prototype.initBuffers=function(){if(!this.buffer){var t=this.gl;this.buffer=new Float32Array(12*this.BUFFER_SIZE);this.bufRects=new Array(this.BUFFER_SIZE);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.bufferData(t.ARRAY_BUFFER,4*this.buffer.length,t.DYNAMIC_DRAW)}};_GLDrawRect.prototype.drawRect=function(t,e){this.initBuffers();if(e!==this.previousFill){this.flush();this.previousFill=e}this.bufRects[this.bufLen++]=t;this.bufLen>=this.BUFFER_SIZE&&this.flush()};_GLDrawRect.prototype.flush=function(){if(0!=this.bufLen){var t=this.gl;t.useProgram(this.shaderProgram);var e=new core.Color(this.previousFill);t.uniform4f(this.colorLocation,e.r/255,e.g/255,e.b/255,e.a);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);this.setData();t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.drawArrays(t.TRIANGLES,0,6*this.bufLen);this.bufLen=0}};_GLDrawRect.prototype.setData=function(){for(var t=this.gl,e=this.bufLen,i=this.buffer,r=0;r<e;r++){var n=this.bufRects[r],o=n.left,s=n.right,a=n.top,h=n.bottom,f=12*r;i[f]=o;i[f+1]=a;i[f+2]=s;i[f+3]=a;i[f+4]=o;i[f+5]=h;i[f+6]=o;i[f+7]=h;i[f+8]=s;i[f+9]=a;i[f+10]=s;i[f+11]=h}t.bufferSubData(t.ARRAY_BUFFER,0,i.subarray(0,12*e))};return _GLDrawRect}(_GLDrawBase),_GLDrawEllipse=function(t){__extends(_GLDrawEllipse,t);function _GLDrawEllipse(e){var i=t.call(this,e)||this;i.NTRIANGLES=12;i.BUFFER_SIZE=1e4;i.bufRects=new Array(i.BUFFER_SIZE);i.bufLen=0;i.sin1=new Float32Array(i.NTRIANGLES);i.sin2=new Float32Array(i.NTRIANGLES);i.cos1=new Float32Array(i.NTRIANGLES);i.cos2=new Float32Array(i.NTRIANGLES);i.data=new Float32Array(i.BUFFER_SIZE*i.NTRIANGLES*6);for(var r=2*Math.PI/i.NTRIANGLES,n=0;n<i.NTRIANGLES;n++){var o=r*n;i.sin1[n]=Math.sin(o);i.cos1[n]=Math.cos(o);i.sin2[n]=Math.sin(o+r);i.cos2[n]=Math.cos(o+r)}i.init();e.enableVertexAttribArray(i.positionAttributeLocation);e.bindBuffer(e.ARRAY_BUFFER,i.positionBuffer);e.vertexAttribPointer(i.positionAttributeLocation,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,4*i.data.length,e.DYNAMIC_DRAW);return i}_GLDrawEllipse.prototype.drawEllipse=function(t,e){if(e!==this.previousFill){this.flush();this.previousFill=e}this.bufRects[this.bufLen++]=t;this.bufLen>=this.BUFFER_SIZE&&this.flush()};_GLDrawEllipse.prototype.flush=function(){if(0!=this.bufLen){var t=this.gl;t.useProgram(this.shaderProgram);var e=new core.Color(this.previousFill);t.uniform4f(this.colorLocation,e.r/255,e.g/255,e.b/255,e.a);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);this.setData();t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.drawArrays(t.TRIANGLES,0,this.bufLen*this.NTRIANGLES*3);this.bufLen=0}};_GLDrawEllipse.prototype.setData=function(){for(var t=this.gl,e=this.bufLen,i=this.data,r=0,n=0;n<e;n++)for(var o=this.bufRects[n],s=.5*o.width,a=.5*o.height,h=o.left+s,f=o.top+a,u=0;u<this.NTRIANGLES;u++){i[r=6*(n*this.NTRIANGLES+u)]=h;i[r+1]=f;i[r+2]=h+s*this.sin1[u];i[r+3]=f+a*this.cos1[u];i[r+4]=h+s*this.sin2[u];i[r+5]=f+a*this.cos2[u]}t.bufferSubData(t.ARRAY_BUFFER,0,i.subarray(0,r+6))};return _GLDrawEllipse}(_GLDrawBase),_GLDrawPoints=function(t){__extends(_GLDrawPoints,t);function _GLDrawPoints(e){var i=t.call(this,e)||this;i.BUFFER_SIZE=1e5;i.bufferLen=0;i._vsSource1="\n    attribute vec2 a_position;\n    uniform vec2 u_resolution;\n    void main() {\n      vec2 zeroToOne = a_position / u_resolution;\n      vec2 zeroToTwo = zeroToOne * 2.0;\n      vec2 clipSpace = zeroToTwo - 1.0;\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n      gl_PointSize = 5.0;\n    }\n    ";i.init();return i}_GLDrawPoints.prototype.initBuffers=function(){if(!this.buffer){var t=this.gl;this.buffer=new Float32Array(this.BUFFER_SIZE);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.bufferData(t.ARRAY_BUFFER,4*this.buffer.length,t.DYNAMIC_DRAW)}};_GLDrawPoints.prototype.drawPoint=function(t,e){this.initBuffers();if(e!==this.previousFill){this.flush();this.previousFill=e}this.buffer[this.bufferLen++]=t.x;this.buffer[this.bufferLen++]=t.y;this.bufferLen>=this.BUFFER_SIZE&&this.flush()};_GLDrawPoints.prototype.flush=function(){if(0!=this.bufferLen){var t=this.gl;t.useProgram(this.shaderProgram);var e=new core.Color(this.previousFill);t.uniform4f(this.colorLocation,e.r/255,e.g/255,e.b/255,e.a>0?1:0);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.bufferSubData(t.ARRAY_BUFFER,0,this.buffer.subarray(0,this.bufferLen));t.drawArrays(t.POINTS,0,this.bufferLen/2);this.bufferLen=0}};Object.defineProperty(_GLDrawPoints.prototype,"vsSource",{get:function(){return this._vsSource1},enumerable:!0,configurable:!0});return _GLDrawPoints}(_GLDrawBase),_GLDrawLines=function(t){__extends(_GLDrawLines,t);function _GLDrawLines(e){var i=t.call(this,e)||this;i.BUFFER_SIZE=1e6;i.init();return i}_GLDrawLines.prototype.initBuffers=function(){if(!this.buffer){var t=this.gl;this.buffer=new Float32Array(4*this.BUFFER_SIZE);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.bufferData(t.ARRAY_BUFFER,4*this.buffer.length,t.DYNAMIC_DRAW)}};_GLDrawLines.prototype.drawLines=function(t,e,i,r,n){void 0===n&&(n=null);this.initBuffers();var o=i||t.length,s=this.gl;s.useProgram(this.shaderProgram);if(n){s.enable(s.SCISSOR_TEST);s.scissor(n.left,s.canvas.height-n.bottom,n.width,n.height)}var a=new core.Color(r);s.uniform4f(this.colorLocation,a.r/255,a.g/255,a.b/255,a.a>0?1:0);s.enableVertexAttribArray(this.positionAttributeLocation);s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer);s.vertexAttribPointer(this.positionAttributeLocation,2,s.FLOAT,!1,0,0);for(var h=0;h<o;h++){this.buffer[2*h]=t[h];this.buffer[2*h+1]=e[h]}s.bufferSubData(s.ARRAY_BUFFER,0,this.buffer.subarray(0,2*o));s.enableVertexAttribArray(this.positionAttributeLocation);s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer);s.vertexAttribPointer(this.positionAttributeLocation,2,s.FLOAT,!1,0,0);s.drawArrays(s.LINE_STRIP,0,o);n&&s.disable(s.SCISSOR_TEST)};return _GLDrawLines}(_GLDrawBase),_GLDrawAreas=function(t){__extends(_GLDrawAreas,t);function _GLDrawAreas(e){var i=t.call(this,e)||this;i.BUFFER_SIZE=1e6;i.init();return i}_GLDrawAreas.prototype.initBuffers=function(){if(!this.buffer){var t=this.gl;this.buffer=new Float32Array(4*this.BUFFER_SIZE);t.enableVertexAttribArray(this.positionAttributeLocation);t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer);t.vertexAttribPointer(this.positionAttributeLocation,2,t.FLOAT,!1,0,0);t.bufferData(t.ARRAY_BUFFER,4*this.buffer.length,t.DYNAMIC_DRAW)}};_GLDrawAreas.prototype.drawPolygon=function(t,e,i,r){void 0===r&&(r=null);this.initBuffers();var n=t.length,o=this.gl;o.useProgram(this.shaderProgram);if(r){o.enable(o.SCISSOR_TEST);o.scissor(r.left,o.canvas.height-r.bottom,r.width,r.height)}var s=new core.Color(i);o.uniform4f(this.colorLocation,s.r/255,s.g/255,s.b/255,s.a>0?1:0);o.enableVertexAttribArray(this.positionAttributeLocation);o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer);o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0);t[n-2],t[n-1];for(var a=e[n-2],h=0,f=0;f<n-2;f++){this.buffer[h++]=t[f];this.buffer[h++]=e[f];this.buffer[h++]=t[f];this.buffer[h++]=a}o.bufferSubData(o.ARRAY_BUFFER,0,this.buffer.subarray(0,h));o.enableVertexAttribArray(this.positionAttributeLocation);o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer);o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0);o.drawArrays(o.TRIANGLE_STRIP,0,2*(n-2));r&&o.disable(o.SCISSOR_TEST)};return _GLDrawAreas}(_GLDrawBase);_registerModule("wijmo.chart.webgl",selfModule);