/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{createElement,format,evalTemplate,toggleClass,isFunction,isNumber,isArray,isBoolean,_registerModule}from"wijmo/wijmo";import{DataMap,DataMapEditor}from"wijmo/wijmo.grid";import*as selfModule from"wijmo/wijmo.grid.cellmaker";export var SparklineType;!function(e){e[e.Line=0]="Line";e[e.Column=1]="Column";e[e.WinLoss=2]="WinLoss"}(SparklineType||(SparklineType={}));export var SparklineMarkers;!function(e){e[e.None=0]="None";e[e.First=1]="First";e[e.Last=2]="Last";e[e.High=4]="High";e[e.Low=8]="Low";e[e.Negative=16]="Negative"}(SparklineMarkers||(SparklineMarkers={}));var CellMaker=function(){function CellMaker(){}CellMaker.makeButton=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<button type="button">{txt}</button>',{txt:CellMaker._getOptionText(e,"text",r,r.text)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeLink=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<a href="{href}">{txt}</a>',{txt:CellMaker._getOptionText(e,"text",r,r.text),href:CellMaker._getOptionText(e,"href",r,"#")});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeSparkline=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format("<div><svg><g>{spark}</g></svg></div>",{spark:CellMaker._getSparkline(r.value,e)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeImage=function(e){return function(r,t){r.col.isReadOnly=!0;t.innerHTML="";var a=format('<img src="{src}"></div>',{src:CellMaker._getOptionText(e,"src",r,r.text)});CellMaker._createElement(t,a,e,r);return null}};CellMaker.makeRating=function(e){return function(r,t){var a=r.col,l=DataMapEditor,n=a.cssClass||"",i=CellMaker._WJC_CellMaker;if(!a.dataMap||a.dataMapEditor!=l.RadioButtons||n.indexOf(i)<0){for(var o=e?e.range:null,s=[],u=(o=o&&isArray(o)&&o.length>1&&o[1]>o[0]?o:[0,5])[0];u<=o[1];u++)s.push(u);a.dataMap=new DataMap(s);a.dataMapEditor=l.RadioButtons;n.indexOf(i)<0&&(a.cssClass=(n+" "+i).trim())}if(e&&e.label){var c=CellMaker._getOptionText(e,"label",r);t.setAttribute("aria-label",c.trim())}var k=t.querySelectorAll("label"),m=!!e&&e.showZeros,M=null==t.querySelector("input:checked");for(u=0;u<k.length;u++){c=k[u];toggleClass(c,"wj-chk-hidden","0"==c.textContent&&!m);toggleClass(c,"wj-chk-off",M);M=M||null!=c.querySelector("input:checked")}return null}};CellMaker._getOptionText=function(e,r,t,a){void 0===a&&(a="");var l=e?e[r]:"";return l?evalTemplate(l,t):a};CellMaker._createElement=function(e,r,t,a){var l=createElement(r,e),n=CellMaker._WJC_CellMaker;t&&t.cssClass&&(n+=" "+CellMaker._getOptionText(t,"cssClass",a));l.className=n.trim();if(t&&t.label){var i=CellMaker._getOptionText(t,"label",a);l.setAttribute("aria-label",i.trim());l instanceof HTMLImageElement&&l.setAttribute("alt",i.trim())}if(t&&t.attributes)for(var o in t.attributes)l.setAttribute(o,t.attributes[o]);t&&isFunction(t.click)&&(l.onclick=CellMaker._handleClick.bind({options:t,ctx:CellMaker._cloneContext(a)}));return l};CellMaker._cloneContext=function(e){if(isFunction(Object.assign))return Object.assign({},e);var r={};for(var t in e)r[t]=e[t];return r};CellMaker._handleClick=function(e){var r=this.options;if(isFunction(r.click)){e.preventDefault();var t=this.ctx;r.click(e,t)}};CellMaker._getSparkline=function(e,r){var t="",a=SparklineType,l=SparklineMarkers,n=null!=(r=r||{}).type?r.type:a.Line,i=null!=r.markers?r.markers:l.None,o=isNumber(r.baseValue)?r.baseValue:n==a.Line?null:0,s=isNumber(r.maxPoints)?r.maxPoints:null;if(e instanceof Array&&e.length>1){n==a.WinLoss&&(e=e.map((function(e){return isBoolean(e)?e?1:-1:isNumber(e)?e>0?1:e<0?-1:null:null})));var u=CellMaker._scaleValues(e,o,s),c=u.points,k=u.base,m=100/(c.length-(n==a.Line?1:0)),M=m>4?m-2:m,f=m-M;switch(n){case a.Column:case a.WinLoss:for(var C=0;C<c.length;C++){var p=c[C];null!=p&&(t+=format("<rect {cls}x={x}% y={y}% width={w}% height={h}% />",{x:(C*m+f).toFixed(2),y:Math.min(k,p),w:M.toFixed(2),h:Math.abs(k-p),cls:CellMaker._getMarkers(i,u,C)}))}break;case a.Line:for(C=0;C<c.length-1;C++){var g=c[C],x=c[C+1];null!=g&&null!=x&&(t+=format("<line x1={x1}% y1={y1}% x2={x2}% y2={y2}% />",{x1:Math.round(m*C),y1:g,x2:Math.round(m*(C+1)),y2:x}));var h=CellMaker._getMarkers(i,u,C),d='<circle {cls}cx={x}% cy={y}% r="3"/>';h&&(t+=format(d,{x:Math.round(m*C),y:g,cls:h}));C==c.length-2&&(h=CellMaker._getMarkers(i,u,C+1))&&(t+=format(d,{x:Math.round(m*(C+1)),y:x,cls:h}))}}null!=o&&n!=a.WinLoss&&(t+=format('<line class="x-axis" x1=0% y1={base}% x2=100% y2={base}% />',{base:u.base}))}return t};CellMaker._scaleValues=function(e,r,t){var a,l,n=[];t&&t>1&&e.length>t&&(e=e.slice(0,t));e.forEach((function(e){if(isNumber(e)){a=!isNumber(a)||e<a?e:a;l=!isNumber(l)||e>l?e:l}}));if(isNumber(a)&&isNumber(l)){if(null!=r){a=Math.min(a,r);l=Math.max(l,r)}else r=a>0?a:l<0?l:0;if(a==l){a--;l++}var i=l-a;e.forEach((function(e){n.push(isNumber(e)?100-Math.round((e-a)/i*100):null)}));r=100-Math.round((r-a)/i*100)}return{min:a,max:l,base:r,points:n,data:e}};CellMaker._getMarkers=function(e,r,t){var a="",l=SparklineMarkers;if(e){var n=r.data,i="wj-marker-";0!=(e&l.First)&&0==t&&(a+=i+"first ");0!=(e&l.Last)&&t==n.length-1&&(a+=i+"last ");0!=(e&l.High)&&n[t]==r.max&&(a+=i+"high ");0!=(e&l.Low)&&n[t]==r.min&&(a+=i+"low ");0!=(e&l.Negative)&&n[t]<0&&(a+=i+"negative ")}return a?'class="wj-marker '+a.trim()+'"':""};CellMaker._WJC_CellMaker="wj-cell-maker";return CellMaker}();export{CellMaker};_registerModule("wijmo.grid.cellmaker",selfModule);