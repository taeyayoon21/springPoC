/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();import{_addCultureInfo,Key,Control,culture,copy,asEnum,asNumber,asBoolean,asFunction,isFunction,isNumber,animate,setCss,closest,closestClass,addClass,hasClass,setAriaLabel,setAttribute,_registerModule}from"wijmo/wijmo";import{Row,FlexGrid,MergeManager,CellRange,CellType,GroupRow,_NewRowTemplate}from"wijmo/wijmo.grid";import*as selfModule from"wijmo/wijmo.grid.detail";var DetailRow=function(e){__extends(DetailRow,e);function DetailRow(t){var i=e.call(this)||this;i.isReadOnly=!0;return i}Object.defineProperty(DetailRow.prototype,"detail",{get:function(){return this._detail},set:function(e){this._detail=e},enumerable:!0,configurable:!0});return DetailRow}(Row);export{DetailRow};var DetailMergeManager=function(e){__extends(DetailMergeManager,e);function DetailMergeManager(t){return e.call(this,t)||this}DetailMergeManager.prototype.getMergedRange=function(t,i,r,o){void 0===o&&(o=!0);switch(t.cellType){case CellType.Cell:if(t.rows[i]instanceof DetailRow){t.columns.frozen>0&&t.grid&&(t.grid.cloneFrozenCells=!1);return new CellRange(i,0,i,t.columns.length-1)}break;case CellType.RowHeader:var l=t.rows.frozen;if(t.rows[i]instanceof DetailRow&&i!=l)return new CellRange(i-1,r,i,r);if(i<t.rows.length-1&&t.rows[i+1]instanceof DetailRow&&i!=l-1)return new CellRange(i,r,i+1,r)}return e.prototype.getMergedRange.call(this,t,i,r,o)};return DetailMergeManager}(MergeManager);export{DetailMergeManager};_addCultureInfo("FlexGridDetailProvider",{ariaLabels:{toggleDetail:"Toggle Row Detail"}});export var KeyAction;!function(e){e[e.None=0]="None";e[e.ToggleDetail=1]="ToggleDetail"}(KeyAction||(KeyAction={}));export var DetailVisibilityMode;!function(e){e[e.Code=0]="Code";e[e.Selection=1]="Selection";e[e.ExpandSingle=2]="ExpandSingle";e[e.ExpandMulti=3]="ExpandMulti"}(DetailVisibilityMode||(DetailVisibilityMode={}));var FlexGridDetailProvider=function(){function FlexGridDetailProvider(e,t){var i=this;this._mode=DetailVisibilityMode.ExpandSingle;this._animated=!1;this._keyActionEnter=KeyAction.None;this._g=e;e.mergeManager=new DetailMergeManager(e);e.rowHeaders.hostElement.addEventListener("click",this._hdrClick.bind(this));e.rowHeaders.hostElement.addEventListener("mousedown",(function(t){var r=e.editableCollectionView;if(e.activeEditor||r&&r.currentEditItem){i._hdrClick(t);t.preventDefault()}}));e.formatItem.addHandler(this._formatItem,this);e.selectionChanged.addHandler(this._selectionChanged,this);e.resizedRow.addHandler(this._resizedRow,this);e.loadingRows.addHandler((function(){return i.hideDetail()}));e.deletingRow.addHandler((function(e,t){i.hideDetail(t.row)}));e.updatedView.addHandler(this._handleFrozenCells,this);e.draggingRow.addHandler((function(e,t){if(t.row<e.rows.length-1&&e.rows[t.row+1]instanceof DetailRow){t.cancel=!0;i.hideDetail(t.row)}}));e.hostElement.addEventListener("keydown",(function(e){if(e.keyCode==Key.Enter&&i._keyActionEnter==KeyAction.ToggleDetail){var t=i._g.selection.row;i._toggleRowDetail(t)&&e.preventDefault()}}),!0);e._root.addEventListener("scroll",(function(){Control.refreshAll(e._root)}));copy(this,t)}Object.defineProperty(FlexGridDetailProvider.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"detailVisibilityMode",{get:function(){return this._mode},set:function(e){if((e=asEnum(e,DetailVisibilityMode))!=this._mode){this._mode=e;this.hideDetail();this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"maxHeight",{get:function(){return this._maxHeight},set:function(e){if((e=asNumber(e,!0))!=this._maxHeight){this._maxHeight=e;this.hideDetail()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"isAnimated",{get:function(){return this._animated},set:function(e){e!=this._animated&&(this._animated=asBoolean(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"keyActionEnter",{get:function(){return this._keyActionEnter},set:function(e){this._keyActionEnter=asEnum(e,KeyAction)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"createDetailCell",{get:function(){return this._createDetailCellFn},set:function(e){this._createDetailCellFn=asFunction(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"disposeDetailCell",{get:function(){return this._disposeDetailCellFn},set:function(e){this._disposeDetailCellFn=asFunction(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridDetailProvider.prototype,"rowHasDetail",{get:function(){return this._rowHasDetailFn},set:function(e){if((e=asFunction(e,!0))!=this._rowHasDetailFn){this._rowHasDetailFn=e;this.hideDetail();this._g.invalidate()}},enumerable:!0,configurable:!0});FlexGridDetailProvider.prototype.getDetailRow=function(e){var t=this._g.rows,i=this._toIndex(e),r=t[i];!(r instanceof DetailRow)&&i<t.length-1&&(r=t[i+1]);return r instanceof DetailRow?r:null};FlexGridDetailProvider.prototype.isDetailVisible=function(e){return null!=this.getDetailRow(e)};FlexGridDetailProvider.prototype.isDetailAvailable=function(e){e=this._toIndex(e);return this._hasDetail(e)};FlexGridDetailProvider.prototype.hideDetail=function(e){var t=this._g.rows;if(null!=e){var i=this._toIndex(e);!(t[i]instanceof DetailRow)&&i<t.length-1&&t[i+1]instanceof DetailRow&&i++;var r=t[i];if(r instanceof DetailRow){!!this.disposeDetailCell&&this.disposeDetailCell(r)||Control.disposeAll(r.detail);t.removeAt(i)}}else for(var o=0;o<t.length;o++)t[o]instanceof DetailRow&&this.hideDetail(o)};FlexGridDetailProvider.prototype.showDetail=function(e,t){void 0===t&&(t=!1);var i=this._g,r=i.rows,o=this._toIndex(e);o>0&&r[o]instanceof DetailRow&&o--;if(t){for(var l=i.selection,n=!1,a=0;a<r.length-1;a++)if(a!=o&&r[a+1]instanceof DetailRow){this.hideDetail(a);a<o&&o--;if(a<l.row){l.row--;l.row2--;n=!0}}n&&i.select(l,!1)}if(!this.isDetailVisible(o)&&this._hasDetail(o)){var s=new DetailRow(r[o]),d=this._createDetailCell(r[o]);s.detail=d;if(d){r.insert(o+1,s);var c=i.containsFocus();if(this._animated){var u=d.style;u.transform="translateY(-100%)";u.opacity="0";animate((function(e){if(e<1){u.transform="translateY("+(100*-(1-e)).toFixed(0)+"%)";u.opacity=(e*e).toString()}else{u.transform=u.opacity="";Control.invalidateAll(d);c&&i.scrollIntoView(o+1,-1)}}))}else c&&i.scrollIntoView(o+1,-1,!0)}}};FlexGridDetailProvider.prototype._sizeDetailRow=function(e){var t=this._g,i=e.detail;Control.refreshAll(i);var r=i.offsetHeight+t._cellPadVert+1,o=this._maxHeight;isNumber(o)&&o>0&&r>o&&(r=o);e.height=r;i.style.height||(i.style.height="100%");var l=i.querySelector(".wj-flexgrid");l&&!l.style.height&&(l.style.height="100%")};FlexGridDetailProvider.prototype._handleFrozenCells=function(){var e=this._g,t=e.hostElement,i=Control.getControl(t.querySelector(".wj-flexgrid"));if(i instanceof FlexGrid&&(i.frozenRows||i.frozenColumns)){setCss([e._eTL,e._eBL,e._eCHdr,e._eCFtr,e._eRHdr,e._eMarquee],{zIndex:"13"});for(var r=t.querySelectorAll(".wj-frozen"),o=0;o<r.length;o++){var l=r[o];if(closest(l,".wj-flexgrid")==t){var n=parseInt(l.style.zIndex);l.style.zIndex=(n%10+10).toString()}}}};FlexGridDetailProvider.prototype._toIndex=function(e){return e instanceof Row?e.index:asNumber(e)};FlexGridDetailProvider.prototype._hdrClick=function(e){if(!e.defaultPrevented&&0==e.button&&closestClass(e.target,FlexGridDetailProvider._WJC_DETAIL)){var t=DetailVisibilityMode;switch(this._mode){case t.ExpandMulti:case t.ExpandSingle:var i=this._g,r=i.hitTest(e.target);r.panel||(r=i.hitTest(e));r.panel&&this._toggleRowDetail(r.row)&&e.preventDefault()}}};FlexGridDetailProvider.prototype._toggleRowDetail=function(e){if(e>-1){if(this.isDetailVisible(e)){this.hideDetail(e);return!0}if(this._hasDetail(e)){var t=this._g;t.select(new CellRange(e,0,e,t.columns.length-1));this.showDetail(e,this._mode==DetailVisibilityMode.ExpandSingle);return!0}}return!1};FlexGridDetailProvider.prototype._selectionChanged=function(e,t){var i=this;if(this._mode==DetailVisibilityMode.Selection){this._toSel&&clearTimeout(this._toSel);this._toSel=setTimeout((function(){var t=e._selHdl.selection.row;t>-1?i.showDetail(t,!0):i.hideDetail()}),300)}};FlexGridDetailProvider.prototype._formatItem=function(e,t){var i=this._g,r=t.cell,o=t.getRow(),l=DetailVisibilityMode;if(t.panel==i.cells&&o instanceof DetailRow&&null!=o.detail&&!hasClass(r,"wj-detail")){addClass(r,"wj-detail");r.textContent="";r.style.textAlign=r.style.zIndex="";r.className=r.className.replace(/wj\-align\-[\S]+/g,"");r.appendChild(o.detail);null==o.height?this._sizeDetailRow(o):Control.refreshAll(o.detail)}if(t.panel==i.rowHeaders&&0==t.col&&this._hasDetail(t.row)){r.style.cursor="";switch(this._mode){case l.ExpandMulti:case l.ExpandSingle:var n=i.rows[t.row+1]instanceof DetailRow,a=n?"minus":"plus",s=FlexGridDetailProvider._WJC_DETAIL;r.innerHTML='<div class="wj-btn wj-btn-glyph '+s+'" role="button" tabindex="-1"><span class="wj-glyph-'+a+'"></span></div>';var d=r.children[0],c=culture.FlexGridDetailProvider.ariaLabels.toggleDetail;setAriaLabel(d,c);setAttribute(d,"aria-expanded",n)}}};FlexGridDetailProvider.prototype._resizedRow=function(e,t){var i=t.getRow();i instanceof DetailRow&&i.detail&&Control.refreshAll(i.detail)};FlexGridDetailProvider.prototype._hasDetail=function(e){var t=this._g.rows[e];return isFunction(this._rowHasDetailFn)?this._rowHasDetailFn(t):this._isRegularRow(t)};FlexGridDetailProvider.prototype._isRegularRow=function(e){return!(e instanceof _NewRowTemplate||e instanceof DetailRow)&&!(e instanceof GroupRow&&!this._g.childItemsPath)};FlexGridDetailProvider.prototype._createDetailCell=function(e){return this.createDetailCell?this.createDetailCell(e):null};FlexGridDetailProvider._WJC_DETAIL="wj-elem-detail";return FlexGridDetailProvider}();export{FlexGridDetailProvider};_registerModule("wijmo.grid.detail",selfModule);