/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();import{assert,asBoolean,Key,copy,asInt,getType,isIE,Event,CancelEventArgs,addClass,createElement,hasItems,asArray,toggleClass,isFunction,isString,isBoolean,NotifyCollectionChangedAction,isArray,toHeaderCase,_registerModule}from"wijmo/wijmo";import{Row,GroupRow,CellRange,RowColFlags,CellRangeEventArgs,MergeManager,CellType,FlexGrid,_AddNewHandler,_NewRowTemplate,Column,SelectionMode,AllowDragging,ColumnCollection}from"wijmo/wijmo.grid";import*as selfModule from"wijmo/wijmo.grid.multirow";var _Cell=function(e){__extends(_Cell,e);function _Cell(t){var o=e.call(this)||this;o._row=o._col=0;o._rowspan=o._colspan=1;copy(o,t);return o}Object.defineProperty(_Cell.prototype,"row",{get:function(){return this._row},set:function(e){this._row=asInt(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"col",{get:function(){return this._col},set:function(e){this._col=asInt(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"colspan",{get:function(){return this._colspan},set:function(e){this._colspan=asInt(e,!1,!0);assert(this._colspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"rowspan",{get:function(){return this._rowspan},set:function(e){this._rowspan=asInt(e,!1,!0);assert(this._rowspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});return _Cell}(Column);export{_Cell};var _MultiRow=function(e){__extends(_MultiRow,e);function _MultiRow(t,o,r){var n=e.call(this,t)||this;n._idxData=o;n._idxRecord=r;return n}Object.defineProperty(_MultiRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRow}(Row);export{_MultiRow};var _MultiGroupRow=function(e){__extends(_MultiGroupRow,e);function _MultiGroupRow(t,o){var r=e.call(this,t)||this;r._idxRecord=o;return r}Object.defineProperty(_MultiGroupRow.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});Object.defineProperty(_MultiGroupRow.prototype,"hasChildren",{get:function(){return!0},enumerable:!0,configurable:!0});_MultiGroupRow.prototype.getCellRange=function(){var t=this._getLastRowInHeader();return t!=this?t.getCellRange():e.prototype.getCellRange.call(this)};Object.defineProperty(_MultiGroupRow.prototype,"isCollapsed",{get:function(){return this._getLastRowInHeader()._getFlag(RowColFlags.Collapsed)},set:function(e){var t=this._getLastRowInHeader();e!=t.isCollapsed&&null!=t._list&&t._setCollapsed(asBoolean(e))},enumerable:!0,configurable:!0});_MultiGroupRow.prototype._setCollapsed=function(e){var t=this,o=this.grid,r=o.rows,n=this.getCellRange(),l=new CellRangeEventArgs(o.cells,new CellRange(this.index,-1));if(o.onGroupCollapsedChanging(l)){o.deferUpdate((function(){r.deferUpdate((function(){t._setFlag(RowColFlags.Collapsed,e,!0);for(var o=n.topRow+1;o<=n.bottomRow&&o>-1&&o<r.length;o++){r[o]._setFlag(RowColFlags.ParentCollapsed,e,!0);var l=r[o];if(l instanceof _MultiGroupRow){var i=l._getLastRowInHeader();for(o+=1;o<=i.index;o++)(l=r[o])._setFlag(RowColFlags.ParentCollapsed,e,!0);o--}l instanceof GroupRow&&l.isCollapsed&&(o=l.getCellRange().bottomRow)}}))}));o.onGroupCollapsedChanged(l)}};_MultiGroupRow.prototype._getLastRowInHeader=function(){var e=this.grid,t=this;if(e.multiRowGroupHeaders)for(var o=e.rows,r=this.dataItem,n=this.index+1;n<o.length&&o[n].dataItem==r;n++)t=o[n];assert(t instanceof _MultiGroupRow,"last row in header should be a _MultiRowGroup");return t};return _MultiGroupRow}(GroupRow);export{_MultiGroupRow};var MultiRow=function(e){__extends(MultiRow,e);function MultiRow(t,o){var r=e.call(this,t)||this;r._centerVert=!0;r._collapsedHeaders=!1;r._multiRowGroupHeaders=!1;r._rowHdrCnt=0;r.collapsedHeadersChanging=new Event;r.collapsedHeadersChanged=new Event;r._layout=new _MultiRowLayout(r,null);addClass(r.hostElement,"wj-multirow");var n=r.columnHeaders.hostElement.parentElement,l=createElement('<div class="wj-hdr-collapse"><span></span></div>');l.style.display="none";n.appendChild(l);r._btnCollapse=l;r._updateButtonGlyph();r.addEventListener(l,"mousedown",(function(e){switch(r.collapsedHeaders){case null:case!1:r._collapsedHeadersWasNull=null==r.collapsedHeaders;r.collapsedHeaders=!0;break;case!0:r.collapsedHeaders=!!r._collapsedHeadersWasNull&&null}e.preventDefault();r.focus()}),!0);var i=r.hostElement;r.addEventListener(i,"mousedown",(function(e){if(!r._mouseHdl._szRowCol){var t=r._layout?r._layout._bindingGroups:null;if(t&&t[0].isRowHeader){var o=r.hitTest(e);if(o.panel==r.columnHeaders&&o.col<r.frozenColumns){e.preventDefault();r.selectAll()}}}}),!0);r.removeEventListener(i,"dragover");r.removeEventListener(i,"dragleave");r.removeEventListener(i,"dragdrop");r._addHdl=new _MultiRowAddNewHandler(r);r.formatItem.addHandler(r._formatItem,r);r.autoGenerateColumns=!1;r.allowDragging=AllowDragging.None;r.mergeManager=new _MergeManager(r);r.initialize(o);return r}MultiRow.prototype._getProductInfo=function(){return"H87K,MultiRow"};Object.defineProperty(MultiRow.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(e){this._layoutDef=asArray(e);this._layout=new _MultiRowLayout(this,e);this._rowHdrCnt=0;if(this._layout)for(var t=this._layout._bindingGroups,o=0;o<t.length;o++){var r=t[o];if(!r.isRowHeader)break;this._rowHdrCnt=r._colstart+r.colspan;r.cells.forEach((function(e){e.isReadOnly=!0;!e.header||e.binding||e.cellTemplate||(e.cellTemplate=e.header);e.cssClass?e.cssClass.indexOf("wj-header")<0&&(e.cssClass+=" wj-header"):e.cssClass="wj-header"}))}this.frozenColumns=this._rowHdrCnt;this._bindGrid(!0);this._rowHdrCnt&&this.selectionMode&&this.select(this.selection.row,this._rowHdrCnt)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"headerLayoutDefinition",{get:function(){return this._hdrLayoutDef},set:function(e){this._hdrLayoutDef=asArray(e);this._hdrLayout=e?new _MultiRowLayout(this,e):null;this._bindGrid(!0)},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"rowsPerItem",{get:function(){return this._layout._rowsPerItem},enumerable:!0,configurable:!0});MultiRow.prototype.getBindingColumn=function(e,t,o){return this._getBindingColumn(e,t,e.columns[o])};MultiRow.prototype.getColumn=function(t){if(isString(t)){for(var o=this._layout._bindingGroups,r=null,n=0;n<o.length&&!r;n++)r=o[n].getColumn(t);return r}return e.prototype.getColumn.call(this,t)};Object.defineProperty(MultiRow.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(e){if(e!=this._centerVert){this._centerVert=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"collapsedHeaders",{get:function(){return this._collapsedHeaders},set:function(e){if(e!=this._collapsedHeaders){var t=new CancelEventArgs;if(this.onCollapsedHeadersChanging(t)){this._collapsedHeaders=asBoolean(e,!0);this._updateCollapsedHeaders();this._updateButtonGlyph();this.onCollapsedHeadersChanged(t)}}},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"showHeaderCollapseButton",{get:function(){return""==this._btnCollapse.style.display},set:function(e){e!=this.showHeaderCollapseButton&&(this._btnCollapse.style.display=asBoolean(e)?"":"none")},enumerable:!0,configurable:!0});Object.defineProperty(MultiRow.prototype,"multiRowGroupHeaders",{get:function(){return this._multiRowGroupHeaders},set:function(e){if(e!=this._multiRowGroupHeaders){this._multiRowGroupHeaders=asBoolean(e);this._bindGrid(!0)}},enumerable:!0,configurable:!0});MultiRow.prototype.onCollapsedHeadersChanging=function(e){this.collapsedHeadersChanging.raise(this,e);return!e.cancel};MultiRow.prototype.onCollapsedHeadersChanged=function(e){this.collapsedHeadersChanged.raise(this,e)};Object.defineProperty(MultiRow.prototype,"allowPinning",{get:function(){return!1},set:function(e){assert(!e,"MultiRow does not support pinning.")},enumerable:!0,configurable:!0});MultiRow.prototype.onSelectionChanging=function(t){var o=t._rng;if(o&&o.isValid&&this.selectionMode){var r=this._mouseHdl._htDown,n=this.rows,l=this.columns,i=this._rowHdrCnt;if(i){o.col=Math.max(o.col,i);o.col2=Math.max(o.col2,i)}if(r&&(r.panel==this.rowHeaders||r.panel==this.cells&&r.col<i)){var a=n[o.topRow],s=n[o.bottomRow];if(a&&null!=a.recordIndex){var u=a.index-a.recordIndex,p=s instanceof _MultiGroupRow&&!this._multiRowGroupHeaders?1:this.rowsPerItem,c=s.index-s.recordIndex+p-1,d=l.length-1,w=o.row!=o.topRow?new CellRange(c,0,u,d):new CellRange(u,0,c,d);o.row=w.row;o.row2=w.row2;o.col2=d;switch(this.selectionMode){case SelectionMode.Cell:o.row2=w.row;o.col2=w.col;break;case SelectionMode.Row:o.row2=w.row}}}}return e.prototype.onSelectionChanging.call(this,t)};MultiRow.prototype._getDeleteColumnIndex=function(){return this._rowHdrCnt};MultiRow.prototype._getQuickAutoSize=function(){return isBoolean(this.quickAutoSize)?this.quickAutoSize:this.formatItem.handlerCount<=1&&null==this.itemFormatter};MultiRow.prototype._addBoundRow=function(e,t){for(var o=e[t],r=0;r<this.rowsPerItem;r++)this.rows.push(new _MultiRow(o,t,r))};MultiRow.prototype._addNode=function(e,t,o){this._addBoundRow(e,t)};MultiRow.prototype._addGroupRow=function(e){for(var t=this._multiRowGroupHeaders?this.rowsPerItem:1,o=0;o<t;o++)this.rows.push(new _MultiGroupRow(e,o))};MultiRow.prototype._bindColumns=function(){for(var e=this,t=this.columnHeaders.rows,o=this._layout,r=this._hdrLayout,n=(r?r._rowsPerItem:this.rowsPerItem)+1;t.length>n;)t.removeAt(t.length-1);for(;t.length<n;)t.push(new Row);this._updateCollapsedHeaders();this.columns.clear();o&&o._bindingGroups.forEach((function(t){for(var _loop_1=function(o){for(var r=new Column,_loop_2=function(e){var n=t.cells[e];if(n._col==o){"width,minWidth,maxWidth,binding,header,format,dataMap,name,aggregate,cellTemplate".split(",").forEach((function(e){null!=n[e]&&(r[e]=n[e])}));return"break"}},n=0;n<t.cells.length;n++){if("break"===_loop_2(n))break}e.columns.push(r)},o=0;o<t._colspan;o++)_loop_1(o)}))};MultiRow.prototype._updateCollapsedHeaders=function(){var e=this.columnHeaders.rows,t=this.collapsedHeaders;e[0].visible=0!=t;for(var o=1;o<e.length;o++)e[o].visible=1!=t};MultiRow.prototype._updateColumnTypes=function(){e.prototype._updateColumnTypes.call(this);var t=this.collectionView;if(hasItems(t)){var o=t.items[0];this._layout&&this._layout._updateCellTypes(o);this._hdrLayout&&this._hdrLayout._updateCellTypes(o)}};MultiRow.prototype._getBindingColumn=function(e,t,o){if(e==this.cells||e==this.columnHeaders){var r=e.cellType==CellType.ColumnHeader;r&&t--;o=this._getGroupByColumn(o.index,r).getBindingColumn(e,t,o.index)}return o};MultiRow.prototype._getBindingColumns=function(){var e=[];this._layout._bindingGroups.forEach((function(t){t._cols.forEach((function(t){e.indexOf(t)<0&&e.push(t)}))}));return e};MultiRow.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var o=NotifyCollectionChangedAction;switch(t.action){case o.Change:this.invalidate();break;case o.Add:if(t.index==this.collectionView.items.length-1){for(var r=this.rows.length;r>0&&this.rows[r-1]instanceof _NewRowTemplate;)r--;for(var n=0;n<this.rowsPerItem;n++)this.rows.insert(r+n,new _MultiRow(t.item,t.index,n));return}assert(!1,"added item should be the last one.");break;default:this._bindGrid(!1)}}};MultiRow.prototype._getGroupByColumn=function(e,t){var o=null;t&&this._hdrLayout&&!this.collapsedHeaders&&(o=this._hdrLayout._getGroupByColumn(e));o||(o=this._layout._getGroupByColumn(e));assert(o instanceof _CellGroup,"Failed to get the group!");return o};MultiRow.prototype._formatItem=function(e,t){var o=this.rowsPerItem,r=t.panel,n=r.cellType,l=r.rows[t.range.row],i=r.rows[t.range.row2],a=t.cell;n==CellType.ColumnHeader&&toggleClass(a,"wj-group-header",0==t.range.row);if(n==CellType.Cell||n==CellType.ColumnHeader){var s=this._getGroupByColumn(t.col,n==CellType.ColumnHeader);toggleClass(a,"wj-group-start",s._colstart==t.range.col);toggleClass(a,"wj-group-end",s._colstart+s._colspan-1==t.range.col2)}if(o>1&&(n==CellType.Cell||n==CellType.RowHeader)){var u=i instanceof _MultiRow||i instanceof _MultiRowNewRowTemplate;toggleClass(a,"wj-record-start",!!(l instanceof _MultiRow||l instanceof _MultiRowNewRowTemplate)&&0==l.recordIndex);toggleClass(a,"wj-record-end",!!u&&i.recordIndex==o-1)}var p=this.alternatingRowStep;if(p){var c=!1;if(l instanceof _MultiRow){c=l.dataIndex%(p+1)==0;1==p&&(c=!c)}toggleClass(a,"wj-alt",c)}if(this._centerVert&&!a.getAttribute("wj-state-measuring")){var d=!1;if(a.innerHTML&&t.range.rowSpan>1){d=!0;if(0==a.childElementCount)a.innerHTML="<div>"+a.innerHTML+"</div>";else{var w=document.createElement("div"),_=document.createRange();_.selectNodeContents(a);_.surroundContents(w)}}toggleClass(a,"wj-center-vert",d)}};MultiRow.prototype._updateButtonGlyph=function(){var e=this._btnCollapse.querySelector("span");e instanceof HTMLElement&&(e.className=this.collapsedHeaders?"wj-glyph-left":"wj-glyph-down-left")};MultiRow.prototype._getError=function(t,o,r,n){if(isFunction(this.itemValidator)&&t==this.rowHeaders)for(var l=0;l<this.rowsPerItem;l++)for(r=0;r<this.columns.length;r++){var i=this.itemValidator(o+l,r,n);if(i)return i}return e.prototype._getError.call(this,t,o,r,n)};return MultiRow}(FlexGrid);export{MultiRow};var _MultiRowAddNewHandler=function(e){__extends(_MultiRowAddNewHandler,e);function _MultiRowAddNewHandler(t){t._addHdl._detach();return e.call(this,t)||this}_MultiRowAddNewHandler.prototype.updateNewRowTemplate=function(){for(var e=this._g.editableCollectionView,t=this._g,o=t.rows,r=e&&e.canAddNew&&t.allowAddNew&&!t.isReadOnly,n=-1,l=0;l<o.length;l+=t.rowsPerItem)if(o[l]instanceof _MultiRowNewRowTemplate){n=l;break}if(r&&n>-1&&(this._top&&n>0||!this._top&&0==n)){n=-1;this._removeNewRowTemplate()}if(r&&n<0)for(l=0;l<t.rowsPerItem;l++){var i=new _MultiRowNewRowTemplate(l);this._top?o.insert(l,i):o.push(i)}!r&&n>-1&&this._removeNewRowTemplate()};_MultiRowAddNewHandler.prototype._keydown=function(t){e.prototype._keydown.call(this,t);t.defaultPrevented||t.keyCode!=Key.Escape||this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._rowEditEnded=function(t,o){e.prototype._rowEditEnded.call(this,t,o);this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._beginningEdit=function(t,o){e.prototype._beginningEdit.call(this,t,o);this._top&&!t.rows[0].dataItem&&this._copyNewDataItem()};_MultiRowAddNewHandler.prototype._copyNewDataItem=function(){if(this._top)for(var e=this._g,t=e.rows,o=0;o<e.rowsPerItem;o++)t[o]instanceof _NewRowTemplate&&(t[o].dataItem=this._nrt.dataItem)};_MultiRowAddNewHandler.prototype._removeNewRowTemplate=function(){for(var e=0,t=this._g.rows;e<t.length;e++)if(t[e]instanceof _NewRowTemplate){t.removeAt(e);e--}};return _MultiRowAddNewHandler}(_AddNewHandler);export{_MultiRowAddNewHandler};var _MultiRowNewRowTemplate=function(e){__extends(_MultiRowNewRowTemplate,e);function _MultiRowNewRowTemplate(t){var o=e.call(this)||this;o._idxRecord=t;return o}Object.defineProperty(_MultiRowNewRowTemplate.prototype,"recordIndex",{get:function(){return this._idxRecord},enumerable:!0,configurable:!0});return _MultiRowNewRowTemplate}(_NewRowTemplate);export{_MultiRowNewRowTemplate};var _CellGroup=function(e){__extends(_CellGroup,e);function _CellGroup(t,o){var r=e.call(this)||this;r._isRowHeader=!1;r._colstart=0;r._layout=t;r._g=t._grid;copy(r,o);if(!r._cells)throw"Cell group with no cells?";var n=0,l=0;r._cells.forEach((function(e,t){for(;!r._cellFits(e,t,n,l);)0==(l=(l+1)%r.colspan)&&n++;e.row=n;e.col=l}));var i=1,a=1;r._cells.forEach((function(e){i=Math.max(i,e.row+e.rowspan);a=Math.max(a,e.col+e.colspan)}));r.rowspan=i;r.colspan=a;return r}_CellGroup.prototype._copy=function(e,t){var o=this;if("cells"==e){this._cells=[];isArray(t)&&t.forEach((function(e){var t=new _Cell(e);t.binding&&!t.header&&(t.header=toHeaderCase(t.binding));o._cells.push(t);o.colspan=Math.max(o.colspan,t.colspan)}));return!0}return!1};Object.defineProperty(_CellGroup.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});Object.defineProperty(_CellGroup.prototype,"isRowHeader",{get:function(){return this._isRowHeader},set:function(e){this._isRowHeader=asBoolean(e)},enumerable:!0,configurable:!0});_CellGroup.prototype.closeGroup=function(e){var t=this;if(e>this.rowspan){this._cells.forEach((function(o){o.row==t.rowspan-1&&(o.rowspan=e-o.row)}));this.rowspan=e}this._cells.forEach((function(e){for(;e.col+e.colspan<t.colspan&&!t._slotTaken(e.row,e.col+e.colspan);)e.colspan++}));this._cells.forEach((function(e){for(;e.row+e.rowspan<t.rowspan&&!t._slotTaken(e.row+e.rowspan,e.col);)e.rowspan++}));for(var o=0;o<this.rowspan;o++)for(var r=0;r<this.colspan;r++)assert(this._slotTaken(o,r),"Invalid layout (empty cells).");this._cols=new ColumnCollection(this._g,this._g.columns.defaultSize);this._rng=new Array(e*this.colspan);this._cells.forEach((function(e){for(var o=0;o<e.rowspan;o++)for(var r=0;r<e.colspan;r++){var n=(e.row+o)*t.colspan+e.col+r;t._cols.setAt(n,e);var l=new CellRange(0-o,0-r,0-o+e.rowspan-1,0-r+e.colspan-1);l.isSingleCell||(t._rng[n]=l)}}));var n=this._colstart;this._rng[-1]=new CellRange(0,n,0,n+this.colspan-1);this._hasAggregates=!1;for(var l=0;l<this._cells.length&&!this._hasAggregates;l++)this._hasAggregates=0!=this._cells[l].aggregate};_CellGroup.prototype.getColumnWidth=function(e){for(var t=0;t<this._cells.length;t++){var o=this._cells[t];if(o.col==e&&1==o.colspan)return o.width}return null};_CellGroup.prototype.getMergedRange=function(e,t,o){if(t<0)return this._rng[-1];var r=e.rows[t],n=null!=r.recordIndex?r.recordIndex:t%this.rowspan,l=o-this._colstart,i=this._rng[n*this.colspan+l];e.cellType==CellType.ColumnHeader&&t++;if(e.cellType==CellType.Cell&&r instanceof _MultiGroupRow){var a=e.grid;if(a.multiRowGroupHeaders&&!this._hasAggregates){var s=a._layout._bindingGroups,u=s.indexOf(this),p=a.rowsPerItem;(i=new CellRange(Math.floor(t/p)*p,this._colstart)).row2+=p-1;i.col2+=this.colspan-1;for(var c=u-1;c>=0&&!s[c]._hasAggregates;c--)i.col-=s[c].colspan;for(var d=u+1;d<s.length&&!s[d]._hasAggregates;d++)i.col2+=s[d].colspan;return i}}return i?new CellRange(t+i.row,o+i.col,t+i.row2,o+i.col2):null};_CellGroup.prototype.getBindingColumn=function(e,t,o){if(t<0)return this;var r=e.rows[t],n=r&&null!=r.recordIndex?r.recordIndex:t%this.rowspan,l=o-this._colstart;return this._cols[n*this.colspan+l]};_CellGroup.prototype.getColumn=function(e){return this._cols.getColumn(e)};_CellGroup.prototype._cellFits=function(e,t,o,r){if(r>0&&r+e.colspan>this.colspan)return!1;for(var n=0;n<e.colspan;n++)if(this._slotTaken(o,r+n,t))return!1;this.colspan=Math.max(this.colspan,r+e.colspan-1);return!0};_CellGroup.prototype._slotTaken=function(e,t,o){void 0===o&&(o=this._cells.length);for(var r=0;r<o;r++){var n=this._cells[r];if(e>=n.row&&e<=n.row+n.rowspan-1&&t>=n.col&&t<=n.col+n.colspan-1)return!0}return!1};return _CellGroup}(_Cell);export{_CellGroup};var _MergeManager=function(e){__extends(_MergeManager,e);function _MergeManager(){return null!==e&&e.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(t,o,r,n){void 0===n&&(n=!0);var l=t.grid;if(o<0||o>=t.rows.length||r<0||r>=t.columns.length)return null;switch(t.cellType){case CellType.Cell:case CellType.RowHeader:if(t.rows[o]instanceof GroupRow&&!l.multiRowGroupHeaders)return e.prototype.getMergedRange.call(this,t,o,r,n)}switch(t.cellType){case CellType.Cell:case CellType.ColumnHeader:var i=t.cellType==CellType.ColumnHeader,a=l._getGroupByColumn(r,i);assert(a instanceof _CellGroup,"Failed to get the group!");var s=i?a.getMergedRange(t,o-1,r):a.getMergedRange(t,o,r),u=t.columns.frozen;if(u&&s&&s.columnSpan>1&&s.col<u&&s.col2>=u){s=s.clone();r<u?s.col2=u-1:s.col=u}var p=t.rows.frozen;if(p&&s&&s.rowSpan>1&&t.cellType==CellType.Cell&&s.row<p&&s.row2>=p){s=s.clone();o<p?s.row2=p-1:s.row=p}assert(!s||s.contains(o,r),"Merged range must contain source cell");return s;case CellType.RowHeader:var c=l.rowsPerItem,d=o-t.rows[o].recordIndex,w=Math.min(d+c-1,t.rows.length-1);return new CellRange(d,0,w,t.columns.length-1);case CellType.TopLeft:return new CellRange(0,0,t.rows.length-1,t.columns.length-1)}return null};return _MergeManager}(MergeManager);export{_MergeManager};var _MultiRowLayout=function(){function _MultiRowLayout(e,t){this._rowsPerItem=1;this._bindingGroups=[];this._groupsByColumn={};this._grid=e;this._bindingGroups=this._parseCellGroups(t)}_MultiRowLayout.prototype._parseCellGroups=function(e){var t=[],o=1;if(e){for(var r=0,n=0;r<e.length;r++){var l=new _CellGroup(this,e[r]);l._colstart=n;n+=l._colspan;o=Math.max(o,l._rowspan);t.push(l)}t.forEach((function(e){e.closeGroup(o)}));this._rowsPerItem=o}return t};_MultiRowLayout.prototype._getGroupByColumn=function(e){var t=this._groupsByColumn[e];if(!t)for(var o=this._bindingGroups,r=0;r<o.length;r++)if(e>=(t=o[r])._colstart&&e<=t._colstart+t._colspan-1){this._groupsByColumn[e]=t;break}return t};_MultiRowLayout.prototype._updateCellTypes=function(e){this._bindingGroups.forEach((function(t){t._cols.forEach((function(t){null==t.dataType&&t._binding&&(t.dataType=getType(t._binding.getValue(e)));if(!t.isReadOnly){var o=isIE()?null:Object.getOwnPropertyDescriptor(e,t.binding);t.isReadOnly=o&&!o.writable&&!o.set}}))}))};return _MultiRowLayout}();export{_MultiRowLayout};_registerModule("wijmo.grid.multirow",selfModule);