/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();import{WjBinding,WjContext,MetaFactory}from"wijmo/wijmo.knockout.base";import*as mKo from"knockout";import*as wjcGrid from"wijmo/wijmo.grid";var wjKo=mKo,wjFlexGrid=function(t){__extends(wjFlexGrid,t);function wjFlexGrid(){return null!==t&&t.apply(this,arguments)||this}wjFlexGrid.prototype._getControlConstructor=function(){return wjcGrid.FlexGrid};wjFlexGrid.prototype._createWijmoContext=function(){return new WjFlexGridContext(this)};wjFlexGrid.prototype._initialize=function(){t.prototype._initialize.call(this);MetaFactory.findProp("itemFormatter",this._metaData.props).updateControl=this._formatterPropHandler};wjFlexGrid.prototype._formatterPropHandler=function(t,e,r,o,n){if(o!==t._userFormatter){t._userFormatter=o;r.invalidate()}return!0};wjFlexGrid._columnTemplateProp="_wjkoColumnTemplate";wjFlexGrid._cellClonedTemplateProp="__wjkoClonedTempl";wjFlexGrid._cellVMProp="__wjkoCellVM";wjFlexGrid._templColIdx="_wjkoTemplColIdx";wjFlexGrid._columnStyleBinding="wjStyle";wjFlexGrid._columnStyleProp="__wjkoStyle";return wjFlexGrid}(WjBinding);export{wjFlexGrid};var WjFlexGridContext=function(t){__extends(WjFlexGridContext,t);function WjFlexGridContext(){var e=null!==t&&t.apply(this,arguments)||this;e._wrapperFormatter=e._itemFormatter.bind(e);return e}WjFlexGridContext.prototype._initControl=function(){t.prototype._initControl.call(this);this.control.itemFormatter=this._wrapperFormatter};WjFlexGridContext.prototype._itemFormatter=function(t,e,r,o){var n=t.columns[r],l=n[wjFlexGrid._columnTemplateProp],i=n[wjFlexGrid._columnStyleProp];if((l||i)&&t.cellType==wjcGrid.CellType.Cell){var d=t.grid.editRange;if(d&&d.row===e&&d.col===r)return;if(t.rows[e]instanceof wjcGrid.GroupRow)return;var u=o[wjFlexGrid._cellVMProp],a=o[wjFlexGrid._cellClonedTemplateProp],p=t.rows[e].dataItem;if(u&&o[wjFlexGrid._templColIdx]!=r){o[wjFlexGrid._cellVMProp]=o[wjFlexGrid._cellClonedTemplateProp]=o[wjFlexGrid._templColIdx]=u=a=null;wjKo.cleanNode(o)}if(u){if(a){o.innerHTML="";o.appendChild(a)}u.$row(e);u.$col(r);u.$item()!=p?u.$item(p):u.$item.valueHasMutated()}else{u={$row:wjKo.observable(e),$col:wjKo.observable(r),$item:wjKo.observable(p)};var j=this.bindingContext.extend(u);if(l){o.innerHTML="<div>"+l+"</div>";var x=o.childNodes[0];o[wjFlexGrid._cellClonedTemplateProp]=x}else o.setAttribute("data-bind","style:"+i);o[wjFlexGrid._cellVMProp]=u;o[wjFlexGrid._templColIdx]=r;wjKo.applyBindings(j,o)}var w=o.scrollHeight;t.rows[e].renderHeight<w&&(t.rows.defaultSize=w)}else this._userFormatter&&this._userFormatter(t,e,r,o)};return WjFlexGridContext}(WjContext);export{WjFlexGridContext};var wjFlexGridColumn=function(t){__extends(wjFlexGridColumn,t);function wjFlexGridColumn(){return null!==t&&t.apply(this,arguments)||this}wjFlexGridColumn.prototype._getControlConstructor=function(){return wjcGrid.Column};wjFlexGridColumn.prototype._createControl=function(t){return new wjcGrid.Column};wjFlexGridColumn.prototype._createWijmoContext=function(){return new WjFlexGridColumnContext(this)};return wjFlexGridColumn}(WjBinding);export{wjFlexGridColumn};var WjFlexGridColumnContext=function(t){__extends(WjFlexGridColumnContext,t);function WjFlexGridColumnContext(){return null!==t&&t.apply(this,arguments)||this}WjFlexGridColumnContext.prototype._initControl=function(){var e=this.parentWjContext;if(e){var r=e.control;if(r.autoGenerateColumns){r.autoGenerateColumns=!1;r.columns.clear()}}t.prototype._initControl.call(this);var o=this.element.innerHTML.trim();this.control[wjFlexGrid._columnTemplateProp]=o;var n=this.allBindings.get(wjFlexGrid._columnStyleBinding);n&&(this.control[wjFlexGrid._columnStyleProp]=n.trim());(o||n)&&this.control._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.element.innerHTML=""};return WjFlexGridColumnContext}(WjContext);export{WjFlexGridColumnContext};var wjStyle=function(){function wjStyle(){this.preprocess=function(t,e,r){return wjStyle.quoteString(t)};this.init=function(){}}wjStyle.quoteString=function(t){return null==t?t:"'"+t.replace(/'/g,"\\'")+"'"};wjStyle.unquoteString=function(t){if(!t||t.length<2)return t;"'"===t.charAt(0)&&(t=t.substr(1,t.length-1));return t.replace(/\\\'/g,"'")};return wjStyle}();export{wjStyle};wjKo.bindingHandlers[wjFlexGrid._columnStyleBinding]=new wjStyle;wjKo.bindingHandlers.wjFlexGrid=new wjFlexGrid;wjKo.bindingHandlers.wjFlexGridColumn=new wjFlexGridColumn;