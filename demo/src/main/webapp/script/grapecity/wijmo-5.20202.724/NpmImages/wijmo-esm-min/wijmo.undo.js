/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();import{_getModule,CancelEventArgs,assert,isFunction,Control,CollectionView,DateTime,isArray,isDate,isString,asNumber,asBoolean,closest,hasClass,copy,getActiveElement,getEventOptions,Event,EventArgs,_registerModule}from"wijmo/wijmo";import*as selfModule from"wijmo/wijmo.undo";var UndoableAction=function(){function UndoableAction(t){this._target=t}UndoableAction.prototype.undo=function(){if(this._actions)for(var t=this._actions.length-1;t>=0;t--)this._actions[t].undo();this.applyState(this._oldState)};UndoableAction.prototype.redo=function(){this.applyState(this._newState);this._actions&&this._actions.forEach((function(t){t.redo()}))};UndoableAction.prototype.close=function(){return!0};UndoableAction.prototype.applyState=function(t){};UndoableAction.prototype.shouldAddAsChildAction=function(t){return!1};UndoableAction.prototype.addChildAction=function(t){this._actions||(this._actions=[]);this._actions.push(t)};Object.defineProperty(UndoableAction.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0});return UndoableAction}();export{UndoableAction};var _UndoStackHTML=function(){function _UndoStackHTML(){}_UndoStackHTML.addTarget=function(t,e){var n=!1;if(e instanceof HTMLInputElement){_UndoStackHTML._addInputElement(t,e);n=!0}else if(e instanceof HTMLTextAreaElement){_UndoStackHTML._addTextAreaElement(t,e);n=!0}else if(e instanceof HTMLSelectElement){_UndoStackHTML._addSelectElement(t,e);n=!0}else for(var i=0;i<e.children.length;i++){var o=e.children[i];t.addTarget(o)&&(n=!0)}return n};_UndoStackHTML._addInputElement=function(t,e){if("checkbox"==e.type)e.addEventListener("click",(function(e){t._pendingAction=new CheckboxClickAction(e);t.pushPendingAction()}));else if("radio"==e.type){e.addEventListener("mousedown",(function(e){t._pendingAction=new RadioClickAction(e)}),!0);var n=_UndoStackHTML._getLabel(e);n&&n.addEventListener("mousedown",(function(n){t._pendingAction=new RadioClickAction({target:e})}),!0);e.addEventListener("focus",(function(e){t._pendingAction instanceof RadioClickAction&&t._pendingAction.target==e.target||(t._pendingAction=new RadioClickAction(e))}));e.addEventListener("click",(function(e){t._pendingAction instanceof RadioClickAction&&t.pushPendingAction()}))}else{e.addEventListener("focus",(function(e){t._pendingAction=new InputChangeAction(e)}));e.addEventListener("blur",(function(e){t._pendingAction instanceof InputChangeAction&&t.pushPendingAction()}))}};_UndoStackHTML._addTextAreaElement=function(t,e){e.addEventListener("focus",(function(e){t._pendingAction=new InputChangeAction(e)}));e.addEventListener("blur",(function(e){t._pendingAction instanceof InputChangeAction&&t.pushPendingAction()}))};_UndoStackHTML._addSelectElement=function(t,e){e.addEventListener("focus",(function(e){t._pendingAction=new InputChangeAction(e)}));e.addEventListener("blur",(function(e){t._pendingAction instanceof InputChangeAction&&t.pushPendingAction()}))};_UndoStackHTML._getLabel=function(t){var e=t.parentElement;e instanceof HTMLLabelElement||(e=document.querySelector('label[for="'+t.id+'"'));return e};return _UndoStackHTML}();export{_UndoStackHTML};var InputChangeAction=function(t){__extends(InputChangeAction,t);function InputChangeAction(e){var n=t.call(this,e.target)||this;n._oldState=n._target.value;return n}InputChangeAction.prototype.close=function(){this._newState=this._target.value;return this._newState!=this._oldState};InputChangeAction.prototype.applyState=function(t){var e=this._target;e.value=t;e.dispatchEvent(UndoStack._evtInput);isFunction(e.select)?e.select():e.focus()};return InputChangeAction}(UndoableAction);export{InputChangeAction};var CheckboxClickAction=function(t){__extends(CheckboxClickAction,t);function CheckboxClickAction(e){var n=t.call(this,e.target)||this;assert("checkbox"==n._target.type,"checkbox expected");n._newState=n._target.checked;n._oldState=!n._newState;return n}CheckboxClickAction.prototype.applyState=function(t){this._target.checked=t;this._target.focus()};return CheckboxClickAction}(UndoableAction);export{CheckboxClickAction};var RadioClickAction=function(t){__extends(RadioClickAction,t);function RadioClickAction(e){var n=t.call(this,e.target)||this,i=n._target.type;assert("radio"==i,"radio button expected");n._oldState=n._getState();return n}RadioClickAction.prototype.close=function(){this._newState=this._getState();return this._newState!=this._oldState};RadioClickAction.prototype.applyState=function(t){if(t){t.checked=!0;t.focus()}};RadioClickAction.prototype._getState=function(){for(var t='input[name="'+this._target.name+'"]',e=document.querySelectorAll(t),n=0;n<e.length;n++)if(e[n].checked)return e[n];return null};return RadioClickAction}(UndoableAction);export{RadioClickAction};var UndoStack=function(){function UndoStack(t,e){var n=this;this._autoKbd=!0;this._stack=[];this._maxActions=1e3;this._ptr=0;this.addingTarget=new Event;this.addedTarget=new Event;this.addingAction=new Event;this.addedAction=new Event;this.undoingAction=new Event;this.undoneAction=new Event;this.redoingAction=new Event;this.redoneAction=new Event;this.stateChanged=new Event;UndoStack._evtInput=document.createEvent("HTMLEvents");UndoStack._evtInput.initEvent("input",!0,!1);copy(this,e);this.addTarget(t||"body");document.addEventListener("keydown",(function(t){if(n._autoKbd&&t.ctrlKey&&!t.defaultPrevented)switch(t.keyCode){case 90:if(n.canUndo){getActiveElement().blur();setTimeout((function(){return n.undo()}),100);t.preventDefault()}break;case 89:if(n.canRedo){getActiveElement().blur();setTimeout((function(){return n.redo()}),100);t.preventDefault()}}}),getEventOptions(!0,!1))}UndoStack.prototype.addTarget=function(t){var e=!1;if(isString(t)){for(var n=document.querySelectorAll(t),i=!1,o=0;o<n.length;o++)this.addTarget(n[o])&&(i=!0);return i}assert(t instanceof HTMLElement,"Undo target should be an HTML element");var r=new AddTargetEventArgs(t);r.cancel=hasClass(t,"wj-no-undo");if(this.onAddingTarget(r)){var c=Control.getControl(t);c&&(e=_UndoStackWijmo.addTarget(this,c));e||closest(t,".wj-control")||(e=_UndoStackHTML.addTarget(this,t));e&&this.onAddedTarget(r)}return e};Object.defineProperty(UndoStack.prototype,"autoKeyboard",{get:function(){return this._autoKbd},set:function(t){this._autoKbd=asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"isDisabled",{get:function(){return this._disabled},set:function(t){this._disabled=asBoolean(t)},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"maxActions",{get:function(){return this._maxActions},set:function(t){if(t!=this._maxActions){this._maxActions=asNumber(t,!1,!0);this.clear()}},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"actionCount",{get:function(){return this._stack.length},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"canUndo",{get:function(){return this._stack.length&&this._ptr>0&&!this._disabled},enumerable:!0,configurable:!0});Object.defineProperty(UndoStack.prototype,"canRedo",{get:function(){return this._stack.length&&this._ptr<this._stack.length&&!this._disabled},enumerable:!0,configurable:!0});UndoStack.prototype.undo=function(){if(this.canUndo){var t=this._stack[this._ptr-1],e=new UndoActionEventArgs(t);if(this.onUndoingAction(e)){this._ptr--;this._undoing=!0;t.undo();this._undoing=!1;this._pendingAction=null;this.onUndoneAction(e);this.onStateChanged()}}};UndoStack.prototype.redo=function(){if(this.canRedo){var t=this._stack[this._ptr],e=new UndoActionEventArgs(t);if(this.onRedoingAction(e)){this._ptr++;this._undoing=!0;t.redo();this._undoing=!1;this._pendingAction=null;this.onRedoneAction(e);this.onStateChanged()}}};UndoStack.prototype.clear=function(){this._ptr=0;this._stack.splice(0,this._stack.length);this.onStateChanged()};UndoStack.prototype.onAddingTarget=function(t){this.addingTarget.raise(this,t);return!t.cancel};UndoStack.prototype.onAddedTarget=function(t){this.addedTarget.raise(this,t)};UndoStack.prototype.onAddingAction=function(t){this.addingAction.raise(this,t);return!t.cancel};UndoStack.prototype.onAddedAction=function(t){this.addedAction.raise(this,t)};UndoStack.prototype.onUndoingAction=function(t){this.undoingAction.raise(this,t);return!t.cancel};UndoStack.prototype.onUndoneAction=function(t){this.undoneAction.raise(this,t)};UndoStack.prototype.onRedoingAction=function(t){this.redoingAction.raise(this,t);return!t.cancel};UndoStack.prototype.onRedoneAction=function(t){this.redoneAction.raise(this,t)};UndoStack.prototype.onStateChanged=function(){this.stateChanged.raise(this,EventArgs.empty)};UndoStack.prototype.pushPendingAction=function(){if(!this._disabled&&!this._undoing&&this._pendingAction&&this._pendingAction.close()){this._stack.splice(this._ptr,this._stack.length-this._ptr);assert(this._stack.length==this._ptr,"should be at the end of the stack");if(this._stack.length){var t=this._stack[this._ptr-1];if(t.shouldAddAsChildAction(this._pendingAction)){t.addChildAction(this._pendingAction);this._pendingAction=null;this.onStateChanged();return}}var e=new UndoActionEventArgs(this._pendingAction);if(!this.onAddingAction(e))return;this._stack.push(this._pendingAction);this._ptr++;this._pendingAction=null;var n=this._stack.length-this._maxActions;if(n>0){this._stack.splice(0,n);this._ptr-=n;assert(this._ptr>=0,"pointer should not be negative")}this.onStateChanged()}};return UndoStack}();export{UndoStack};var AddTargetEventArgs=function(t){__extends(AddTargetEventArgs,t);function AddTargetEventArgs(e){var n=t.call(this)||this;n._target=e;return n}Object.defineProperty(AddTargetEventArgs.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0});return AddTargetEventArgs}(CancelEventArgs);export{AddTargetEventArgs};var UndoActionEventArgs=function(t){__extends(UndoActionEventArgs,t);function UndoActionEventArgs(e){var n=t.call(this)||this;n._action=e;return n}Object.defineProperty(UndoActionEventArgs.prototype,"action",{get:function(){return this._action},enumerable:!0,configurable:!0});return UndoActionEventArgs}(CancelEventArgs);export{UndoActionEventArgs};export function softInput(){return _getModule("wijmo.input")}export function softGrid(){return _getModule("wijmo.grid")}export function softGauge(){return _getModule("wijmo.gauge")}export function softNav(){return _getModule("wijmo.nav")}var _UndoStackWijmo=function(){function _UndoStackWijmo(){}_UndoStackWijmo.addTarget=function(t,e){var n=_UndoStackWijmo;return softGrid()&&e instanceof softGrid().FlexGrid?n._addFlexGrid(t,e):softGauge()&&e instanceof softGauge().Gauge?n._addGauge(t,e):softNav()&&e instanceof softNav().TreeView?n._addTreeView(t,e):!!n._isInputControl(e)&&n._addInputControl(t,e)};_UndoStackWijmo._isInputControl=function(t){var e=softInput();return!!e&&(t instanceof e.DropDown||t instanceof e.InputMask||t instanceof e.InputNumber||t instanceof e.Calendar||t instanceof e.ColorPicker)};_UndoStackWijmo._addInputControl=function(t,e){var n=e.hostElement;n.addEventListener("focus",(function(){t._pendingAction instanceof InputControlChangeAction&&t._pendingAction.target==e||(t._pendingAction=new InputControlChangeAction({target:e}))}),!0);n.addEventListener("blur",(function(){t._pendingAction instanceof InputControlChangeAction&&!e.containsFocus()&&t.pushPendingAction()}),!0);return!0};_UndoStackWijmo._addGauge=function(t,e){if(!(softGauge()&&e instanceof softGauge().Gauge))return!1;if(e.isReadOnly)return!1;var n=e.hostElement;n.addEventListener("focus",(function(){t._pendingAction instanceof GaugeChangeAction&&t._pendingAction.target==e||(t._pendingAction=new GaugeChangeAction(e))}),!0);n.addEventListener("blur",(function(){t._pendingAction instanceof GaugeChangeAction&&!e.containsFocus()&&t.pushPendingAction()}),!0)};_UndoStackWijmo._addTreeView=function(t,e){if(!(softNav()&&e instanceof softNav().TreeView))return!1;e.nodeEditStarted.addHandler((function(e,n){t._pendingAction=new TreeViewEditAction(e,n)}));e.nodeEditEnded.addHandler((function(e,n){t._pendingAction instanceof TreeViewEditAction&&t.pushPendingAction()}));e.isCheckedChanging.addHandler((function(e,n){t._pendingAction=new TreeViewCheckAction(e,n)}));e.isCheckedChanged.addHandler((function(e,n){t._pendingAction instanceof TreeViewCheckAction&&t.pushPendingAction()}));return!0};_UndoStackWijmo._addFlexGrid=function(t,e){if(!(softGrid()&&e instanceof softGrid().FlexGrid))return!1;e.beginningEdit.addHandler((function(e,n){t._pendingAction=new GridEditAction(e,n)}));e.cellEditEnded.addHandler((function(e,n){t._pendingAction instanceof GridEditAction&&t.pushPendingAction()}));e.pastingCell.addHandler((function(e,n){t._pendingAction=new GridEditAction(e,n)}));e.pastedCell.addHandler((function(e,n){t._pendingAction instanceof GridEditAction&&t.pushPendingAction()}));e.sortingColumn.addHandler((function(e,n){t._pendingAction=new GridSortAction(e,n)}));e.sortedColumn.addHandler((function(e,n){t._pendingAction instanceof GridSortAction&&t.pushPendingAction()}));e.resizingColumn.addHandler((function(e,n){t._pendingAction instanceof GridResizeAction&&t._pendingAction.target==e||(t._pendingAction=new GridResizeAction(e,n))}));e.resizedColumn.addHandler((function(){t._pendingAction instanceof GridResizeAction&&t.pushPendingAction()}));e.autoSizingColumn.addHandler((function(e,n){t._pendingAction=new GridResizeAction(e,n)}));e.autoSizedColumn.addHandler((function(){t._pendingAction instanceof GridResizeAction&&t.pushPendingAction()}));e.draggingColumn.addHandler((function(e,n){t._pendingAction=new GridDragAction(e,n)}));e.draggedColumn.addHandler((function(e,n){t._pendingAction instanceof GridDragAction&&t.pushPendingAction()}));e.rowAdded.addHandler((function(e,n){if(!n.cancel){t._pendingAction=new GridAddRowAction(e,n);t.pushPendingAction()}}));e.deletingRow.addHandler((function(e,n){if(!n.cancel){t._pendingAction=new GridRemoveRowAction(e,n);t.pushPendingAction()}}));return!0};return _UndoStackWijmo}();export{_UndoStackWijmo};var InputControlChangeAction=function(t){__extends(InputControlChangeAction,t);function InputControlChangeAction(e){var n=t.call(this,e)||this;n._ctl=e.target;n._oldState=n._getControlState();return n}Object.defineProperty(InputControlChangeAction.prototype,"control",{get:function(){return this._ctl},enumerable:!0,configurable:!0});InputControlChangeAction.prototype.close=function(){this._timeStamp=Date.now();this._newState=this._getControlState();return!this._sameContent(this._oldState,this._newState)};InputControlChangeAction.prototype.shouldAddAsChildAction=function(t){if(t instanceof InputControlChangeAction&&t.target==this.target&&t._timeStamp-this._timeStamp<500){this._timeStamp=Date.now();return!0}return!1};InputControlChangeAction.prototype.applyState=function(t){var e=this._ctl,n=softInput();if(n){e instanceof n.MultiSelect?e.checkedItems=t:e instanceof n.MultiAutoComplete?e.selectedItems=t:"value"in e?e.value=t:"text"in e?e.text=t:assert(!1,"can't get control state?");e.focus()}};InputControlChangeAction.prototype._getControlState=function(){var t=this._ctl,e=softInput();if(e){if(t instanceof e.MultiSelect)return t.checkedItems.slice();if(t instanceof e.MultiAutoComplete)return t.selectedItems.slice();if("value"in t)return t.value;if("text"in t)return t.text;assert(!1,"can't get control state?")}};InputControlChangeAction.prototype._sameContent=function(t,e){if(isArray(t)&&isArray(e)){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}return isDate(t)||isDate(e)?DateTime.sameDate(t,e):t==e};return InputControlChangeAction}(InputChangeAction),GaugeChangeAction=function(t){__extends(GaugeChangeAction,t);function GaugeChangeAction(e){var n=t.call(this,e)||this;n._oldState=e.value;return n}Object.defineProperty(GaugeChangeAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});GaugeChangeAction.prototype.close=function(){this._newState=this._target.value;return this._newState!=this._oldState};GaugeChangeAction.prototype.applyState=function(t){var e=this._target;e.value=t;e.focus()};return GaugeChangeAction}(UndoableAction),GridEditAction=function(t){__extends(GridEditAction,t);function GridEditAction(e,n){var i=t.call(this,e)||this,o=e.collectionView;i._row=n.row;i._col=n.col;i._dataItem=e.rows[n.row].dataItem;i._page=o instanceof CollectionView?o.pageIndex:-1;i._oldState=e.getCellData(n.row,n.col,!1);return i}Object.defineProperty(GridEditAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(GridEditAction.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0});Object.defineProperty(GridEditAction.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0});Object.defineProperty(GridEditAction.prototype,"dataItem",{get:function(){return this._dataItem},enumerable:!0,configurable:!0});GridEditAction.prototype.close=function(){var t=this._target.collectionView;if(t&&t.currentAddItem)return!1;this._timeStamp=Date.now();this._newState=this._target.getCellData(this._row,this._col,!1);return this._newState!=this._oldState};GridEditAction.prototype.applyState=function(t){var e=this._target,n=e.collectionView,i=e.columns[this._col],o=e._getBindingColumn(e.cells,this._row,i);if(o&&o._binding&&n){n instanceof CollectionView&&this._page>-1&&n.moveToPage(this._page);var r=this._dataItem;o._binding.setValue(r,t);n.refresh();n.moveCurrentTo(r)}e.focus()};GridEditAction.prototype.shouldAddAsChildAction=function(t){return t instanceof GridEditAction&&t.target==this.target&&t._timeStamp-this._timeStamp<100};return GridEditAction}(UndoableAction),GridSortAction=function(t){__extends(GridSortAction,t);function GridSortAction(e,n){var i=t.call(this,e)||this,o=i._target.collectionView;o&&(i._oldState=o.sortDescriptions.slice());return i}Object.defineProperty(GridSortAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});GridSortAction.prototype.close=function(){var t=this._target.collectionView;if(t){this._newState=t.sortDescriptions.slice();return!0}return!1};GridSortAction.prototype.applyState=function(t){var e=this._target.collectionView;e&&e.deferUpdate((function(){var n=e.sortDescriptions;n.clear();t.forEach((function(t){n.push(t)}))}));this._target.focus()};return GridSortAction}(UndoableAction),GridResizeAction=function(t){__extends(GridResizeAction,t);function GridResizeAction(e,n){var i=t.call(this,e)||this;i._col=e.columns[n.col];i._oldState=i._col.renderWidth;return i}Object.defineProperty(GridResizeAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(GridResizeAction.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0});GridResizeAction.prototype.close=function(){this._newState=this._col.renderWidth;return this._newState!=this._oldState};GridResizeAction.prototype.applyState=function(t){this._col.width=t;this._target.focus()};return GridResizeAction}(UndoableAction),GridDragAction=function(t){__extends(GridDragAction,t);function GridDragAction(e,n){var i=t.call(this,e)||this;i._col=e.columns[n.col];i._oldState=e.columns.indexOf(i._col);return i}Object.defineProperty(GridDragAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(GridDragAction.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0});GridDragAction.prototype.close=function(){this._newState=this._col.grid.columns.indexOf(this._col);return this._newState!=this._oldState};GridDragAction.prototype.applyState=function(t){var e=this,n=this._col.grid.columns;n.deferUpdate((function(){n.remove(e._col);n.insert(t,e._col)}));this._target.focus()};return GridDragAction}(UndoableAction),GridAddRowAction=function(t){__extends(GridAddRowAction,t);function GridAddRowAction(e,n){var i=t.call(this,e)||this,o=i._target.collectionView;if(o&&o.currentAddItem){var r=o.currentAddItem,c=o.sourceCollection.indexOf(r),a=o.currentPosition;i._oldState={item:r,index:c,position:a};i._newState={index:c,position:a}}return i}Object.defineProperty(GridAddRowAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});GridAddRowAction.prototype.close=function(){return null!=this._oldState};GridAddRowAction.prototype.applyState=function(t){var e=this._target.collectionView;if(e){var n=e.sourceCollection;if(t.item){n.splice(t.index,1);if(e instanceof CollectionView&&e.trackChanges){var i=t.item;assert(e.itemsAdded.indexOf(i)>-1,"item should be in the itemsAdded list");e.itemsAdded.remove(i)}}else{i=this._oldState.item;n.splice(t.index,0,i);if(e instanceof CollectionView&&e.trackChanges){assert(e.itemsAdded.indexOf(i)<0,"item should not be in the itemsAdded list");e.itemsAdded.push(i)}}e.refresh();e.moveCurrentToPosition(t.position);this._target.focus()}};return GridAddRowAction}(UndoableAction),GridRemoveRowAction=function(t){__extends(GridRemoveRowAction,t);function GridRemoveRowAction(e,n){var i=t.call(this,e)||this,o=i._target.collectionView;if(o){var r=e.rows[n.row].dataItem,c=o.sourceCollection.indexOf(r),a=o.currentPosition;i._oldState={item:r,index:c,position:a};i._newState={index:c,position:a}}return i}Object.defineProperty(GridRemoveRowAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(GridRemoveRowAction.prototype,"dataItem",{get:function(){return this._oldState.item},enumerable:!0,configurable:!0});GridRemoveRowAction.prototype.close=function(){this._timeStamp=Date.now();return null!=this._oldState};GridRemoveRowAction.prototype.applyState=function(t){var e=this._target,n=e.collectionView;if(n){var i=n.sourceCollection;if(t.item){i.splice(t.index,0,t.item);if(n instanceof CollectionView&&n.trackChanges){var o=t.item;assert(n.itemsRemoved.indexOf(o)>-1,"item should be in the itemsRemoved list");n.itemsRemoved.remove(o)}}else{i.splice(t.index,1);if(n instanceof CollectionView&&n.trackChanges){o=this._oldState.item;assert(n.itemsRemoved.indexOf(o)<0,"item should not be in the itemsRemoved list");n.itemsRemoved.push(o)}}n.refresh();n.moveCurrentToPosition(t.position);var r=new(softGrid().CellRange)(t.position,0,t.position,e.columns.length-1);e.select(r);e.focus()}};GridRemoveRowAction.prototype.shouldAddAsChildAction=function(t){return t instanceof GridRemoveRowAction&&t.target==this.target&&t._timeStamp-this._timeStamp<100};return GridRemoveRowAction}(UndoableAction),TreeViewEditAction=function(t){__extends(TreeViewEditAction,t);function TreeViewEditAction(e,n){var i=t.call(this,e)||this;i._nd=n.node;i._oldState=i._getNodeText();return i}Object.defineProperty(TreeViewEditAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(TreeViewEditAction.prototype,"node",{get:function(){return this._nd},enumerable:!0,configurable:!0});TreeViewEditAction.prototype.close=function(){this._newState=this._getNodeText();return this._newState!=this._oldState};TreeViewEditAction.prototype.applyState=function(t){this._nd.select();this._setNodeText(t);this._target.focus()};TreeViewEditAction.prototype._getNodeText=function(){var t=this._nd.dataItem[this._getDisplayMemberPath()];return null!=t?t.toString():""};TreeViewEditAction.prototype._setNodeText=function(t){var e=this._nd,n=e.dataItem,i=this._getDisplayMemberPath(),o=e.element.querySelector(".wj-node-text");n[i]=t;e.treeView.isContentHtml?o.innerHTML=t:o.textContent=t};TreeViewEditAction.prototype._getDisplayMemberPath=function(){var t=this._nd,e=t.treeView.displayMemberPath;e instanceof Array&&(e=e[t.level]);return e};return TreeViewEditAction}(UndoableAction),TreeViewCheckAction=function(t){__extends(TreeViewCheckAction,t);function TreeViewCheckAction(e,n){var i=t.call(this,e)||this;i._nd=n.node;i._oldState=i._nd.isChecked;return i}Object.defineProperty(TreeViewCheckAction.prototype,"control",{get:function(){return this._target},enumerable:!0,configurable:!0});Object.defineProperty(TreeViewCheckAction.prototype,"node",{get:function(){return this._nd},enumerable:!0,configurable:!0});TreeViewCheckAction.prototype.close=function(){this._newState=this._nd.isChecked;return this._newState!=this._oldState};TreeViewCheckAction.prototype.applyState=function(t){this._nd.select();this._nd.isChecked=t;this._target.focus()};return TreeViewCheckAction}(UndoableAction);_registerModule("wijmo.undo",selfModule);