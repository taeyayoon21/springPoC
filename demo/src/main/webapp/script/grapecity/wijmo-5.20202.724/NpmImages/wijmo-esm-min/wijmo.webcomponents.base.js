/*!
    *
    * Wijmo Library 5.20202.724
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{Control,isArray,addClass}from"wijmo/wijmo";import{ControlMetaFactory,PropertyType}from"wijmo/wijmo.meta";!function(){var t=document.createElement("style");t.innerHTML=".wj-web-component {\n            display: inline-block;\n        }";document.head.insertBefore(t,document.head.firstElementChild)}();var WjComponentBehavior=function(){function WjComponentBehavior(t){this._isMounted=!1;this._mountedCBs=[];this._isDomInitialized=!1;this._initialValues=[];this.component=t;this.isWrapper||(this.control=t)}WjComponentBehavior._attach=function(t){return new this(t)};WjComponentBehavior.register=function(t,e){if(null!=e){var o=!!t;if(this._registered.indexOf(e)<0){this._registered.push(e);window.customElements.define(o?t:"wjc-dummy-"+ ++this._cmpRegId,e)}else if(o)throw"Wijmo WebComponents error: component '"+t+"' is already registered.";if(e.wrappedClass){if(o)for(var _loop_1=function(t){var o=t.propertyName;if(t.isNativeControlProperty){o in HTMLElement.prototype&&console.log("WARNING: Wijmo WebComponent '"+e.name+"' exposes the '"+o+"' property which coinsides with the HTMLElement class member.");Object.defineProperty(e.prototype,o,{get:function(){return this.control[o]},set:function(t){this.control[o]=t},enumerable:!0,configurable:!0})}},n=0,r=this._getMetaData(e).props;n<r.length;n++){_loop_1(r[n])}}else for(var i=Object.getPrototypeOf(e.prototype).constructor;i.prototype!==HTMLElement.prototype&&this._registered.indexOf(i)<0;i=Object.getPrototypeOf(i.prototype).constructor){var a="wjc-dummy-"+ ++this._cmpRegId;this._registered.push(i);window.customElements.define(a,i)}}};WjComponentBehavior.getProps=function(t){this._ensureMetadata(t);return t._props};WjComponentBehavior.ensureNs=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];for(var n=t.split("."),r=window,i=!0,a=0,p=n;a<p.length;a++){var s=p[a],h=r[s];if(!h){h=r[s]={};i=!1}r=h}if(e)for(var l=0,m=e;l<m.length;l++){var c=m[l];if(c&&!r[c]){r[c]=null;i=!1}}return i};Object.defineProperty(WjComponentBehavior.prototype,"isWrapper",{get:function(){return null!=this.component.constructor.wrappedClass},enumerable:!0,configurable:!0});WjComponentBehavior.prototype.lhConnected=function(){this.parentComponent=this.component.parentElement;this._prepareControl();this._isChild()&&this._initParent()};WjComponentBehavior.prototype.lhDisconnected=function(){var t=this.control;if(t&&this._isChild()){var e=this._getParentProp();if(e){var o=this.parentComponent[e];if(isArray(o)){var n=o.indexOf(t);n>-1&&o.splice(n,1)}}}this.parentComponent=null};WjComponentBehavior.prototype.lhAttributeChanged=function(t,e,o){this._onAttributeChanged(t,e,o)};WjComponentBehavior.prototype._initParent=function(){this._callCmpMethod(WjComponentBehavior._beforeInitParent);var t=this._getParentProp();if(t){var e=this.parentComponent.control,o=e[t];if(isArray(o)){var n=this._getSiblingIndex();(n<0||n>=o.length)&&(n=o.length);o.splice(n,0,this.control)}else e[t]=this.control}this._callCmpMethod(WjComponentBehavior._afterInitParent)};WjComponentBehavior.prototype._prepareControl=function(){if(!this._isDomInitialized){var t=this.component.constructor,e=this.component,o=this.control=t.wrappedClass?this._createControl():e;e.control=o;addClass(e,"wj-web-component");if(e instanceof Control&&o.hostElement!==e){var n=o.hostElement;n.style.height="100%";n.style.width="100%"}this._isChild()&&(e.style.display="none");this._initDom();if(!this._siblingId){null==t.siblingId&&(t.siblingId=++WjComponentBehavior._siblingDirId+"");this._siblingId=t.siblingId}e.setAttribute(WjComponentBehavior._typeSiblingIdAttr,this._siblingId);this._flushInitialValues();this._initEvents()}};WjComponentBehavior.prototype._initDom=function(){if(!this._isDomInitialized){this._isDomInitialized=!0;var t=this.control,e=this.component;t instanceof Control&&t.hostElement!==e&&e.appendChild(t.hostElement)}};WjComponentBehavior.prototype._createControl=function(){var t=this._isChild()?this._isParentInCtor()?this.parentComponent.control:void 0:this._getElement();return new(WjComponentBehavior._getControlType(this.component.constructor))(t)};WjComponentBehavior.prototype._initEvents=function(){var t=this,e=WjComponentBehavior._getMetaData(this.component.constructor);if(e)for(var o=0,n=e.events;o<n.length;o++){!function(e){t.control[e.eventName].addHandler((function(o,n){t.component.dispatchEvent(new CustomEvent(WjComponentBehavior.toDash(e.eventName),{detail:n}))}))}(n[o])}};WjComponentBehavior.prototype._onAttributeChanged=function(t,e,o){var n=this.control;if(e!=o)if(n){this._initialValues&&this._flushInitialValues();var r=WjComponentBehavior,i=r._getPropsMetaData(this.component.constructor),a=t,p=r.toCamelCase(t),s=i[a];null!=s&&(o=s.castValueToType(o));n[p]!==o&&(n[p]=o)}else this._initialValues&&this._initialValues.push({name:t,oldValue:e,newValue:o})};WjComponentBehavior.prototype._flushInitialValues=function(){var t=this._initialValues;if(t){this._initialValues=null;for(var e=0,o=t;e<o.length;e++){var n=o[e];this._onAttributeChanged(n.name,n.oldValue,n.newValue)}}};WjComponentBehavior.prototype._isChild=function(){var t=this.component.constructor;return null!=t.parentProp||null!=t.parentInCtor};WjComponentBehavior.prototype._isParentInCtor=function(){return!0===this.component.constructor.parentInCtor};WjComponentBehavior.prototype._getParentProp=function(){return this.component.getAttribute("wj-property")||this.component.constructor.parentProp};WjComponentBehavior.prototype._getSiblingIndex=function(){var t=this._getElement(),e=t.parentElement;if(!e)return-1;for(var o=e.childNodes,n=-1,r=this._siblingId,i=0;i<o.length;i++){var a=o[i];if(1==a.nodeType&&a.getAttribute(WjComponentBehavior._typeSiblingIdAttr)==r){++n;if(a===t)return n}}return-1};WjComponentBehavior.prototype._getElement=function(){return this.component};WjComponentBehavior._getControlType=function(t){return t.wrappedClass?t.wrappedClass():Object.getPrototypeOf(t.prototype).constructor};WjComponentBehavior._getMetaDataId=function(t){return this._getControlType(t)};WjComponentBehavior._getMetaData=function(t){this._ensureMetadata(t);return t._meta};WjComponentBehavior._getPropsMetaData=function(t){this._ensureMetadata(t);return t._propsMeta};WjComponentBehavior._ensureMetadata=function(t){if(!t._meta){var e=this._getMetaDataId(t);if(e){var o=t._meta=ControlMetaFactory.getMetaData(e);o.prepare();for(var n=t._propsMeta={},r=o.props,i=t._props=[],a=0,p=r;a<p.length;a++){var s=p[a];if(s.propertyType<=PropertyType.Enum){var h=WjComponentBehavior.toDash(s.propertyName);n[h]=s;i.push(h)}}}}};WjComponentBehavior.prototype._callCmpMethod=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this.component,r=n[t];"function"==typeof r&&r.apply(n,e)};WjComponentBehavior.toCamelCase=function(t){return ControlMetaFactory.toCamelCase(t)};WjComponentBehavior.toDash=function(t){return t.replace(/([A-Z])/g,(function(t){return"-"+t[0].toLowerCase()}))};WjComponentBehavior._typeSiblingIdAttr="_wjSiblingId";WjComponentBehavior._behClassProp="_wjBehCl";WjComponentBehavior._behProp="_wjBehaviour";WjComponentBehavior._beforeInitParent="_beforeInitParent";WjComponentBehavior._afterInitParent="_afterInitParent";WjComponentBehavior._siblingDirId=0;WjComponentBehavior._cmpRegId=0;WjComponentBehavior._registered=[];return WjComponentBehavior}();export{WjComponentBehavior};